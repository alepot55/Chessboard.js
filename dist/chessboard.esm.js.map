{"version":3,"file":"chessboard.esm.js","sources":["../src/constants/positions.js","../src/errors/messages.js","../src/errors/ChessboardError.js","../src/services/ValidationService.js","../src/core/ChessboardConfig.js","../src/components/Piece.js","../src/components/Square.js","../src/components/Move.js","../src/services/AnimationService.js","../src/services/BoardService.js","../src/services/CoordinateService.js","../src/utils/cross-browser.js","../src/services/EventService.js","../src/services/MoveService.js","../src/services/PieceService.js","../src/utils/chess.js","../src/services/PositionService.js","../src/utils/performance.js","../src/modes/BaseMode.js","../src/modes/CreativeMode.js","../src/modes/PvPMode.js","../src/ai/ChessAI.js","../src/modes/VsBotMode.js","../src/modes/ModeManager.js","../src/core/Chessboard.js","../src/utils/logger.js","../src/core/ChessboardFactory.js","../src/core/index.js","../src/utils/coordinates.js","../src/utils/validation.js","../src/utils/animations.js","../src/engines/BaseEngine.js","../src/engines/StockfishEngine.js","../src/engines/UCIEngine.js","../src/engines/CloudEngine.js","../src/engines/EngineManager.js","../src/index.js"],"sourcesContent":["/**\n * Standard chess positions and FEN constants\n * @module constants/positions\n * @since 2.0.0\n */\n\n/**\n * Standard chess positions used throughout the application\n * @type {Object.<string, string>}\n * @readonly\n */\nexport const STANDARD_POSITIONS = {\n    'start': 'start',\n    'default': 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',\n    'empty': '8/8/8/8/8/8/8/8 w - - 0 1'\n};\n\n/**\n * Default starting position FEN string\n * @type {string}\n * @readonly\n */\nexport const DEFAULT_STARTING_POSITION = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';\n\n/**\n * Chess piece types\n * @type {string[]}\n * @readonly\n */\nexport const PIECE_TYPES = ['p', 'r', 'n', 'b', 'q', 'k'];\n\n/**\n * Chess piece colors\n * @type {string[]}\n * @readonly\n */\nexport const PIECE_COLORS = ['w', 'b'];\n\n/**\n * Valid promotion pieces\n * @type {string[]}\n * @readonly\n */\nexport const PROMOTION_PIECES = ['q', 'r', 'b', 'n'];\n\n/**\n * Board coordinates letters\n * @type {string}\n * @readonly\n */\nexport const BOARD_LETTERS = 'abcdefgh';\n\n/**\n * Board size constants\n * @type {Object}\n * @readonly\n */\nexport const BOARD_SIZE = {\n    ROWS: 8,\n    COLS: 8,\n    TOTAL_SQUARES: 64\n};\n","/**\n * Error messages and error handling utilities\n * @module errors/messages\n * @since 2.0.0\n */\n\n/**\n * Error codes for categorizing different types of errors\n * @type {Object.<string, string>}\n * @readonly\n */\nexport const ERROR_CODES = Object.freeze({\n    VALIDATION_ERROR: 'VALIDATION_ERROR',\n    CONFIG_ERROR: 'CONFIG_ERROR',\n    MOVE_ERROR: 'MOVE_ERROR',\n    DOM_ERROR: 'DOM_ERROR',\n    ANIMATION_ERROR: 'ANIMATION_ERROR',\n    PIECE_ERROR: 'PIECE_ERROR',\n    INITIALIZATION_ERROR: 'INITIALIZATION_ERROR',\n    POSITION_ERROR: 'POSITION_ERROR',\n    FEN_ERROR: 'FEN_ERROR',\n    SQUARE_ERROR: 'SQUARE_ERROR',\n    THEME_ERROR: 'THEME_ERROR',\n    NETWORK_ERROR: 'NETWORK_ERROR'\n});\n\n/**\n * Standardized error messages for the chessboard application\n * @type {Object.<string, string>}\n * @readonly\n */\nexport const ERROR_MESSAGES = Object.freeze({\n    // Position and FEN related\n    invalid_position: 'Invalid position: ',\n    invalid_fen: 'Invalid FEN string: ',\n    position_load_failed: 'Failed to load position: ',\n    \n    // DOM and UI related\n    invalid_id_div: 'Board container not found: ',\n    invalid_value: 'Invalid value: ',\n    dom_operation_failed: 'DOM operation failed: ',\n    element_not_found: 'Element not found: ',\n    \n    // Piece related\n    invalid_piece: 'Invalid piece notation: ',\n    invalid_square: 'Invalid square notation: ',\n    invalid_piecesPath: 'Invalid pieces path: ',\n    piece_operation_failed: 'Piece operation failed: ',\n    \n    // Board configuration\n    invalid_orientation: 'Invalid orientation: ',\n    invalid_color: 'Invalid color: ',\n    invalid_mode: 'Invalid mode: ',\n    invalid_dropOffBoard: 'Invalid dropOffBoard setting: ',\n    invalid_size: 'Invalid size: ',\n    invalid_movableColors: 'Invalid movableColors setting: ',\n    \n    // Animation related\n    invalid_snapbackTime: 'Invalid snapbackTime: ',\n    invalid_snapbackAnimation: 'Invalid snapbackAnimation: ',\n    invalid_fadeTime: 'Invalid fadeTime: ',\n    invalid_fadeAnimation: 'Invalid fadeAnimation: ',\n    invalid_ratio: 'Invalid ratio: ',\n    invalid_animationStyle: 'Invalid animationStyle: ',\n    animation_failed: 'Animation failed: ',\n    \n    // Event handlers\n    invalid_onMove: 'Invalid onMove callback: ',\n    invalid_onMoveEnd: 'Invalid onMoveEnd callback: ',\n    invalid_onChange: 'Invalid onChange callback: ',\n    invalid_onDragStart: 'Invalid onDragStart callback: ',\n    invalid_onDragMove: 'Invalid onDragMove callback: ',\n    invalid_onDrop: 'Invalid onDrop callback: ',\n    invalid_onSnapbackEnd: 'Invalid onSnapbackEnd callback: ',\n    callback_execution_failed: 'Callback execution failed: ',\n    \n    // Visual styling\n    invalid_whiteSquare: 'Invalid whiteSquare color: ',\n    invalid_blackSquare: 'Invalid blackSquare color: ',\n    invalid_highlight: 'Invalid highlight color: ',\n    invalid_selectedSquareWhite: 'Invalid selectedSquareWhite color: ',\n    invalid_selectedSquareBlack: 'Invalid selectedSquareBlack color: ',\n    invalid_movedSquareWhite: 'Invalid movedSquareWhite color: ',\n    invalid_movedSquareBlack: 'Invalid movedSquareBlack color: ',\n    invalid_choiceSquare: 'Invalid choiceSquare color: ',\n    invalid_coverSquare: 'Invalid coverSquare color: ',\n    invalid_hintColor: 'Invalid hintColor: ',\n    \n    // Move related\n    invalid_move: 'Invalid move: ',\n    invalid_move_format: 'Invalid move format: ',\n    move_execution_failed: 'Move execution failed: ',\n    illegal_move: 'Illegal move: ',\n    square_no_piece: 'No piece found on square: ',\n    move_validation_failed: 'Move validation failed: ',\n    \n    // Game state\n    game_over: 'Game is over',\n    invalid_turn: 'Invalid turn: ',\n    position_validation_failed: 'Position validation failed: ',\n    \n    // Theme and assets\n    theme_load_failed: 'Theme loading failed: ',\n    asset_load_failed: 'Asset loading failed: ',\n    invalid_theme: 'Invalid theme: ',\n    \n    // Network and resources\n    network_error: 'Network error: ',\n    resource_not_found: 'Resource not found: ',\n    timeout_error: 'Operation timed out: ',\n    \n    // General errors\n    initialization_failed: 'Initialization failed: ',\n    operation_failed: 'Operation failed: ',\n    invalid_state: 'Invalid state: ',\n    memory_limit_exceeded: 'Memory limit exceeded',\n    performance_degraded: 'Performance degraded: '\n});\n\n/**\n * Error severity levels\n * @type {Object.<string, string>}\n * @readonly\n */\nexport const ERROR_SEVERITY = Object.freeze({\n    LOW: 'LOW',\n    MEDIUM: 'MEDIUM',\n    HIGH: 'HIGH',\n    CRITICAL: 'CRITICAL'\n});\n\n/**\n * Maps error codes to their severity levels\n * @type {Object.<string, string>}\n * @readonly\n */\nexport const ERROR_SEVERITY_MAP = Object.freeze({\n    [ERROR_CODES.VALIDATION_ERROR]: ERROR_SEVERITY.MEDIUM,\n    [ERROR_CODES.CONFIG_ERROR]: ERROR_SEVERITY.HIGH,\n    [ERROR_CODES.MOVE_ERROR]: ERROR_SEVERITY.LOW,\n    [ERROR_CODES.DOM_ERROR]: ERROR_SEVERITY.HIGH,\n    [ERROR_CODES.ANIMATION_ERROR]: ERROR_SEVERITY.LOW,\n    [ERROR_CODES.PIECE_ERROR]: ERROR_SEVERITY.MEDIUM,\n    [ERROR_CODES.INITIALIZATION_ERROR]: ERROR_SEVERITY.CRITICAL,\n    [ERROR_CODES.POSITION_ERROR]: ERROR_SEVERITY.MEDIUM,\n    [ERROR_CODES.FEN_ERROR]: ERROR_SEVERITY.MEDIUM,\n    [ERROR_CODES.SQUARE_ERROR]: ERROR_SEVERITY.MEDIUM,\n    [ERROR_CODES.THEME_ERROR]: ERROR_SEVERITY.LOW,\n    [ERROR_CODES.NETWORK_ERROR]: ERROR_SEVERITY.MEDIUM\n});\n\n/**\n * Utility function to get error severity\n * @param {string} errorCode - Error code\n * @returns {string} Error severity level\n */\nexport function getErrorSeverity(errorCode) {\n    return ERROR_SEVERITY_MAP[errorCode] || ERROR_SEVERITY.MEDIUM;\n}\n\n/**\n * Utility function to format error message\n * @param {string} messageKey - Message key from ERROR_MESSAGES\n * @param {string} [details] - Additional details\n * @returns {string} Formatted error message\n */\nexport function formatErrorMessage(messageKey, details = '') {\n    const message = ERROR_MESSAGES[messageKey];\n    if (!message) {\n        return `Unknown error: ${messageKey}${details ? ` - ${details}` : ''}`;\n    }\n    return `${message}${details}`;\n}\n\n/**\n * Utility function to create error context\n * @param {string} operation - Operation that failed\n * @param {Object} [data] - Additional context data\n * @returns {Object} Error context object\n */\nexport function createErrorContext(operation, data = {}) {\n    return {\n        operation,\n        timestamp: new Date().toISOString(),\n        userAgent: typeof navigator !== 'undefined' ? navigator.userAgent : 'Unknown',\n        url: typeof window !== 'undefined' ? window.location.href : 'Unknown',\n        ...data\n    };\n}\n","/**\n * Custom error classes for better error handling\n * @module errors/ChessboardError\n * @since 2.0.0\n */\n\nimport { ERROR_CODES } from './messages.js';\n\n/**\n * Base error class for all chessboard-related errors\n * @class\n * @extends Error\n */\nexport class ChessboardError extends Error {\n    /**\n     * Creates a new ChessboardError instance\n     * @param {string} message - Error message\n     * @param {string} code - Error code from ERROR_CODES\n     * @param {Object} [context={}] - Additional context information\n     */\n    constructor(message, code, context = {}) {\n        super(message);\n        this.name = 'ChessboardError';\n        this.code = code;\n        this.context = context;\n        this.timestamp = new Date().toISOString();\n        \n        // Maintain stack trace for debugging\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, ChessboardError);\n        }\n    }\n}\n\n/**\n * Error thrown when validation fails\n * @class\n * @extends ChessboardError\n */\nexport class ValidationError extends ChessboardError {\n    /**\n     * Creates a new ValidationError instance\n     * @param {string} message - Error message\n     * @param {string} field - Field that failed validation\n     * @param {*} value - Value that failed validation\n     */\n    constructor(message, field, value) {\n        super(message, ERROR_CODES.VALIDATION_ERROR, { field, value });\n        this.name = 'ValidationError';\n        this.field = field;\n        this.value = value;\n    }\n}\n\n/**\n * Error thrown when configuration is invalid\n * @class\n * @extends ChessboardError\n */\nexport class ConfigurationError extends ChessboardError {\n    /**\n     * Creates a new ConfigurationError instance\n     * @param {string} message - Error message\n     * @param {string} configKey - Configuration key that is invalid\n     * @param {*} configValue - Configuration value that is invalid\n     */\n    constructor(message, configKey, configValue) {\n        super(message, ERROR_CODES.CONFIG_ERROR, { configKey, configValue });\n        this.name = 'ConfigurationError';\n        this.configKey = configKey;\n        this.configValue = configValue;\n    }\n}\n\n/**\n * Error thrown when a move is invalid or fails\n * @class\n * @extends ChessboardError\n */\nexport class MoveError extends ChessboardError {\n    /**\n     * Creates a new MoveError instance\n     * @param {string} message - Error message\n     * @param {string} from - Source square\n     * @param {string} to - Target square\n     * @param {string} [piece] - Piece being moved\n     */\n    constructor(message, from, to, piece) {\n        super(message, ERROR_CODES.MOVE_ERROR, { from, to, piece });\n        this.name = 'MoveError';\n        this.from = from;\n        this.to = to;\n        this.piece = piece;\n    }\n}\n\n/**\n * Error thrown when DOM operations fail\n * @class\n * @extends ChessboardError\n */\nexport class DOMError extends ChessboardError {\n    /**\n     * Creates a new DOMError instance\n     * @param {string} message - Error message\n     * @param {string} elementId - Element ID that caused the error\n     */\n    constructor(message, elementId) {\n        super(message, ERROR_CODES.DOM_ERROR, { elementId });\n        this.name = 'DOMError';\n        this.elementId = elementId;\n    }\n}\n\n/**\n * Error thrown when piece operations fail\n * @class\n * @extends ChessboardError\n */\nexport class PieceError extends ChessboardError {\n    /**\n     * Creates a new PieceError instance\n     * @param {string} message - Error message\n     * @param {string} pieceId - Piece ID that caused the error\n     * @param {string} [square] - Square where the error occurred\n     */\n    constructor(message, pieceId, square) {\n        super(message, ERROR_CODES.PIECE_ERROR, { pieceId, square });\n        this.name = 'PieceError';\n        this.pieceId = pieceId;\n        this.square = square;\n    }\n}\n","/**\n * Service for input validation and data sanitization\n * @module services/ValidationService\n * @since 2.0.0\n */\n\nimport { PIECE_TYPES, PIECE_COLORS } from '../constants/positions.js';\nimport { ValidationError } from '../errors/ChessboardError.js';\nimport { ERROR_MESSAGES } from '../errors/messages.js';\n\n/**\n * Validation patterns compiled for performance\n * @constant\n * @type {Object}\n */\nconst VALIDATION_PATTERNS = Object.freeze({\n  square: /^[a-h][1-8]$/,\n  piece: /^[prnbqkPRNBQK][wb]$/,\n  fen: /^([rnbqkpRNBQKP1-8]+\\/){7}[rnbqkpRNBQKP1-8]+\\s[wb]\\s[KQkq-]+\\s[a-h1-8-]+\\s\\d+\\s\\d+$/,\n  move: /^[a-h][1-8][a-h][1-8][qrnb]?$/,\n  color: /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,\n});\n\n/**\n * Valid values for various configuration options\n * @constant\n * @type {Object}\n */\nconst VALID_VALUES = Object.freeze({\n  orientations: ['w', 'b', 'white', 'black'],\n  colors: ['w', 'b', 'white', 'black'],\n  movableColors: ['w', 'b', 'white', 'black', 'both', 'none'],\n  dropOffBoard: ['snapback', 'trash'],\n  easingTypes: ['linear', 'ease', 'ease-in', 'ease-out', 'ease-in-out'],\n  animationStyles: ['sequential', 'simultaneous'],\n  modes: ['normal', 'creative', 'analysis'],\n  promotionPieces: ['q', 'r', 'b', 'n', 'Q', 'R', 'B', 'N'],\n});\n\n/**\n * Size constraints for validation\n * @constant\n * @type {Object}\n */\nconst SIZE_CONSTRAINTS = Object.freeze({\n  min: 50,\n  max: 2000,\n  maxTime: 10000,\n  maxDelay: 5000,\n});\n\n/**\n * Service responsible for validating inputs and data\n * Implements caching for performance optimization\n * @class\n */\nexport class ValidationService {\n  /**\n   * Creates a new ValidationService instance\n   */\n  constructor() {\n    // Cache for validation results to improve performance\n    this._validationCache = new Map();\n    this._cacheMaxSize = 1000;\n\n    // Compile patterns for reuse\n    this._patterns = VALIDATION_PATTERNS;\n    this._validValues = VALID_VALUES;\n    this._constraints = SIZE_CONSTRAINTS;\n  }\n\n  /**\n   * Validates a square identifier with caching\n   * @param {string} square - Square to validate (e.g., 'e4')\n   * @returns {boolean} True if valid\n   */\n  isValidSquare(square) {\n    const cacheKey = `square:${square}`;\n\n    if (this._validationCache.has(cacheKey)) {\n      return this._validationCache.get(cacheKey);\n    }\n\n    const isValid =\n      typeof square === 'string' && square.length === 2 && this._patterns.square.test(square);\n\n    this._cacheValidationResult(cacheKey, isValid);\n    return isValid;\n  }\n\n  /**\n   * Validates a piece identifier with enhanced format support\n   * @param {string} piece - Piece to validate (e.g., 'wK', 'bp')\n   * @returns {boolean} True if valid\n   */\n  isValidPiece(piece) {\n    if (typeof piece !== 'string' || piece.length !== 2) {\n      return false;\n    }\n\n    const cacheKey = `piece:${piece}`;\n\n    if (this._validationCache.has(cacheKey)) {\n      return this._validationCache.get(cacheKey);\n    }\n\n    const [first, second] = piece.split('');\n\n    // Check both formats: [type][color] and [color][type]\n    const format1 = PIECE_TYPES.includes(first.toLowerCase()) && PIECE_COLORS.includes(second);\n    const format2 = PIECE_COLORS.includes(first) && PIECE_TYPES.includes(second.toLowerCase());\n\n    const isValid = format1 || format2;\n    this._cacheValidationResult(cacheKey, isValid);\n    return isValid;\n  }\n\n  /**\n   * Validates a FEN string with comprehensive checks\n   * @param {string} fen - FEN string to validate\n   * @returns {boolean} True if valid\n   */\n  isValidFen(fen) {\n    if (typeof fen !== 'string') {\n      return false;\n    }\n\n    const cacheKey = `fen:${fen}`;\n\n    if (this._validationCache.has(cacheKey)) {\n      return this._validationCache.get(cacheKey);\n    }\n\n    // Basic pattern check\n    if (!this._patterns.fen.test(fen)) {\n      this._cacheValidationResult(cacheKey, false);\n      return false;\n    }\n\n    // Additional FEN validation\n    const isValid = this._validateFenStructure(fen);\n    this._cacheValidationResult(cacheKey, isValid);\n    return isValid;\n  }\n\n  /**\n   * Validates FEN structure in detail\n   * @private\n   * @param {string} fen - FEN string to validate\n   * @returns {boolean} True if valid\n   */\n  _validateFenStructure(fen) {\n    const parts = fen.split(' ');\n\n    if (parts.length !== 6) {\n      return false;\n    }\n\n    // Validate piece placement\n    const ranks = parts[0].split('/');\n    if (ranks.length !== 8) {\n      return false;\n    }\n\n    // Validate each rank\n    for (const rank of ranks) {\n      if (!this._validateRank(rank)) {\n        return false;\n      }\n    }\n\n    // Validate active color\n    if (!['w', 'b'].includes(parts[1])) {\n      return false;\n    }\n\n    // Validate castling rights\n    if (!/^[KQkq-]*$/.test(parts[2])) {\n      return false;\n    }\n\n    // Validate en passant target\n    if (parts[3] !== '-' && !this.isValidSquare(parts[3])) {\n      return false;\n    }\n\n    // Validate halfmove clock and fullmove number\n    const halfmove = parseInt(parts[4], 10);\n    const fullmove = parseInt(parts[5], 10);\n\n    return !isNaN(halfmove) && !isNaN(fullmove) && halfmove >= 0 && fullmove >= 1;\n  }\n\n  /**\n   * Validates a single rank in FEN notation\n   * @private\n   * @param {string} rank - Rank to validate\n   * @returns {boolean} True if valid\n   */\n  _validateRank(rank) {\n    let squares = 0;\n\n    for (let i = 0; i < rank.length; i++) {\n      const char = rank[i];\n\n      if (/[1-8]/.test(char)) {\n        squares += parseInt(char, 10);\n      } else if (/[prnbqkPRNBQK]/.test(char)) {\n        squares += 1;\n      } else {\n        return false;\n      }\n    }\n\n    return squares === 8;\n  }\n\n  /**\n   * Validates a move string with comprehensive format support\n   * @param {string} move - Move string to validate (e.g., 'e2e4', 'e7e8q')\n   * @returns {boolean} True if valid\n   */\n  isValidMove(move) {\n    if (typeof move !== 'string') {\n      return false;\n    }\n\n    const cacheKey = `move:${move}`;\n\n    if (this._validationCache.has(cacheKey)) {\n      return this._validationCache.get(cacheKey);\n    }\n\n    const isValid = this._validateMoveFormat(move);\n    this._cacheValidationResult(cacheKey, isValid);\n    return isValid;\n  }\n\n  /**\n   * Validates move format in detail\n   * @private\n   * @param {string} move - Move string to validate\n   * @returns {boolean} True if valid\n   */\n  _validateMoveFormat(move) {\n    if (move.length < 4 || move.length > 5) {\n      return false;\n    }\n\n    const from = move.slice(0, 2);\n    const to = move.slice(2, 4);\n    const promotion = move.slice(4, 5);\n\n    if (!this.isValidSquare(from) || !this.isValidSquare(to)) {\n      return false;\n    }\n\n    if (promotion && !this._validValues.promotionPieces.includes(promotion)) {\n      return false;\n    }\n\n    // Additional move validation (e.g., source and target different)\n    return from !== to;\n  }\n\n  /**\n   * Validates board orientation\n   * @param {string} orientation - Orientation to validate\n   * @returns {boolean} True if valid\n   */\n  isValidOrientation(orientation) {\n    return this._validValues.orientations.includes(orientation);\n  }\n\n  /**\n   * Validates a color value\n   * @param {string} color - Color to validate\n   * @returns {boolean} True if valid\n   */\n  isValidColor(color) {\n    return this._validValues.colors.includes(color);\n  }\n\n  /**\n   * Validates a size value with constraints\n   * @param {number|string} size - Size to validate\n   * @returns {boolean} True if valid\n   */\n  isValidSize(size) {\n    if (size === 'auto') {\n      return true;\n    }\n\n    if (typeof size === 'number') {\n      return size >= this._constraints.min && size <= this._constraints.max;\n    }\n\n    return false;\n  }\n\n  /**\n   * Validates a time value with constraints\n   * @param {number} time - Time value to validate\n   * @returns {boolean} True if valid\n   */\n  isValidTime(time) {\n    return typeof time === 'number' && time >= 0 && time <= this._constraints.maxTime;\n  }\n\n  /**\n   * Validates a callback function\n   * @param {Function} callback - Callback to validate\n   * @returns {boolean} True if valid\n   */\n  isValidCallback(callback) {\n    return typeof callback === 'function';\n  }\n\n  /**\n   * Validates a DOM element ID\n   * @param {string} id - Element ID to validate\n   * @returns {boolean} True if valid\n   */\n  isValidElementId(id) {\n    return (\n      typeof id === 'string' &&\n      id.length > 0 &&\n      id.length <= 100 && // Reasonable length limit\n      /^[a-zA-Z][\\w:-]*$/.test(id)\n    ); // Valid HTML ID format\n  }\n\n  /**\n   * Validates movable colors configuration\n   * @param {string} colors - Colors value to validate\n   * @returns {boolean} True if valid\n   */\n  isValidMovableColors(colors) {\n    return this._validValues.movableColors.includes(colors);\n  }\n\n  /**\n   * Validates drop off board configuration\n   * @param {string} dropOff - Drop off board value to validate\n   * @returns {boolean} True if valid\n   */\n  isValidDropOffBoard(dropOff) {\n    return this._validValues.dropOffBoard.includes(dropOff);\n  }\n\n  /**\n   * Validates animation easing type\n   * @param {string} easing - Easing type to validate\n   * @returns {boolean} True if valid\n   */\n  isValidEasing(easing) {\n    return this._validValues.easingTypes.includes(easing);\n  }\n\n  /**\n   * Validates animation style\n   * @param {string} style - Animation style to validate\n   * @returns {boolean} True if valid\n   */\n  isValidAnimationStyle(style) {\n    return this._validValues.animationStyles.includes(style);\n  }\n\n  /**\n   * Validates CSS color format\n   * @param {string} color - Color string to validate\n   * @returns {boolean} True if valid\n   */\n  isValidCSSColor(color) {\n    if (typeof color !== 'string') {\n      return false;\n    }\n\n    // Check for hex colors\n    if (this._patterns.color.test(color)) {\n      return true;\n    }\n\n    // Check for named colors (basic set)\n    const namedColors = ['white', 'black', 'red', 'green', 'blue', 'yellow', 'cyan', 'magenta'];\n    if (namedColors.includes(color.toLowerCase())) {\n      return true;\n    }\n\n    // Check for rgb/rgba format\n    if (\n      /^rgb\\(\\s*\\d+\\s*,\\s*\\d+\\s*,\\s*\\d+\\s*\\)$/.test(color) ||\n      /^rgba\\(\\s*\\d+\\s*,\\s*\\d+\\s*,\\s*\\d+\\s*,\\s*[0-1](\\.\\d+)?\\s*\\)$/.test(color)\n    ) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Validates and sanitizes a square identifier\n   * @param {string} square - Square to validate\n   * @returns {string} Sanitized square\n   * @throws {ValidationError} If square is invalid\n   */\n  validateSquare(square) {\n    if (!this.isValidSquare(square)) {\n      throw new ValidationError(ERROR_MESSAGES.invalid_square + square, 'square', square);\n    }\n    return square.toLowerCase();\n  }\n\n  /**\n   * Validates and sanitizes a piece identifier\n   * @param {string} piece - Piece to validate\n   * @returns {string} Sanitized piece\n   * @throws {ValidationError} If piece is invalid\n   */\n  validatePiece(piece) {\n    if (!this.isValidPiece(piece)) {\n      throw new ValidationError(ERROR_MESSAGES.invalid_piece + piece, 'piece', piece);\n    }\n    return piece.toLowerCase();\n  }\n\n  /**\n   * Validates and sanitizes a FEN string\n   * @param {string} fen - FEN to validate\n   * @returns {string} Sanitized FEN\n   * @throws {ValidationError} If FEN is invalid\n   */\n  validateFen(fen) {\n    if (!this.isValidFen(fen)) {\n      throw new ValidationError(ERROR_MESSAGES.invalid_fen + fen, 'fen', fen);\n    }\n    return fen.trim();\n  }\n\n  /**\n   * Validates and sanitizes a move string\n   * @param {string} move - Move to validate\n   * @returns {string} Sanitized move\n   * @throws {ValidationError} If move is invalid\n   */\n  validateMove(move) {\n    if (!this.isValidMove(move)) {\n      throw new ValidationError(ERROR_MESSAGES.invalid_move + move, 'move', move);\n    }\n    return move.toLowerCase();\n  }\n\n  /**\n   * Validates and sanitizes orientation\n   * @param {string} orientation - Orientation to validate\n   * @returns {string} Sanitized orientation ('w' or 'b')\n   * @throws {ValidationError} If orientation is invalid\n   */\n  validateOrientation(orientation) {\n    if (!this.isValidOrientation(orientation)) {\n      throw new ValidationError(\n        ERROR_MESSAGES.invalid_orientation + orientation,\n        'orientation',\n        orientation\n      );\n    }\n\n    // Normalize to 'w' or 'b'\n    return orientation === 'white' ? 'w' : orientation === 'black' ? 'b' : orientation;\n  }\n\n  /**\n   * Validates and sanitizes color\n   * @param {string} color - Color to validate\n   * @returns {string} Sanitized color ('w' or 'b')\n   * @throws {ValidationError} If color is invalid\n   */\n  validateColor(color) {\n    if (!this.isValidColor(color)) {\n      throw new ValidationError(ERROR_MESSAGES.invalid_color + color, 'color', color);\n    }\n\n    // Normalize to 'w' or 'b'\n    return color === 'white' ? 'w' : color === 'black' ? 'b' : color;\n  }\n\n  /**\n   * Validates and sanitizes size\n   * @param {number|string} size - Size to validate\n   * @returns {number|string} Sanitized size\n   * @throws {ValidationError} If size is invalid\n   */\n  validateSize(size) {\n    if (!this.isValidSize(size)) {\n      throw new ValidationError(ERROR_MESSAGES.invalid_size + size, 'size', size);\n    }\n    return size;\n  }\n\n  /**\n   * Validates configuration object with comprehensive checks\n   * @param {Object} config - Configuration to validate\n   * @returns {Object} Validated configuration\n   * @throws {ValidationError} If configuration is invalid\n   */\n  validateConfig(config) {\n    if (!config || typeof config !== 'object') {\n      throw new ValidationError('Configuration must be an object', 'config', config);\n    }\n\n    const errors = [];\n\n    // Validate required fields\n    if (!config.id && !config.id_div) {\n      errors.push('Configuration must include id or id_div');\n    }\n\n    // Validate optional fields\n    if (config.orientation && !this.isValidOrientation(config.orientation)) {\n      errors.push(ERROR_MESSAGES.invalid_orientation + config.orientation);\n    }\n\n    if (config.size && !this.isValidSize(config.size)) {\n      errors.push(ERROR_MESSAGES.invalid_size + config.size);\n    }\n\n    if (config.movableColors && !this.isValidMovableColors(config.movableColors)) {\n      errors.push(ERROR_MESSAGES.invalid_color + config.movableColors);\n    }\n\n    if (config.dropOffBoard && !this.isValidDropOffBoard(config.dropOffBoard)) {\n      errors.push(ERROR_MESSAGES.invalid_dropOffBoard + config.dropOffBoard);\n    }\n\n    if (config.animationStyle && !this.isValidAnimationStyle(config.animationStyle)) {\n      errors.push(ERROR_MESSAGES.invalid_animationStyle + config.animationStyle);\n    }\n\n    // Validate callbacks\n    const callbacks = [\n      'onMove',\n      'onMoveEnd',\n      'onChange',\n      'onDragStart',\n      'onDragMove',\n      'onDrop',\n      'onSnapbackEnd',\n    ];\n    for (const callback of callbacks) {\n      if (config[callback] && !this.isValidCallback(config[callback])) {\n        errors.push(`Invalid ${callback} callback`);\n      }\n    }\n\n    // Validate colors\n    const colorFields = ['whiteSquare', 'blackSquare', 'highlight', 'hintColor'];\n    for (const field of colorFields) {\n      if (config[field] && !this.isValidCSSColor(config[field])) {\n        errors.push(`Invalid ${field} color: ${config[field]}`);\n      }\n    }\n\n    if (errors.length > 0) {\n      throw new ValidationError(\n        `Configuration validation failed: ${errors.join(', ')}`,\n        'config',\n        config\n      );\n    }\n\n    return config;\n  }\n\n  /**\n   * Caches validation result for performance\n   * @private\n   * @param {string} key - Cache key\n   * @param {boolean} result - Validation result\n   */\n  _cacheValidationResult(key, result) {\n    if (this._validationCache.size >= this._cacheMaxSize) {\n      // Remove oldest entry\n      const firstKey = this._validationCache.keys().next().value;\n      this._validationCache.delete(firstKey);\n    }\n\n    this._validationCache.set(key, result);\n  }\n\n  /**\n   * Clears the validation cache\n   */\n  clearCache() {\n    this._validationCache.clear();\n  }\n\n  /**\n   * Gets validation cache statistics\n   * @returns {Object} Cache statistics\n   */\n  getCacheStats() {\n    return {\n      size: this._validationCache.size,\n      maxSize: this._cacheMaxSize,\n      hitRate: this._cacheHits / (this._cacheHits + this._cacheMisses) || 0,\n    };\n  }\n\n  /**\n   * Batch validates multiple values\n   * @param {Array} validations - Array of validation objects\n   * @returns {Array} Array of validation results\n   */\n  batchValidate(validations) {\n    return validations.map((validation) => {\n      try {\n        const { type, value } = validation;\n\n        switch (type) {\n          case 'square':\n            return { valid: this.isValidSquare(value), value };\n          case 'piece':\n            return { valid: this.isValidPiece(value), value };\n          case 'fen':\n            return { valid: this.isValidFen(value), value };\n          case 'move':\n            return { valid: this.isValidMove(value), value };\n          default:\n            return { valid: false, value, error: 'Unknown validation type' };\n        }\n      } catch (error) {\n        return { valid: false, value: validation.value, error: error.message };\n      }\n    });\n  }\n\n  /**\n   * Cleans up resources\n   */\n  destroy() {\n    this.clearCache();\n    this._validationCache = null;\n    this._patterns = null;\n    this._validValues = null;\n    this._constraints = null;\n  }\n}\n","/**\n * Configuration management for Chessboard.js\n * @module core/ChessboardConfig\n * @since 2.0.0\n */\n\nimport { ValidationService } from '../services/ValidationService.js';\nimport { ConfigurationError } from '../errors/ChessboardError.js';\n\n/**\n * Animation timing constants\n * @constant\n * @type {Object}\n */\nconst ANIMATION_TIMES = Object.freeze({\n    fast: 200,\n    slow: 600,\n    normal: 400,\n    verySlow: 1000,\n    veryFast: 100\n});\n\n/**\n * Boolean value mappings\n * @constant\n * @type {Object}\n */\nconst BOOLEAN_VALUES = Object.freeze({\n    true: true,\n    false: false,\n    none: false,\n    1: true,\n    0: false\n});\n\n/**\n * CSS transition functions\n * @constant\n * @type {Object}\n */\nconst TRANSITION_FUNCTIONS = Object.freeze({\n    ease: 'ease',\n    linear: 'linear',\n    'ease-in': 'ease-in',\n    'ease-out': 'ease-out',\n    'ease-in-out': 'ease-in-out',\n    none: null\n});\n\n/**\n * Default configuration values\n * @constant\n * @type {Object}\n */\nconst DEFAULT_CONFIG = Object.freeze({\n    id: 'board',\n    position: 'start',\n    orientation: 'w',\n    mode: 'normal',\n    size: 'auto',\n    draggable: true,\n    hints: true,\n    clickable: true,\n    movableColors: 'both',\n    moveHighlight: true,\n    overHighlight: true,\n    moveAnimation: 'ease',\n    moveTime: 'fast',\n    dropOffBoard: 'snapback',\n    snapbackTime: 'fast',\n    snapbackAnimation: 'ease',\n    dropCenterTime: 'veryFast',\n    dropCenterAnimation: 'ease',\n    fadeTime: 'fast',\n    fadeAnimation: 'ease',\n    ratio: 0.9,\n    piecesPath: '../assets/themes/default',\n    animationStyle: 'simultaneous',\n    simultaneousAnimationDelay: 100,\n    onMove: () => true,\n    onMoveEnd: () => true,\n    onChange: () => true,\n    onDragStart: () => true,\n    onDragMove: () => true,\n    onDrop: () => true,\n    onSnapbackEnd: () => true,\n    whiteSquare: '#f0d9b5',\n    blackSquare: '#b58863',\n    highlight: 'yellow',\n    selectedSquareWhite: '#ababaa',\n    selectedSquareBlack: '#ababaa',\n    movedSquareWhite: '#f1f1a0',\n    movedSquareBlack: '#e9e981',\n    choiceSquare: 'white',\n    coverSquare: 'black',\n    hintColor: '#ababaa'\n});\n\n/**\n * Configuration management class for Chessboard.js\n * Handles validation, normalization, and CSS property management\n * @class\n */\nclass ChessboardConfig {\n    /**\n     * Creates a new ChessboardConfig instance\n     * @param {Object} settings - User-provided configuration\n     * @throws {ConfigurationError} If configuration is invalid\n     */\n    constructor(settings = {}) {\n        // Initialize validation service\n        this._validationService = new ValidationService();\n\n        // Validate input\n        this._validateInput(settings);\n\n        // Merge with defaults\n        const config = this._mergeWithDefaults(settings);\n\n        // Process and validate configuration\n        this._processConfiguration(config);\n\n        // Set CSS properties\n        this._setCSSProperties(config);\n\n        // Configure mode-specific settings\n        this._configureModeSettings();\n    }\n\n    /**\n     * Validates input configuration\n     * @private\n     * @param {Object} settings - Input settings\n     * @throws {ConfigurationError} If input is invalid\n     */\n    _validateInput(settings) {\n        if (settings !== null && typeof settings !== 'object') {\n            throw new ConfigurationError('Settings must be an object', 'settings', settings);\n        }\n\n        // Validate using validation service\n        try {\n            this._validationService.validateConfig(settings);\n        } catch (error) {\n            throw new ConfigurationError(error.message, error.field, error.value);\n        }\n    }\n\n    /**\n     * Merges user settings with defaults\n     * @private\n     * @param {Object} settings - User settings\n     * @returns {Object} Merged configuration\n     */\n    _mergeWithDefaults(settings) {\n        return Object.assign({}, DEFAULT_CONFIG, settings);\n    }\n\n    /**\n     * Processes and validates configuration values\n     * @private\n     * @param {Object} config - Configuration object\n     */\n    _processConfiguration(config) {\n        // Basic properties\n        this.id_div = config.id;\n        this.position = config.position;\n        this.orientation = config.orientation;\n        this.mode = config.mode;\n        this.dropOffBoard = config.dropOffBoard;\n        this.size = config.size;\n        this.movableColors = config.movableColors;\n        this.piecesPath = config.piecesPath;\n\n        // Event handlers\n        this.onMove = this._validateCallback(config.onMove);\n        this.onMoveEnd = this._validateCallback(config.onMoveEnd);\n        this.onChange = this._validateCallback(config.onChange);\n        this.onDragStart = this._validateCallback(config.onDragStart);\n        this.onDragMove = this._validateCallback(config.onDragMove);\n        this.onDrop = this._validateCallback(config.onDrop);\n        this.onSnapbackEnd = this._validateCallback(config.onSnapbackEnd);\n\n        // Animation properties\n        this.moveAnimation = this._setTransitionFunction(config.moveAnimation);\n        this.snapbackAnimation = this._setTransitionFunction(config.snapbackAnimation);\n        this.dropCenterAnimation = this._setTransitionFunction(config.dropCenterAnimation);\n        this.fadeAnimation = this._setTransitionFunction(config.fadeAnimation);\n\n        // Boolean properties\n        this.hints = this._setBoolean(config.hints);\n        this.clickable = this._setBoolean(config.clickable);\n        this.draggable = this._setBoolean(config.draggable);\n        this.moveHighlight = this._setBoolean(config.moveHighlight);\n        this.overHighlight = this._setBoolean(config.overHighlight);\n\n        // Timing properties\n        this.moveTime = this._setTime(config.moveTime);\n        this.snapbackTime = this._setTime(config.snapbackTime);\n        this.dropCenterTime = this._setTime(config.dropCenterTime);\n        this.fadeTime = this._setTime(config.fadeTime);\n\n        // Animation style properties\n        this.animationStyle = this._validateAnimationStyle(config.animationStyle);\n        this.simultaneousAnimationDelay = this._validateDelay(config.simultaneousAnimationDelay);\n    }\n\n    /**\n     * Sets CSS custom properties\n     * @private\n     * @param {Object} config - Configuration object\n     */\n    _setCSSProperties(config) {\n        const cssProperties = {\n            pieceRatio: config.ratio,\n            whiteSquare: config.whiteSquare,\n            blackSquare: config.blackSquare,\n            highlightSquare: config.highlight,\n            selectedSquareWhite: config.selectedSquareWhite,\n            selectedSquareBlack: config.selectedSquareBlack,\n            movedSquareWhite: config.movedSquareWhite,\n            movedSquareBlack: config.movedSquareBlack,\n            choiceSquare: config.choiceSquare,\n            coverSquare: config.coverSquare,\n            hintColor: config.hintColor\n        };\n\n        Object.entries(cssProperties).forEach(([property, value]) => {\n            this._setCSSProperty(property, value);\n        });\n    }\n\n    /**\n     * Configures mode-specific settings\n     * @private\n     */\n    _configureModeSettings() {\n        switch (this.mode) {\n            case 'creative':\n                this.onlyLegalMoves = false;\n                this.hints = false;\n                break;\n            case 'normal':\n                this.onlyLegalMoves = true;\n                break;\n            default:\n                this.onlyLegalMoves = true;\n        }\n    }\n\n    /**\n     * Validates a callback function\n     * @private\n     * @param {Function} callback - Callback to validate\n     * @returns {Function} Validated callback\n     * @throws {ConfigurationError} If callback is invalid\n     */\n    _validateCallback(callback) {\n        if (!this._validationService.isValidCallback(callback)) {\n            throw new ConfigurationError('Callback must be a function', 'callback', callback);\n        }\n        return callback;\n    }\n\n    /**\n     * Validates animation style\n     * @private\n     * @param {string} style - Animation style\n     * @returns {string} Validated style\n     * @throws {ConfigurationError} If style is invalid\n     */\n    _validateAnimationStyle(style) {\n        if (!this._validationService.isValidAnimationStyle(style)) {\n            throw new ConfigurationError('Invalid animation style', 'animationStyle', style);\n        }\n        return style;\n    }\n\n    /**\n     * Validates animation delay\n     * @private\n     * @param {number} delay - Animation delay\n     * @returns {number} Validated delay\n     * @throws {ConfigurationError} If delay is invalid\n     */\n    _validateDelay(delay) {\n        if (typeof delay !== 'number' || delay < 0 || delay > 5000) {\n            throw new ConfigurationError('Invalid animation delay', 'simultaneousAnimationDelay', delay);\n        }\n        return delay;\n    }\n\n    /**\n     * Sets a CSS custom property\n     * @private\n     * @param {string} property - Property name\n     * @param {string} value - Property value\n     */\n    _setCSSProperty(property, value) {\n        try {\n            if (typeof document !== 'undefined' && document.documentElement) {\n                document.documentElement.style.setProperty(`--${property}`, value);\n            }\n        } catch (error) {\n            console.warn(`Failed to set CSS property ${property}:`, error.message);\n        }\n    }\n\n    /**\n     * Sets orientation with validation\n     * @param {string} orientation - Orientation value\n     * @returns {ChessboardConfig} This instance for chaining\n     * @throws {ConfigurationError} If orientation is invalid\n     */\n    setOrientation(orientation) {\n        const validatedOrientation = this._validationService.validateOrientation(orientation);\n        this.orientation = validatedOrientation;\n        return this;\n    }\n\n    /**\n     * Validates and sets time value\n     * @private\n     * @param {string|number} value - Time value\n     * @returns {number} Validated time value\n     * @throws {ConfigurationError} If time value is invalid\n     */\n    _setTime(value) {\n        if (typeof value === 'number') {\n            if (!this._validationService.isValidTime(value)) {\n                throw new ConfigurationError('Invalid time value', 'time', value);\n            }\n            return value;\n        }\n\n        if (typeof value === 'string' && value in ANIMATION_TIMES) {\n            return ANIMATION_TIMES[value];\n        }\n\n        throw new ConfigurationError('Invalid time value', 'time', value);\n    }\n\n    /**\n     * Validates and sets boolean value\n     * @private\n     * @param {*} value - Boolean value\n     * @returns {boolean} Validated boolean value\n     * @throws {ConfigurationError} If boolean value is invalid\n     */\n    _setBoolean(value) {\n        if (typeof value === 'boolean') {\n            return value;\n        }\n\n        if (value in BOOLEAN_VALUES) {\n            return BOOLEAN_VALUES[value];\n        }\n\n        throw new ConfigurationError('Invalid boolean value', 'boolean', value);\n    }\n\n    /**\n     * Validates and sets transition function\n     * @private\n     * @param {string|boolean|null} value - Transition function value\n     * @returns {string|null} Validated transition function\n     * @throws {ConfigurationError} If transition function is invalid\n     */\n    _setTransitionFunction(value) {\n        // Handle boolean values - true means use default 'ease', false/null means no animation\n        if (typeof value === 'boolean') {\n            return value ? TRANSITION_FUNCTIONS.ease : null;\n        }\n\n        // Handle string values\n        if (typeof value === 'string' && value in TRANSITION_FUNCTIONS) {\n            return TRANSITION_FUNCTIONS[value];\n        }\n\n        // Handle null/undefined\n        if (value === null || value === undefined) {\n            return null;\n        }\n\n        throw new ConfigurationError('Invalid transition function', 'transitionFunction', value);\n    }\n\n    /**\n     * Gets the current configuration as a plain object\n     * @returns {Object} Configuration object\n     */\n    toObject() {\n        return {\n            id_div: this.id_div,\n            position: this.position,\n            orientation: this.orientation,\n            mode: this.mode,\n            size: this.size,\n            draggable: this.draggable,\n            hints: this.hints,\n            clickable: this.clickable,\n            movableColors: this.movableColors,\n            moveHighlight: this.moveHighlight,\n            overHighlight: this.overHighlight,\n            moveAnimation: this.moveAnimation,\n            moveTime: this.moveTime,\n            dropOffBoard: this.dropOffBoard,\n            snapbackTime: this.snapbackTime,\n            snapbackAnimation: this.snapbackAnimation,\n            dropCenterTime: this.dropCenterTime,\n            dropCenterAnimation: this.dropCenterAnimation,\n            fadeTime: this.fadeTime,\n            fadeAnimation: this.fadeAnimation,\n            piecesPath: this.piecesPath,\n            animationStyle: this.animationStyle,\n            simultaneousAnimationDelay: this.simultaneousAnimationDelay,\n            onlyLegalMoves: this.onlyLegalMoves\n        };\n    }\n\n    /**\n     * Updates configuration with new values\n     * @param {Object} updates - Configuration updates\n     * @returns {ChessboardConfig} This instance for chaining\n     * @throws {ConfigurationError} If updates are invalid\n     */\n    update(updates) {\n        if (!updates || typeof updates !== 'object') {\n            throw new ConfigurationError('Updates must be an object', 'updates', updates);\n        }\n\n        // Validate updates\n        this._validationService.validateConfig(updates);\n\n        // Apply updates\n        const newConfig = Object.assign({}, this.toObject(), updates);\n\n        // Re-process configuration\n        this._processConfiguration(newConfig);\n        this._setCSSProperties(newConfig);\n        this._configureModeSettings();\n\n        return this;\n    }\n\n    /**\n     * Cleans up resources\n     */\n    destroy() {\n        if (this._validationService) {\n            this._validationService.destroy();\n            this._validationService = null;\n        }\n    }\n}\n\nexport { ChessboardConfig };\nexport default ChessboardConfig;","/**\n * Chess piece component\n * @module components/Piece\n */\n\nclass Piece {\n  constructor(color, type, src, opacity = 1) {\n    this.color = color;\n    this.type = type;\n    this.id = this.getId();\n    this.src = src;\n    this.element = this.createElement(src, opacity);\n    this._currentAnimation = null;\n    this.check();\n  }\n\n  getId() {\n    return this.type + this.color;\n  }\n\n  createElement(src, opacity = 1) {\n    const element = document.createElement('img');\n    element.classList.add('piece');\n    element.id = this.id;\n    element.src = src || this.src;\n    element.style.opacity = opacity;\n    element.draggable = false;\n\n    element.onerror = () => {\n      console.warn('Failed to load piece image:', element.src);\n    };\n\n    return element;\n  }\n\n  visible() {\n    if (this.element) {\n      this.element.style.opacity = 1;\n    }\n  }\n\n  invisible() {\n    if (this.element) {\n      this.element.style.opacity = 0;\n    }\n  }\n\n  updateSrc(newSrc) {\n    this.src = newSrc;\n    if (this.element) {\n      this.element.src = newSrc;\n    }\n  }\n\n  /**\n   * Transforms the piece to a new type with smooth animation\n   */\n  transformTo(newType, newSrc, duration = 200, callback = null) {\n    if (!this.element) {\n      if (callback) callback();\n      return;\n    }\n\n    const element = this.element;\n    element.classList.add('transforming');\n\n    const halfDuration = duration / 2;\n\n    // Scale down animation\n    const scaleDownAnim = element.animate(\n      [\n        { transform: 'scale(1)', opacity: 1 },\n        { transform: 'scale(0.7)', opacity: 0.5 },\n      ],\n      { duration: halfDuration, easing: 'ease-in', fill: 'forwards' }\n    );\n\n    scaleDownAnim.onfinish = () => {\n      if (!this.element) {\n        if (callback) callback();\n        return;\n      }\n\n      // Update piece data\n      this.type = newType;\n      this.id = this.getId();\n      this.src = newSrc;\n      element.src = newSrc;\n      element.id = this.id;\n\n      // Scale up animation\n      const scaleUpAnim = element.animate(\n        [\n          { transform: 'scale(0.7)', opacity: 0.5 },\n          { transform: 'scale(1)', opacity: 1 },\n        ],\n        { duration: halfDuration, easing: 'ease-out', fill: 'forwards' }\n      );\n\n      scaleUpAnim.onfinish = () => {\n        if (!this.element) {\n          if (callback) callback();\n          return;\n        }\n\n        // Clean up\n        scaleDownAnim.cancel();\n        scaleUpAnim.cancel();\n        element.style.transform = '';\n        element.style.opacity = '';\n        element.classList.remove('transforming');\n\n        if (callback) callback();\n      };\n    };\n  }\n\n  fadeIn(duration, speed, transition_f, callback) {\n    if (!this.element) {\n      if (callback) callback();\n      return;\n    }\n\n    const start = performance.now();\n\n    const fade = () => {\n      if (!this.element) {\n        if (callback) callback();\n        return;\n      }\n\n      const elapsed = performance.now() - start;\n      const progress = Math.min(elapsed / duration, 1);\n      this.element.style.opacity = progress;\n\n      if (progress < 1) {\n        requestAnimationFrame(fade);\n      } else {\n        this.element.style.opacity = 1;\n        if (callback) callback();\n      }\n    };\n\n    fade();\n  }\n\n  fadeOut(duration, speed, transition_f, callback) {\n    if (!this.element) {\n      if (callback) callback();\n      return;\n    }\n\n    const start = performance.now();\n\n    const fade = () => {\n      if (!this.element) {\n        if (callback) callback();\n        return;\n      }\n\n      const elapsed = performance.now() - start;\n      const progress = Math.min(elapsed / duration, 1);\n      this.element.style.opacity = 1 - progress;\n\n      if (progress < 1) {\n        requestAnimationFrame(fade);\n      } else {\n        this.element.style.opacity = 0;\n        if (callback) callback();\n      }\n    };\n\n    fade();\n  }\n\n  setDrag(f) {\n    if (!this.element) return;\n\n    // Remove existing handler\n    if (this._dragHandler) {\n      this.element.removeEventListener('mousedown', this._dragHandler);\n      this.element.removeEventListener('touchstart', this._dragHandler);\n    }\n\n    this.element.ondragstart = (e) => e.preventDefault();\n\n    this._dragHandler = f;\n    this.element.addEventListener('mousedown', this._dragHandler);\n    this.element.addEventListener('touchstart', this._dragHandler, { passive: false });\n  }\n\n  destroy() {\n    // Cancel any running animation\n    if (this._currentAnimation) {\n      this._currentAnimation.cancel();\n      this._currentAnimation = null;\n    }\n\n    if (this.element) {\n      if (this._dragHandler) {\n        this.element.removeEventListener('mousedown', this._dragHandler);\n        this.element.removeEventListener('touchstart', this._dragHandler);\n        this._dragHandler = null;\n      }\n\n      this.element.onmousedown = null;\n      this.element.ondragstart = null;\n\n      if (this.element.parentNode) {\n        this.element.parentNode.removeChild(this.element);\n      }\n\n      this.element = null;\n    }\n  }\n\n  /**\n   * Animate piece translation to target square\n   * Uses Web Animations API for smooth, precise animations\n   */\n  translate(targetSquare, duration, transition_f, speed, callback = null) {\n    if (!this.element || !targetSquare) {\n      if (callback) callback();\n      return;\n    }\n\n    // Cancel any existing animation\n    if (this._currentAnimation) {\n      this._currentAnimation.cancel();\n      this._currentAnimation = null;\n    }\n\n    // If duration is 0, skip animation\n    if (duration <= 0) {\n      if (callback) callback();\n      return;\n    }\n\n    // Calculate translation distance\n    const sourceRect = this.element.getBoundingClientRect();\n    const targetRect = targetSquare.element\n      ? targetSquare.element.getBoundingClientRect()\n      : targetSquare.getBoundingClientRect();\n\n    const dx = targetRect.left + targetRect.width / 2 - (sourceRect.left + sourceRect.width / 2);\n    const dy = targetRect.top + targetRect.height / 2 - (sourceRect.top + sourceRect.height / 2);\n\n    // Skip animation if already at target (within 1px tolerance)\n    if (Math.abs(dx) < 1 && Math.abs(dy) < 1) {\n      if (callback) callback();\n      return;\n    }\n\n    // Create animation with fill:forwards to maintain position until DOM update\n    const animation = this.element.animate(\n      [{ transform: 'translate(0, 0)' }, { transform: `translate(${dx}px, ${dy}px)` }],\n      {\n        duration,\n        easing: 'cubic-bezier(0.25, 0.1, 0.25, 1)', // Smooth easing\n        fill: 'forwards', // Keep final position until we clean up\n      }\n    );\n\n    this._currentAnimation = animation;\n\n    animation.onfinish = () => {\n      if (!this.element) {\n        if (callback) callback();\n        return;\n      }\n\n      // First: call the callback which moves the piece in the DOM\n      // At this point, the animation is keeping the piece visually in place\n      if (callback) callback();\n\n      // Then: cancel the animation and reset transform\n      // The piece is now in the correct DOM position, so this won't cause a jump\n      requestAnimationFrame(() => {\n        if (this._currentAnimation === animation) {\n          animation.cancel();\n          this._currentAnimation = null;\n        }\n        if (this.element) {\n          this.element.style.transform = '';\n        }\n      });\n    };\n\n    animation.oncancel = () => {\n      if (this._currentAnimation === animation) {\n        this._currentAnimation = null;\n      }\n    };\n  }\n\n  check() {\n    if (!['p', 'r', 'n', 'b', 'q', 'k'].includes(this.type)) {\n      throw new Error(`Invalid piece type: ${this.type}`);\n    }\n    if (!['w', 'b'].includes(this.color)) {\n      throw new Error(`Invalid piece color: ${this.color}`);\n    }\n  }\n}\n\nexport default Piece;\n","class Square {\n  constructor(row, col) {\n    this.row = row;\n    this.col = col;\n    this.id = this.getId();\n    this.element = this.createElement();\n    this.piece = null;\n  }\n\n  getPiece() {\n    return this.piece;\n  }\n\n  opposite() {\n    this.row = 9 - this.row;\n    this.col = 9 - this.col;\n    this.id = this.getId();\n    this.element = this.resetElement();\n  }\n\n  isWhite() {\n    return (this.row + this.col) % 2 === 0;\n  }\n\n  getId() {\n    const letters = 'abcdefgh';\n    const letter = letters[this.col - 1];\n    return letter + this.row;\n  }\n\n  resetElement() {\n    this.element.id = this.id;\n    this.element.className = '';\n    this.element.classList.add('square');\n    this.element.classList.add(this.isWhite() ? 'whiteSquare' : 'blackSquare');\n  }\n\n  createElement() {\n    const element = document.createElement('div');\n    element.id = this.id;\n    element.classList.add('square');\n    element.classList.add(this.isWhite() ? 'whiteSquare' : 'blackSquare');\n    return element;\n  }\n\n  getElement() {\n    return this.element;\n  }\n\n  getBoundingClientRect() {\n    return this.element.getBoundingClientRect();\n  }\n\n  removePiece(preserve = false) {\n    if (!this.piece) {\n      return null;\n    }\n    // Only destroy the piece if not preserving (i.e., not moving)\n    if (!preserve && typeof this.piece.destroy === 'function') {\n      this.piece.destroy();\n    }\n    this.piece = null;\n    return null;\n  }\n\n  /**\n   * Forcefully removes all pieces from this square\n   */\n  forceRemoveAllPieces() {\n    // Best practice: destroy the piece object if present\n    if (this.piece && typeof this.piece.destroy === 'function') {\n      this.piece.destroy();\n      this.piece = null;\n    }\n    // Remove any orphaned img.piece elements from the DOM\n    const pieceElements = this.element.querySelectorAll('img.piece');\n    pieceElements.forEach((element) => {\n      if (element.parentNode === this.element) {\n        this.element.removeChild(element);\n      }\n    });\n  }\n\n  /**\n   * Replaces the current piece with a new one efficiently\n   * @param {Piece} newPiece - The new piece to place\n   */\n  replacePiece(newPiece) {\n    // If there's an existing piece, remove it first\n    if (this.piece) {\n      this.removePiece();\n    }\n\n    // Add the new piece\n    this.putPiece(newPiece);\n\n    // Ensure the piece is properly displayed\n    newPiece.element.style.opacity = '1';\n  }\n\n  addEventListener(event, callback) {\n    this.element.addEventListener(event, callback);\n  }\n\n  putPiece(piece) {\n    // If there's already a piece, remove it first, but preserve if moving\n    if (this.piece) {\n      this.removePiece(true);\n    }\n    this.piece = piece;\n    if (piece && piece.element) {\n      this.element.appendChild(piece.element);\n    }\n  }\n\n  putHint(catchable) {\n    if (this.element.querySelector('.hint')) {\n      return;\n    }\n    const hint = document.createElement('div');\n    hint.classList.add('hint');\n    this.element.appendChild(hint);\n    if (catchable) {\n      hint.classList.add('catchable');\n    }\n  }\n\n  removeHint() {\n    const hint = this.element.querySelector('.hint');\n    if (hint) {\n      this.element.removeChild(hint);\n    }\n  }\n\n  select() {\n    this.element.classList.add(this.isWhite() ? 'selectedSquareWhite' : 'selectedSquareBlack');\n  }\n\n  deselect() {\n    this.element.classList.remove('selectedSquareWhite');\n    this.element.classList.remove('selectedSquareBlack');\n  }\n\n  moved() {\n    this.element.classList.add(this.isWhite() ? 'movedSquareWhite' : 'movedSquareBlack');\n  }\n\n  unmoved() {\n    this.element.classList.remove('movedSquareWhite');\n    this.element.classList.remove('movedSquareBlack');\n  }\n\n  highlight() {\n    this.element.classList.add('highlighted');\n  }\n\n  dehighlight() {\n    this.element.classList.remove('highlighted');\n  }\n\n  putCover(callback) {\n    const cover = document.createElement('div');\n    cover.classList.add('square');\n    cover.classList.add('cover');\n    this.element.appendChild(cover);\n    cover.addEventListener('click', (e) => {\n      e.stopPropagation();\n      callback();\n    });\n  }\n\n  removeCover() {\n    const cover = this.element.querySelector('.cover');\n    if (cover) {\n      this.element.removeChild(cover);\n    }\n  }\n\n  putPromotion(src, callback) {\n    const choice = document.createElement('div');\n    choice.classList.add('square');\n    choice.classList.add('choice');\n    this.element.appendChild(choice);\n    const img = document.createElement('img');\n    img.classList.add('piece');\n    img.classList.add('choicable');\n    img.src = src;\n    choice.appendChild(img);\n    choice.addEventListener('click', (e) => {\n      e.stopPropagation();\n      callback();\n    });\n  }\n\n  hasPromotion() {\n    return this.element.querySelector('.choice') !== null;\n  }\n\n  removePromotion() {\n    const choice = this.element.querySelector('.choice');\n    if (choice) {\n      choice.removeChild(choice.firstChild);\n      this.element.removeChild(choice);\n    }\n  }\n\n  destroy() {\n    // Remove all piece DOM nodes and clear reference\n    this.forceRemoveAllPieces();\n    this.element.remove();\n    this.piece = null;\n  }\n\n  hasPiece() {\n    return this.piece !== null;\n  }\n\n  getColor() {\n    return this.piece.getColor();\n  }\n\n  check() {\n    if (this.row < 1 || this.row > 8) {\n      throw new Error('Invalid square: row is out of bounds');\n    }\n    if (this.col < 1 || this.col > 8) {\n      throw new Error('Invalid square: col is out of bounds');\n    }\n  }\n}\n\nexport default Square;\n","import Piece from './Piece.js';\nimport Square from './Square.js';\n\nclass Move {\n  constructor(from, to, promotion = null, check = false) {\n    this.piece = from ? from.getPiece() : null;\n    this.from = from;\n    this.to = to;\n    this.promotion = promotion;\n\n    if (check) this.check();\n  }\n\n  hasPromotion() {\n    return this.promotion !== null;\n  }\n\n  setPromotion(promotion) {\n    this.promotion = promotion;\n  }\n\n  check() {\n    if (this.piece === null) return false;\n    if (!(this.piece instanceof Piece)) return false;\n    if (['q', 'r', 'b', 'n', null].indexOf(this.promotion) === -1) return false;\n    if (!(this.from instanceof Square)) return false;\n    if (!(this.to instanceof Square)) return false;\n    if (!this.to) return false;\n    if (!this.from) return false;\n    if (this.from === this.to) return false;\n    return true;\n  }\n\n  isLegal(game) {\n    const destinations = game.moves({ square: this.from.id, verbose: true }).map((move) => move.to);\n    return destinations.indexOf(this.to.id) !== -1;\n  }\n}\n\nexport default Move;\n","/**\n * Service for managing animations and transitions\n * @module services/AnimationService\n * @since 2.0.0\n */\n\n/**\n * Service responsible for coordinating animations and transitions\n * @class\n */\nexport class AnimationService {\n  /**\n   * Creates a new AnimationService instance\n   * @param {ChessboardConfig} config - Board configuration\n   */\n  constructor(config) {\n    this.config = config;\n    this.activeAnimations = new Map();\n    this.animationId = 0;\n  }\n\n  /**\n   * Creates a timing function for animations\n   * @param {string} [type='ease'] - Animation type\n   * @returns {Function} Timing function\n   */\n  createTimingFunction(type = 'ease') {\n    return (elapsed, duration) => {\n      const x = elapsed / duration;\n\n      switch (type) {\n        case 'linear':\n          return x;\n        case 'ease':\n          return x ** 2 * (3 - 2 * x);\n        case 'ease-in':\n          return x ** 2;\n        case 'ease-out':\n          return -1 * (x - 1) ** 2 + 1;\n        case 'ease-in-out':\n          return x < 0.5 ? 2 * x ** 2 : 4 * x - 2 * x ** 2 - 1;\n        default:\n          return x;\n      }\n    };\n  }\n\n  /**\n   * Animates an element with given properties\n   * @param {HTMLElement} element - Element to animate\n   * @param {Object} properties - Properties to animate\n   * @param {number} duration - Animation duration in milliseconds\n   * @param {string} [easing='ease'] - Easing function\n   * @param {Function} [callback] - Callback when animation completes\n   * @returns {number} Animation ID\n   */\n  animate(element, properties, duration, easing = 'ease', callback) {\n    const animationId = ++this.animationId;\n    const timingFunction = this.createTimingFunction(easing);\n    const startTime = performance.now();\n    const startValues = {};\n\n    // Store initial values\n    Object.keys(properties).forEach((prop) => {\n      startValues[prop] = this._getInitialValue(element, prop);\n    });\n\n    const animate = (currentTime) => {\n      const elapsed = currentTime - startTime;\n      const progress = Math.min(elapsed / duration, 1);\n      const easedProgress = timingFunction(elapsed, duration);\n\n      // Apply animated values\n      Object.keys(properties).forEach((prop) => {\n        const startValue = startValues[prop];\n        const endValue = properties[prop];\n        const currentValue = this._interpolateValue(startValue, endValue, easedProgress);\n        this._applyValue(element, prop, currentValue);\n      });\n\n      if (progress < 1 && this.activeAnimations.has(animationId)) {\n        requestAnimationFrame(animate);\n      } else {\n        this.activeAnimations.delete(animationId);\n        if (callback) callback();\n      }\n    };\n\n    this.activeAnimations.set(animationId, { element, animate, callback });\n    requestAnimationFrame(animate);\n\n    return animationId;\n  }\n\n  /**\n   * Cancels an animation\n   * @param {number} animationId - Animation ID to cancel\n   */\n  cancel(animationId) {\n    if (this.activeAnimations.has(animationId)) {\n      this.activeAnimations.delete(animationId);\n    }\n  }\n\n  /**\n   * Cancels all animations\n   */\n  cancelAll() {\n    this.activeAnimations.clear();\n  }\n\n  /**\n   * Gets initial value for a property\n   * @private\n   * @param {HTMLElement} element - Element\n   * @param {string} property - Property name\n   * @returns {number} Initial value\n   */\n  _getInitialValue(element, property) {\n    if (!element || !element.style) return 0;\n    switch (property) {\n      case 'opacity':\n        return parseFloat(getComputedStyle(element).opacity) || 1;\n      case 'left':\n        return parseFloat(element.style.left) || 0;\n      case 'top':\n        return parseFloat(element.style.top) || 0;\n      case 'scale':\n        return 1;\n      default:\n        return 0;\n    }\n  }\n\n  /**\n   * Interpolates between two values\n   * @private\n   * @param {number} start - Start value\n   * @param {number} end - End value\n   * @param {number} progress - Progress (0-1)\n   * @returns {number} Interpolated value\n   */\n  _interpolateValue(start, end, progress) {\n    return start + (end - start) * progress;\n  }\n\n  /**\n   * Applies animated value to element\n   * @private\n   * @param {HTMLElement} element - Element\n   * @param {string} property - Property name\n   * @param {number} value - Value to apply\n   */\n  _applyValue(element, property, value) {\n    if (!element || !element.style) return;\n    switch (property) {\n      case 'opacity':\n        element.style.opacity = value;\n        break;\n      case 'left':\n        element.style.left = `${value}px`;\n        break;\n      case 'top':\n        element.style.top = `${value}px`;\n        break;\n      case 'scale':\n        element.style.transform = `scale(${value})`;\n        break;\n      default:\n        element.style[property] = value;\n    }\n  }\n\n  /**\n   * Cleans up resources\n   */\n  destroy() {\n    this.cancelAll();\n  }\n}\n","/**\n * Service for managing board setup and DOM operations\n * @module services/BoardService\n * @since 2.0.0\n */\n\nimport { BOARD_SIZE } from '../constants/positions.js';\nimport { DOMError, ValidationError } from '../errors/ChessboardError.js';\nimport { ERROR_MESSAGES } from '../errors/messages.js';\nimport Square from '../components/Square.js';\n\n/**\n * Service responsible for board DOM manipulation and setup\n * @class\n */\nexport class BoardService {\n  /**\n   * Creates a new BoardService instance\n   * @param {ChessboardConfig} config - Board configuration\n   */\n  constructor(config) {\n    this.config = config;\n    this.element = null;\n    this.squares = {};\n  }\n\n  /**\n   * Builds the board DOM element and attaches it to the configured container\n   * @throws {DOMError} When the container element cannot be found\n   */\n  buildBoard() {\n    this.element = document.getElementById(this.config.id_div);\n    if (!this.element) {\n      throw new DOMError(ERROR_MESSAGES.invalid_id_div + this.config.id_div, this.config.id_div);\n    }\n\n    this.resize(this.config.size);\n    this.element.className = 'board';\n  }\n\n  /**\n   * Creates all 64 squares and adds them to the board\n   * @param {Function} coordConverter - Function to convert row/col to real coordinates\n   */\n  buildSquares(coordConverter) {\n    for (let row = 0; row < BOARD_SIZE.ROWS; row++) {\n      for (let col = 0; col < BOARD_SIZE.COLS; col++) {\n        const [squareRow, squareCol] = coordConverter(row, col);\n        const square = new Square(squareRow, squareCol);\n\n        this.squares[square.getId()] = square;\n        this.element.appendChild(square.element);\n      }\n    }\n  }\n\n  /**\n   * Removes all squares from the board and cleans up their resources\n   * Best practice: always destroy JS objects and DOM nodes, and clear references.\n   */\n  removeSquares() {\n    for (const square of Object.values(this.squares)) {\n      // Always call destroy to remove DOM and clear piece reference\n      square.destroy();\n    }\n    this.squares = {};\n  }\n\n  /**\n   * Removes all content from the board element\n   * Best practice: clear DOM and force element to be re-fetched on next build.\n   */\n  removeBoard() {\n    if (this.element) {\n      this.element.innerHTML = '';\n      this.element = null;\n    }\n  }\n\n  /**\n   * Resizes the board to the specified size\n   * @param {number|string} value - Size in pixels or 'auto'\n   * @throws {ValidationError} When size value is invalid\n   */\n  resize(value) {\n    if (value === 'auto') {\n      const size = this._calculateAutoSize();\n      this.resize(size);\n    } else if (typeof value !== 'number') {\n      throw new ValidationError(ERROR_MESSAGES.invalid_value + value, 'size', value);\n    } else {\n      document.documentElement.style.setProperty('--dimBoard', `${value}px`);\n    }\n  }\n\n  /**\n   * Calculates the optimal size when 'auto' is specified\n   * @private\n   * @returns {number} Calculated size in pixels\n   */\n  _calculateAutoSize() {\n    if (!this.element) return 400; // Default fallback\n\n    const { offsetWidth, offsetHeight } = this.element;\n\n    if (offsetWidth === 0) {\n      return offsetHeight || 400;\n    } else if (offsetHeight === 0) {\n      return offsetWidth;\n    }\n    return Math.min(offsetWidth, offsetHeight);\n  }\n\n  /**\n   * Gets a square by its ID\n   * @param {string} squareId - Square identifier (e.g., 'e4')\n   * @returns {Square|null} The square or null if not found\n   */\n  getSquare(squareId) {\n    return this.squares[squareId] || null;\n  }\n\n  /**\n   * Gets all squares\n   * @returns {Object.<string, Square>} All squares indexed by ID\n   */\n  getAllSquares() {\n    return { ...this.squares };\n  }\n\n  /**\n   * Applies a method to all squares\n   * @param {string} methodName - Name of the method to call on each square\n   * @param {...*} args - Arguments to pass to the method\n   */\n  applyToAllSquares(methodName, ...args) {\n    for (const square of Object.values(this.squares)) {\n      if (typeof square[methodName] === 'function') {\n        square[methodName](...args);\n      }\n    }\n  }\n\n  /**\n   * Cleans up all resources\n   */\n  destroy() {\n    this.removeSquares();\n    this.removeBoard();\n    this.element = null;\n    this.squares = {};\n  }\n}\n","/**\n * Service for managing coordinate conversions and board orientation\n * @module services/CoordinateService\n * @since 2.0.0\n */\n\nimport { BOARD_LETTERS } from '../constants/positions.js';\nimport { ValidationError } from '../errors/ChessboardError.js';\nimport { ERROR_MESSAGES } from '../errors/messages.js';\n\n/**\n * Service responsible for coordinate conversions and board orientation\n * @class\n */\nexport class CoordinateService {\n  /**\n   * Creates a new CoordinateService instance\n   * @param {ChessboardConfig} config - Board configuration\n   */\n  constructor(config) {\n    this.config = config;\n  }\n\n  /**\n   * Converts logical coordinates to real coordinates based on board orientation\n   * @param {number} row - Row index (0-7)\n   * @param {number} col - Column index (0-7)\n   * @returns {Array<number>} Real coordinates [row, col] (1-8)\n   */\n  realCoord(row, col) {\n    let realRow = row;\n    let realCol = col;\n\n    if (this.isWhiteOriented()) {\n      realRow = 7 - row;\n    } else {\n      realCol = 7 - col;\n    }\n\n    return [realRow + 1, realCol + 1];\n  }\n\n  /**\n   * Converts board coordinates to square ID\n   * @param {number} row - Row index (0-7)\n   * @param {number} col - Column index (0-7)\n   * @returns {string} Square ID (e.g., 'e4')\n   */\n  getSquareID(row, col) {\n    row = parseInt(row);\n    col = parseInt(col);\n\n    if (this.isWhiteOriented()) {\n      row = 8 - row;\n      col = col + 1;\n    } else {\n      row = row + 1;\n      col = 8 - col;\n    }\n\n    if (col < 1 || col > 8 || row < 1 || row > 8) {\n      throw new ValidationError(\n        `Invalid board coordinates: row=${row}, col=${col}`,\n        'coordinates',\n        { row, col }\n      );\n    }\n\n    const letter = BOARD_LETTERS[col - 1];\n    return letter + row;\n  }\n\n  /**\n   * Converts square ID to board coordinates\n   * @param {string} squareId - Square ID (e.g., 'e4')\n   * @returns {Array<number>} Board coordinates [row, col] (0-7)\n   */\n  getCoordinatesFromSquareID(squareId) {\n    if (typeof squareId !== 'string' || squareId.length !== 2) {\n      throw new ValidationError(ERROR_MESSAGES.invalid_square + squareId, 'squareId', squareId);\n    }\n\n    const letter = squareId[0];\n    const number = parseInt(squareId[1]);\n\n    const col = BOARD_LETTERS.indexOf(letter);\n    if (col === -1) {\n      throw new ValidationError(ERROR_MESSAGES.invalid_square + squareId, 'squareId', squareId);\n    }\n\n    if (number < 1 || number > 8) {\n      throw new ValidationError(ERROR_MESSAGES.invalid_square + squareId, 'squareId', squareId);\n    }\n\n    let row, boardCol;\n\n    if (this.isWhiteOriented()) {\n      row = 8 - number;\n      boardCol = col;\n    } else {\n      row = number - 1;\n      boardCol = 7 - col;\n    }\n\n    return [row, boardCol];\n  }\n\n  /**\n   * Converts pixel coordinates to square ID\n   * @param {number} x - X coordinate in pixels\n   * @param {number} y - Y coordinate in pixels\n   * @param {HTMLElement} boardElement - Board DOM element\n   * @returns {string|null} Square ID or null if outside board\n   */\n  pixelToSquareID(x, y, boardElement) {\n    if (!boardElement) return null;\n\n    const rect = boardElement.getBoundingClientRect();\n    const { width, height } = rect;\n\n    // Check if coordinates are within board bounds\n    if (x < 0 || x >= width || y < 0 || y >= height) {\n      return null;\n    }\n\n    const squareWidth = width / 8;\n    const squareHeight = height / 8;\n\n    const col = Math.floor(x / squareWidth);\n    const row = Math.floor(y / squareHeight);\n\n    try {\n      return this.getSquareID(row, col);\n    } catch {\n      return null;\n    }\n  }\n\n  /**\n   * Converts square ID to pixel coordinates\n   * @param {string} squareId - Square ID (e.g., 'e4')\n   * @param {HTMLElement} boardElement - Board DOM element\n   * @returns {Object|null} Pixel coordinates {x, y} or null if invalid\n   */\n  squareIDToPixel(squareId, boardElement) {\n    if (!boardElement) return null;\n\n    try {\n      const [row, col] = this.getCoordinatesFromSquareID(squareId);\n      const rect = boardElement.getBoundingClientRect();\n      const { width, height } = rect;\n\n      const squareWidth = width / 8;\n      const squareHeight = height / 8;\n\n      const x = col * squareWidth;\n      const y = row * squareHeight;\n\n      return { x, y };\n    } catch {\n      return null;\n    }\n  }\n\n  /**\n   * Gets the center pixel coordinates of a square\n   * @param {string} squareId - Square ID (e.g., 'e4')\n   * @param {HTMLElement} boardElement - Board DOM element\n   * @returns {Object|null} Center coordinates {x, y} or null if invalid\n   */\n  getSquareCenter(squareId, boardElement) {\n    const coords = this.squareIDToPixel(squareId, boardElement);\n    if (!coords) return null;\n\n    const rect = boardElement.getBoundingClientRect();\n    const squareWidth = rect.width / 8;\n    const squareHeight = rect.height / 8;\n\n    return {\n      x: coords.x + squareWidth / 2,\n      y: coords.y + squareHeight / 2,\n    };\n  }\n\n  /**\n   * Calculates the distance between two squares\n   * @param {string} fromSquare - Source square ID\n   * @param {string} toSquare - Target square ID\n   * @returns {number} Distance between squares\n   */\n  getSquareDistance(fromSquare, toSquare) {\n    try {\n      const [fromRow, fromCol] = this.getCoordinatesFromSquareID(fromSquare);\n      const [toRow, toCol] = this.getCoordinatesFromSquareID(toSquare);\n\n      const rowDiff = Math.abs(toRow - fromRow);\n      const colDiff = Math.abs(toCol - fromCol);\n\n      return Math.sqrt(rowDiff * rowDiff + colDiff * colDiff);\n    } catch {\n      return 0;\n    }\n  }\n\n  /**\n   * Checks if the board is oriented from white's perspective\n   * @returns {boolean} True if white-oriented\n   */\n  isWhiteOriented() {\n    return this.config.orientation === 'w';\n  }\n\n  /**\n   * Checks if the board is oriented from black's perspective\n   * @returns {boolean} True if black-oriented\n   */\n  isBlackOriented() {\n    return this.config.orientation === 'b';\n  }\n\n  /**\n   * Gets the current orientation\n   * @returns {string} Current orientation ('w' or 'b')\n   */\n  getOrientation() {\n    return this.config.orientation;\n  }\n\n  /**\n   * Sets the orientation\n   * @param {string} orientation - New orientation ('w', 'b', 'white', 'black')\n   */\n  setOrientation(orientation) {\n    // Normalize orientation\n    const normalizedOrientation =\n      orientation === 'white' ? 'w' : orientation === 'black' ? 'b' : orientation;\n\n    if (normalizedOrientation !== 'w' && normalizedOrientation !== 'b') {\n      throw new ValidationError(\n        `${ERROR_MESSAGES.invalid_orientation}${orientation}`,\n        'orientation',\n        orientation\n      );\n    }\n\n    this.config.orientation = normalizedOrientation;\n  }\n\n  /**\n   * Flips the board orientation\n   */\n  flipOrientation() {\n    this.config.orientation = this.isWhiteOriented() ? 'b' : 'w';\n  }\n\n  /**\n   * Gets all square IDs in order\n   * @returns {Array<string>} Array of all square IDs\n   */\n  getAllSquareIDs() {\n    const squares = [];\n\n    for (let row = 0; row < 8; row++) {\n      for (let col = 0; col < 8; col++) {\n        squares.push(this.getSquareID(row, col));\n      }\n    }\n\n    return squares;\n  }\n\n  /**\n   * Gets squares in a specific rank (row)\n   * @param {number} rank - Rank number (1-8)\n   * @returns {Array<string>} Array of square IDs in the rank\n   */\n  getSquaresByRank(rank) {\n    if (rank < 1 || rank > 8) {\n      throw new ValidationError(`Invalid rank: ${rank}`, 'rank', rank);\n    }\n\n    const squares = [];\n\n    for (let col = 0; col < 8; col++) {\n      const row = this.isWhiteOriented() ? 8 - rank : rank - 1;\n      squares.push(this.getSquareID(row, col));\n    }\n\n    return squares;\n  }\n\n  /**\n   * Gets squares in a specific file (column)\n   * @param {string} file - File letter (a-h)\n   * @returns {Array<string>} Array of square IDs in the file\n   */\n  getSquaresByFile(file) {\n    const col = BOARD_LETTERS.indexOf(file);\n    if (col === -1) {\n      throw new ValidationError(`Invalid file: ${file}`, 'file', file);\n    }\n\n    const squares = [];\n\n    for (let row = 0; row < 8; row++) {\n      squares.push(this.getSquareID(row, col));\n    }\n\n    return squares;\n  }\n}\n","/**\n * Cross-browser utilities for consistent drag & drop behavior\n */\n\n/**\n * Detect browser type and version\n * @returns {Object} Browser information\n */\nexport function getBrowserInfo() {\n    const ua = navigator.userAgent;\n    const isChrome = ua.includes('Chrome') && !ua.includes('Edg');\n    const isFirefox = ua.includes('Firefox');\n    const isSafari = ua.includes('Safari') && !ua.includes('Chrome');\n    const isEdge = ua.includes('Edg');\n    \n    return {\n        isChrome,\n        isFirefox,\n        isSafari,\n        isEdge,\n        devicePixelRatio: window.devicePixelRatio || 1,\n        userAgent: ua\n    };\n}\n\n/**\n * Get accurate mouse coordinates accounting for browser differences\n * @param {MouseEvent} event - Mouse event\n * @returns {Object} Normalized coordinates\n */\nexport function getNormalizedCoordinates(event) {\n    const browserInfo = getBrowserInfo();\n    \n    // Base coordinates\n    let x = event.clientX;\n    let y = event.clientY;\n    \n    // Add scroll offset for absolute positioning\n    x += window.scrollX || window.pageXOffset || 0;\n    y += window.scrollY || window.pageYOffset || 0;\n    \n    // Chrome-specific adjustments if needed\n    if (browserInfo.isChrome) {\n        // Chrome sometimes has sub-pixel rendering differences\n        x = Math.round(x);\n        y = Math.round(y);\n    }\n    \n    return { x, y };\n}\n\n/**\n * Set element position using the most compatible method\n * @param {HTMLElement} element - Element to position\n * @param {number} x - X coordinate\n * @param {number} y - Y coordinate\n */\nexport function setElementPosition(element, x, y) {\n    // Ensure pixel-perfect positioning\n    element.style.left = `${Math.round(x)}px`;\n    element.style.top = `${Math.round(y)}px`;\n}\n\n/**\n * Calculate offset from center for drag positioning\n * @param {HTMLElement} element - Element being dragged\n * @param {number} mouseX - Mouse X coordinate\n * @param {number} mouseY - Mouse Y coordinate\n * @returns {Object} Position coordinates\n */\nexport function calculateDragPosition(element, mouseX, mouseY) {\n    const rect = element.getBoundingClientRect();\n    const halfWidth = rect.width / 2;\n    const halfHeight = rect.height / 2;\n    \n    return {\n        x: mouseX - halfWidth,\n        y: mouseY - halfHeight\n    };\n}\n\n/**\n * Enhanced mouse coordinate tracking for cross-browser compatibility\n */\nexport class MouseTracker {\n    constructor() {\n        this.lastKnownPosition = { x: 0, y: 0 };\n        this.browserInfo = getBrowserInfo();\n    }\n    \n    /**\n     * Update position from mouse event\n     * @param {MouseEvent} event - Mouse event\n     * @returns {Object} Normalized position\n     */\n    updatePosition(event) {\n        const coords = getNormalizedCoordinates(event);\n        this.lastKnownPosition = coords;\n        return coords;\n    }\n    \n    /**\n     * Get element position for dragging\n     * @param {HTMLElement} element - Element to position\n     * @param {MouseEvent} event - Mouse event\n     * @returns {Object} Position for the element\n     */\n    getDragPosition(element, event) {\n        const mousePos = this.updatePosition(event);\n        return calculateDragPosition(element, mousePos.x, mousePos.y);\n    }\n}\n\n/**\n * Browser-specific drag optimizations\n */\nexport const DragOptimizations = {\n    /**\n     * Apply browser-specific optimizations to an element\n     * @param {HTMLElement} element - Element to optimize\n     */\n    enableForDrag(element) {\n        const browserInfo = getBrowserInfo();\n        \n        // Base optimizations for all browsers\n        element.style.willChange = 'left, top';\n        element.style.pointerEvents = 'none'; // Prevent conflicts\n        \n        // Chrome-specific optimizations\n        if (browserInfo.isChrome) {\n            element.style.transform = 'translateZ(0)'; // Force hardware acceleration\n        }\n        \n        // Firefox-specific optimizations\n        if (browserInfo.isFirefox) {\n            element.style.backfaceVisibility = 'hidden';\n        }\n    },\n    \n    /**\n     * Clean up optimizations after drag\n     * @param {HTMLElement} element - Element to clean up\n     */\n    cleanupAfterDrag(element) {\n        element.style.willChange = 'auto';\n        element.style.pointerEvents = '';\n        element.style.transform = '';\n        element.style.backfaceVisibility = '';\n    }\n};\n","/**\n * Service for managing events and user interactions\n * Refactored for simplicity and reliability\n * @module services/EventService\n * @since 2.0.0\n */\n\nimport { DragOptimizations } from '../utils/cross-browser.js';\nimport Move from '../components/Move.js';\n\n/**\n * Service responsible for event handling and user interactions\n * @class\n */\nexport class EventService {\n  /**\n   * Creates a new EventService instance\n   * @param {ChessboardConfig} config - Board configuration\n   * @param {BoardService} boardService - Board service instance\n   * @param {MoveService} moveService - Move service instance\n   * @param {CoordinateService} coordinateService - Coordinate service instance\n   * @param {Chessboard} chessboard - Chessboard instance\n   */\n  constructor(config, boardService, moveService, coordinateService, chessboard) {\n    this.config = config;\n    this.boardService = boardService;\n    this.moveService = moveService;\n    this.coordinateService = coordinateService;\n    this.chessboard = chessboard;\n\n    // State - keep it minimal\n    this.selectedSquare = null; // Currently selected square (for click-to-move)\n    this.isDragging = false;\n    this.isProcessing = false; // Prevents multiple simultaneous operations\n\n    this.eventListeners = new Map();\n  }\n\n  /**\n   * Adds event listeners to all squares\n   */\n  addListeners(onSquareClick, onPieceHover, onPieceLeave) {\n    this.removeListeners();\n\n    const squares = this.boardService.getAllSquares();\n    Object.values(squares).forEach((square) => {\n      this._addSquareListeners(square, onSquareClick, onPieceHover, onPieceLeave);\n    });\n  }\n\n  /**\n   * Adds event listeners to a specific square\n   * @private\n   */\n  _addSquareListeners(square, onSquareClick, onPieceHover, onPieceLeave) {\n    const listeners = [];\n\n    // Hover - only show hints for the hovered square's piece\n    const handleMouseEnter = () => {\n      if (!this.selectedSquare && this.config.hints && square.piece) {\n        onPieceHover(square);\n      }\n    };\n\n    const handleMouseLeave = () => {\n      if (!this.selectedSquare && this.config.hints) {\n        onPieceLeave(square);\n      }\n    };\n\n    // Click handler - simple and direct\n    const handleClick = (e) => {\n      e.stopPropagation();\n      if (this.config.clickable && !this.isProcessing && !this.isDragging) {\n        onSquareClick(square);\n      }\n    };\n\n    // Add listeners\n    square.element.addEventListener('mouseenter', handleMouseEnter);\n    square.element.addEventListener('mouseleave', handleMouseLeave);\n    square.element.addEventListener('click', handleClick);\n\n    listeners.push(\n      { element: square.element, type: 'mouseenter', handler: handleMouseEnter },\n      { element: square.element, type: 'mouseleave', handler: handleMouseLeave },\n      { element: square.element, type: 'click', handler: handleClick }\n    );\n\n    this.eventListeners.set(square.id, listeners);\n  }\n\n  /**\n   * Creates a drag function for a piece\n   */\n  createDragFunction(square, piece, onDragStart, onDragMove, onDrop, onSnapback, onMove, onRemove) {\n    return (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (!this.config.draggable || !piece || this.isProcessing || this.isDragging) {\n        return;\n      }\n\n      if (!this.moveService.canMove(square)) {\n        return;\n      }\n\n      const img = piece.element;\n      const startX = event.clientX || event.touches?.[0]?.clientX || 0;\n      const startY = event.clientY || event.touches?.[0]?.clientY || 0;\n      let hasMoved = false;\n      let targetSquare = null;\n      let lastHighlighted = null;\n\n      const moveAt = (clientX, clientY) => {\n        const boardElement = this.boardService.element;\n        const boardRect = boardElement.getBoundingClientRect();\n        const squareSize = boardRect.width / 8;\n\n        const x = clientX - boardRect.left - squareSize / 2;\n        const y = clientY - boardRect.top - squareSize / 2;\n\n        img.style.left = `${x}px`;\n        img.style.top = `${y}px`;\n\n        // Determine target square\n        const relX = clientX - boardRect.left;\n        const relY = clientY - boardRect.top;\n\n        if (relX >= 0 && relX <= boardRect.width && relY >= 0 && relY <= boardRect.height) {\n          const squareId = this.coordinateService.pixelToSquareID(relX, relY, boardElement);\n          targetSquare = squareId ? this.boardService.getSquare(squareId) : null;\n        } else {\n          targetSquare = null;\n        }\n\n        // Update highlight\n        if (targetSquare !== lastHighlighted) {\n          lastHighlighted?.dehighlight();\n          targetSquare?.highlight();\n          lastHighlighted = targetSquare;\n        }\n      };\n\n      const onMouseMove = (e) => {\n        const clientX = e.clientX || e.touches?.[0]?.clientX || 0;\n        const clientY = e.clientY || e.touches?.[0]?.clientY || 0;\n\n        // Start dragging after threshold\n        if (!hasMoved) {\n          const dx = Math.abs(clientX - startX);\n          const dy = Math.abs(clientY - startY);\n\n          if (dx > 3 || dy > 3) {\n            hasMoved = true;\n            this.isDragging = true;\n\n            // Visual feedback\n            square.select();\n\n            // Prepare piece for dragging\n            const style = window.getComputedStyle(img);\n            img.style.position = 'absolute';\n            img.style.zIndex = '100';\n            img.style.width = style.width;\n            img.style.height = style.height;\n            img.classList.add('dragging');\n\n            DragOptimizations.enableForDrag(img);\n            onDragStart(square, piece);\n          }\n        }\n\n        if (hasMoved) {\n          moveAt(clientX, clientY);\n          onDragMove(square, targetSquare, piece);\n        }\n      };\n\n      const onMouseUp = () => {\n        // Cleanup listeners\n        document.removeEventListener('mousemove', onMouseMove);\n        document.removeEventListener('touchmove', onMouseMove);\n        window.removeEventListener('mouseup', onMouseUp);\n        window.removeEventListener('touchend', onMouseUp);\n\n        lastHighlighted?.dehighlight();\n\n        if (!hasMoved) {\n          this.isDragging = false;\n          return; // Was just a click, let click handler deal with it\n        }\n\n        // Don't reset styles here - let PieceService.translatePiece handle it\n        // when it detects the piece is dragging. This ensures proper style cleanup\n        // after the piece is moved to its new position.\n\n        this.isDragging = false;\n\n        // Handle drop\n        const dropResult = onDrop(square, targetSquare, piece);\n\n        if (!targetSquare) {\n          // Dropped outside board - reset all styles immediately\n          img.classList.remove('dragging');\n          img.style.zIndex = '';\n          img.style.willChange = 'auto';\n          DragOptimizations.cleanupAfterDrag(img);\n\n          if (this.config.dropOffBoard === 'trash' || dropResult === 'trash') {\n            this._resetPiecePosition(img);\n            onRemove(square);\n          } else {\n            this._resetPiecePosition(img);\n            onSnapback(square, piece);\n          }\n          square.deselect();\n          this.boardService.applyToAllSquares('removeHint');\n          return;\n        }\n\n        // Try to make the move - PieceService will handle style cleanup\n        this._handleMove(square, targetSquare, piece, onMove, onSnapback);\n      };\n\n      // Attach listeners\n      document.addEventListener('mousemove', onMouseMove);\n      document.addEventListener('touchmove', onMouseMove, { passive: false });\n      window.addEventListener('mouseup', onMouseUp);\n      window.addEventListener('touchend', onMouseUp);\n    };\n  }\n\n  /**\n   * Resets piece position after failed drag\n   * @private\n   */\n  _resetPiecePosition(img) {\n    if (!img) return;\n    img.style.position = '';\n    img.style.left = '';\n    img.style.top = '';\n    img.style.transform = '';\n    img.style.width = '';\n    img.style.height = '';\n    img.style.zIndex = '';\n    img.classList.remove('dragging');\n    DragOptimizations.cleanupAfterDrag(img);\n  }\n\n  /**\n   * Handles a move attempt (from drag or click)\n   * @private\n   */\n  _handleMove(fromSquare, toSquare, piece, onMove, onSnapback) {\n    if (this.isProcessing) return;\n    this.isProcessing = true;\n\n    const cleanup = () => {\n      this.isProcessing = false;\n      this.selectedSquare = null;\n      fromSquare.deselect();\n      this.boardService.applyToAllSquares('removeHint');\n    };\n\n    // Check if promotion is needed\n    const move = new Move(fromSquare, toSquare);\n    if (this.moveService.requiresPromotion(move)) {\n      this._handlePromotion(fromSquare, toSquare, piece, onMove, onSnapback, cleanup);\n      return;\n    }\n\n    // Try normal move\n    const success = onMove(fromSquare, toSquare, null, true);\n\n    if (success) {\n      cleanup();\n    } else {\n      // Move failed - snapback\n      this._resetPiecePosition(piece.element);\n      onSnapback(fromSquare, piece);\n      cleanup();\n    }\n  }\n\n  /**\n   * Handles promotion move\n   * @private\n   */\n  _handlePromotion(fromSquare, toSquare, piece, onMove, onSnapback, cleanup) {\n    // Show promotion UI\n    this.moveService.setupPromotion(\n      new Move(fromSquare, toSquare),\n      this.boardService.squares,\n      (selectedPiece) => {\n        // Promotion selected\n        this.boardService.applyToAllSquares('removePromotion');\n        this.boardService.applyToAllSquares('removeCover');\n\n        const success = onMove(fromSquare, toSquare, selectedPiece, true);\n\n        if (success) {\n          // Update the piece visually after move\n          this._updatePromotedPiece(toSquare, selectedPiece);\n        } else {\n          this._resetPiecePosition(piece.element);\n          onSnapback(fromSquare, piece);\n        }\n        cleanup();\n      },\n      () => {\n        // Promotion cancelled\n        this.boardService.applyToAllSquares('removePromotion');\n        this.boardService.applyToAllSquares('removeCover');\n        this._resetPiecePosition(piece.element);\n        onSnapback(fromSquare, piece);\n        cleanup();\n      }\n    );\n  }\n\n  /**\n   * Updates piece after promotion\n   * @private\n   */\n  _updatePromotedPiece(square, promotionPiece) {\n    setTimeout(() => {\n      const targetSquare = this.boardService.getSquare(square.id);\n      if (!targetSquare?.piece) return;\n\n      const game = this.chessboard.positionService.getGame();\n      const gamePiece = game.get(square.id);\n      if (!gamePiece) return;\n\n      const pieceId = promotionPiece + gamePiece.color;\n      const piecePath = this.chessboard.pieceService.getPiecePath(pieceId);\n\n      targetSquare.piece.transformTo(promotionPiece, piecePath, 200, () => {\n        const dragFn = this.chessboard._createDragFunction.bind(this.chessboard);\n        targetSquare.piece.setDrag(dragFn(targetSquare, targetSquare.piece));\n      });\n    }, 100);\n  }\n\n  /**\n   * Handles square click events\n   */\n  onClick(square, onMove, onSelect, onDeselect, animate = true) {\n    if (this.isProcessing || this.isDragging) {\n      return false;\n    }\n\n    // Case 1: No square selected yet\n    if (!this.selectedSquare) {\n      if (this.moveService.canMove(square)) {\n        this.selectedSquare = square;\n        onSelect(square);\n      }\n      return false;\n    }\n\n    // Case 2: Clicking the same square - deselect\n    if (this.selectedSquare === square) {\n      onDeselect(square);\n      this.selectedSquare = null;\n      return false;\n    }\n\n    // Case 3: Try to make a move\n    const from = this.selectedSquare;\n    const move = new Move(from, square);\n\n    // Check for promotion\n    if (this.moveService.requiresPromotion(move)) {\n      this._handlePromotion(\n        from,\n        square,\n        from.piece,\n        onMove,\n        () => {}, // No snapback needed for click moves\n        () => {\n          onDeselect(from);\n          this.selectedSquare = null;\n        }\n      );\n      return false;\n    }\n\n    // Try normal move\n    const success = onMove(from, square, null, animate);\n\n    if (success) {\n      onDeselect(from);\n      this.selectedSquare = null;\n      return true;\n    }\n\n    // Move failed - try to select the new square instead\n    onDeselect(from);\n    this.selectedSquare = null;\n    this.boardService.applyToAllSquares('removeHint');\n\n    if (this.moveService.canMove(square)) {\n      this.selectedSquare = square;\n      onSelect(square);\n    }\n\n    return false;\n  }\n\n  // State management\n  setClicked(square) {\n    this.selectedSquare = square;\n  }\n\n  getClicked() {\n    return this.selectedSquare;\n  }\n\n  setPromoting(_promotion) {\n    // Kept for compatibility but not used in refactored version\n  }\n\n  getPromoting() {\n    return false;\n  }\n\n  setAnimating(_isAnimating) {\n    // Kept for compatibility\n  }\n\n  getAnimating() {\n    return this.isProcessing;\n  }\n\n  /**\n   * Removes all event listeners\n   */\n  removeListeners() {\n    this.eventListeners.forEach((listeners) => {\n      listeners.forEach(({ element, type, handler }) => {\n        element.removeEventListener(type, handler);\n      });\n    });\n    this.eventListeners.clear();\n  }\n\n  removeAllListeners() {\n    this.removeListeners();\n  }\n\n  /**\n   * Cleans up resources\n   */\n  destroy() {\n    this.removeAllListeners();\n    this.selectedSquare = null;\n    this.isDragging = false;\n    this.isProcessing = false;\n  }\n}\n","/**\n * Service for managing chess moves and move validation\n * @module services/MoveService\n * @since 2.0.0\n */\n\nimport Move from '../components/Move.js';\nimport { MoveError } from '../errors/ChessboardError.js';\nimport { ERROR_MESSAGES } from '../errors/messages.js';\nimport { PROMOTION_PIECES } from '../constants/positions.js';\n\n/**\n * Service responsible for move management and validation\n * @class\n */\nexport class MoveService {\n  /**\n   * Creates a new MoveService instance\n   * @param {ChessboardConfig} config - Board configuration\n   * @param {PositionService} positionService - Position service instance\n   */\n  constructor(config, positionService) {\n    this.config = config;\n    this.positionService = positionService;\n    this._movesCache = new Map();\n    this._cacheTimeout = null;\n  }\n\n  /**\n   * Checks if a piece on a square can move\n   * @param {Square} square - Square to check\n   * @returns {boolean} True if piece can move\n   */\n  canMove(square) {\n    if (!square.piece) return false;\n\n    const { movableColors, onlyLegalMoves } = this.config;\n\n    if (movableColors === 'none') return false;\n    if (movableColors === 'w' && square.piece.color === 'b') return false;\n    if (movableColors === 'b' && square.piece.color === 'w') return false;\n\n    if (!onlyLegalMoves) return true;\n\n    // Check if position service and game are available\n    if (!this.positionService || !this.positionService.getGame()) {\n      return false;\n    }\n\n    const game = this.positionService.getGame();\n    return square.piece.color === game.turn();\n  }\n\n  /**\n   * Converts various move formats to a Move instance\n   * @param {string|Move} move - Move in various formats\n   * @param {Object} squares - All board squares\n   * @returns {Move} Move instance\n   * @throws {MoveError} When move format is invalid\n   */\n  convertMove(move, squares) {\n    if (move instanceof Move) {\n      return move;\n    }\n\n    if (typeof move === 'string' && move.length >= 4) {\n      const fromId = move.slice(0, 2);\n      const toId = move.slice(2, 4);\n      const promotion = move.slice(4, 5) || null;\n\n      if (!squares[fromId] || !squares[toId]) {\n        throw new MoveError(ERROR_MESSAGES.invalid_move_format, fromId, toId);\n      }\n\n      return new Move(squares[fromId], squares[toId], promotion);\n    }\n\n    throw new MoveError(ERROR_MESSAGES.invalid_move_format, 'unknown', 'unknown');\n  }\n\n  /**\n   * Checks if a move is legal\n   * @param {Move} move - Move to check\n   * @returns {boolean} True if move is legal\n   */\n  isLegalMove(move) {\n    const legalMoves = this.getLegalMoves(move.from.id);\n\n    return legalMoves.some(\n      (legalMove) => legalMove.to === move.to.id && move.promotion === legalMove.promotion\n    );\n  }\n\n  /**\n   * Gets all legal moves for a square or the entire position\n   * @param {string} [from] - Square to get moves from (optional)\n   * @param {boolean} [verbose=true] - Whether to return verbose move objects\n   * @returns {Array} Array of legal moves\n   */\n  getLegalMoves(from = null, verbose = true) {\n    // Check if position service and game are available\n    if (!this.positionService || !this.positionService.getGame()) {\n      return [];\n    }\n\n    const game = this.positionService.getGame();\n\n    if (!game) return [];\n\n    const options = { verbose };\n    if (from) {\n      options.square = from;\n    }\n\n    return game.moves(options);\n  }\n\n  /**\n   * Gets legal moves with caching for performance\n   * @param {Square} square - Square to get moves from\n   * @returns {Array} Array of legal moves\n   */\n  getCachedLegalMoves(square) {\n    // Check if position service and game are available\n    if (!this.positionService || !this.positionService.getGame()) {\n      return [];\n    }\n\n    const game = this.positionService.getGame();\n    if (!game) return [];\n\n    const cacheKey = `${square.id}-${game.fen()}`;\n    let moves = this._movesCache.get(cacheKey);\n\n    if (!moves) {\n      moves = game.moves({ square: square.id, verbose: true });\n      this._movesCache.set(cacheKey, moves);\n\n      // Clear cache after a short delay to prevent memory buildup\n      if (this._cacheTimeout) {\n        clearTimeout(this._cacheTimeout);\n      }\n\n      this._cacheTimeout = setTimeout(() => {\n        this._movesCache.clear();\n      }, 1000);\n    }\n\n    return moves;\n  }\n\n  /**\n   * Executes a move on the game\n   * @param {Move} move - Move to execute\n   * @returns {Object|null} Move result from chess.js or null if invalid\n   */\n  executeMove(move) {\n    // Check if position service and game are available\n    if (!this.positionService || !this.positionService.getGame()) {\n      return null;\n    }\n\n    const game = this.positionService.getGame();\n    if (!game) return null;\n\n    const moveOptions = {\n      from: move.from.id,\n      to: move.to.id,\n    };\n\n    if (move.hasPromotion()) {\n      moveOptions.promotion = move.promotion;\n    }\n\n    const result = game.move(moveOptions);\n\n    return result;\n  }\n\n  /**\n   * Checks if a move requires promotion\n   * @param {Move} move - Move to check\n   * @returns {boolean} True if promotion is required\n   */\n  requiresPromotion(move) {\n    if (!this.config.onlyLegalMoves) {\n      return false;\n    }\n\n    const game = this.positionService?.getGame();\n    if (!game) {\n      return false;\n    }\n\n    const piece = game.get(move.from.id);\n    if (!piece || piece.type !== 'p') {\n      return false;\n    }\n\n    const targetRank = move.to.row;\n\n    // Check if moving to promotion rank\n    if (piece.color === 'w' && targetRank !== 8) {\n      return false;\n    }\n    if (piece.color === 'b' && targetRank !== 1) {\n      return false;\n    }\n\n    // Check if this is a legal pawn move\n    const legalMoves = game.moves({ square: move.from.id, verbose: true });\n    const matchingMove = legalMoves.find((m) => m.to === move.to.id);\n\n    return !!matchingMove;\n  }\n\n  /**\n   * Handles promotion UI setup\n   * @param {Move} move - Move requiring promotion\n   * @param {Object} squares - All board squares\n   * @param {Function} onPromotionSelect - Callback when promotion piece is selected\n   * @param {Function} onPromotionCancel - Callback when promotion is cancelled\n   * @returns {boolean} True if promotion UI was set up\n   */\n  setupPromotion(move, squares, onPromotionSelect, onPromotionCancel) {\n    const game = this.positionService?.getGame();\n    if (!game) return false;\n\n    const piece = game.get(move.from.id);\n    if (!piece) return false;\n\n    const targetSquare = move.to;\n\n    // Clear any existing promotion UI\n    Object.values(squares).forEach((square) => {\n      square.removePromotion();\n      square.removeCover();\n    });\n\n    // Show promotion choices in a column\n    this._showPromotionInColumn(targetSquare, piece, squares, onPromotionSelect, onPromotionCancel);\n\n    return true;\n  }\n\n  /**\n   * Shows promotion choices in a column\n   * @private\n   */\n  _showPromotionInColumn(targetSquare, piece, squares, onPromotionSelect, onPromotionCancel) {\n    // Set up promotion choices starting from border row\n    PROMOTION_PIECES.forEach((pieceType, index) => {\n      const choiceSquare = this._findPromotionSquare(targetSquare, index, squares);\n\n      if (choiceSquare) {\n        const pieceId = pieceType + piece.color;\n        const piecePath = this._getPiecePathForPromotion(pieceId);\n\n        choiceSquare.putPromotion(piecePath, () => {\n          onPromotionSelect(pieceType);\n        });\n      }\n    });\n\n    // Set up cover squares (for cancellation)\n    Object.values(squares).forEach((square) => {\n      if (!square.hasPromotion()) {\n        square.putCover(() => {\n          onPromotionCancel();\n        });\n      }\n    });\n\n    return true;\n  }\n\n  /**\n   * Finds the appropriate square for a promotion piece\n   * @private\n   * @param {Square} targetSquare - Target square of the promotion move\n   * @param {number} distance - Distance from target square\n   * @param {Object} squares - All board squares\n   * @returns {Square|null} Square for promotion piece or null\n   */\n  _findPromotionSquare(targetSquare, index, squares) {\n    const col = targetSquare.col;\n    const baseRow = targetSquare.row;\n\n    // Calculate row based on index and promotion direction\n    // Start from the border row (1 or 8) and go inward\n    let row;\n    if (baseRow === 8) {\n      // White promotion: start from row 8 and go down\n      row = 8 - index;\n    } else if (baseRow === 1) {\n      // Black promotion: start from row 1 and go up\n      row = 1 + index;\n    } else {\n      return null;\n    }\n\n    // Ensure row is within bounds\n    if (row < 1 || row > 8) {\n      return null;\n    }\n\n    // Find square by row/col\n    for (const square of Object.values(squares)) {\n      if (square.col === col && square.row === row) {\n        return square;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Gets piece path for promotion UI\n   * @private\n   * @param {string} pieceId - Piece identifier\n   * @returns {string} Path to piece asset\n   */\n  _getPiecePathForPromotion(pieceId) {\n    // This would typically use the PieceService\n    // For now, we'll use a simple implementation\n    const { piecesPath } = this.config;\n\n    if (typeof piecesPath === 'string') {\n      return `${piecesPath}/${pieceId}.svg`;\n    }\n\n    // Fallback for other path types\n    return `assets/pieces/${pieceId}.svg`;\n  }\n\n  /**\n   * Parses a move string into a move object\n   * @param {string} moveString - Move string (e.g., 'e2e4', 'e7e8q')\n   * @returns {Object|null} Move object or null if invalid\n   */\n  parseMove(moveString) {\n    if (typeof moveString !== 'string' || moveString.length < 4 || moveString.length > 5) {\n      return null;\n    }\n\n    const from = moveString.slice(0, 2);\n    const to = moveString.slice(2, 4);\n    const promotion = moveString.slice(4, 5);\n\n    // Basic validation\n    if (!/^[a-h][1-8]$/.test(from) || !/^[a-h][1-8]$/.test(to)) {\n      return null;\n    }\n\n    if (promotion && !['q', 'r', 'b', 'n'].includes(promotion.toLowerCase())) {\n      return null;\n    }\n\n    return {\n      from,\n      to,\n      promotion: promotion || null,\n    };\n  }\n\n  /**\n   * Checks if a move is a castle move\n   * @param {Object} gameMove - Game move object from chess.js\n   * @returns {boolean} True if move is castle\n   */\n  isCastle(gameMove) {\n    return gameMove && (gameMove.isKingsideCastle() || gameMove.isQueensideCastle());\n  }\n\n  /**\n   * Gets the rook move for a castle move\n   * @param {Object} gameMove - Game move object from chess.js\n   * @returns {Object|null} Rook move object or null if not castle\n   */\n  getCastleRookMove(gameMove) {\n    if (!this.isCastle(gameMove)) {\n      return null;\n    }\n\n    const isKingSide = gameMove.isKingsideCastle();\n    const isWhite = gameMove.color === 'w';\n\n    if (isKingSide) {\n      // King side castle\n      if (isWhite) {\n        return { from: 'h1', to: 'f1' };\n      }\n      return { from: 'h8', to: 'f8' };\n    }\n    // Queen side castle\n    if (isWhite) {\n      return { from: 'a1', to: 'd1' };\n    }\n    return { from: 'a8', to: 'd8' };\n  }\n\n  /**\n   * Checks if a move is en passant\n   * @param {Object} gameMove - Game move object from chess.js\n   * @returns {boolean} True if move is en passant\n   */\n  isEnPassant(gameMove) {\n    return gameMove && gameMove.isEnPassant();\n  }\n\n  /**\n   * Gets the captured pawn square for en passant\n   * @param {Object} gameMove - Game move object from chess.js\n   * @returns {string|null} Square of captured pawn or null if not en passant\n   */\n  getEnPassantCapturedSquare(gameMove) {\n    if (!this.isEnPassant(gameMove)) {\n      return null;\n    }\n\n    const toSquare = gameMove.to;\n    const rank = parseInt(toSquare[1]);\n    const file = toSquare[0];\n\n    // The captured pawn is on the same file but different rank\n    if (gameMove.color === 'w') {\n      // White captures black pawn one rank below\n      return file + (rank - 1);\n    }\n    // Black captures white pawn one rank above\n    return file + (rank + 1);\n  }\n\n  /**\n   * Clears the moves cache\n   */\n  clearCache() {\n    this._movesCache.clear();\n    if (this._cacheTimeout) {\n      clearTimeout(this._cacheTimeout);\n      this._cacheTimeout = null;\n    }\n  }\n\n  /**\n   * Cleans up resources\n   */\n  destroy() {\n    this.clearCache();\n    this.positionService = null;\n  }\n}\n","/**\n * Service for managing chess pieces and their operations\n * @module services/PieceService\n * @since 2.0.0\n */\n\nimport Piece from '../components/Piece.js';\nimport { PieceError, ValidationError } from '../errors/ChessboardError.js';\nimport { ERROR_MESSAGES } from '../errors/messages.js';\nimport { PIECE_TYPES, PIECE_COLORS } from '../constants/positions.js';\nimport { DragOptimizations } from '../utils/cross-browser.js';\n\n/**\n * Service responsible for piece management and operations\n * @class\n */\nexport class PieceService {\n  /**\n   * Creates a new PieceService instance\n   * @param {ChessboardConfig} config - Board configuration\n   */\n  constructor(config) {\n    this.config = config;\n  }\n\n  /**\n   * Gets the path to a piece asset\n   * @param {string} piece - Piece identifier (e.g., 'wK', 'bP')\n   * @returns {string} Path to piece asset\n   * @throws {ValidationError} When piecesPath configuration is invalid\n   */\n  getPiecePath(piece) {\n    const { piecesPath } = this.config;\n\n    if (typeof piecesPath === 'string') {\n      return `${piecesPath}/${piece}.svg`;\n    } else if (typeof piecesPath === 'object' && piecesPath !== null) {\n      return piecesPath[piece];\n    } else if (typeof piecesPath === 'function') {\n      return piecesPath(piece);\n    }\n    throw new ValidationError(ERROR_MESSAGES.invalid_piecesPath, 'piecesPath', piecesPath);\n  }\n\n  /**\n   * Converts various piece formats to a Piece instance\n   * @param {string|Piece} piece - Piece in various formats\n   * @returns {Piece} Piece instance\n   * @throws {PieceError} When piece format is invalid\n   */\n  convertPiece(piece) {\n    if (piece instanceof Piece) {\n      return piece;\n    }\n\n    if (typeof piece === 'string' && piece.length === 2) {\n      const [first, second] = piece.split('');\n      let type, color;\n\n      // Check format: [type][color] (e.g., 'pw')\n      if (PIECE_TYPES.includes(first.toLowerCase()) && PIECE_COLORS.includes(second)) {\n        type = first.toLowerCase();\n        color = second;\n      }\n      // Check format: [color][type] (e.g., 'wP')\n      else if (PIECE_COLORS.includes(first) && PIECE_TYPES.includes(second.toLowerCase())) {\n        color = first;\n        type = second.toLowerCase();\n      } else {\n        throw new PieceError(ERROR_MESSAGES.invalid_piece + piece, piece);\n      }\n\n      const piecePath = this.getPiecePath(type + color);\n      return new Piece(color, type, piecePath);\n    }\n\n    throw new PieceError(ERROR_MESSAGES.invalid_piece + piece, piece);\n  }\n\n  /**\n   * Adds a piece to a square with optional fade-in animation\n   * @param {Square} square - Target square\n   * @param {Piece} piece - Piece to add\n   * @param {boolean} [fade=true] - Whether to fade in the piece\n   * @param {Function} dragFunction - Function to handle drag events\n   * @param {Function} [callback] - Callback when animation completes\n   */\n  addPieceOnSquare(square, piece, fade = true, dragFunction, callback) {\n    square.putPiece(piece);\n\n    if (dragFunction) {\n      piece.setDrag(dragFunction(square, piece));\n    }\n\n    if (fade && this.config.fadeTime > 0) {\n      piece.fadeIn(\n        this.config.fadeTime,\n        this.config.fadeAnimation,\n        this._getTransitionTimingFunction(),\n        callback\n      );\n    } else {\n      if (callback) callback();\n    }\n\n    piece.visible();\n  }\n\n  /**\n   * Removes a piece from a square with optional fade-out animation\n   * @param {Square} square - Source square\n   * @param {boolean} [fade=true] - Whether to fade out the piece\n   * @param {Function} [callback] - Callback when animation completes\n   * @returns {Piece} The removed piece\n   * @throws {PieceError} When square has no piece to remove\n   */\n  removePieceFromSquare(square, fade = true, callback) {\n    square.check();\n\n    const piece = square.piece;\n    if (!piece) {\n      if (callback) callback();\n      throw new PieceError(ERROR_MESSAGES.square_no_piece, null, square.getId());\n    }\n\n    if (fade && this.config.fadeTime > 0) {\n      piece.fadeOut(\n        this.config.fadeTime,\n        this.config.fadeAnimation,\n        this._getTransitionTimingFunction(),\n        callback\n      );\n    } else {\n      if (callback) callback();\n    }\n\n    square.removePiece();\n    return piece;\n  }\n\n  /**\n   * Moves a piece to a new position with animation\n   * @param {Piece} piece - Piece to move\n   * @param {Square} targetSquare - Target square\n   * @param {number} duration - Animation duration\n   * @param {Function} [callback] - Callback function when animation completes\n   */\n  movePiece(piece, targetSquare, duration, callback) {\n    if (!piece) {\n      if (callback) callback();\n      return;\n    }\n\n    piece.translate(\n      targetSquare,\n      duration,\n      this._getTransitionTimingFunction(),\n      this.config.moveAnimation,\n      callback\n    );\n  }\n\n  /**\n   * Handles piece translation with optional capture\n   * @param {Move} move - Move object containing from/to squares and piece\n   * @param {boolean} removeTarget - Whether to remove piece from target square\n   * @param {boolean} animate - Whether to animate the move\n   * @param {Function} [dragFunction] - Function to create drag handlers\n   * @param {Function} [callback] - Callback function when complete\n   */\n  translatePiece(move, removeTarget, animate, dragFunction = null, callback = null) {\n    if (!move.piece) {\n      if (callback) callback();\n      return;\n    }\n\n    if (removeTarget) {\n      // Deselect the captured piece before removing it\n      move.to.deselect();\n      this.removePieceFromSquare(move.to, false);\n    }\n\n    const changeSquareCallback = () => {\n      // Check if piece still exists and is on the source square\n      if (move.from.piece === move.piece) {\n        move.from.removePiece(true); // Preserve the piece when moving\n      }\n\n      // Only put piece if destination square doesn't already have it\n      if (move.to.piece !== move.piece) {\n        move.to.putPiece(move.piece);\n\n        // Re-attach drag handler if provided\n        if (dragFunction && this.config.draggable && move.piece.element) {\n          move.piece.setDrag(dragFunction(move.to, move.piece));\n        }\n      }\n\n      if (callback) callback();\n    };\n\n    // Check if piece is currently being dragged\n    const isDragging = move.piece.element && move.piece.element.classList.contains('dragging');\n\n    if (isDragging) {\n      // If piece is being dragged, move it immediately then reset styles\n      changeSquareCallback();\n\n      // Reset all inline styles that were set during drag\n      // This ensures the piece uses CSS grid positioning\n      if (move.piece.element) {\n        const el = move.piece.element;\n        el.style.position = '';\n        el.style.left = '';\n        el.style.top = '';\n        el.style.transform = '';\n        el.style.zIndex = '';\n        el.style.width = '';\n        el.style.height = '';\n        el.classList.remove('dragging');\n        DragOptimizations.cleanupAfterDrag(el);\n      }\n    } else {\n      // Normal animation\n      const duration = animate ? this.config.moveTime : 0;\n      this.movePiece(move.piece, move.to, duration, changeSquareCallback);\n    }\n  }\n\n  /**\n   * Snaps a piece back to its original position\n   * @param {Square} square - Square containing the piece\n   * @param {boolean} [animate=true] - Whether to animate the snapback\n   */\n  snapbackPiece(square, animate = true) {\n    if (!square || !square.piece) {\n      return;\n    }\n    const piece = square.piece;\n    const duration = animate ? this.config.snapbackTime : 0;\n    piece.translate(\n      square,\n      duration,\n      this._getTransitionTimingFunction(),\n      this.config.snapbackAnimation\n    );\n  }\n\n  /**\n   * Centers a piece in its square with animation (after successful drop)\n   * @param {Square} square - Square containing the piece to center\n   * @param {boolean} animate - Whether to animate the centering\n   */\n  centerPiece(square, animate = true) {\n    if (!square || !square.piece) {\n      return;\n    }\n    const piece = square.piece;\n    const duration = animate ? this.config.dropCenterTime : 0;\n    piece.translate(\n      square,\n      duration,\n      this._getTransitionTimingFunction(),\n      this.config.dropCenterAnimation,\n      () => {\n        // After animation, reset all drag-related styles\n        if (!piece.element) return;\n        piece.element.style.position = '';\n        piece.element.style.left = '';\n        piece.element.style.top = '';\n        piece.element.style.transform = '';\n        piece.element.style.zIndex = '';\n        // Remove inline dimensions set during drag\n        piece.element.style.width = '';\n        piece.element.style.height = '';\n        // Remove dragging class\n        piece.element.classList.remove('dragging');\n\n        // Clean up drag optimizations that might interfere with click\n        DragOptimizations.cleanupAfterDrag(piece.element);\n      }\n    );\n  }\n\n  /**\n   * Gets the transition timing function for animations\n   * @private\n   * @returns {Function} Timing function\n   */\n  _getTransitionTimingFunction() {\n    return (elapsed, duration, type = 'ease') => {\n      const x = elapsed / duration;\n\n      switch (type) {\n        case 'linear':\n          return x;\n        case 'ease':\n          return x ** 2 * (3 - 2 * x);\n        case 'ease-in':\n          return x ** 2;\n        case 'ease-out':\n          return -1 * (x - 1) ** 2 + 1;\n        case 'ease-in-out':\n          return x < 0.5 ? 2 * x ** 2 : 4 * x - 2 * x ** 2 - 1;\n        default:\n          return x;\n      }\n    };\n  }\n\n  /**\n   * Cleans up resources\n   */\n  destroy() {\n    // Cleanup any cached pieces or references\n  }\n}\n","/**\n * @license\n * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice,\n *    this list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\nexport const WHITE = 'w';\nexport const BLACK = 'b';\nexport const PAWN = 'p';\nexport const KNIGHT = 'n';\nexport const BISHOP = 'b';\nexport const ROOK = 'r';\nexport const QUEEN = 'q';\nexport const KING = 'k';\nexport const DEFAULT_POSITION = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';\nexport class Move {\n  color;\n  from;\n  to;\n  piece;\n  captured;\n  promotion;\n  /**\n   * @deprecated This field is deprecated and will be removed in version 2.0.0.\n   * Please use move descriptor functions instead: `isCapture`, `isPromotion`,\n   * `isEnPassant`, `isKingsideCastle`, `isQueensideCastle`, `isCastle`, and\n   * `isBigPawn`\n   */\n  flags;\n  san;\n  lan;\n  before;\n  after;\n  constructor(chess, internal) {\n    const { color, piece, from, to, flags, captured, promotion } = internal;\n    const fromAlgebraic = algebraic(from);\n    const toAlgebraic = algebraic(to);\n    this.color = color;\n    this.piece = piece;\n    this.from = fromAlgebraic;\n    this.to = toAlgebraic;\n    /*\n     * HACK: The chess['_method']() calls below invoke private methods in the\n     * Chess class to generate SAN and FEN. It's a bit of a hack, but makes the\n     * code cleaner elsewhere.\n     */\n    this.san = chess['_moveToSan'](internal, chess['_moves']({ legal: true }));\n    this.lan = fromAlgebraic + toAlgebraic;\n    this.before = chess.fen();\n    // Generate the FEN for the 'after' key\n    chess['_makeMove'](internal);\n    this.after = chess.fen();\n    chess['_undoMove']();\n    // Build the text representation of the move flags\n    this.flags = '';\n    for (const flag in BITS) {\n      if (BITS[flag] & flags) {\n        this.flags += FLAGS[flag];\n      }\n    }\n    if (captured) {\n      this.captured = captured;\n    }\n    if (promotion) {\n      this.promotion = promotion;\n      this.lan += promotion;\n    }\n  }\n  isCapture() {\n    return this.flags.indexOf(FLAGS['CAPTURE']) > -1;\n  }\n  isPromotion() {\n    return this.flags.indexOf(FLAGS['PROMOTION']) > -1;\n  }\n  isEnPassant() {\n    return this.flags.indexOf(FLAGS['EP_CAPTURE']) > -1;\n  }\n  isKingsideCastle() {\n    return this.flags.indexOf(FLAGS['KSIDE_CASTLE']) > -1;\n  }\n  isQueensideCastle() {\n    return this.flags.indexOf(FLAGS['QSIDE_CASTLE']) > -1;\n  }\n  isBigPawn() {\n    return this.flags.indexOf(FLAGS['BIG_PAWN']) > -1;\n  }\n}\nconst EMPTY = -1;\nconst FLAGS = {\n  NORMAL: 'n',\n  CAPTURE: 'c',\n  BIG_PAWN: 'b',\n  EP_CAPTURE: 'e',\n  PROMOTION: 'p',\n  KSIDE_CASTLE: 'k',\n  QSIDE_CASTLE: 'q',\n};\n// prettier-ignore\nexport const SQUARES = [\n    'a8', 'b8', 'c8', 'd8', 'e8', 'f8', 'g8', 'h8',\n    'a7', 'b7', 'c7', 'd7', 'e7', 'f7', 'g7', 'h7',\n    'a6', 'b6', 'c6', 'd6', 'e6', 'f6', 'g6', 'h6',\n    'a5', 'b5', 'c5', 'd5', 'e5', 'f5', 'g5', 'h5',\n    'a4', 'b4', 'c4', 'd4', 'e4', 'f4', 'g4', 'h4',\n    'a3', 'b3', 'c3', 'd3', 'e3', 'f3', 'g3', 'h3',\n    'a2', 'b2', 'c2', 'd2', 'e2', 'f2', 'g2', 'h2',\n    'a1', 'b1', 'c1', 'd1', 'e1', 'f1', 'g1', 'h1'\n];\nconst BITS = {\n  NORMAL: 1,\n  CAPTURE: 2,\n  BIG_PAWN: 4,\n  EP_CAPTURE: 8,\n  PROMOTION: 16,\n  KSIDE_CASTLE: 32,\n  QSIDE_CASTLE: 64,\n};\n/*\n * NOTES ABOUT 0x88 MOVE GENERATION ALGORITHM\n * ----------------------------------------------------------------------------\n * From https://github.com/jhlywa/chess.js/issues/230\n *\n * A lot of people are confused when they first see the internal representation\n * of chess.js. It uses the 0x88 Move Generation Algorithm which internally\n * stores the board as an 8x16 array. This is purely for efficiency but has a\n * couple of interesting benefits:\n *\n * 1. 0x88 offers a very inexpensive \"off the board\" check. Bitwise AND (&) any\n *    square with 0x88, if the result is non-zero then the square is off the\n *    board. For example, assuming a knight square A8 (0 in 0x88 notation),\n *    there are 8 possible directions in which the knight can move. These\n *    directions are relative to the 8x16 board and are stored in the\n *    PIECE_OFFSETS map. One possible move is A8 - 18 (up one square, and two\n *    squares to the left - which is off the board). 0 - 18 = -18 & 0x88 = 0x88\n *    (because of two-complement representation of -18). The non-zero result\n *    means the square is off the board and the move is illegal. Take the\n *    opposite move (from A8 to C7), 0 + 18 = 18 & 0x88 = 0. A result of zero\n *    means the square is on the board.\n *\n * 2. The relative distance (or difference) between two squares on a 8x16 board\n *    is unique and can be used to inexpensively determine if a piece on a\n *    square can attack any other arbitrary square. For example, let's see if a\n *    pawn on E7 can attack E2. The difference between E7 (20) - E2 (100) is\n *    -80. We add 119 to make the ATTACKS array index non-negative (because the\n *    worst case difference is A8 - H1 = -119). The ATTACKS array contains a\n *    bitmask of pieces that can attack from that distance and direction.\n *    ATTACKS[-80 + 119=39] gives us 24 or 0b11000 in binary. Look at the\n *    PIECE_MASKS map to determine the mask for a given piece type. In our pawn\n *    example, we would check to see if 24 & 0x1 is non-zero, which it is\n *    not. So, naturally, a pawn on E7 can't attack a piece on E2. However, a\n *    rook can since 24 & 0x8 is non-zero. The only thing left to check is that\n *    there are no blocking pieces between E7 and E2. That's where the RAYS\n *    array comes in. It provides an offset (in this case 16) to add to E7 (20)\n *    to check for blocking pieces. E7 (20) + 16 = E6 (36) + 16 = E5 (52) etc.\n */\n// prettier-ignore\n\nconst Ox88 = {\n    a8: 0, b8: 1, c8: 2, d8: 3, e8: 4, f8: 5, g8: 6, h8: 7,\n    a7: 16, b7: 17, c7: 18, d7: 19, e7: 20, f7: 21, g7: 22, h7: 23,\n    a6: 32, b6: 33, c6: 34, d6: 35, e6: 36, f6: 37, g6: 38, h6: 39,\n    a5: 48, b5: 49, c5: 50, d5: 51, e5: 52, f5: 53, g5: 54, h5: 55,\n    a4: 64, b4: 65, c4: 66, d4: 67, e4: 68, f4: 69, g4: 70, h4: 71,\n    a3: 80, b3: 81, c3: 82, d3: 83, e3: 84, f3: 85, g3: 86, h3: 87,\n    a2: 96, b2: 97, c2: 98, d2: 99, e2: 100, f2: 101, g2: 102, h2: 103,\n    a1: 112, b1: 113, c1: 114, d1: 115, e1: 116, f1: 117, g1: 118, h1: 119\n};\nconst PAWN_OFFSETS = {\n  b: [16, 32, 17, 15],\n  w: [-16, -32, -17, -15],\n};\nconst PIECE_OFFSETS = {\n  n: [-18, -33, -31, -14, 18, 33, 31, 14],\n  b: [-17, -15, 17, 15],\n  r: [-16, 1, 16, -1],\n  q: [-17, -16, -15, 1, 17, 16, 15, -1],\n  k: [-17, -16, -15, 1, 17, 16, 15, -1],\n};\n// prettier-ignore\nconst ATTACKS = [\n    20, 0, 0, 0, 0, 0, 0, 24, 0, 0, 0, 0, 0, 0, 20, 0,\n    0, 20, 0, 0, 0, 0, 0, 24, 0, 0, 0, 0, 0, 20, 0, 0,\n    0, 0, 20, 0, 0, 0, 0, 24, 0, 0, 0, 0, 20, 0, 0, 0,\n    0, 0, 0, 20, 0, 0, 0, 24, 0, 0, 0, 20, 0, 0, 0, 0,\n    0, 0, 0, 0, 20, 0, 0, 24, 0, 0, 20, 0, 0, 0, 0, 0,\n    0, 0, 0, 0, 0, 20, 2, 24, 2, 20, 0, 0, 0, 0, 0, 0,\n    0, 0, 0, 0, 0, 2, 53, 56, 53, 2, 0, 0, 0, 0, 0, 0,\n    24, 24, 24, 24, 24, 24, 56, 0, 56, 24, 24, 24, 24, 24, 24, 0,\n    0, 0, 0, 0, 0, 2, 53, 56, 53, 2, 0, 0, 0, 0, 0, 0,\n    0, 0, 0, 0, 0, 20, 2, 24, 2, 20, 0, 0, 0, 0, 0, 0,\n    0, 0, 0, 0, 20, 0, 0, 24, 0, 0, 20, 0, 0, 0, 0, 0,\n    0, 0, 0, 20, 0, 0, 0, 24, 0, 0, 0, 20, 0, 0, 0, 0,\n    0, 0, 20, 0, 0, 0, 0, 24, 0, 0, 0, 0, 20, 0, 0, 0,\n    0, 20, 0, 0, 0, 0, 0, 24, 0, 0, 0, 0, 0, 20, 0, 0,\n    20, 0, 0, 0, 0, 0, 0, 24, 0, 0, 0, 0, 0, 0, 20\n];\n// prettier-ignore\nconst RAYS = [\n    17, 0, 0, 0, 0, 0, 0, 16, 0, 0, 0, 0, 0, 0, 15, 0,\n    0, 17, 0, 0, 0, 0, 0, 16, 0, 0, 0, 0, 0, 15, 0, 0,\n    0, 0, 17, 0, 0, 0, 0, 16, 0, 0, 0, 0, 15, 0, 0, 0,\n    0, 0, 0, 17, 0, 0, 0, 16, 0, 0, 0, 15, 0, 0, 0, 0,\n    0, 0, 0, 0, 17, 0, 0, 16, 0, 0, 15, 0, 0, 0, 0, 0,\n    0, 0, 0, 0, 0, 17, 0, 16, 0, 15, 0, 0, 0, 0, 0, 0,\n    0, 0, 0, 0, 0, 0, 17, 16, 15, 0, 0, 0, 0, 0, 0, 0,\n    1, 1, 1, 1, 1, 1, 1, 0, -1, -1, -1, -1, -1, -1, -1, 0,\n    0, 0, 0, 0, 0, 0, -15, -16, -17, 0, 0, 0, 0, 0, 0, 0,\n    0, 0, 0, 0, 0, -15, 0, -16, 0, -17, 0, 0, 0, 0, 0, 0,\n    0, 0, 0, 0, -15, 0, 0, -16, 0, 0, -17, 0, 0, 0, 0, 0,\n    0, 0, 0, -15, 0, 0, 0, -16, 0, 0, 0, -17, 0, 0, 0, 0,\n    0, 0, -15, 0, 0, 0, 0, -16, 0, 0, 0, 0, -17, 0, 0, 0,\n    0, -15, 0, 0, 0, 0, 0, -16, 0, 0, 0, 0, 0, -17, 0, 0,\n    -15, 0, 0, 0, 0, 0, 0, -16, 0, 0, 0, 0, 0, 0, -17\n];\nconst PIECE_MASKS = { p: 0x1, n: 0x2, b: 0x4, r: 0x8, q: 0x10, k: 0x20 };\nconst SYMBOLS = 'pnbrqkPNBRQK';\nconst PROMOTIONS = [KNIGHT, BISHOP, ROOK, QUEEN];\nconst RANK_1 = 7;\nconst RANK_2 = 6;\n/*\n * const RANK_3 = 5\n * const RANK_4 = 4\n * const RANK_5 = 3\n * const RANK_6 = 2\n */\nconst RANK_7 = 1;\nconst RANK_8 = 0;\nconst SIDES = {\n  [KING]: BITS.KSIDE_CASTLE,\n  [QUEEN]: BITS.QSIDE_CASTLE,\n};\nconst ROOKS = {\n  w: [\n    { square: Ox88.a1, flag: BITS.QSIDE_CASTLE },\n    { square: Ox88.h1, flag: BITS.KSIDE_CASTLE },\n  ],\n  b: [\n    { square: Ox88.a8, flag: BITS.QSIDE_CASTLE },\n    { square: Ox88.h8, flag: BITS.KSIDE_CASTLE },\n  ],\n};\nconst SECOND_RANK = { b: RANK_7, w: RANK_2 };\nconst TERMINATION_MARKERS = ['1-0', '0-1', '1/2-1/2', '*'];\n// Extracts the zero-based rank of an 0x88 square.\nfunction rank(square) {\n  return square >> 4;\n}\n// Extracts the zero-based file of an 0x88 square.\nfunction file(square) {\n  return square & 0xf;\n}\nfunction isDigit(c) {\n  return '0123456789'.indexOf(c) !== -1;\n}\n// Converts a 0x88 square to algebraic notation.\nfunction algebraic(square) {\n  const f = file(square);\n  const r = rank(square);\n  return 'abcdefgh'.substring(f, f + 1) + '87654321'.substring(r, r + 1);\n}\nfunction swapColor(color) {\n  return color === WHITE ? BLACK : WHITE;\n}\nexport function validateFen(fen) {\n  // 1st criterion: 6 space-seperated fields?\n  const tokens = fen.split(/\\s+/);\n  if (tokens.length !== 6) {\n    return {\n      ok: false,\n      error: 'Invalid FEN: must contain six space-delimited fields',\n    };\n  }\n  // 2nd criterion: move number field is a integer value > 0?\n  const moveNumber = parseInt(tokens[5], 10);\n  if (isNaN(moveNumber) || moveNumber <= 0) {\n    return {\n      ok: false,\n      error: 'Invalid FEN: move number must be a positive integer',\n    };\n  }\n  // 3rd criterion: half move counter is an integer >= 0?\n  const halfMoves = parseInt(tokens[4], 10);\n  if (isNaN(halfMoves) || halfMoves < 0) {\n    return {\n      ok: false,\n      error: 'Invalid FEN: half move counter number must be a non-negative integer',\n    };\n  }\n  // 4th criterion: 4th field is a valid e.p.-string?\n  if (!/^(-|[abcdefgh][36])$/.test(tokens[3])) {\n    return { ok: false, error: 'Invalid FEN: en-passant square is invalid' };\n  }\n  // 5th criterion: 3th field is a valid castle-string?\n  if (/[^kKqQ-]/.test(tokens[2])) {\n    return { ok: false, error: 'Invalid FEN: castling availability is invalid' };\n  }\n  // 6th criterion: 2nd field is \"w\" (white) or \"b\" (black)?\n  if (!/^(w|b)$/.test(tokens[1])) {\n    return { ok: false, error: 'Invalid FEN: side-to-move is invalid' };\n  }\n  // 7th criterion: 1st field contains 8 rows?\n  const rows = tokens[0].split('/');\n  if (rows.length !== 8) {\n    return {\n      ok: false,\n      error: \"Invalid FEN: piece data does not contain 8 '/'-delimited rows\",\n    };\n  }\n  // 8th criterion: every row is valid?\n  for (let i = 0; i < rows.length; i++) {\n    // check for right sum of fields AND not two numbers in succession\n    let sumFields = 0;\n    let previousWasNumber = false;\n    for (let k = 0; k < rows[i].length; k++) {\n      if (isDigit(rows[i][k])) {\n        if (previousWasNumber) {\n          return {\n            ok: false,\n            error: 'Invalid FEN: piece data is invalid (consecutive number)',\n          };\n        }\n        sumFields += parseInt(rows[i][k], 10);\n        previousWasNumber = true;\n      } else {\n        if (!/^[prnbqkPRNBQK]$/.test(rows[i][k])) {\n          return {\n            ok: false,\n            error: 'Invalid FEN: piece data is invalid (invalid piece)',\n          };\n        }\n        sumFields += 1;\n        previousWasNumber = false;\n      }\n    }\n    if (sumFields !== 8) {\n      return {\n        ok: false,\n        error: 'Invalid FEN: piece data is invalid (too many squares in rank)',\n      };\n    }\n  }\n  // 9th criterion: is en-passant square legal?\n  if ((tokens[3][1] === '3' && tokens[1] === 'w') || (tokens[3][1] === '6' && tokens[1] === 'b')) {\n    return { ok: false, error: 'Invalid FEN: illegal en-passant square' };\n  }\n  // 10th criterion: does chess position contain exact two kings?\n  const kings = [\n    { color: 'white', regex: /K/g },\n    { color: 'black', regex: /k/g },\n  ];\n  for (const { color, regex } of kings) {\n    if (!regex.test(tokens[0])) {\n      return { ok: false, error: `Invalid FEN: missing ${color} king` };\n    }\n    if ((tokens[0].match(regex) || []).length > 1) {\n      return { ok: false, error: `Invalid FEN: too many ${color} kings` };\n    }\n  }\n  // 11th criterion: are any pawns on the first or eighth rows?\n  if (Array.from(rows[0] + rows[7]).some((char) => char.toUpperCase() === 'P')) {\n    return {\n      ok: false,\n      error: 'Invalid FEN: some pawns are on the edge rows',\n    };\n  }\n  return { ok: true };\n}\n// this function is used to uniquely identify ambiguous moves\nfunction getDisambiguator(move, moves) {\n  const from = move.from;\n  const to = move.to;\n  const piece = move.piece;\n  let ambiguities = 0;\n  let sameRank = 0;\n  let sameFile = 0;\n  for (let i = 0, len = moves.length; i < len; i++) {\n    const ambigFrom = moves[i].from;\n    const ambigTo = moves[i].to;\n    const ambigPiece = moves[i].piece;\n    /*\n     * if a move of the same piece type ends on the same to square, we'll need\n     * to add a disambiguator to the algebraic notation\n     */\n    if (piece === ambigPiece && from !== ambigFrom && to === ambigTo) {\n      ambiguities++;\n      if (rank(from) === rank(ambigFrom)) {\n        sameRank++;\n      }\n      if (file(from) === file(ambigFrom)) {\n        sameFile++;\n      }\n    }\n  }\n  if (ambiguities > 0) {\n    if (sameRank > 0 && sameFile > 0) {\n      /*\n       * if there exists a similar moving piece on the same rank and file as\n       * the move in question, use the square as the disambiguator\n       */\n      return algebraic(from);\n    } else if (sameFile > 0) {\n      /*\n       * if the moving piece rests on the same file, use the rank symbol as the\n       * disambiguator\n       */\n      return algebraic(from).charAt(1);\n    }\n\n    // else use the file symbol\n    return algebraic(from).charAt(0);\n  }\n  return '';\n}\nfunction addMove(moves, color, from, to, piece, captured = undefined, flags = BITS.NORMAL) {\n  const r = rank(to);\n  if (piece === PAWN && (r === RANK_1 || r === RANK_8)) {\n    for (let i = 0; i < PROMOTIONS.length; i++) {\n      const promotion = PROMOTIONS[i];\n      moves.push({\n        color,\n        from,\n        to,\n        piece,\n        captured,\n        promotion,\n        flags: flags | BITS.PROMOTION,\n      });\n    }\n  } else {\n    moves.push({\n      color,\n      from,\n      to,\n      piece,\n      captured,\n      flags,\n    });\n  }\n}\nfunction inferPieceType(san) {\n  let pieceType = san.charAt(0);\n  if (pieceType >= 'a' && pieceType <= 'h') {\n    const matches = san.match(/[a-h]\\d.*[a-h]\\d/);\n    if (matches) {\n      return undefined;\n    }\n    return PAWN;\n  }\n  pieceType = pieceType.toLowerCase();\n  if (pieceType === 'o') {\n    return KING;\n  }\n  return pieceType;\n}\n// parses all of the decorators out of a SAN string\nfunction strippedSan(move) {\n  return move.replace(/=/, '').replace(/[+#]?[?!]*$/, '');\n}\nfunction trimFen(fen) {\n  /*\n   * remove last two fields in FEN string as they're not needed when checking\n   * for repetition\n   */\n  return fen.split(' ').slice(0, 4).join(' ');\n}\nexport class Chess {\n  _board = new Array(128);\n  _turn = WHITE;\n  _header = {};\n  _kings = { w: EMPTY, b: EMPTY };\n  _epSquare = -1;\n  _halfMoves = 0;\n  _moveNumber = 0;\n  _history = [];\n  _comments = {};\n  _castling = { w: 0, b: 0 };\n  // tracks number of times a position has been seen for repetition checking\n  _positionCount = {};\n  constructor(fen = DEFAULT_POSITION) {\n    this.load(fen);\n  }\n  clear({ preserveHeaders = false } = {}) {\n    this._board = new Array(128);\n    this._kings = { w: EMPTY, b: EMPTY };\n    this._turn = WHITE;\n    this._castling = { w: 0, b: 0 };\n    this._epSquare = EMPTY;\n    this._halfMoves = 0;\n    this._moveNumber = 1;\n    this._history = [];\n    this._comments = {};\n    this._header = preserveHeaders ? this._header : {};\n    this._positionCount = {};\n    /*\n     * Delete the SetUp and FEN headers (if preserved), the board is empty and\n     * these headers don't make sense in this state. They'll get added later\n     * via .load() or .put()\n     */\n    delete this._header['SetUp'];\n    delete this._header['FEN'];\n  }\n  load(fen, { skipValidation = false, preserveHeaders = false } = {}) {\n    let tokens = fen.split(/\\s+/);\n    // append commonly omitted fen tokens\n    if (tokens.length >= 2 && tokens.length < 6) {\n      const adjustments = ['-', '-', '0', '1'];\n      fen = tokens.concat(adjustments.slice(-(6 - tokens.length))).join(' ');\n    }\n    tokens = fen.split(/\\s+/);\n    if (!skipValidation) {\n      const { ok, error } = validateFen(fen);\n      if (!ok) {\n        throw new Error(error);\n      }\n    }\n    const position = tokens[0];\n    let square = 0;\n    this.clear({ preserveHeaders });\n    for (let i = 0; i < position.length; i++) {\n      const piece = position.charAt(i);\n      if (piece === '/') {\n        square += 8;\n      } else if (isDigit(piece)) {\n        square += parseInt(piece, 10);\n      } else {\n        const color = piece < 'a' ? WHITE : BLACK;\n        this._put({ type: piece.toLowerCase(), color }, algebraic(square));\n        square++;\n      }\n    }\n    this._turn = tokens[1];\n    if (tokens[2].indexOf('K') > -1) {\n      this._castling.w |= BITS.KSIDE_CASTLE;\n    }\n    if (tokens[2].indexOf('Q') > -1) {\n      this._castling.w |= BITS.QSIDE_CASTLE;\n    }\n    if (tokens[2].indexOf('k') > -1) {\n      this._castling.b |= BITS.KSIDE_CASTLE;\n    }\n    if (tokens[2].indexOf('q') > -1) {\n      this._castling.b |= BITS.QSIDE_CASTLE;\n    }\n    this._epSquare = tokens[3] === '-' ? EMPTY : Ox88[tokens[3]];\n    this._halfMoves = parseInt(tokens[4], 10);\n    this._moveNumber = parseInt(tokens[5], 10);\n    this._updateSetup(fen);\n    this._incPositionCount(fen);\n  }\n  fen() {\n    let empty = 0;\n    let fen = '';\n    for (let i = Ox88.a8; i <= Ox88.h1; i++) {\n      if (this._board[i]) {\n        if (empty > 0) {\n          fen += empty;\n          empty = 0;\n        }\n        const { color, type: piece } = this._board[i];\n        fen += color === WHITE ? piece.toUpperCase() : piece.toLowerCase();\n      } else {\n        empty++;\n      }\n      if ((i + 1) & 0x88) {\n        if (empty > 0) {\n          fen += empty;\n        }\n        if (i !== Ox88.h1) {\n          fen += '/';\n        }\n        empty = 0;\n        i += 8;\n      }\n    }\n    let castling = '';\n    if (this._castling[WHITE] & BITS.KSIDE_CASTLE) {\n      castling += 'K';\n    }\n    if (this._castling[WHITE] & BITS.QSIDE_CASTLE) {\n      castling += 'Q';\n    }\n    if (this._castling[BLACK] & BITS.KSIDE_CASTLE) {\n      castling += 'k';\n    }\n    if (this._castling[BLACK] & BITS.QSIDE_CASTLE) {\n      castling += 'q';\n    }\n    // do we have an empty castling flag?\n    castling = castling || '-';\n    let epSquare = '-';\n    /*\n     * only print the ep square if en passant is a valid move (pawn is present\n     * and ep capture is not pinned)\n     */\n    if (this._epSquare !== EMPTY) {\n      const bigPawnSquare = this._epSquare + (this._turn === WHITE ? 16 : -16);\n      const squares = [bigPawnSquare + 1, bigPawnSquare - 1];\n      for (const square of squares) {\n        // is the square off the board?\n        if (square & 0x88) {\n          continue;\n        }\n        const color = this._turn;\n        // is there a pawn that can capture the epSquare?\n        if (this._board[square]?.color === color && this._board[square]?.type === PAWN) {\n          // if the pawn makes an ep capture, does it leave it's king in check?\n          this._makeMove({\n            color,\n            from: square,\n            to: this._epSquare,\n            piece: PAWN,\n            captured: PAWN,\n            flags: BITS.EP_CAPTURE,\n          });\n          const isLegal = !this._isKingAttacked(color);\n          this._undoMove();\n          // if ep is legal, break and set the ep square in the FEN output\n          if (isLegal) {\n            epSquare = algebraic(this._epSquare);\n            break;\n          }\n        }\n      }\n    }\n    return [fen, this._turn, castling, epSquare, this._halfMoves, this._moveNumber].join(' ');\n  }\n  /*\n   * Called when the initial board setup is changed with put() or remove().\n   * modifies the SetUp and FEN properties of the header object. If the FEN\n   * is equal to the default position, the SetUp and FEN are deleted the setup\n   * is only updated if history.length is zero, ie moves haven't been made.\n   */\n  _updateSetup(fen) {\n    if (this._history.length > 0) return;\n    if (fen !== DEFAULT_POSITION) {\n      this._header['SetUp'] = '1';\n      this._header['FEN'] = fen;\n    } else {\n      delete this._header['SetUp'];\n      delete this._header['FEN'];\n    }\n  }\n  reset() {\n    this.load(DEFAULT_POSITION);\n  }\n  get(square) {\n    return this._board[Ox88[square]];\n  }\n  put({ type, color }, square) {\n    if (this._put({ type, color }, square)) {\n      this._updateCastlingRights();\n      this._updateEnPassantSquare();\n      this._updateSetup(this.fen());\n      return true;\n    }\n    return false;\n  }\n  _put({ type, color }, square) {\n    // check for piece\n    if (SYMBOLS.indexOf(type.toLowerCase()) === -1) {\n      return false;\n    }\n    // check for valid square\n    if (!(square in Ox88)) {\n      return false;\n    }\n    const sq = Ox88[square];\n    // don't let the user place more than one king\n    if (type === KING && !(this._kings[color] === EMPTY || this._kings[color] === sq)) {\n      return false;\n    }\n    const currentPieceOnSquare = this._board[sq];\n    // if one of the kings will be replaced by the piece from args, set the `_kings` respective entry to `EMPTY`\n    if (currentPieceOnSquare && currentPieceOnSquare.type === KING) {\n      this._kings[currentPieceOnSquare.color] = EMPTY;\n    }\n    this._board[sq] = { type, color };\n    if (type === KING) {\n      this._kings[color] = sq;\n    }\n    return true;\n  }\n  remove(square) {\n    const piece = this.get(square);\n    delete this._board[Ox88[square]];\n    if (piece && piece.type === KING) {\n      this._kings[piece.color] = EMPTY;\n    }\n    this._updateCastlingRights();\n    this._updateEnPassantSquare();\n    this._updateSetup(this.fen());\n    return piece;\n  }\n  _updateCastlingRights() {\n    const whiteKingInPlace =\n      this._board[Ox88.e1]?.type === KING && this._board[Ox88.e1]?.color === WHITE;\n    const blackKingInPlace =\n      this._board[Ox88.e8]?.type === KING && this._board[Ox88.e8]?.color === BLACK;\n    if (\n      !whiteKingInPlace ||\n      this._board[Ox88.a1]?.type !== ROOK ||\n      this._board[Ox88.a1]?.color !== WHITE\n    ) {\n      this._castling.w &= ~BITS.QSIDE_CASTLE;\n    }\n    if (\n      !whiteKingInPlace ||\n      this._board[Ox88.h1]?.type !== ROOK ||\n      this._board[Ox88.h1]?.color !== WHITE\n    ) {\n      this._castling.w &= ~BITS.KSIDE_CASTLE;\n    }\n    if (\n      !blackKingInPlace ||\n      this._board[Ox88.a8]?.type !== ROOK ||\n      this._board[Ox88.a8]?.color !== BLACK\n    ) {\n      this._castling.b &= ~BITS.QSIDE_CASTLE;\n    }\n    if (\n      !blackKingInPlace ||\n      this._board[Ox88.h8]?.type !== ROOK ||\n      this._board[Ox88.h8]?.color !== BLACK\n    ) {\n      this._castling.b &= ~BITS.KSIDE_CASTLE;\n    }\n  }\n  _updateEnPassantSquare() {\n    if (this._epSquare === EMPTY) {\n      return;\n    }\n    const startSquare = this._epSquare + (this._turn === WHITE ? -16 : 16);\n    const currentSquare = this._epSquare + (this._turn === WHITE ? 16 : -16);\n    const attackers = [currentSquare + 1, currentSquare - 1];\n    if (\n      this._board[startSquare] !== null ||\n      this._board[this._epSquare] !== null ||\n      this._board[currentSquare]?.color !== swapColor(this._turn) ||\n      this._board[currentSquare]?.type !== PAWN\n    ) {\n      this._epSquare = EMPTY;\n      return;\n    }\n    const canCapture = (square) =>\n      !(square & 0x88) &&\n      this._board[square]?.color === this._turn &&\n      this._board[square]?.type === PAWN;\n    if (!attackers.some(canCapture)) {\n      this._epSquare = EMPTY;\n    }\n  }\n  _attacked(color, square, verbose) {\n    const attackers = [];\n    for (let i = Ox88.a8; i <= Ox88.h1; i++) {\n      // did we run off the end of the board\n      if (i & 0x88) {\n        i += 7;\n        continue;\n      }\n      // if empty square or wrong color\n      if (this._board[i] === undefined || this._board[i].color !== color) {\n        continue;\n      }\n      const piece = this._board[i];\n      const difference = i - square;\n      // skip - to/from square are the same\n      if (difference === 0) {\n        continue;\n      }\n      const index = difference + 119;\n      if (ATTACKS[index] & PIECE_MASKS[piece.type]) {\n        if (piece.type === PAWN) {\n          if (\n            (difference > 0 && piece.color === WHITE) ||\n            (difference <= 0 && piece.color === BLACK)\n          ) {\n            if (!verbose) {\n              return true;\n            }\n\n            attackers.push(algebraic(i));\n          }\n          continue;\n        }\n        // if the piece is a knight or a king\n        if (piece.type === 'n' || piece.type === 'k') {\n          if (!verbose) {\n            return true;\n          }\n\n          attackers.push(algebraic(i));\n          continue;\n        }\n        const offset = RAYS[index];\n        let j = i + offset;\n        let blocked = false;\n        while (j !== square) {\n          if (this._board[j] != null) {\n            blocked = true;\n            break;\n          }\n          j += offset;\n        }\n        if (!blocked) {\n          if (!verbose) {\n            return true;\n          }\n\n          attackers.push(algebraic(i));\n          continue;\n        }\n      }\n    }\n    if (verbose) {\n      return attackers;\n    }\n\n    return false;\n  }\n  attackers(square, attackedBy) {\n    if (!attackedBy) {\n      return this._attacked(this._turn, Ox88[square], true);\n    }\n\n    return this._attacked(attackedBy, Ox88[square], true);\n  }\n  _isKingAttacked(color) {\n    const square = this._kings[color];\n    return square === -1 ? false : this._attacked(swapColor(color), square);\n  }\n  isAttacked(square, attackedBy) {\n    return this._attacked(attackedBy, Ox88[square]);\n  }\n  isCheck() {\n    return this._isKingAttacked(this._turn);\n  }\n  inCheck() {\n    return this.isCheck();\n  }\n  isCheckmate() {\n    return this.isCheck() && this._moves().length === 0;\n  }\n  isStalemate() {\n    return !this.isCheck() && this._moves().length === 0;\n  }\n  isInsufficientMaterial() {\n    /*\n     * k.b. vs k.b. (of opposite colors) with mate in 1:\n     * 8/8/8/8/1b6/8/B1k5/K7 b - - 0 1\n     *\n     * k.b. vs k.n. with mate in 1:\n     * 8/8/8/8/1n6/8/B7/K1k5 b - - 2 1\n     */\n    const pieces = {\n      b: 0,\n      n: 0,\n      r: 0,\n      q: 0,\n      k: 0,\n      p: 0,\n    };\n    const bishops = [];\n    let numPieces = 0;\n    let squareColor = 0;\n    for (let i = Ox88.a8; i <= Ox88.h1; i++) {\n      squareColor = (squareColor + 1) % 2;\n      if (i & 0x88) {\n        i += 7;\n        continue;\n      }\n      const piece = this._board[i];\n      if (piece) {\n        pieces[piece.type] = piece.type in pieces ? pieces[piece.type] + 1 : 1;\n        if (piece.type === BISHOP) {\n          bishops.push(squareColor);\n        }\n        numPieces++;\n      }\n    }\n    // k vs. k\n    if (numPieces === 2) {\n      return true;\n    } else if (\n      // k vs. kn .... or .... k vs. kb\n      numPieces === 3 &&\n      (pieces[BISHOP] === 1 || pieces[KNIGHT] === 1)\n    ) {\n      return true;\n    } else if (numPieces === pieces[BISHOP] + 2) {\n      // kb vs. kb where any number of bishops are all on the same color\n      let sum = 0;\n      const len = bishops.length;\n      for (let i = 0; i < len; i++) {\n        sum += bishops[i];\n      }\n      if (sum === 0 || sum === len) {\n        return true;\n      }\n    }\n    return false;\n  }\n  isThreefoldRepetition() {\n    return this._getPositionCount(this.fen()) >= 3;\n  }\n  isDrawByFiftyMoves() {\n    return this._halfMoves >= 100; // 50 moves per side = 100 half moves\n  }\n  isDraw() {\n    return (\n      this.isDrawByFiftyMoves() ||\n      this.isStalemate() ||\n      this.isInsufficientMaterial() ||\n      this.isThreefoldRepetition()\n    );\n  }\n  isGameOver() {\n    return this.isCheckmate() || this.isStalemate() || this.isDraw();\n  }\n  moves({ verbose = false, square = undefined, piece = undefined } = {}) {\n    const moves = this._moves({ square, piece });\n    if (verbose) {\n      return moves.map((move) => new Move(this, move));\n    }\n\n    return moves.map((move) => this._moveToSan(move, moves));\n  }\n  _moves({ legal = true, piece = undefined, square = undefined } = {}) {\n    const forSquare = square ? square.toLowerCase() : undefined;\n    const forPiece = piece?.toLowerCase();\n    const moves = [];\n    const us = this._turn;\n    const them = swapColor(us);\n    let firstSquare = Ox88.a8;\n    let lastSquare = Ox88.h1;\n    let singleSquare = false;\n    // are we generating moves for a single square?\n    if (forSquare) {\n      // illegal square, return empty moves\n      if (!(forSquare in Ox88)) {\n        return [];\n      }\n\n      firstSquare = lastSquare = Ox88[forSquare];\n      singleSquare = true;\n    }\n    for (let from = firstSquare; from <= lastSquare; from++) {\n      // did we run off the end of the board\n      if (from & 0x88) {\n        from += 7;\n        continue;\n      }\n      // empty square or opponent, skip\n      if (!this._board[from] || this._board[from].color === them) {\n        continue;\n      }\n      const { type } = this._board[from];\n      let to;\n      if (type === PAWN) {\n        if (forPiece && forPiece !== type) continue;\n        // single square, non-capturing\n        to = from + PAWN_OFFSETS[us][0];\n        if (!this._board[to]) {\n          addMove(moves, us, from, to, PAWN);\n          // double square\n          to = from + PAWN_OFFSETS[us][1];\n          if (SECOND_RANK[us] === rank(from) && !this._board[to]) {\n            addMove(moves, us, from, to, PAWN, undefined, BITS.BIG_PAWN);\n          }\n        }\n        // pawn captures\n        for (let j = 2; j < 4; j++) {\n          to = from + PAWN_OFFSETS[us][j];\n          if (to & 0x88) continue;\n          if (this._board[to]?.color === them) {\n            addMove(moves, us, from, to, PAWN, this._board[to].type, BITS.CAPTURE);\n          } else if (to === this._epSquare) {\n            addMove(moves, us, from, to, PAWN, PAWN, BITS.EP_CAPTURE);\n          }\n        }\n      } else {\n        if (forPiece && forPiece !== type) continue;\n        for (let j = 0, len = PIECE_OFFSETS[type].length; j < len; j++) {\n          const offset = PIECE_OFFSETS[type][j];\n          to = from;\n          while (true) {\n            to += offset;\n            if (to & 0x88) break;\n            if (!this._board[to]) {\n              addMove(moves, us, from, to, type);\n            } else {\n              // own color, stop loop\n              if (this._board[to].color === us) break;\n              addMove(moves, us, from, to, type, this._board[to].type, BITS.CAPTURE);\n              break;\n            }\n            /* break, if knight or king */\n            if (type === KNIGHT || type === KING) break;\n          }\n        }\n      }\n    }\n    /*\n     * check for castling if we're:\n     *   a) generating all moves, or\n     *   b) doing single square move generation on the king's square\n     */\n    if (forPiece === undefined || forPiece === KING) {\n      if (!singleSquare || lastSquare === this._kings[us]) {\n        // king-side castling\n        if (this._castling[us] & BITS.KSIDE_CASTLE) {\n          const castlingFrom = this._kings[us];\n          const castlingTo = castlingFrom + 2;\n          if (\n            !this._board[castlingFrom + 1] &&\n            !this._board[castlingTo] &&\n            !this._attacked(them, this._kings[us]) &&\n            !this._attacked(them, castlingFrom + 1) &&\n            !this._attacked(them, castlingTo)\n          ) {\n            addMove(moves, us, this._kings[us], castlingTo, KING, undefined, BITS.KSIDE_CASTLE);\n          }\n        }\n        // queen-side castling\n        if (this._castling[us] & BITS.QSIDE_CASTLE) {\n          const castlingFrom = this._kings[us];\n          const castlingTo = castlingFrom - 2;\n          if (\n            !this._board[castlingFrom - 1] &&\n            !this._board[castlingFrom - 2] &&\n            !this._board[castlingFrom - 3] &&\n            !this._attacked(them, this._kings[us]) &&\n            !this._attacked(them, castlingFrom - 1) &&\n            !this._attacked(them, castlingTo)\n          ) {\n            addMove(moves, us, this._kings[us], castlingTo, KING, undefined, BITS.QSIDE_CASTLE);\n          }\n        }\n      }\n    }\n    /*\n     * return all pseudo-legal moves (this includes moves that allow the king\n     * to be captured)\n     */\n    if (!legal || this._kings[us] === -1) {\n      return moves;\n    }\n    // filter out illegal moves\n    const legalMoves = [];\n    for (let i = 0, len = moves.length; i < len; i++) {\n      this._makeMove(moves[i]);\n      if (!this._isKingAttacked(us)) {\n        legalMoves.push(moves[i]);\n      }\n      this._undoMove();\n    }\n    return legalMoves;\n  }\n  move(move, { strict = false } = {}) {\n    /*\n     * The move function can be called with in the following parameters:\n     *\n     * .move('Nxb7')       <- argument is a case-sensitive SAN string\n     *\n     * .move({ from: 'h7', <- argument is a move object\n     *         to :'h8',\n     *         promotion: 'q' })\n     *\n     *\n     * An optional strict argument may be supplied to tell chess.js to\n     * strictly follow the SAN specification.\n     */\n    let moveObj = null;\n    if (typeof move === 'string') {\n      moveObj = this._moveFromSan(move, strict);\n    } else if (typeof move === 'object') {\n      const moves = this._moves();\n      // convert the pretty move object to an ugly move object\n      for (let i = 0, len = moves.length; i < len; i++) {\n        if (\n          move.from === algebraic(moves[i].from) &&\n          move.to === algebraic(moves[i].to) &&\n          (!('promotion' in moves[i]) || move.promotion === moves[i].promotion)\n        ) {\n          moveObj = moves[i];\n          break;\n        }\n      }\n    }\n    // failed to find move\n    if (!moveObj) {\n      if (typeof move === 'string') {\n        throw new Error(`Invalid move: ${move}`);\n      } else {\n        throw new Error(`Invalid move: ${JSON.stringify(move)}`);\n      }\n    }\n    /*\n     * need to make a copy of move because we can't generate SAN after the move\n     * is made\n     */\n    const prettyMove = new Move(this, moveObj);\n    this._makeMove(moveObj);\n    this._incPositionCount(prettyMove.after);\n    return prettyMove;\n  }\n  _push(move) {\n    this._history.push({\n      move,\n      kings: { b: this._kings.b, w: this._kings.w },\n      turn: this._turn,\n      castling: { b: this._castling.b, w: this._castling.w },\n      epSquare: this._epSquare,\n      halfMoves: this._halfMoves,\n      moveNumber: this._moveNumber,\n    });\n  }\n  _makeMove(move) {\n    const us = this._turn;\n    const them = swapColor(us);\n    this._push(move);\n    this._board[move.to] = this._board[move.from];\n    delete this._board[move.from];\n    // if ep capture, remove the captured pawn\n    if (move.flags & BITS.EP_CAPTURE) {\n      if (this._turn === BLACK) {\n        delete this._board[move.to - 16];\n      } else {\n        delete this._board[move.to + 16];\n      }\n    }\n    // if pawn promotion, replace with new piece\n    if (move.promotion) {\n      this._board[move.to] = { type: move.promotion, color: us };\n    }\n    // if we moved the king\n    if (this._board[move.to].type === KING) {\n      this._kings[us] = move.to;\n      // if we castled, move the rook next to the king\n      if (move.flags & BITS.KSIDE_CASTLE) {\n        const castlingTo = move.to - 1;\n        const castlingFrom = move.to + 1;\n        this._board[castlingTo] = this._board[castlingFrom];\n        delete this._board[castlingFrom];\n      } else if (move.flags & BITS.QSIDE_CASTLE) {\n        const castlingTo = move.to + 1;\n        const castlingFrom = move.to - 2;\n        this._board[castlingTo] = this._board[castlingFrom];\n        delete this._board[castlingFrom];\n      }\n      // turn off castling\n      this._castling[us] = 0;\n    }\n    // turn off castling if we move a rook\n    if (this._castling[us]) {\n      for (let i = 0, len = ROOKS[us].length; i < len; i++) {\n        if (move.from === ROOKS[us][i].square && this._castling[us] & ROOKS[us][i].flag) {\n          this._castling[us] ^= ROOKS[us][i].flag;\n          break;\n        }\n      }\n    }\n    // turn off castling if we capture a rook\n    if (this._castling[them]) {\n      for (let i = 0, len = ROOKS[them].length; i < len; i++) {\n        if (move.to === ROOKS[them][i].square && this._castling[them] & ROOKS[them][i].flag) {\n          this._castling[them] ^= ROOKS[them][i].flag;\n          break;\n        }\n      }\n    }\n    // if big pawn move, update the en passant square\n    if (move.flags & BITS.BIG_PAWN) {\n      if (us === BLACK) {\n        this._epSquare = move.to - 16;\n      } else {\n        this._epSquare = move.to + 16;\n      }\n    } else {\n      this._epSquare = EMPTY;\n    }\n    // reset the 50 move counter if a pawn is moved or a piece is captured\n    if (move.piece === PAWN) {\n      this._halfMoves = 0;\n    } else if (move.flags & (BITS.CAPTURE | BITS.EP_CAPTURE)) {\n      this._halfMoves = 0;\n    } else {\n      this._halfMoves++;\n    }\n    if (us === BLACK) {\n      this._moveNumber++;\n    }\n    this._turn = them;\n  }\n  undo() {\n    const move = this._undoMove();\n    if (move) {\n      const prettyMove = new Move(this, move);\n      this._decPositionCount(prettyMove.after);\n      return prettyMove;\n    }\n    return null;\n  }\n  _undoMove() {\n    const old = this._history.pop();\n    if (old === undefined) {\n      return null;\n    }\n    const move = old.move;\n    this._kings = old.kings;\n    this._turn = old.turn;\n    this._castling = old.castling;\n    this._epSquare = old.epSquare;\n    this._halfMoves = old.halfMoves;\n    this._moveNumber = old.moveNumber;\n    const us = this._turn;\n    const them = swapColor(us);\n    this._board[move.from] = this._board[move.to];\n    this._board[move.from].type = move.piece; // to undo any promotions\n    delete this._board[move.to];\n    if (move.captured) {\n      if (move.flags & BITS.EP_CAPTURE) {\n        // en passant capture\n        let index;\n        if (us === BLACK) {\n          index = move.to - 16;\n        } else {\n          index = move.to + 16;\n        }\n        this._board[index] = { type: PAWN, color: them };\n      } else {\n        // regular capture\n        this._board[move.to] = { type: move.captured, color: them };\n      }\n    }\n    if (move.flags & (BITS.KSIDE_CASTLE | BITS.QSIDE_CASTLE)) {\n      let castlingTo, castlingFrom;\n      if (move.flags & BITS.KSIDE_CASTLE) {\n        castlingTo = move.to + 1;\n        castlingFrom = move.to - 1;\n      } else {\n        castlingTo = move.to - 2;\n        castlingFrom = move.to + 1;\n      }\n      this._board[castlingTo] = this._board[castlingFrom];\n      delete this._board[castlingFrom];\n    }\n    return move;\n  }\n  pgn({ newline = '\\n', maxWidth = 0 } = {}) {\n    /*\n     * using the specification from http://www.chessclub.com/help/PGN-spec\n     * example for html usage: .pgn({ max_width: 72, newline_char: \"<br />\" })\n     */\n    const result = [];\n    let headerExists = false;\n    /* add the PGN header information */\n    for (const i in this._header) {\n      /*\n       * TODO: order of enumerated properties in header object is not\n       * guaranteed, see ECMA-262 spec (section 12.6.4)\n       */\n      result.push(`[${i} \"${this._header[i]}\"]${newline}`);\n      headerExists = true;\n    }\n    if (headerExists && this._history.length) {\n      result.push(newline);\n    }\n    const appendComment = (moveString) => {\n      const comment = this._comments[this.fen()];\n      if (typeof comment !== 'undefined') {\n        const delimiter = moveString.length > 0 ? ' ' : '';\n        moveString = `${moveString}${delimiter}{${comment}}`;\n      }\n      return moveString;\n    };\n    // pop all of history onto reversed_history\n    const reversedHistory = [];\n    while (this._history.length > 0) {\n      reversedHistory.push(this._undoMove());\n    }\n    const moves = [];\n    let moveString = '';\n    // special case of a commented starting position with no moves\n    if (reversedHistory.length === 0) {\n      moves.push(appendComment(''));\n    }\n    // build the list of moves.  a move_string looks like: \"3. e3 e6\"\n    while (reversedHistory.length > 0) {\n      moveString = appendComment(moveString);\n      const move = reversedHistory.pop();\n      // make TypeScript stop complaining about move being undefined\n      if (!move) {\n        break;\n      }\n      // if the position started with black to move, start PGN with #. ...\n      if (!this._history.length && move.color === 'b') {\n        const prefix = `${this._moveNumber}. ...`;\n        // is there a comment preceding the first move?\n        moveString = moveString ? `${moveString} ${prefix}` : prefix;\n      } else if (move.color === 'w') {\n        // store the previous generated move_string if we have one\n        if (moveString.length) {\n          moves.push(moveString);\n        }\n        moveString = `${this._moveNumber}.`;\n      }\n      moveString = `${moveString} ${this._moveToSan(move, this._moves({ legal: true }))}`;\n      this._makeMove(move);\n    }\n    // are there any other leftover moves?\n    if (moveString.length) {\n      moves.push(appendComment(moveString));\n    }\n    // is there a result?\n    if (typeof this._header.Result !== 'undefined') {\n      moves.push(this._header.Result);\n    }\n    /*\n     * history should be back to what it was before we started generating PGN,\n     * so join together moves\n     */\n    if (maxWidth === 0) {\n      return result.join('') + moves.join(' ');\n    }\n    // TODO (jah): huh?\n    const strip = function () {\n      if (result.length > 0 && result[result.length - 1] === ' ') {\n        result.pop();\n        return true;\n      }\n      return false;\n    };\n    // NB: this does not preserve comment whitespace.\n    const wrapComment = function (width, move) {\n      for (const token of move.split(' ')) {\n        if (!token) {\n          continue;\n        }\n        if (width + token.length > maxWidth) {\n          while (strip()) {\n            width--;\n          }\n          result.push(newline);\n          width = 0;\n        }\n        result.push(token);\n        width += token.length;\n        result.push(' ');\n        width++;\n      }\n      if (strip()) {\n        width--;\n      }\n      return width;\n    };\n    // wrap the PGN output at max_width\n    let currentWidth = 0;\n    for (let i = 0; i < moves.length; i++) {\n      if (currentWidth + moves[i].length > maxWidth) {\n        if (moves[i].includes('{')) {\n          currentWidth = wrapComment(currentWidth, moves[i]);\n          continue;\n        }\n      }\n      // if the current move will push past max_width\n      if (currentWidth + moves[i].length > maxWidth && i !== 0) {\n        // don't end the line with whitespace\n        if (result[result.length - 1] === ' ') {\n          result.pop();\n        }\n        result.push(newline);\n        currentWidth = 0;\n      } else if (i !== 0) {\n        result.push(' ');\n        currentWidth++;\n      }\n      result.push(moves[i]);\n      currentWidth += moves[i].length;\n    }\n    return result.join('');\n  }\n  /*\n   * @deprecated Use `setHeader` and `getHeaders` instead.\n   */\n  header(...args) {\n    for (let i = 0; i < args.length; i += 2) {\n      if (typeof args[i] === 'string' && typeof args[i + 1] === 'string') {\n        this._header[args[i]] = args[i + 1];\n      }\n    }\n    return this._header;\n  }\n  setHeader(key, value) {\n    this._header[key] = value;\n    return this._header;\n  }\n  removeHeader(key) {\n    if (key in this._header) {\n      delete this._header[key];\n      return true;\n    }\n    return false;\n  }\n  getHeaders() {\n    return this._header;\n  }\n  loadPgn(pgn, { strict = false, newlineChar = '\\r?\\n' } = {}) {\n    function mask(str) {\n      return str.replace(/\\\\/g, '\\\\');\n    }\n    function parsePgnHeader(header) {\n      const headerObj = {};\n      const headers = header.split(new RegExp(mask(newlineChar)));\n      let key = '';\n      let value = '';\n      for (let i = 0; i < headers.length; i++) {\n        const regex = /^\\s*\\[\\s*([A-Za-z]+)\\s*\"(.*)\"\\s*\\]\\s*$/;\n        key = headers[i].replace(regex, '$1');\n        value = headers[i].replace(regex, '$2');\n        if (key.trim().length > 0) {\n          headerObj[key] = value;\n        }\n      }\n      return headerObj;\n    }\n    // strip whitespace from head/tail of PGN block\n    pgn = pgn.trim();\n    /*\n     * RegExp to split header. Takes advantage of the fact that header and movetext\n     * will always have a blank line between them (ie, two newline_char's). Handles\n     * case where movetext is empty by matching newlineChar until end of string is\n     * matched - effectively trimming from the end extra newlineChar.\n     *\n     * With default newline_char, will equal:\n     * /^(\\[((?:\\r?\\n)|.)*\\])((?:\\s*\\r?\\n){2}|(?:\\s*\\r?\\n)*$)/\n     */\n    const headerRegex = new RegExp(\n      `^(\\\\[((?:${mask(newlineChar)})|.)*\\\\])` +\n        `((?:\\\\s*${mask(newlineChar)}){2}|(?:\\\\s*${mask(newlineChar)})*$)`\n    );\n    // If no header given, begin with moves.\n    const headerRegexResults = headerRegex.exec(pgn);\n    const headerString = headerRegexResults\n      ? headerRegexResults.length >= 2\n        ? headerRegexResults[1]\n        : ''\n      : '';\n    // Put the board in the starting position\n    this.reset();\n    // parse PGN header\n    const headers = parsePgnHeader(headerString);\n    let fen = '';\n    for (const key in headers) {\n      // check to see user is including fen (possibly with wrong tag case)\n      if (key.toLowerCase() === 'fen') {\n        fen = headers[key];\n      }\n      this.header(key, headers[key]);\n    }\n    /*\n     * the permissive parser should attempt to load a fen tag, even if it's the\n     * wrong case and doesn't include a corresponding [SetUp \"1\"] tag\n     */\n    if (!strict) {\n      if (fen) {\n        this.load(fen, { preserveHeaders: true });\n      }\n    } else {\n      /*\n       * strict parser - load the starting position indicated by [Setup '1']\n       * and [FEN position]\n       */\n      if (headers['SetUp'] === '1') {\n        if (!('FEN' in headers)) {\n          throw new Error('Invalid PGN: FEN tag must be supplied with SetUp tag');\n        }\n        // don't clear the headers when loading\n        this.load(headers['FEN'], { preserveHeaders: true });\n      }\n    }\n    /*\n     * NB: the regexes below that delete move numbers, recursive annotations,\n     * and numeric annotation glyphs may also match text in comments. To\n     * prevent this, we transform comments by hex-encoding them in place and\n     * decoding them again after the other tokens have been deleted.\n     *\n     * While the spec states that PGN files should be ASCII encoded, we use\n     * {en,de}codeURIComponent here to support arbitrary UTF8 as a convenience\n     * for modern users\n     */\n    function toHex(s) {\n      return Array.from(s)\n        .map((c) => {\n          /*\n           * encodeURI doesn't transform most ASCII characters, so we handle\n           * these ourselves\n           */\n          return c.charCodeAt(0) < 128\n            ? c.charCodeAt(0).toString(16)\n            : encodeURIComponent(c).replace(/%/g, '').toLowerCase();\n        })\n        .join('');\n    }\n    function fromHex(s) {\n      return s.length === 0 ? '' : decodeURIComponent(`%${(s.match(/.{1,2}/g) || []).join('%')}`);\n    }\n    const encodeComment = function (s) {\n      s = s.replace(new RegExp(mask(newlineChar), 'g'), ' ');\n      return `{${toHex(s.slice(1, s.length - 1))}}`;\n    };\n    const decodeComment = function (s) {\n      if (s.startsWith('{') && s.endsWith('}')) {\n        return fromHex(s.slice(1, s.length - 1));\n      }\n    };\n    // delete header to get the moves\n    let ms = pgn\n      .replace(headerString, '')\n      .replace(\n        // encode comments so they don't get deleted below\n        new RegExp(`({[^}]*})+?|;([^${mask(newlineChar)}]*)`, 'g'),\n        (_match, bracket, semicolon) => {\n          return bracket !== undefined\n            ? encodeComment(bracket)\n            : ` ${encodeComment(`{${semicolon.slice(1)}}`)}`;\n        }\n      )\n      .replace(new RegExp(mask(newlineChar), 'g'), ' ');\n    // delete recursive annotation variations\n    const ravRegex = /(\\([^()]+\\))+?/g;\n    while (ravRegex.test(ms)) {\n      ms = ms.replace(ravRegex, '');\n    }\n    // delete move numbers\n    ms = ms.replace(/\\d+\\.(\\.\\.)?/g, '');\n    // delete ... indicating black to move\n    ms = ms.replace(/\\.\\.\\./g, '');\n    /* delete numeric annotation glyphs */\n    ms = ms.replace(/\\$\\d+/g, '');\n    // trim and get array of moves\n    let moves = ms.trim().split(new RegExp(/\\s+/));\n    // delete empty entries\n    moves = moves.filter((move) => move !== '');\n    let result = '';\n    for (let halfMove = 0; halfMove < moves.length; halfMove++) {\n      const comment = decodeComment(moves[halfMove]);\n      if (comment !== undefined) {\n        this._comments[this.fen()] = comment;\n        continue;\n      }\n      const move = this._moveFromSan(moves[halfMove], strict);\n      // invalid move\n      if (move == null) {\n        // was the move an end of game marker\n        if (TERMINATION_MARKERS.indexOf(moves[halfMove]) > -1) {\n          result = moves[halfMove];\n        } else {\n          throw new Error(`Invalid move in PGN: ${moves[halfMove]}`);\n        }\n      } else {\n        // reset the end of game marker if making a valid move\n        result = '';\n        this._makeMove(move);\n        this._incPositionCount(this.fen());\n      }\n    }\n    /*\n     * Per section 8.2.6 of the PGN spec, the Result tag pair must match match\n     * the termination marker. Only do this when headers are present, but the\n     * result tag is missing\n     */\n    if (result && Object.keys(this._header).length && !this._header['Result']) {\n      this.header('Result', result);\n    }\n  }\n  /*\n   * Convert a move from 0x88 coordinates to Standard Algebraic Notation\n   * (SAN)\n   *\n   * @param {boolean} strict Use the strict SAN parser. It will throw errors\n   * on overly disambiguated moves (see below):\n   *\n   * r1bqkbnr/ppp2ppp/2n5/1B1pP3/4P3/8/PPPP2PP/RNBQK1NR b KQkq - 2 4\n   * 4. ... Nge7 is overly disambiguated because the knight on c6 is pinned\n   * 4. ... Ne7 is technically the valid SAN\n   */\n  _moveToSan(move, moves) {\n    let output = '';\n    if (move.flags & BITS.KSIDE_CASTLE) {\n      output = 'O-O';\n    } else if (move.flags & BITS.QSIDE_CASTLE) {\n      output = 'O-O-O';\n    } else {\n      if (move.piece !== PAWN) {\n        const disambiguator = getDisambiguator(move, moves);\n        output += move.piece.toUpperCase() + disambiguator;\n      }\n      if (move.flags & (BITS.CAPTURE | BITS.EP_CAPTURE)) {\n        if (move.piece === PAWN) {\n          output += algebraic(move.from)[0];\n        }\n        output += 'x';\n      }\n      output += algebraic(move.to);\n      if (move.promotion) {\n        output += `=${move.promotion.toUpperCase()}`;\n      }\n    }\n    this._makeMove(move);\n    if (this.isCheck()) {\n      if (this.isCheckmate()) {\n        output += '#';\n      } else {\n        output += '+';\n      }\n    }\n    this._undoMove();\n    return output;\n  }\n  // convert a move from Standard Algebraic Notation (SAN) to 0x88 coordinates\n  _moveFromSan(move, strict = false) {\n    // strip off any move decorations: e.g Nf3+?! becomes Nf3\n    const cleanMove = strippedSan(move);\n    let pieceType = inferPieceType(cleanMove);\n    let moves = this._moves({ legal: true, piece: pieceType });\n    // strict parser\n    for (let i = 0, len = moves.length; i < len; i++) {\n      if (cleanMove === strippedSan(this._moveToSan(moves[i], moves))) {\n        return moves[i];\n      }\n    }\n    // the strict parser failed\n    if (strict) {\n      return null;\n    }\n    let piece = undefined;\n    let matches = undefined;\n    let from = undefined;\n    let to = undefined;\n    let promotion = undefined;\n    /*\n     * The default permissive (non-strict) parser allows the user to parse\n     * non-standard chess notations. This parser is only run after the strict\n     * Standard Algebraic Notation (SAN) parser has failed.\n     *\n     * When running the permissive parser, we'll run a regex to grab the piece, the\n     * to/from square, and an optional promotion piece. This regex will\n     * parse common non-standard notation like: Pe2-e4, Rc1c4, Qf3xf7,\n     * f7f8q, b1c3\n     *\n     * NOTE: Some positions and moves may be ambiguous when using the permissive\n     * parser. For example, in this position: 6k1/8/8/B7/8/8/8/BN4K1 w - - 0 1,\n     * the move b1c3 may be interpreted as Nc3 or B1c3 (a disambiguated bishop\n     * move). In these cases, the permissive parser will default to the most\n     * basic interpretation (which is b1c3 parsing to Nc3).\n     */\n    let overlyDisambiguated = false;\n    matches = cleanMove.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);\n    if (matches) {\n      piece = matches[1];\n      from = matches[2];\n      to = matches[3];\n      promotion = matches[4];\n      if (from.length === 1) {\n        overlyDisambiguated = true;\n      }\n    } else {\n      /*\n       * The [a-h]?[1-8]? portion of the regex below handles moves that may be\n       * overly disambiguated (e.g. Nge7 is unnecessary and non-standard when\n       * there is one legal knight move to e7). In this case, the value of\n       * 'from' variable will be a rank or file, not a square.\n       */\n      matches = cleanMove.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/);\n      if (matches) {\n        piece = matches[1];\n        from = matches[2];\n        to = matches[3];\n        promotion = matches[4];\n        if (from.length === 1) {\n          overlyDisambiguated = true;\n        }\n      }\n    }\n    pieceType = inferPieceType(cleanMove);\n    moves = this._moves({\n      legal: true,\n      piece: piece ? piece : pieceType,\n    });\n    if (!to) {\n      return null;\n    }\n    for (let i = 0, len = moves.length; i < len; i++) {\n      if (!from) {\n        // if there is no from square, it could be just 'x' missing from a capture\n        if (cleanMove === strippedSan(this._moveToSan(moves[i], moves)).replace('x', '')) {\n          return moves[i];\n        }\n        // hand-compare move properties with the results from our permissive regex\n      } else if (\n        (!piece || piece.toLowerCase() === moves[i].piece) &&\n        Ox88[from] === moves[i].from &&\n        Ox88[to] === moves[i].to &&\n        (!promotion || promotion.toLowerCase() === moves[i].promotion)\n      ) {\n        return moves[i];\n      } else if (overlyDisambiguated) {\n        /*\n         * SPECIAL CASE: we parsed a move string that may have an unneeded\n         * rank/file disambiguator (e.g. Nge7).  The 'from' variable will\n         */\n        const square = algebraic(moves[i].from);\n        if (\n          (!piece || piece.toLowerCase() === moves[i].piece) &&\n          Ox88[to] === moves[i].to &&\n          (from === square[0] || from === square[1]) &&\n          (!promotion || promotion.toLowerCase() === moves[i].promotion)\n        ) {\n          return moves[i];\n        }\n      }\n    }\n    return null;\n  }\n  ascii() {\n    let s = '   +------------------------+\\n';\n    for (let i = Ox88.a8; i <= Ox88.h1; i++) {\n      // display the rank\n      if (file(i) === 0) {\n        s += ` ${'87654321'[rank(i)]} |`;\n      }\n      if (this._board[i]) {\n        const piece = this._board[i].type;\n        const color = this._board[i].color;\n        const symbol = color === WHITE ? piece.toUpperCase() : piece.toLowerCase();\n        s += ` ${symbol} `;\n      } else {\n        s += ' . ';\n      }\n      if ((i + 1) & 0x88) {\n        s += '|\\n';\n        i += 8;\n      }\n    }\n    s += '   +------------------------+\\n';\n    s += '     a  b  c  d  e  f  g  h';\n    return s;\n  }\n  perft(depth) {\n    const moves = this._moves({ legal: false });\n    let nodes = 0;\n    const color = this._turn;\n    for (let i = 0, len = moves.length; i < len; i++) {\n      this._makeMove(moves[i]);\n      if (!this._isKingAttacked(color)) {\n        if (depth - 1 > 0) {\n          nodes += this.perft(depth - 1);\n        } else {\n          nodes++;\n        }\n      }\n      this._undoMove();\n    }\n    return nodes;\n  }\n  turn() {\n    return this._turn;\n  }\n  board() {\n    const output = [];\n    let row = [];\n    for (let i = Ox88.a8; i <= Ox88.h1; i++) {\n      if (this._board[i] == null) {\n        row.push(null);\n      } else {\n        row.push({\n          square: algebraic(i),\n          type: this._board[i].type,\n          color: this._board[i].color,\n        });\n      }\n      if ((i + 1) & 0x88) {\n        output.push(row);\n        row = [];\n        i += 8;\n      }\n    }\n    return output;\n  }\n  squareColor(square) {\n    if (square in Ox88) {\n      const sq = Ox88[square];\n      return (rank(sq) + file(sq)) % 2 === 0 ? 'light' : 'dark';\n    }\n    return null;\n  }\n  history({ verbose = false } = {}) {\n    const reversedHistory = [];\n    const moveHistory = [];\n    while (this._history.length > 0) {\n      reversedHistory.push(this._undoMove());\n    }\n    while (true) {\n      const move = reversedHistory.pop();\n      if (!move) {\n        break;\n      }\n      if (verbose) {\n        moveHistory.push(new Move(this, move));\n      } else {\n        moveHistory.push(this._moveToSan(move, this._moves()));\n      }\n      this._makeMove(move);\n    }\n    return moveHistory;\n  }\n  /*\n   * Keeps track of position occurrence counts for the purpose of repetition\n   * checking. All three methods (`_inc`, `_dec`, and `_get`) trim the\n   * irrelevent information from the fen, initialising new positions, and\n   * removing old positions from the record if their counts are reduced to 0.\n   */\n  _getPositionCount(fen) {\n    const trimmedFen = trimFen(fen);\n    return this._positionCount[trimmedFen] || 0;\n  }\n  _incPositionCount(fen) {\n    const trimmedFen = trimFen(fen);\n    if (this._positionCount[trimmedFen] === undefined) {\n      this._positionCount[trimmedFen] = 0;\n    }\n    this._positionCount[trimmedFen] += 1;\n  }\n  _decPositionCount(fen) {\n    const trimmedFen = trimFen(fen);\n    if (this._positionCount[trimmedFen] === 1) {\n      delete this._positionCount[trimmedFen];\n    } else {\n      this._positionCount[trimmedFen] -= 1;\n    }\n  }\n  _pruneComments() {\n    const reversedHistory = [];\n    const currentComments = {};\n    const copyComment = (fen) => {\n      if (fen in this._comments) {\n        currentComments[fen] = this._comments[fen];\n      }\n    };\n    while (this._history.length > 0) {\n      reversedHistory.push(this._undoMove());\n    }\n    copyComment(this.fen());\n    while (true) {\n      const move = reversedHistory.pop();\n      if (!move) {\n        break;\n      }\n      this._makeMove(move);\n      copyComment(this.fen());\n    }\n    this._comments = currentComments;\n  }\n  getComment() {\n    return this._comments[this.fen()];\n  }\n  setComment(comment) {\n    this._comments[this.fen()] = comment.replace('{', '[').replace('}', ']');\n  }\n  /**\n   * @deprecated Renamed to `removeComment` for consistency\n   */\n  deleteComment() {\n    return this.removeComment();\n  }\n  removeComment() {\n    const comment = this._comments[this.fen()];\n    delete this._comments[this.fen()];\n    return comment;\n  }\n  getComments() {\n    this._pruneComments();\n    return Object.keys(this._comments).map((fen) => {\n      return { fen, comment: this._comments[fen] };\n    });\n  }\n  /**\n   * @deprecated Renamed to `removeComments` for consistency\n   */\n  deleteComments() {\n    return this.removeComments();\n  }\n  removeComments() {\n    this._pruneComments();\n    return Object.keys(this._comments).map((fen) => {\n      const comment = this._comments[fen];\n      delete this._comments[fen];\n      return { fen, comment };\n    });\n  }\n  setCastlingRights(color, rights) {\n    for (const side of [KING, QUEEN]) {\n      if (rights[side] !== undefined) {\n        if (rights[side]) {\n          this._castling[color] |= SIDES[side];\n        } else {\n          this._castling[color] &= ~SIDES[side];\n        }\n      }\n    }\n    this._updateCastlingRights();\n    const result = this.getCastlingRights(color);\n    return (\n      (rights[KING] === undefined || rights[KING] === result[KING]) &&\n      (rights[QUEEN] === undefined || rights[QUEEN] === result[QUEEN])\n    );\n  }\n  getCastlingRights(color) {\n    return {\n      [KING]: (this._castling[color] & SIDES[KING]) !== 0,\n      [QUEEN]: (this._castling[color] & SIDES[QUEEN]) !== 0,\n    };\n  }\n  moveNumber() {\n    return this._moveNumber;\n  }\n}\n//# sourceMappingURL=chess.js.map\n","/**\n * Service for managing chess positions and FEN conversion\n * @module services/PositionService\n * @since 2.0.0\n */\n\nimport { Chess, validateFen } from '../utils/chess.js';\nimport {\n  STANDARD_POSITIONS,\n  DEFAULT_STARTING_POSITION,\n  BOARD_LETTERS,\n} from '../constants/positions.js';\nimport { ValidationError } from '../errors/ChessboardError.js';\nimport { ERROR_MESSAGES } from '../errors/messages.js';\n\n/**\n * Service responsible for position management and FEN operations\n * @class\n */\nexport class PositionService {\n  /**\n   * Creates a new PositionService instance\n   * @param {ChessboardConfig} config - Board configuration\n   */\n  constructor(config) {\n    this.config = config;\n    this.game = null;\n  }\n\n  /**\n   * Converts various position formats to FEN string\n   * @param {string|Object} position - Position in various formats\n   * @returns {string} FEN string representation\n   * @throws {ValidationError} When position format is invalid\n   */\n  convertFen(position) {\n    if (typeof position === 'string') {\n      return this._convertStringPosition(position);\n    } else if (typeof position === 'object' && position !== null) {\n      return this._convertObjectPosition(position);\n    }\n    throw new ValidationError(ERROR_MESSAGES.invalid_position + position, 'position', position);\n  }\n\n  /**\n   * Converts string position to FEN\n   * @private\n   * @param {string} position - String position\n   * @returns {string} FEN string\n   */\n  _convertStringPosition(position) {\n    if (position === 'start') {\n      return DEFAULT_STARTING_POSITION;\n    }\n\n    if (this.validateFen(position)) {\n      return position;\n    }\n\n    if (STANDARD_POSITIONS[position]) {\n      return STANDARD_POSITIONS[position];\n    }\n\n    throw new ValidationError(ERROR_MESSAGES.invalid_position + position, 'position', position);\n  }\n\n  /**\n   * Converts object position to FEN\n   * @private\n   * @param {Object} position - Object with square->piece mapping\n   * @returns {string} FEN string\n   */\n  _convertObjectPosition(position) {\n    const parts = [];\n\n    for (let row = 0; row < 8; row++) {\n      const rowParts = [];\n      let empty = 0;\n\n      for (let col = 0; col < 8; col++) {\n        const square = this._getSquareID(row, col);\n        const piece = position[square];\n\n        if (piece) {\n          if (empty > 0) {\n            rowParts.push(empty);\n            empty = 0;\n          }\n          // Convert piece notation: white pieces become uppercase, black remain lowercase\n          const fenPiece = piece[1] === 'w' ? piece[0].toUpperCase() : piece[0].toLowerCase();\n          rowParts.push(fenPiece);\n        } else {\n          empty++;\n        }\n      }\n\n      if (empty > 0) {\n        rowParts.push(empty);\n      }\n\n      parts.push(rowParts.join(''));\n    }\n\n    return `${parts.join('/')} w KQkq - 0 1`;\n  }\n\n  /**\n   * Sets up the game with the given position\n   * @param {string|Object} position - Position to set\n   * @param {Object} [options] - Additional options for game setup\n   */\n  setGame(position, options = {}) {\n    const fen = this.convertFen(position);\n\n    if (this.game) {\n      this.game.load(fen, options);\n    } else {\n      this.game = new Chess(fen);\n    }\n  }\n\n  /**\n   * Gets the current game instance\n   * @returns {Chess} Current chess.js game instance\n   */\n  getGame() {\n    return this.game;\n  }\n\n  /**\n   * Validates a FEN string\n   * @param {string} fen - FEN string to validate\n   * @returns {boolean} True if valid, false otherwise\n   */\n  validateFen(fen) {\n    return validateFen(fen);\n  }\n\n  /**\n   * Gets piece information for a specific square\n   * @param {string} squareId - Square identifier\n   * @returns {string|null} Piece ID or null if no piece\n   */\n  getGamePieceId(squareId) {\n    if (!this.game) return null;\n    const piece = this.game.get(squareId);\n    return piece ? piece.color + piece.type : null;\n  }\n\n  /**\n   * Checks if a specific piece is on a specific square\n   * @param {string} piece - Piece ID to check\n   * @param {string} square - Square to check\n   * @returns {boolean} True if piece is on square\n   */\n  isPiece(piece, square) {\n    return this.getGamePieceId(square) === piece;\n  }\n\n  /**\n   * Converts board coordinates to square ID\n   * @private\n   * @param {number} row - Row index (0-7)\n   * @param {number} col - Column index (0-7)\n   * @returns {string} Square ID (e.g., 'e4')\n   */\n  _getSquareID(row, col) {\n    row = parseInt(row);\n    col = parseInt(col);\n\n    if (this.config.orientation === 'w') {\n      row = 8 - row;\n      col = col + 1;\n    } else {\n      row = row + 1;\n      col = 8 - col;\n    }\n\n    const letter = BOARD_LETTERS[col - 1];\n    return letter + row;\n  }\n\n  /**\n   * Changes the turn in a FEN string\n   * @param {string} fen - Original FEN string\n   * @param {string} color - New turn color ('w' or 'b')\n   * @returns {string} Modified FEN string\n   */\n  changeFenTurn(fen, color) {\n    const parts = fen.split(' ');\n    parts[1] = color;\n    return parts.join(' ');\n  }\n\n  /**\n   * Gets the current position as an object\n   * @returns {Object} Position object with piece placements\n   */\n  getPosition() {\n    const position = {};\n    const game = this.getGame();\n\n    // Convert chess.js board to position object\n    const squares = [\n      'a1',\n      'b1',\n      'c1',\n      'd1',\n      'e1',\n      'f1',\n      'g1',\n      'h1',\n      'a2',\n      'b2',\n      'c2',\n      'd2',\n      'e2',\n      'f2',\n      'g2',\n      'h2',\n      'a3',\n      'b3',\n      'c3',\n      'd3',\n      'e3',\n      'f3',\n      'g3',\n      'h3',\n      'a4',\n      'b4',\n      'c4',\n      'd4',\n      'e4',\n      'f4',\n      'g4',\n      'h4',\n      'a5',\n      'b5',\n      'c5',\n      'd5',\n      'e5',\n      'f5',\n      'g5',\n      'h5',\n      'a6',\n      'b6',\n      'c6',\n      'd6',\n      'e6',\n      'f6',\n      'g6',\n      'h6',\n      'a7',\n      'b7',\n      'c7',\n      'd7',\n      'e7',\n      'f7',\n      'g7',\n      'h7',\n      'a8',\n      'b8',\n      'c8',\n      'd8',\n      'e8',\n      'f8',\n      'g8',\n      'h8',\n    ];\n\n    for (const square of squares) {\n      const piece = game.get(square);\n      if (piece) {\n        position[square] = piece.type + piece.color;\n      }\n    }\n\n    return position;\n  }\n\n  /**\n   * Toggles the turn in a FEN string\n   * @param {string} fen - Original FEN string\n   * @returns {string} Modified FEN string\n   */\n  changeFenColor(fen) {\n    const parts = fen.split(' ');\n    parts[1] = parts[1] === 'w' ? 'b' : 'w';\n    return parts.join(' ');\n  }\n\n  /**\n   * Cleans up resources\n   */\n  destroy() {\n    this.game = null;\n  }\n}\n","/**\n * Performance utilities for smooth interactions and monitoring\n * @module utils/performance\n * @since 2.0.0\n */\n\n/**\n * Performance monitoring class for measuring and tracking performance metrics\n * @class\n */\nexport class PerformanceMonitor {\n  /**\n   * Creates a new PerformanceMonitor instance\n   */\n  constructor() {\n    this.metrics = new Map();\n    this.observers = new Map();\n    this.isEnabled = typeof performance !== 'undefined' && performance.mark;\n\n    if (this.isEnabled) {\n      this._setupObservers();\n    }\n  }\n\n  /**\n   * Sets up performance observers for automatic metrics collection\n   * @private\n   */\n  _setupObservers() {\n    try {\n      // Performance Observer for paint metrics\n      if (typeof PerformanceObserver !== 'undefined') {\n        const paintObserver = new PerformanceObserver((list) => {\n          for (const entry of list.getEntries()) {\n            this.recordMetric(entry.name, entry.startTime);\n          }\n        });\n\n        paintObserver.observe({ entryTypes: ['paint'] });\n        this.observers.set('paint', paintObserver);\n      }\n    } catch (error) {\n      console.warn('Performance observers not available:', error.message);\n    }\n  }\n\n  /**\n   * Starts measuring performance for a given operation\n   * @param {string} name - Name of the operation\n   */\n  startMeasure(name) {\n    if (!this.isEnabled) return;\n\n    try {\n      performance.mark(`${name}-start`);\n    } catch (error) {\n      console.warn(`Failed to start performance measure for ${name}:`, error.message);\n    }\n  }\n\n  /**\n   * Ends measuring performance for a given operation\n   * @param {string} name - Name of the operation\n   * @returns {number} Duration in milliseconds\n   */\n  endMeasure(name) {\n    if (!this.isEnabled) return 0;\n\n    try {\n      performance.mark(`${name}-end`);\n      const measure = performance.measure(name, `${name}-start`, `${name}-end`);\n\n      this.recordMetric(name, measure.duration);\n\n      // Clean up marks\n      performance.clearMarks(`${name}-start`);\n      performance.clearMarks(`${name}-end`);\n      performance.clearMeasures(name);\n\n      return measure.duration;\n    } catch (error) {\n      console.warn(`Failed to end performance measure for ${name}:`, error.message);\n      return 0;\n    }\n  }\n\n  /**\n   * Records a metric value\n   * @param {string} name - Metric name\n   * @param {number} value - Metric value\n   */\n  recordMetric(name, value) {\n    if (!this.metrics.has(name)) {\n      this.metrics.set(name, {\n        count: 0,\n        total: 0,\n        min: Infinity,\n        max: -Infinity,\n        values: [],\n      });\n    }\n\n    const metric = this.metrics.get(name);\n    metric.count++;\n    metric.total += value;\n    metric.min = Math.min(metric.min, value);\n    metric.max = Math.max(metric.max, value);\n    metric.values.push(value);\n\n    // Keep only last 100 values to prevent memory leaks\n    if (metric.values.length > 100) {\n      metric.values.shift();\n    }\n  }\n\n  /**\n   * Gets metrics summary\n   * @returns {Object} Metrics summary\n   */\n  getMetrics() {\n    const summary = {};\n\n    for (const [name, metric] of this.metrics) {\n      summary[name] = {\n        count: metric.count,\n        average: metric.total / metric.count,\n        min: metric.min,\n        max: metric.max,\n        total: metric.total,\n        p95: this._calculatePercentile(metric.values, 95),\n        p99: this._calculatePercentile(metric.values, 99),\n      };\n    }\n\n    return summary;\n  }\n\n  /**\n   * Calculates percentile for a set of values\n   * @private\n   * @param {Array<number>} values - Array of values\n   * @param {number} percentile - Percentile to calculate (0-100)\n   * @returns {number} Percentile value\n   */\n  _calculatePercentile(values, percentile) {\n    if (values.length === 0) return 0;\n\n    const sorted = [...values].sort((a, b) => a - b);\n    const index = Math.ceil((percentile / 100) * sorted.length) - 1;\n    return sorted[Math.max(0, index)];\n  }\n\n  /**\n   * Clears all metrics\n   */\n  clearMetrics() {\n    this.metrics.clear();\n  }\n\n  /**\n   * Destroys the performance monitor and cleans up resources\n   */\n  destroy() {\n    // Disconnect observers\n    for (const observer of this.observers.values()) {\n      if (observer && typeof observer.disconnect === 'function') {\n        observer.disconnect();\n      }\n    }\n\n    this.observers.clear();\n    this.metrics.clear();\n  }\n}\n\n/**\n * Throttle function to limit how often a function can be called\n * @param {Function} func - Function to throttle\n * @param {number} limit - Time limit in milliseconds\n * @returns {Function} Throttled function\n */\nexport function throttle(func, limit) {\n  let inThrottle;\n  return function (...args) {\n    if (!inThrottle) {\n      func.apply(this, args);\n      inThrottle = true;\n      setTimeout(() => {\n        inThrottle = false;\n      }, limit);\n    }\n  };\n}\n\n/**\n * Debounce function to delay function execution\n * @param {Function} func - Function to debounce\n * @param {number} delay - Delay in milliseconds\n * @returns {Function} Debounced function\n */\nexport function debounce(func, delay) {\n  let timeoutId;\n  const debounced = function (...args) {\n    clearTimeout(timeoutId);\n    timeoutId = setTimeout(() => func.apply(debounced.context, args), delay);\n  };\n  return function (...args) {\n    debounced.context = this;\n    return debounced(...args);\n  };\n}\n\n/**\n * Request animation frame throttle for smooth animations\n * @param {Function} func - Function to throttle\n * @returns {Function} RAF throttled function\n */\nexport function rafThrottle(func) {\n  let isThrottled = false;\n  const throttled = function (...args) {\n    if (isThrottled) {\n      return;\n    }\n\n    isThrottled = true;\n    requestAnimationFrame(() => {\n      func.apply(throttled.context, args);\n      isThrottled = false;\n    });\n  };\n  return function (...args) {\n    throttled.context = this;\n    return throttled(...args);\n  };\n}\n\n/**\n * High performance transform utility with hardware acceleration\n * @param {HTMLElement} element - Element to transform\n * @param {number} x - X coordinate\n * @param {number} y - Y coordinate\n * @param {number} [scale=1] - Scale factor\n */\nexport function setTransform(element, x, y, scale = 1) {\n  if (!element || !element.style) return;\n\n  // Use transform3d for hardware acceleration\n  element.style.transform = `translate3d(${x}px, ${y}px, 0) scale(${scale})`;\n\n  // Promote to composite layer for better performance\n  element.style.willChange = 'transform';\n}\n\n/**\n * Reset element position efficiently\n * @param {HTMLElement} element - Element to reset\n */\nexport function resetTransform(element) {\n  if (!element || !element.style) return;\n\n  element.style.transform = '';\n  element.style.left = '';\n  element.style.top = '';\n  element.style.willChange = '';\n}\n\n/**\n * Memory-efficient batch DOM operations\n * @param {Function} callback - Callback containing DOM operations\n * @returns {*} Result of the callback\n */\nexport function batchDOMOperations(callback) {\n  return new Promise((resolve) => {\n    requestAnimationFrame(() => {\n      const result = callback();\n      resolve(result);\n    });\n  });\n}\n\n/**\n * Optimized element visibility check\n * @param {HTMLElement} element - Element to check\n * @returns {boolean} True if element is visible\n */\nexport function isElementVisible(element) {\n  if (!element || !element.getBoundingClientRect) return false;\n\n  const rect = element.getBoundingClientRect();\n  return (\n    rect.width > 0 &&\n    rect.height > 0 &&\n    rect.bottom > 0 &&\n    rect.right > 0 &&\n    rect.top < (window.innerHeight || document.documentElement.clientHeight) &&\n    rect.left < (window.innerWidth || document.documentElement.clientWidth)\n  );\n}\n\n/**\n * Memory usage tracking utility\n * @returns {Object} Memory usage information\n */\nexport function getMemoryUsage() {\n  if (typeof performance !== 'undefined' && performance.memory) {\n    return {\n      used: performance.memory.usedJSHeapSize,\n      total: performance.memory.totalJSHeapSize,\n      limit: performance.memory.jsHeapSizeLimit,\n    };\n  }\n\n  return {\n    used: 0,\n    total: 0,\n    limit: 0,\n    supported: false,\n  };\n}\n","/**\n * Base Mode - Abstract class for all chess board modes\n * @module modes/BaseMode\n * @since 3.1.0\n */\n\n/**\n * @typedef {Object} ModeConfig\n * @property {string} name - Mode name\n * @property {boolean} enforceRules - Whether to enforce chess rules\n * @property {boolean} allowFreeMovement - Allow moving any piece anywhere\n * @property {boolean} allowPieceCreation - Allow adding pieces to the board\n * @property {boolean} allowPieceRemoval - Allow removing pieces from the board\n * @property {boolean} trackTurns - Track whose turn it is\n * @property {boolean} detectGameEnd - Detect checkmate/stalemate\n * @property {Function} [onModeStart] - Callback when mode starts\n * @property {Function} [onModeEnd] - Callback when mode ends\n * @property {Function} [onMove] - Callback after each move\n * @property {Function} [onTurnChange] - Callback when turn changes\n */\n\n/**\n * Abstract base class for all game modes\n * @abstract\n */\nexport class BaseMode {\n  /**\n   * @param {Object} chessboard - Reference to the chessboard instance\n   * @param {ModeConfig} [config={}] - Mode configuration\n   */\n  constructor(chessboard, config = {}) {\n    if (new.target === BaseMode) {\n      throw new Error('BaseMode is abstract and cannot be instantiated directly');\n    }\n\n    this.chessboard = chessboard;\n    this.config = {\n      name: 'base',\n      enforceRules: true,\n      allowFreeMovement: false,\n      allowPieceCreation: false,\n      allowPieceRemoval: false,\n      trackTurns: true,\n      detectGameEnd: true,\n      ...config,\n    };\n\n    this.isActive = false;\n    this.moveHistory = [];\n    this.listeners = new Map();\n  }\n\n  /**\n   * Get mode name\n   * @returns {string}\n   */\n  getName() {\n    return this.config.name;\n  }\n\n  /**\n   * Start the mode\n   * @virtual\n   */\n  start() {\n    this.isActive = true;\n    this.moveHistory = [];\n    this._emit('modeStart', { mode: this.getName() });\n\n    if (this.config.onModeStart) {\n      this.config.onModeStart(this);\n    }\n  }\n\n  /**\n   * Stop the mode\n   * @virtual\n   */\n  stop() {\n    this.isActive = false;\n    this._emit('modeEnd', { mode: this.getName() });\n\n    if (this.config.onModeEnd) {\n      this.config.onModeEnd(this);\n    }\n  }\n\n  /**\n   * Check if a move is allowed in this mode\n   * @param {string} from - Source square\n   * @param {string} to - Target square\n   * @param {Object} [options={}] - Additional options\n   * @returns {boolean}\n   * @virtual\n   */\n  canMove(from, to, options = {}) {\n    if (!this.isActive) return false;\n\n    if (this.config.allowFreeMovement) {\n      return true;\n    }\n\n    // Delegate to chess rules validation\n    return this._validateMove(from, to, options);\n  }\n\n  /**\n   * Execute a move\n   * @param {string} from - Source square\n   * @param {string} to - Target square\n   * @param {Object} [options={}] - Additional options\n   * @returns {boolean} - Whether the move was successful\n   * @virtual\n   */\n  executeMove(from, to, options = {}) {\n    if (!this.canMove(from, to, options)) {\n      return false;\n    }\n\n    const moveData = {\n      from,\n      to,\n      timestamp: Date.now(),\n      ...options,\n    };\n\n    this.moveHistory.push(moveData);\n    this._emit('move', moveData);\n\n    if (this.config.onMove) {\n      this.config.onMove(moveData);\n    }\n\n    if (this.config.trackTurns && this.config.onTurnChange) {\n      this.config.onTurnChange(this.getCurrentTurn());\n    }\n\n    return true;\n  }\n\n  /**\n   * Check if piece creation is allowed\n   * @returns {boolean}\n   */\n  canCreatePiece() {\n    return this.isActive && this.config.allowPieceCreation;\n  }\n\n  /**\n   * Check if piece removal is allowed\n   * @returns {boolean}\n   */\n  canRemovePiece() {\n    return this.isActive && this.config.allowPieceRemoval;\n  }\n\n  /**\n   * Get current turn\n   * @returns {'w'|'b'|null}\n   */\n  getCurrentTurn() {\n    if (!this.config.trackTurns) return null;\n    return this.chessboard.turn ? this.chessboard.turn() : 'w';\n  }\n\n  /**\n   * Check if game is over\n   * @returns {boolean}\n   */\n  isGameOver() {\n    if (!this.config.detectGameEnd) return false;\n    return this.chessboard.isGameOver ? this.chessboard.isGameOver() : false;\n  }\n\n  /**\n   * Get game result\n   * @returns {Object|null}\n   */\n  getGameResult() {\n    if (!this.isGameOver()) return null;\n\n    const result = {\n      isOver: true,\n      isCheckmate: this.chessboard.isCheckmate?.() || false,\n      isStalemate: this.chessboard.isStalemate?.() || false,\n      isDraw: this.chessboard.isDraw?.() || false,\n      winner: null,\n    };\n\n    if (result.isCheckmate) {\n      // The side that just moved won\n      result.winner = this.getCurrentTurn() === 'w' ? 'b' : 'w';\n    }\n\n    return result;\n  }\n\n  /**\n   * Add event listener\n   * @param {string} event - Event name\n   * @param {Function} callback - Callback function\n   */\n  on(event, callback) {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, []);\n    }\n    this.listeners.get(event).push(callback);\n  }\n\n  /**\n   * Remove event listener\n   * @param {string} event - Event name\n   * @param {Function} callback - Callback function\n   */\n  off(event, callback) {\n    if (!this.listeners.has(event)) return;\n    const callbacks = this.listeners.get(event);\n    const index = callbacks.indexOf(callback);\n    if (index > -1) {\n      callbacks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Emit event\n   * @protected\n   * @param {string} event - Event name\n   * @param {Object} data - Event data\n   */\n  _emit(event, data) {\n    if (!this.listeners.has(event)) return;\n    this.listeners.get(event).forEach((callback) => {\n      try {\n        callback(data);\n      } catch (err) {\n        console.error(`Error in mode event listener for ${event}:`, err);\n      }\n    });\n  }\n\n  /**\n   * Validate move according to chess rules\n   * @protected\n   * @param {string} from - Source square\n   * @param {string} to - Target square\n   * @returns {boolean}\n   */\n  _validateMove(from, to) {\n    if (!this.chessboard.positionService) return false;\n\n    const game = this.chessboard.positionService.getGame();\n    if (!game) return false;\n\n    // Check if move is legal\n    const moves = game.moves({ square: from, verbose: true });\n    return moves.some((m) => m.to === to);\n  }\n\n  /**\n   * Get mode statistics\n   * @returns {Object}\n   */\n  getStats() {\n    return {\n      mode: this.getName(),\n      isActive: this.isActive,\n      movesPlayed: this.moveHistory.length,\n      currentTurn: this.getCurrentTurn(),\n      isGameOver: this.isGameOver(),\n    };\n  }\n\n  /**\n   * Reset the mode\n   * @virtual\n   */\n  reset() {\n    this.moveHistory = [];\n    this._emit('reset', { mode: this.getName() });\n  }\n\n  /**\n   * Serialize mode state\n   * @returns {Object}\n   */\n  serialize() {\n    return {\n      name: this.getName(),\n      config: this.config,\n      isActive: this.isActive,\n      moveHistory: this.moveHistory,\n    };\n  }\n\n  /**\n   * Restore mode state\n   * @param {Object} state - Serialized state\n   */\n  restore(state) {\n    if (state.moveHistory) {\n      this.moveHistory = state.moveHistory;\n    }\n    if (state.isActive) {\n      this.start();\n    }\n  }\n}\n\nexport default BaseMode;\n","/**\n * Creative Mode - Free piece manipulation without rule enforcement\n * @module modes/CreativeMode\n * @since 3.1.0\n *\n * Features:\n * - Add any piece to any square\n * - Remove pieces freely\n * - Move pieces without rule validation\n * - Copy pieces from one square to another\n * - Clear board or reset to custom positions\n * - Save and load custom positions\n */\n\nimport { BaseMode } from './BaseMode.js';\n\n/**\n * @typedef {Object} CreativeModeConfig\n * @extends ModeConfig\n * @property {boolean} [showPiecePalette=true] - Show piece selection palette\n * @property {boolean} [allowIllegalPositions=true] - Allow positions with multiple kings, etc.\n * @property {string[]} [availablePieces] - Pieces available for placement\n * @property {Function} [onPieceAdded] - Callback when piece is added\n * @property {Function} [onPieceRemoved] - Callback when piece is removed\n * @property {Function} [onPositionSaved] - Callback when position is saved\n */\n\n/**\n * Creative mode for free board manipulation\n */\nexport class CreativeMode extends BaseMode {\n  /**\n   * Default pieces available in creative mode\n   * @static\n   */\n  static DEFAULT_PIECES = ['wk', 'wq', 'wr', 'wb', 'wn', 'wp', 'bk', 'bq', 'br', 'bb', 'bn', 'bp'];\n\n  /**\n   * @param {Object} chessboard - Reference to the chessboard instance\n   * @param {CreativeModeConfig} [config={}] - Mode configuration\n   */\n  constructor(chessboard, config = {}) {\n    super(chessboard, {\n      name: 'creative',\n      enforceRules: false,\n      allowFreeMovement: true,\n      allowPieceCreation: true,\n      allowPieceRemoval: true,\n      trackTurns: false,\n      detectGameEnd: false,\n      showPiecePalette: true,\n      allowIllegalPositions: true,\n      availablePieces: CreativeMode.DEFAULT_PIECES,\n      ...config,\n    });\n\n    this.selectedPiece = null;\n    this.savedPositions = new Map();\n    this.clipboard = null;\n    this.undoStack = [];\n    this.redoStack = [];\n  }\n\n  /**\n   * Start creative mode\n   * @override\n   */\n  start() {\n    super.start();\n\n    // Save initial position for undo\n    this._saveState();\n\n    // Enable piece interaction\n    this._setupInteractions();\n\n    this._emit('creativeStart', {\n      availablePieces: this.config.availablePieces,\n    });\n  }\n\n  /**\n   * Stop creative mode\n   * @override\n   */\n  stop() {\n    this._cleanupInteractions();\n    super.stop();\n  }\n\n  /**\n   * Setup creative mode interactions\n   * @private\n   */\n  _setupInteractions() {\n    // Store original draggable state\n    this._originalDraggable = this.chessboard.config.draggable;\n\n    // Enable dragging in creative mode\n    if (this.chessboard.config) {\n      this.chessboard.config.draggable = true;\n    }\n  }\n\n  /**\n   * Cleanup creative mode interactions\n   * @private\n   */\n  _cleanupInteractions() {\n    // Restore original draggable state\n    if (this._originalDraggable !== undefined && this.chessboard.config) {\n      this.chessboard.config.draggable = this._originalDraggable;\n    }\n  }\n\n  /**\n   * Select a piece type for placement\n   * @param {string} piece - Piece code (e.g., 'wq', 'bn')\n   */\n  selectPiece(piece) {\n    if (!this.config.availablePieces.includes(piece)) {\n      console.warn(`[CreativeMode] Piece ${piece} not available`);\n      return;\n    }\n    this.selectedPiece = piece;\n    this._emit('pieceSelected', { piece });\n  }\n\n  /**\n   * Deselect current piece\n   */\n  deselectPiece() {\n    this.selectedPiece = null;\n    this._emit('pieceDeselected', {});\n  }\n\n  /**\n   * Get currently selected piece\n   * @returns {string|null}\n   */\n  getSelectedPiece() {\n    return this.selectedPiece;\n  }\n\n  /**\n   * Add a piece to a square\n   * @param {string} piece - Piece code\n   * @param {string} square - Target square\n   * @returns {boolean}\n   */\n  addPiece(piece, square) {\n    if (!this.isActive) return false;\n\n    this._saveState();\n\n    try {\n      // Remove existing piece if any\n      const existingPiece = this.chessboard.getPiece(square);\n      if (existingPiece) {\n        this.chessboard.removePiece(square);\n      }\n\n      // Add new piece\n      this.chessboard.putPiece(piece, square);\n      this.chessboard.forceSync();\n\n      this._emit('pieceAdded', { piece, square });\n\n      if (this.config.onPieceAdded) {\n        this.config.onPieceAdded({ piece, square });\n      }\n\n      return true;\n    } catch (err) {\n      console.error('[CreativeMode] Error adding piece:', err);\n      this.undo(); // Rollback\n      return false;\n    }\n  }\n\n  /**\n   * Remove a piece from a square\n   * @param {string} square - Square to clear\n   * @returns {string|null} - The removed piece code\n   */\n  removePiece(square) {\n    if (!this.isActive) return null;\n\n    const piece = this.chessboard.getPiece(square);\n    if (!piece) return null;\n\n    this._saveState();\n\n    try {\n      this.chessboard.removePiece(square);\n      this.chessboard.forceSync();\n\n      this._emit('pieceRemoved', { piece, square });\n\n      if (this.config.onPieceRemoved) {\n        this.config.onPieceRemoved({ piece, square });\n      }\n\n      return piece;\n    } catch (err) {\n      console.error('[CreativeMode] Error removing piece:', err);\n      this.undo();\n      return null;\n    }\n  }\n\n  /**\n   * Move a piece (no rule validation)\n   * @param {string} from - Source square\n   * @param {string} to - Target square\n   * @returns {boolean}\n   */\n  movePiece(from, to) {\n    if (!this.isActive) return false;\n\n    const piece = this.chessboard.getPiece(from);\n    if (!piece) return false;\n\n    this._saveState();\n\n    try {\n      // Remove from source\n      this.chessboard.removePiece(from);\n      // Add to target (replacing any existing piece)\n      this.chessboard.putPiece(piece, to);\n      this.chessboard.forceSync();\n\n      this._emit('pieceMoved', { piece, from, to });\n\n      return true;\n    } catch (err) {\n      console.error('[CreativeMode] Error moving piece:', err);\n      this.undo();\n      return false;\n    }\n  }\n\n  /**\n   * Copy a piece to another square\n   * @param {string} from - Source square\n   * @param {string} to - Target square\n   * @returns {boolean}\n   */\n  copyPiece(from, to) {\n    if (!this.isActive) return false;\n\n    const piece = this.chessboard.getPiece(from);\n    if (!piece) return false;\n\n    return this.addPiece(piece, to);\n  }\n\n  /**\n   * Copy piece to clipboard\n   * @param {string} square - Square to copy from\n   */\n  copyToClipboard(square) {\n    this.clipboard = this.chessboard.getPiece(square);\n    this._emit('clipboardUpdated', { piece: this.clipboard });\n  }\n\n  /**\n   * Paste piece from clipboard\n   * @param {string} square - Target square\n   * @returns {boolean}\n   */\n  pasteFromClipboard(square) {\n    if (!this.clipboard) return false;\n    return this.addPiece(this.clipboard, square);\n  }\n\n  /**\n   * Clear the entire board\n   */\n  clearBoard() {\n    if (!this.isActive) return;\n\n    this._saveState();\n    this.chessboard.clear({ animate: false });\n    this.chessboard.forceSync();\n\n    this._emit('boardCleared', {});\n  }\n\n  /**\n   * Set up starting position\n   */\n  setupStartingPosition() {\n    if (!this.isActive) return;\n\n    this._saveState();\n    this.chessboard.reset({ animate: false });\n    this.chessboard.forceSync();\n\n    this._emit('positionReset', {});\n  }\n\n  /**\n   * Set a custom position from FEN\n   * @param {string} fen - FEN string\n   * @returns {boolean}\n   */\n  setPosition(fen) {\n    if (!this.isActive) return false;\n\n    this._saveState();\n\n    try {\n      this.chessboard.setPosition(fen);\n      this.chessboard.forceSync();\n\n      this._emit('positionSet', { fen });\n      return true;\n    } catch (err) {\n      console.error('[CreativeMode] Error setting position:', err);\n      this.undo();\n      return false;\n    }\n  }\n\n  /**\n   * Save current position with a name\n   * @param {string} name - Position name\n   * @returns {string} - FEN string\n   */\n  savePosition(name) {\n    const fen = this.chessboard.fen();\n    this.savedPositions.set(name, fen);\n\n    this._emit('positionSaved', { name, fen });\n\n    if (this.config.onPositionSaved) {\n      this.config.onPositionSaved({ name, fen });\n    }\n\n    return fen;\n  }\n\n  /**\n   * Load a saved position\n   * @param {string} name - Position name\n   * @returns {boolean}\n   */\n  loadPosition(name) {\n    const fen = this.savedPositions.get(name);\n    if (!fen) {\n      console.warn(`[CreativeMode] Position \"${name}\" not found`);\n      return false;\n    }\n\n    return this.setPosition(fen);\n  }\n\n  /**\n   * Get list of saved positions\n   * @returns {string[]}\n   */\n  getSavedPositions() {\n    return Array.from(this.savedPositions.keys());\n  }\n\n  /**\n   * Delete a saved position\n   * @param {string} name - Position name\n   * @returns {boolean}\n   */\n  deletePosition(name) {\n    return this.savedPositions.delete(name);\n  }\n\n  /**\n   * Undo last action\n   * @returns {boolean}\n   */\n  undo() {\n    if (this.undoStack.length === 0) return false;\n\n    // Save current state to redo stack\n    this.redoStack.push(this.chessboard.fen());\n\n    // Restore previous state\n    const previousFen = this.undoStack.pop();\n    this.chessboard.setPosition(previousFen);\n    this.chessboard.forceSync();\n\n    this._emit('undo', { fen: previousFen });\n    return true;\n  }\n\n  /**\n   * Redo last undone action\n   * @returns {boolean}\n   */\n  redo() {\n    if (this.redoStack.length === 0) return false;\n\n    // Save current state to undo stack\n    this.undoStack.push(this.chessboard.fen());\n\n    // Restore next state\n    const nextFen = this.redoStack.pop();\n    this.chessboard.setPosition(nextFen);\n    this.chessboard.forceSync();\n\n    this._emit('redo', { fen: nextFen });\n    return true;\n  }\n\n  /**\n   * Save current state for undo\n   * @private\n   */\n  _saveState() {\n    this.undoStack.push(this.chessboard.fen());\n    this.redoStack = []; // Clear redo stack on new action\n  }\n\n  /**\n   * Validate position (check for illegal setups)\n   * @returns {Object} - Validation result\n   */\n  validatePosition() {\n    const fen = this.chessboard.fen();\n    const position = fen.split(' ')[0];\n\n    const issues = [];\n    let whiteKings = 0;\n    let blackKings = 0;\n    let whitePawnsOnFirstRank = 0;\n    let blackPawnsOnLastRank = 0;\n\n    // Count pieces\n    for (const char of position) {\n      if (char === 'K') whiteKings++;\n      if (char === 'k') blackKings++;\n    }\n\n    // Check pawns on first/last rank\n    const ranks = position.split('/');\n    if (ranks[0].includes('P')) blackPawnsOnLastRank++;\n    if (ranks[7].includes('p')) whitePawnsOnFirstRank++;\n\n    if (whiteKings !== 1) {\n      issues.push(`White has ${whiteKings} kings (should be 1)`);\n    }\n    if (blackKings !== 1) {\n      issues.push(`Black has ${blackKings} kings (should be 1)`);\n    }\n    if (whitePawnsOnFirstRank > 0) {\n      issues.push('White pawns on 1st rank');\n    }\n    if (blackPawnsOnLastRank > 0) {\n      issues.push('Black pawns on 8th rank');\n    }\n\n    return {\n      isValid: issues.length === 0,\n      issues,\n      fen,\n    };\n  }\n\n  /**\n   * Export position as various formats\n   * @param {string} [format='fen'] - Export format ('fen', 'pgn', 'json')\n   * @returns {string}\n   */\n  exportPosition(format = 'fen') {\n    switch (format) {\n      case 'fen':\n        return this.chessboard.fen();\n      case 'json':\n        return JSON.stringify({\n          fen: this.chessboard.fen(),\n          savedPositions: Object.fromEntries(this.savedPositions),\n        });\n      default:\n        return this.chessboard.fen();\n    }\n  }\n\n  /**\n   * Import position from format\n   * @param {string} data - Position data\n   * @param {string} [format='fen'] - Import format\n   * @returns {boolean}\n   */\n  importPosition(data, format = 'fen') {\n    try {\n      switch (format) {\n        case 'fen':\n          return this.setPosition(data);\n        case 'json': {\n          const parsed = JSON.parse(data);\n          if (parsed.fen) {\n            this.setPosition(parsed.fen);\n          }\n          if (parsed.savedPositions) {\n            Object.entries(parsed.savedPositions).forEach(([name, fen]) => {\n              this.savedPositions.set(name, fen);\n            });\n          }\n          return true;\n        }\n        default:\n          return this.setPosition(data);\n      }\n    } catch (err) {\n      console.error('[CreativeMode] Error importing position:', err);\n      return false;\n    }\n  }\n\n  /**\n   * Get mode-specific stats\n   * @override\n   * @returns {Object}\n   */\n  getStats() {\n    return {\n      ...super.getStats(),\n      selectedPiece: this.selectedPiece,\n      savedPositionsCount: this.savedPositions.size,\n      undoStackSize: this.undoStack.length,\n      redoStackSize: this.redoStack.length,\n      clipboardPiece: this.clipboard,\n      validation: this.validatePosition(),\n    };\n  }\n\n  /**\n   * Reset creative mode\n   * @override\n   */\n  reset() {\n    super.reset();\n    this.selectedPiece = null;\n    this.clipboard = null;\n    this.undoStack = [];\n    this.redoStack = [];\n  }\n\n  /**\n   * Serialize mode state\n   * @override\n   * @returns {Object}\n   */\n  serialize() {\n    return {\n      ...super.serialize(),\n      selectedPiece: this.selectedPiece,\n      savedPositions: Object.fromEntries(this.savedPositions),\n      clipboard: this.clipboard,\n      undoStack: this.undoStack,\n      redoStack: this.redoStack,\n    };\n  }\n\n  /**\n   * Restore mode state\n   * @override\n   * @param {Object} state - Serialized state\n   */\n  restore(state) {\n    super.restore(state);\n    if (state.selectedPiece) this.selectedPiece = state.selectedPiece;\n    if (state.savedPositions) {\n      this.savedPositions = new Map(Object.entries(state.savedPositions));\n    }\n    if (state.clipboard) this.clipboard = state.clipboard;\n    if (state.undoStack) this.undoStack = state.undoStack;\n    if (state.redoStack) this.redoStack = state.redoStack;\n  }\n}\n\nexport default CreativeMode;\n","/**\n * PvP Mode - Player vs Player with full rule enforcement\n * @module modes/PvPMode\n * @since 3.1.0\n *\n * Features:\n * - Full chess rule enforcement\n * - Turn-based gameplay\n * - Optional time controls\n * - Move history with notation\n * - Game result detection\n * - Draw offers\n * - Resignation\n * - Takeback requests\n */\n\nimport { BaseMode } from './BaseMode.js';\n\n/**\n * @typedef {Object} TimeControl\n * @property {number} initial - Initial time in seconds\n * @property {number} increment - Increment per move in seconds\n */\n\n/**\n * @typedef {Object} PvPModeConfig\n * @extends ModeConfig\n * @property {TimeControl|null} [timeControl=null] - Time control settings\n * @property {boolean} [allowTakeback=true] - Allow takeback requests\n * @property {boolean} [allowDrawOffer=true] - Allow draw offers\n * @property {boolean} [showLegalMoves=true] - Highlight legal moves\n * @property {boolean} [showLastMove=true] - Highlight last move\n * @property {boolean} [showCheck=true] - Highlight king when in check\n * @property {Function} [onGameEnd] - Callback when game ends\n * @property {Function} [onTakebackRequest] - Callback for takeback request\n * @property {Function} [onDrawOffer] - Callback for draw offer\n */\n\n/**\n * Player vs Player mode with full rule enforcement\n */\nexport class PvPMode extends BaseMode {\n  /**\n   * @param {Object} chessboard - Reference to the chessboard instance\n   * @param {PvPModeConfig} [config={}] - Mode configuration\n   */\n  constructor(chessboard, config = {}) {\n    super(chessboard, {\n      name: 'pvp',\n      enforceRules: true,\n      allowFreeMovement: false,\n      allowPieceCreation: false,\n      allowPieceRemoval: false,\n      trackTurns: true,\n      detectGameEnd: true,\n      timeControl: null,\n      allowTakeback: true,\n      allowDrawOffer: true,\n      showLegalMoves: true,\n      showLastMove: true,\n      showCheck: true,\n      ...config,\n    });\n\n    // Player info\n    this.players = {\n      w: { name: 'White', timeRemaining: null, connected: true },\n      b: { name: 'Black', timeRemaining: null, connected: true },\n    };\n\n    // Game state\n    this.gameStartTime = null;\n    this.lastMoveTime = null;\n    this.timerInterval = null;\n    this.pendingDrawOffer = null;\n    this.pendingTakeback = null;\n    this.moveNotations = [];\n  }\n\n  /**\n   * Start PvP game\n   * @override\n   */\n  start() {\n    super.start();\n\n    this.gameStartTime = Date.now();\n    this.lastMoveTime = this.gameStartTime;\n\n    // Initialize time controls if set\n    if (this.config.timeControl) {\n      this.players.w.timeRemaining = this.config.timeControl.initial;\n      this.players.b.timeRemaining = this.config.timeControl.initial;\n      this._startTimer();\n    }\n\n    this._emit('gameStart', {\n      players: this.players,\n      timeControl: this.config.timeControl,\n    });\n  }\n\n  /**\n   * Stop PvP game\n   * @override\n   */\n  stop() {\n    this._stopTimer();\n    super.stop();\n  }\n\n  /**\n   * Set player name\n   * @param {'w'|'b'} color - Player color\n   * @param {string} name - Player name\n   */\n  setPlayerName(color, name) {\n    if (this.players[color]) {\n      this.players[color].name = name;\n      this._emit('playerUpdated', { color, name });\n    }\n  }\n\n  /**\n   * Get player info\n   * @param {'w'|'b'} color - Player color\n   * @returns {Object}\n   */\n  getPlayer(color) {\n    return this.players[color];\n  }\n\n  /**\n   * Execute a move with validation\n   * @override\n   * @param {string} from - Source square\n   * @param {string} to - Target square\n   * @param {Object} [options={}] - Additional options\n   * @returns {boolean}\n   */\n  executeMove(from, to, options = {}) {\n    if (!this.isActive) return false;\n\n    // Check if it's the correct player's turn\n    const piece = this.chessboard.getPiece(from);\n    if (!piece) return false;\n\n    const pieceColor = piece[0]; // 'w' or 'b'\n    const currentTurn = this.getCurrentTurn();\n\n    if (pieceColor !== currentTurn) {\n      this._emit('invalidMove', { reason: 'Not your turn', from, to });\n      return false;\n    }\n\n    // Validate move\n    if (!this.canMove(from, to, options)) {\n      this._emit('invalidMove', { reason: 'Illegal move', from, to });\n      return false;\n    }\n\n    // Get move notation before executing\n    const notation = this._getMoveNotation(from, to);\n\n    // Execute the move on the board\n    const success = this.chessboard.movePiece(`${from}${to}${options.promotion || ''}`);\n\n    if (!success) {\n      this._emit('invalidMove', { reason: 'Move failed', from, to });\n      return false;\n    }\n\n    // Update time\n    if (this.config.timeControl) {\n      this._updatePlayerTime(currentTurn);\n    }\n\n    // Record move\n    const moveData = {\n      from,\n      to,\n      piece,\n      notation,\n      timestamp: Date.now(),\n      ...options,\n    };\n\n    this.moveHistory.push(moveData);\n    this.moveNotations.push(notation);\n\n    // Clear pending offers\n    this.pendingDrawOffer = null;\n    this.pendingTakeback = null;\n\n    // Emit events\n    this._emit('move', moveData);\n\n    if (this.config.onMove) {\n      this.config.onMove(moveData);\n    }\n\n    // Check for game end\n    this._checkGameEnd();\n\n    // Notify turn change\n    if (this.config.onTurnChange) {\n      this.config.onTurnChange(this.getCurrentTurn());\n    }\n\n    return true;\n  }\n\n  /**\n   * Get move notation\n   * @private\n   * @param {string} from - Source square\n   * @param {string} to - Target square\n   * @returns {string}\n   */\n  _getMoveNotation(from, to) {\n    const game = this.chessboard.positionService?.getGame();\n    if (!game) return `${from}-${to}`;\n\n    // Try to get SAN notation\n    const moves = game.moves({ verbose: true });\n    const move = moves.find((m) => m.from === from && m.to === to);\n\n    if (move) {\n      return move.san;\n    }\n\n    return `${from}-${to}`;\n  }\n\n  /**\n   * Start the game timer\n   * @private\n   */\n  _startTimer() {\n    if (this.timerInterval) return;\n\n    this.timerInterval = setInterval(() => {\n      const currentTurn = this.getCurrentTurn();\n      if (currentTurn && this.players[currentTurn]) {\n        this.players[currentTurn].timeRemaining -= 1;\n\n        this._emit('timerUpdate', {\n          color: currentTurn,\n          timeRemaining: this.players[currentTurn].timeRemaining,\n        });\n\n        // Check for timeout\n        if (this.players[currentTurn].timeRemaining <= 0) {\n          this._handleTimeout(currentTurn);\n        }\n      }\n    }, 1000);\n  }\n\n  /**\n   * Stop the game timer\n   * @private\n   */\n  _stopTimer() {\n    if (this.timerInterval) {\n      clearInterval(this.timerInterval);\n      this.timerInterval = null;\n    }\n  }\n\n  /**\n   * Update player time after move\n   * @private\n   * @param {'w'|'b'} color - Player who just moved\n   */\n  _updatePlayerTime(color) {\n    if (!this.config.timeControl) return;\n\n    // Add increment\n    this.players[color].timeRemaining += this.config.timeControl.increment;\n\n    this._emit('timerUpdate', {\n      color,\n      timeRemaining: this.players[color].timeRemaining,\n    });\n  }\n\n  /**\n   * Handle player timeout\n   * @private\n   * @param {'w'|'b'} loser - Player who ran out of time\n   */\n  _handleTimeout(loser) {\n    this._stopTimer();\n\n    const winner = loser === 'w' ? 'b' : 'w';\n\n    this._emit('gameEnd', {\n      result: 'timeout',\n      winner,\n      loser,\n      reason: `${this.players[loser].name} ran out of time`,\n    });\n\n    if (this.config.onGameEnd) {\n      this.config.onGameEnd({ result: 'timeout', winner });\n    }\n\n    this.stop();\n  }\n\n  /**\n   * Check for game end conditions\n   * @private\n   */\n  _checkGameEnd() {\n    const game = this.chessboard.positionService?.getGame();\n    if (!game) return;\n\n    let result = null;\n    let winner = null;\n    let reason = '';\n\n    if (game.isCheckmate?.()) {\n      winner = this.getCurrentTurn() === 'w' ? 'b' : 'w';\n      result = 'checkmate';\n      reason = `Checkmate! ${this.players[winner].name} wins`;\n    } else if (game.isStalemate?.()) {\n      result = 'stalemate';\n      reason = 'Stalemate - Draw';\n    } else if (game.isThreefoldRepetition?.()) {\n      result = 'repetition';\n      reason = 'Draw by threefold repetition';\n    } else if (game.isInsufficientMaterial?.()) {\n      result = 'insufficient';\n      reason = 'Draw by insufficient material';\n    } else if (game.isDraw?.()) {\n      result = 'draw';\n      reason = 'Draw';\n    }\n\n    if (result) {\n      this._stopTimer();\n\n      this._emit('gameEnd', { result, winner, reason });\n\n      if (this.config.onGameEnd) {\n        this.config.onGameEnd({ result, winner, reason });\n      }\n    }\n  }\n\n  /**\n   * Offer a draw\n   * @param {'w'|'b'} offerer - Player offering draw\n   * @returns {boolean}\n   */\n  offerDraw(offerer) {\n    if (!this.isActive || !this.config.allowDrawOffer) return false;\n\n    this.pendingDrawOffer = offerer;\n\n    this._emit('drawOffered', { offerer });\n\n    if (this.config.onDrawOffer) {\n      this.config.onDrawOffer({ offerer });\n    }\n\n    return true;\n  }\n\n  /**\n   * Accept draw offer\n   * @returns {boolean}\n   */\n  acceptDraw() {\n    if (!this.pendingDrawOffer) return false;\n\n    this._stopTimer();\n\n    this._emit('gameEnd', {\n      result: 'agreement',\n      winner: null,\n      reason: 'Draw by agreement',\n    });\n\n    if (this.config.onGameEnd) {\n      this.config.onGameEnd({ result: 'agreement', winner: null });\n    }\n\n    this.stop();\n    return true;\n  }\n\n  /**\n   * Decline draw offer\n   */\n  declineDraw() {\n    if (!this.pendingDrawOffer) return;\n\n    const offerer = this.pendingDrawOffer;\n    this.pendingDrawOffer = null;\n\n    this._emit('drawDeclined', { offerer });\n  }\n\n  /**\n   * Request takeback\n   * @param {'w'|'b'} requester - Player requesting takeback\n   * @returns {boolean}\n   */\n  requestTakeback(requester) {\n    if (!this.isActive || !this.config.allowTakeback) return false;\n    if (this.moveHistory.length === 0) return false;\n\n    this.pendingTakeback = requester;\n\n    this._emit('takebackRequested', { requester });\n\n    if (this.config.onTakebackRequest) {\n      this.config.onTakebackRequest({ requester });\n    }\n\n    return true;\n  }\n\n  /**\n   * Accept takeback request\n   * @returns {boolean}\n   */\n  acceptTakeback() {\n    if (!this.pendingTakeback) return false;\n\n    // Undo the last move\n    this.chessboard.undoMove();\n    this.chessboard.forceSync();\n\n    // Remove from history\n    const undonMove = this.moveHistory.pop();\n    this.moveNotations.pop();\n\n    this.pendingTakeback = null;\n\n    this._emit('takebackAccepted', { move: undonMove });\n\n    return true;\n  }\n\n  /**\n   * Decline takeback request\n   */\n  declineTakeback() {\n    if (!this.pendingTakeback) return;\n\n    const requester = this.pendingTakeback;\n    this.pendingTakeback = null;\n\n    this._emit('takebackDeclined', { requester });\n  }\n\n  /**\n   * Resign the game\n   * @param {'w'|'b'} resigner - Player resigning\n   */\n  resign(resigner) {\n    if (!this.isActive) return;\n\n    this._stopTimer();\n\n    const winner = resigner === 'w' ? 'b' : 'w';\n\n    this._emit('gameEnd', {\n      result: 'resignation',\n      winner,\n      reason: `${this.players[resigner].name} resigned`,\n    });\n\n    if (this.config.onGameEnd) {\n      this.config.onGameEnd({ result: 'resignation', winner });\n    }\n\n    this.stop();\n  }\n\n  /**\n   * Get move history in PGN format\n   * @returns {string}\n   */\n  getPGN() {\n    const moves = [];\n    for (let i = 0; i < this.moveNotations.length; i += 2) {\n      const moveNum = Math.floor(i / 2) + 1;\n      const whiteMove = this.moveNotations[i];\n      const blackMove = this.moveNotations[i + 1] || '';\n      moves.push(`${moveNum}. ${whiteMove} ${blackMove}`);\n    }\n    return moves.join(' ');\n  }\n\n  /**\n   * Get formatted time string\n   * @param {'w'|'b'} color - Player color\n   * @returns {string}\n   */\n  getFormattedTime(color) {\n    const time = this.players[color]?.timeRemaining;\n    if (time === null || time === undefined) return '--:--';\n\n    const minutes = Math.floor(time / 60);\n    const seconds = time % 60;\n    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n  }\n\n  /**\n   * Get legal moves for a square\n   * @param {string} square - Square to check\n   * @returns {string[]} - Array of target squares\n   */\n  getLegalMoves(square) {\n    const game = this.chessboard.positionService?.getGame();\n    if (!game) return [];\n\n    const moves = game.moves({ square, verbose: true });\n    return moves.map((m) => m.to);\n  }\n\n  /**\n   * Check if player is in check\n   * @returns {boolean}\n   */\n  isInCheck() {\n    const game = this.chessboard.positionService?.getGame();\n    return game?.isCheck?.() || false;\n  }\n\n  /**\n   * Get mode-specific stats\n   * @override\n   * @returns {Object}\n   */\n  getStats() {\n    return {\n      ...super.getStats(),\n      players: this.players,\n      moveNotations: this.moveNotations,\n      pgn: this.getPGN(),\n      isInCheck: this.isInCheck(),\n      pendingDrawOffer: this.pendingDrawOffer,\n      pendingTakeback: this.pendingTakeback,\n      gameDuration: this.gameStartTime ? Date.now() - this.gameStartTime : 0,\n    };\n  }\n\n  /**\n   * Reset PvP game\n   * @override\n   */\n  reset() {\n    super.reset();\n    this._stopTimer();\n    this.moveNotations = [];\n    this.pendingDrawOffer = null;\n    this.pendingTakeback = null;\n\n    if (this.config.timeControl) {\n      this.players.w.timeRemaining = this.config.timeControl.initial;\n      this.players.b.timeRemaining = this.config.timeControl.initial;\n    }\n  }\n\n  /**\n   * Serialize mode state\n   * @override\n   * @returns {Object}\n   */\n  serialize() {\n    return {\n      ...super.serialize(),\n      players: this.players,\n      moveNotations: this.moveNotations,\n      pendingDrawOffer: this.pendingDrawOffer,\n      pendingTakeback: this.pendingTakeback,\n      gameStartTime: this.gameStartTime,\n    };\n  }\n\n  /**\n   * Restore mode state\n   * @override\n   * @param {Object} state - Serialized state\n   */\n  restore(state) {\n    super.restore(state);\n    if (state.players) this.players = state.players;\n    if (state.moveNotations) this.moveNotations = state.moveNotations;\n    if (state.pendingDrawOffer) this.pendingDrawOffer = state.pendingDrawOffer;\n    if (state.pendingTakeback) this.pendingTakeback = state.pendingTakeback;\n    if (state.gameStartTime) this.gameStartTime = state.gameStartTime;\n  }\n}\n\nexport default PvPMode;\n","/**\n * Chess AI - Artificial Intelligence engine for chess\n * @module ai/ChessAI\n * @since 3.1.0\n *\n * Features:\n * - Multiple difficulty levels (1-10)\n * - Different strategies (random, minimax, alphabeta)\n * - Position evaluation\n * - Opening book support\n * - Configurable thinking time\n */\n\n/**\n * Piece values for evaluation\n * @constant\n */\nconst PIECE_VALUES = {\n  p: 100,\n  n: 320,\n  b: 330,\n  r: 500,\n  q: 900,\n  k: 20000,\n};\n\n/**\n * Piece-square tables for positional evaluation\n * Values from white's perspective (mirrored for black)\n * @constant\n */\nconst PIECE_SQUARE_TABLES = {\n  p: [\n    [0, 0, 0, 0, 0, 0, 0, 0],\n    [50, 50, 50, 50, 50, 50, 50, 50],\n    [10, 10, 20, 30, 30, 20, 10, 10],\n    [5, 5, 10, 25, 25, 10, 5, 5],\n    [0, 0, 0, 20, 20, 0, 0, 0],\n    [5, -5, -10, 0, 0, -10, -5, 5],\n    [5, 10, 10, -20, -20, 10, 10, 5],\n    [0, 0, 0, 0, 0, 0, 0, 0],\n  ],\n  n: [\n    [-50, -40, -30, -30, -30, -30, -40, -50],\n    [-40, -20, 0, 0, 0, 0, -20, -40],\n    [-30, 0, 10, 15, 15, 10, 0, -30],\n    [-30, 5, 15, 20, 20, 15, 5, -30],\n    [-30, 0, 15, 20, 20, 15, 0, -30],\n    [-30, 5, 10, 15, 15, 10, 5, -30],\n    [-40, -20, 0, 5, 5, 0, -20, -40],\n    [-50, -40, -30, -30, -30, -30, -40, -50],\n  ],\n  b: [\n    [-20, -10, -10, -10, -10, -10, -10, -20],\n    [-10, 0, 0, 0, 0, 0, 0, -10],\n    [-10, 0, 5, 10, 10, 5, 0, -10],\n    [-10, 5, 5, 10, 10, 5, 5, -10],\n    [-10, 0, 10, 10, 10, 10, 0, -10],\n    [-10, 10, 10, 10, 10, 10, 10, -10],\n    [-10, 5, 0, 0, 0, 0, 5, -10],\n    [-20, -10, -10, -10, -10, -10, -10, -20],\n  ],\n  r: [\n    [0, 0, 0, 0, 0, 0, 0, 0],\n    [5, 10, 10, 10, 10, 10, 10, 5],\n    [-5, 0, 0, 0, 0, 0, 0, -5],\n    [-5, 0, 0, 0, 0, 0, 0, -5],\n    [-5, 0, 0, 0, 0, 0, 0, -5],\n    [-5, 0, 0, 0, 0, 0, 0, -5],\n    [-5, 0, 0, 0, 0, 0, 0, -5],\n    [0, 0, 0, 5, 5, 0, 0, 0],\n  ],\n  q: [\n    [-20, -10, -10, -5, -5, -10, -10, -20],\n    [-10, 0, 0, 0, 0, 0, 0, -10],\n    [-10, 0, 5, 5, 5, 5, 0, -10],\n    [-5, 0, 5, 5, 5, 5, 0, -5],\n    [0, 0, 5, 5, 5, 5, 0, -5],\n    [-10, 5, 5, 5, 5, 5, 0, -10],\n    [-10, 0, 5, 0, 0, 0, 0, -10],\n    [-20, -10, -10, -5, -5, -10, -10, -20],\n  ],\n  k: [\n    [-30, -40, -40, -50, -50, -40, -40, -30],\n    [-30, -40, -40, -50, -50, -40, -40, -30],\n    [-30, -40, -40, -50, -50, -40, -40, -30],\n    [-30, -40, -40, -50, -50, -40, -40, -30],\n    [-20, -30, -30, -40, -40, -30, -30, -20],\n    [-10, -20, -20, -20, -20, -20, -20, -10],\n    [20, 20, 0, 0, 0, 0, 20, 20],\n    [20, 30, 10, 0, 0, 10, 30, 20],\n  ],\n};\n\n/**\n * Simple opening book with common openings\n * @constant\n */\nconst OPENING_BOOK = {\n  // Starting position responses\n  rnbqkbnr_pppppppp_8_8_8_8_PPPPPPPP_RNBQKBNR: ['e2e4', 'd2d4', 'c2c4', 'g1f3'],\n  // After 1.e4\n  rnbqkbnr_pppppppp_8_8_4P3_8_PPPP1PPP_RNBQKBNR: ['e7e5', 'c7c5', 'e7e6', 'c7c6'],\n  // After 1.d4\n  rnbqkbnr_pppppppp_8_8_3P4_8_PPP1PPPP_RNBQKBNR: ['d7d5', 'g8f6', 'e7e6'],\n};\n\n/**\n * @typedef {Object} AIConfig\n * @property {number} [difficulty=5] - Difficulty level (1-10)\n * @property {number} [maxDepth=4] - Maximum search depth\n * @property {number} [maxTime=5000] - Maximum thinking time in ms\n * @property {boolean} [useOpeningBook=true] - Use opening book\n * @property {boolean} [randomizeEquivalent=true] - Randomize equivalent moves\n * @property {string} [strategy='alphabeta'] - Search strategy\n */\n\n/**\n * Chess AI engine\n */\nexport class ChessAI {\n  /**\n   * @param {Object} game - Chess.js game instance\n   * @param {AIConfig} [config={}] - AI configuration\n   */\n  constructor(game, config = {}) {\n    this.game = game;\n    this.config = {\n      difficulty: 5,\n      maxDepth: 4,\n      maxTime: 5000,\n      useOpeningBook: true,\n      randomizeEquivalent: true,\n      strategy: 'alphabeta',\n      ...config,\n    };\n\n    // Adjust depth based on difficulty\n    this._adjustDifficulty();\n\n    this.nodesSearched = 0;\n    this.startTime = 0;\n  }\n\n  /**\n   * Adjust search parameters based on difficulty\n   * @private\n   */\n  _adjustDifficulty() {\n    const difficulty = Math.max(1, Math.min(10, this.config.difficulty));\n\n    // Map difficulty to depth (1-10 -> 1-6)\n    this.config.maxDepth = Math.ceil(difficulty / 2);\n\n    // Lower difficulties make random mistakes\n    this.mistakeProbability = Math.max(0, (5 - difficulty) * 0.1);\n  }\n\n  /**\n   * Set difficulty level\n   * @param {number} level - Difficulty (1-10)\n   */\n  setDifficulty(level) {\n    this.config.difficulty = level;\n    this._adjustDifficulty();\n  }\n\n  /**\n   * Get best move for current position\n   * @returns {Object|null} - Move object { from, to, promotion }\n   */\n  getBestMove() {\n    this.nodesSearched = 0;\n    this.startTime = Date.now();\n\n    const moves = this.game.moves({ verbose: true });\n    if (moves.length === 0) return null;\n\n    // Try opening book first\n    if (this.config.useOpeningBook && this.game.history().length < 10) {\n      const bookMove = this._getBookMove();\n      if (bookMove) return bookMove;\n    }\n\n    // Random mistake at low difficulty\n    if (this.mistakeProbability > 0 && Math.random() < this.mistakeProbability) {\n      return this._getRandomMove(moves);\n    }\n\n    // Choose strategy\n    let bestMove;\n    switch (this.config.strategy) {\n      case 'random':\n        bestMove = this._getRandomMove(moves);\n        break;\n      case 'minimax':\n        bestMove = this._minimaxRoot(moves);\n        break;\n      case 'alphabeta':\n      default:\n        bestMove = this._alphabetaRoot(moves);\n        break;\n    }\n\n    return bestMove;\n  }\n\n  /**\n   * Get move from opening book\n   * @private\n   * @returns {Object|null}\n   */\n  _getBookMove() {\n    const fen = this.game.fen().split(' ')[0].replace(/\\//g, '_');\n    const bookMoves = OPENING_BOOK[fen];\n\n    if (bookMoves && bookMoves.length > 0) {\n      const moveStr = bookMoves[Math.floor(Math.random() * bookMoves.length)];\n      const from = moveStr.substring(0, 2);\n      const to = moveStr.substring(2, 4);\n      const promotion = moveStr.length > 4 ? moveStr[4] : undefined;\n      return { from, to, promotion };\n    }\n\n    return null;\n  }\n\n  /**\n   * Get random legal move\n   * @private\n   * @param {Object[]} moves - Legal moves\n   * @returns {Object}\n   */\n  _getRandomMove(moves) {\n    const randomIndex = Math.floor(Math.random() * moves.length);\n    const move = moves[randomIndex];\n    return { from: move.from, to: move.to, promotion: move.promotion };\n  }\n\n  /**\n   * Minimax root function\n   * @private\n   * @param {Object[]} moves - Legal moves\n   * @returns {Object}\n   */\n  _minimaxRoot(moves) {\n    let bestMove = null;\n    let bestValue = -Infinity;\n    const isMaximizing = this.game.turn() === 'w';\n\n    for (const move of moves) {\n      this.game.move(move);\n      const value = this._minimax(this.config.maxDepth - 1, !isMaximizing);\n      this.game.undo();\n\n      if (value > bestValue || (value === bestValue && Math.random() < 0.3)) {\n        bestValue = value;\n        bestMove = move;\n      }\n    }\n\n    return bestMove\n      ? { from: bestMove.from, to: bestMove.to, promotion: bestMove.promotion }\n      : null;\n  }\n\n  /**\n   * Minimax algorithm\n   * @private\n   * @param {number} depth - Remaining depth\n   * @param {boolean} isMaximizing - Maximizing player\n   * @returns {number} - Position evaluation\n   */\n  _minimax(depth, isMaximizing) {\n    this.nodesSearched++;\n\n    if (depth === 0 || this.game.isGameOver()) {\n      return this._evaluate();\n    }\n\n    const moves = this.game.moves({ verbose: true });\n\n    if (isMaximizing) {\n      let maxEval = -Infinity;\n      for (const move of moves) {\n        this.game.move(move);\n        const evalScore = this._minimax(depth - 1, false);\n        this.game.undo();\n        maxEval = Math.max(maxEval, evalScore);\n      }\n      return maxEval;\n    }\n\n    let minEval = Infinity;\n    for (const move of moves) {\n      this.game.move(move);\n      const evalScore = this._minimax(depth - 1, true);\n      this.game.undo();\n      minEval = Math.min(minEval, evalScore);\n    }\n    return minEval;\n  }\n\n  /**\n   * Alpha-beta root function\n   * @private\n   * @param {Object[]} moves - Legal moves\n   * @returns {Object}\n   */\n  _alphabetaRoot(moves) {\n    let bestMove = null;\n    let bestValue = -Infinity;\n    let alpha = -Infinity;\n    const beta = Infinity;\n    const isWhite = this.game.turn() === 'w';\n\n    // Sort moves for better pruning (captures first)\n    const sortedMoves = this._sortMoves(moves);\n\n    for (const move of sortedMoves) {\n      this.game.move(move);\n      const value = -this._alphabeta(this.config.maxDepth - 1, -beta, -alpha, !isWhite);\n      this.game.undo();\n\n      if (\n        value > bestValue ||\n        (value === bestValue && this.config.randomizeEquivalent && Math.random() < 0.3)\n      ) {\n        bestValue = value;\n        bestMove = move;\n      }\n\n      alpha = Math.max(alpha, value);\n\n      // Time check\n      if (Date.now() - this.startTime > this.config.maxTime) break;\n    }\n\n    return bestMove\n      ? { from: bestMove.from, to: bestMove.to, promotion: bestMove.promotion }\n      : null;\n  }\n\n  /**\n   * Alpha-beta pruning algorithm (negamax variant)\n   * @private\n   * @param {number} depth - Remaining depth\n   * @param {number} alpha - Alpha value\n   * @param {number} beta - Beta value\n   * @param {boolean} isWhite - White to move\n   * @returns {number} - Position evaluation\n   */\n  _alphabeta(depth, alpha, beta, isWhite) {\n    this.nodesSearched++;\n\n    // Check time limit\n    if (Date.now() - this.startTime > this.config.maxTime) {\n      return this._evaluate() * (isWhite ? 1 : -1);\n    }\n\n    if (depth === 0) {\n      return this._quiesce(alpha, beta, isWhite);\n    }\n\n    if (this.game.isGameOver()) {\n      if (this.game.isCheckmate()) {\n        return -Infinity + (this.config.maxDepth - depth);\n      }\n      return 0; // Draw\n    }\n\n    const moves = this._sortMoves(this.game.moves({ verbose: true }));\n\n    for (const move of moves) {\n      this.game.move(move);\n      const score = -this._alphabeta(depth - 1, -beta, -alpha, !isWhite);\n      this.game.undo();\n\n      if (score >= beta) {\n        return beta; // Beta cutoff\n      }\n\n      alpha = Math.max(alpha, score);\n    }\n\n    return alpha;\n  }\n\n  /**\n   * Quiescence search - search captures to avoid horizon effect\n   * @private\n   * @param {number} alpha - Alpha value\n   * @param {number} beta - Beta value\n   * @param {boolean} isWhite - White to move\n   * @returns {number}\n   */\n  _quiesce(alpha, beta, isWhite) {\n    const standPat = this._evaluate() * (isWhite ? 1 : -1);\n\n    if (standPat >= beta) {\n      return beta;\n    }\n\n    if (standPat > alpha) {\n      alpha = standPat;\n    }\n\n    // Only search captures\n    const captures = this.game.moves({ verbose: true }).filter((m) => m.captured);\n\n    for (const move of captures) {\n      this.game.move(move);\n      const score = -this._quiesce(-beta, -alpha, !isWhite);\n      this.game.undo();\n\n      if (score >= beta) {\n        return beta;\n      }\n\n      alpha = Math.max(alpha, score);\n    }\n\n    return alpha;\n  }\n\n  /**\n   * Sort moves for better alpha-beta pruning\n   * @private\n   * @param {Object[]} moves - Moves to sort\n   * @returns {Object[]}\n   */\n  _sortMoves(moves) {\n    return moves.sort((a, b) => {\n      // Captures first, prioritized by MVV-LVA\n      if (a.captured && !b.captured) return -1;\n      if (!a.captured && b.captured) return 1;\n\n      if (a.captured && b.captured) {\n        const aValue = PIECE_VALUES[a.captured] - PIECE_VALUES[a.piece];\n        const bValue = PIECE_VALUES[b.captured] - PIECE_VALUES[b.piece];\n        return bValue - aValue;\n      }\n\n      // Promotions\n      if (a.promotion && !b.promotion) return -1;\n      if (!a.promotion && b.promotion) return 1;\n\n      // Checks\n      if (a.san?.includes('+') && !b.san?.includes('+')) return -1;\n      if (!a.san?.includes('+') && b.san?.includes('+')) return 1;\n\n      return 0;\n    });\n  }\n\n  /**\n   * Evaluate the current position\n   * @private\n   * @returns {number} - Evaluation (positive = white advantage)\n   */\n  _evaluate() {\n    const board = this.game.board();\n    let score = 0;\n\n    for (let row = 0; row < 8; row++) {\n      for (let col = 0; col < 8; col++) {\n        const piece = board[row][col];\n        if (!piece) continue;\n\n        const pieceValue = PIECE_VALUES[piece.type] || 0;\n        const positionValue = this._getPositionValue(piece.type, row, col, piece.color);\n\n        const value = pieceValue + positionValue;\n        score += piece.color === 'w' ? value : -value;\n      }\n    }\n\n    // Mobility bonus\n    const mobilityScore = this._evaluateMobility();\n    score += mobilityScore;\n\n    return score;\n  }\n\n  /**\n   * Get position value from piece-square tables\n   * @private\n   * @param {string} piece - Piece type\n   * @param {number} row - Row (0-7)\n   * @param {number} col - Column (0-7)\n   * @param {'w'|'b'} color - Piece color\n   * @returns {number}\n   */\n  _getPositionValue(piece, row, col, color) {\n    const table = PIECE_SQUARE_TABLES[piece];\n    if (!table) return 0;\n\n    // Mirror table for black pieces\n    const actualRow = color === 'w' ? row : 7 - row;\n    return table[actualRow][col];\n  }\n\n  /**\n   * Evaluate mobility (number of legal moves)\n   * @private\n   * @returns {number}\n   */\n  _evaluateMobility() {\n    const currentTurn = this.game.turn();\n    const moves = this.game.moves().length;\n\n    // Simple mobility score\n    return currentTurn === 'w' ? moves * 10 : -moves * 10;\n  }\n\n  /**\n   * Get search statistics\n   * @returns {Object}\n   */\n  getStats() {\n    return {\n      nodesSearched: this.nodesSearched,\n      timeElapsed: Date.now() - this.startTime,\n      depth: this.config.maxDepth,\n      difficulty: this.config.difficulty,\n    };\n  }\n}\n\nexport default ChessAI;\n","/**\n * VsBot Mode - Player vs Computer with AI opponent\n * @module modes/VsBotMode\n * @since 3.1.0\n *\n * Features:\n * - Multiple difficulty levels (1-10)\n * - Configurable bot color\n * - Thinking time simulation\n * - Hint system\n * - Analysis mode\n * - Takeback support\n * - External engine support (Stockfish.js, UCI, Cloud APIs)\n */\n\nimport { BaseMode } from './BaseMode.js';\nimport { ChessAI } from '../ai/ChessAI.js';\n\n/**\n * @typedef {Object} VsBotModeConfig\n * @extends ModeConfig\n * @property {'w'|'b'} [playerColor='w'] - Human player's color\n * @property {number} [botDifficulty=5] - Bot difficulty (1-10)\n * @property {number} [botThinkingTime=1000] - Minimum bot thinking time in ms\n * @property {boolean} [showBotThinking=true] - Show thinking indicator\n * @property {boolean} [allowHints=true] - Allow hint requests\n * @property {boolean} [allowTakeback=true] - Allow takeback\n * @property {boolean} [autoMove=true] - Bot moves automatically\n * @property {Object} [engine=null] - External engine instance (StockfishEngine, UCIEngine, CloudEngine)\n * @property {number} [engineDepth=20] - Search depth for external engine\n * @property {number} [engineMoveTime=1000] - Move time for external engine in ms\n * @property {Function} [onBotMove] - Callback when bot moves\n * @property {Function} [onBotThinking] - Callback when bot starts thinking\n * @property {Function} [onEngineInfo] - Callback for engine analysis info\n */\n\n/**\n * Player vs Bot mode\n */\nexport class VsBotMode extends BaseMode {\n  /**\n   * Difficulty level descriptions\n   * @static\n   */\n  static DIFFICULTY_NAMES = {\n    1: 'Beginner',\n    2: 'Easy',\n    3: 'Easy+',\n    4: 'Medium-',\n    5: 'Medium',\n    6: 'Medium+',\n    7: 'Hard-',\n    8: 'Hard',\n    9: 'Expert',\n    10: 'Master',\n  };\n\n  /**\n   * @param {Object} chessboard - Reference to the chessboard instance\n   * @param {VsBotModeConfig} [config={}] - Mode configuration\n   */\n  constructor(chessboard, config = {}) {\n    super(chessboard, {\n      name: 'vsBot',\n      enforceRules: true,\n      allowFreeMovement: false,\n      allowPieceCreation: false,\n      allowPieceRemoval: false,\n      trackTurns: true,\n      detectGameEnd: true,\n      playerColor: 'w',\n      botDifficulty: 5,\n      botThinkingTime: 1000,\n      showBotThinking: true,\n      allowHints: true,\n      allowTakeback: true,\n      autoMove: true,\n      ...config,\n    });\n\n    this.ai = null;\n    this.engine = config.engine || null;\n    this.botColor = this.config.playerColor === 'w' ? 'b' : 'w';\n    this.isThinking = false;\n    this.thinkingTimeout = null;\n    this.hintsUsed = 0;\n    this.lastBotMove = null;\n    this.useExternalEngine = !!config.engine;\n  }\n\n  /**\n   * Start vs bot game\n   * @override\n   */\n  start() {\n    super.start();\n\n    // Initialize AI\n    this._initializeAI();\n\n    this._emit('gameStart', {\n      playerColor: this.config.playerColor,\n      botColor: this.botColor,\n      difficulty: this.config.botDifficulty,\n      difficultyName: VsBotMode.DIFFICULTY_NAMES[this.config.botDifficulty],\n    });\n\n    // If bot plays white, make first move\n    if (this.botColor === 'w' && this.config.autoMove) {\n      this._scheduleBotMove();\n    }\n  }\n\n  /**\n   * Stop vs bot game\n   * @override\n   */\n  stop() {\n    this._cancelBotMove();\n    super.stop();\n  }\n\n  /**\n   * Initialize AI engine\n   * @private\n   */\n  _initializeAI() {\n    const game = this.chessboard.positionService?.getGame();\n    if (!game) {\n      console.error('[VsBotMode] Cannot initialize AI: no game instance');\n      return;\n    }\n\n    this.ai = new ChessAI(game, {\n      difficulty: this.config.botDifficulty,\n    });\n  }\n\n  /**\n   * Set bot difficulty\n   * @param {number} level - Difficulty (1-10)\n   */\n  setDifficulty(level) {\n    this.config.botDifficulty = Math.max(1, Math.min(10, level));\n\n    if (this.ai) {\n      this.ai.setDifficulty(this.config.botDifficulty);\n    }\n\n    this._emit('difficultyChanged', {\n      difficulty: this.config.botDifficulty,\n      difficultyName: VsBotMode.DIFFICULTY_NAMES[this.config.botDifficulty],\n    });\n  }\n\n  /**\n   * Get difficulty name\n   * @returns {string}\n   */\n  getDifficultyName() {\n    return VsBotMode.DIFFICULTY_NAMES[this.config.botDifficulty] || 'Unknown';\n  }\n\n  /**\n   * Set player color\n   * @param {'w'|'b'} color - Player color\n   */\n  setPlayerColor(color) {\n    this.config.playerColor = color;\n    this.botColor = color === 'w' ? 'b' : 'w';\n\n    this._emit('playerColorChanged', {\n      playerColor: color,\n      botColor: this.botColor,\n    });\n  }\n\n  /**\n   * Set external engine for bot moves\n   * @param {Object} engine - Engine instance (StockfishEngine, UCIEngine, CloudEngine)\n   * @param {Object} [options={}] - Engine options\n   * @param {number} [options.depth=20] - Search depth\n   * @param {number} [options.moveTime=1000] - Move time in ms\n   */\n  setEngine(engine, options = {}) {\n    this.engine = engine;\n    this.useExternalEngine = !!engine;\n    this.config.engineDepth = options.depth || this.config.engineDepth || 20;\n    this.config.engineMoveTime = options.moveTime || this.config.engineMoveTime || 1000;\n\n    // Set up engine event listeners\n    if (engine) {\n      engine.on('info', (info) => {\n        this._emit('engineInfo', info);\n        if (this.config.onEngineInfo) {\n          this.config.onEngineInfo(info);\n        }\n      });\n    }\n\n    this._emit('engineChanged', {\n      engine: engine?.getInfo?.() || null,\n      useExternalEngine: this.useExternalEngine,\n    });\n  }\n\n  /**\n   * Remove external engine and use built-in AI\n   */\n  removeEngine() {\n    this.engine = null;\n    this.useExternalEngine = false;\n    this._emit('engineChanged', { engine: null, useExternalEngine: false });\n  }\n\n  /**\n   * Check if using external engine\n   * @returns {boolean}\n   */\n  isUsingExternalEngine() {\n    return this.useExternalEngine && this.engine !== null;\n  }\n\n  /**\n   * Check if it's the human player's turn\n   * @returns {boolean}\n   */\n  isPlayerTurn() {\n    return this.getCurrentTurn() === this.config.playerColor;\n  }\n\n  /**\n   * Check if it's the bot's turn\n   * @returns {boolean}\n   */\n  isBotTurn() {\n    return this.getCurrentTurn() === this.botColor;\n  }\n\n  /**\n   * Execute a player move\n   * @override\n   * @param {string} from - Source square\n   * @param {string} to - Target square\n   * @param {Object} [options={}] - Additional options\n   * @returns {boolean}\n   */\n  executeMove(from, to, options = {}) {\n    if (!this.isActive) return false;\n\n    // Only allow moves on player's turn\n    if (!this.isPlayerTurn()) {\n      this._emit('invalidMove', { reason: \"It's the bot's turn\", from, to });\n      return false;\n    }\n\n    // Validate move\n    if (!this.canMove(from, to, options)) {\n      this._emit('invalidMove', { reason: 'Illegal move', from, to });\n      return false;\n    }\n\n    // Execute the move\n    const moveStr = `${from}${to}${options.promotion || ''}`;\n    const success = this.chessboard.movePiece(moveStr);\n\n    if (!success) {\n      this._emit('invalidMove', { reason: 'Move failed', from, to });\n      return false;\n    }\n\n    // Record move\n    const moveData = {\n      from,\n      to,\n      player: 'human',\n      timestamp: Date.now(),\n      ...options,\n    };\n\n    this.moveHistory.push(moveData);\n    this._emit('move', moveData);\n\n    if (this.config.onMove) {\n      this.config.onMove(moveData);\n    }\n\n    // Check for game end\n    if (this._checkGameEnd()) {\n      return true;\n    }\n\n    // Schedule bot response\n    if (this.config.autoMove) {\n      this._scheduleBotMove();\n    }\n\n    return true;\n  }\n\n  /**\n   * Schedule bot move with thinking time\n   * @private\n   */\n  _scheduleBotMove() {\n    if (this.isThinking) return;\n\n    this.isThinking = true;\n\n    this._emit('botThinking', { thinking: true });\n\n    if (this.config.onBotThinking) {\n      this.config.onBotThinking(true);\n    }\n\n    // Simulate thinking time\n    const thinkingTime = Math.max(\n      this.config.botThinkingTime,\n      Math.random() * 500 + 500 // Add some randomness\n    );\n\n    this.thinkingTimeout = setTimeout(() => {\n      this._makeBotMove();\n    }, thinkingTime);\n  }\n\n  /**\n   * Cancel pending bot move\n   * @private\n   */\n  _cancelBotMove() {\n    if (this.thinkingTimeout) {\n      clearTimeout(this.thinkingTimeout);\n      this.thinkingTimeout = null;\n    }\n    this.isThinking = false;\n  }\n\n  /**\n   * Execute bot move\n   * @private\n   */\n  async _makeBotMove() {\n    this.isThinking = false;\n\n    if (!this.isActive) {\n      this._emit('botThinking', { thinking: false });\n      return;\n    }\n\n    let move = null;\n    let engineStats = null;\n\n    // Try external engine first, fall back to built-in AI\n    if (this.useExternalEngine && this.engine) {\n      try {\n        move = await this._getEngineBestMove();\n        engineStats = { source: 'external', engine: this.engine.getInfo?.()?.name || 'unknown' };\n      } catch (error) {\n        console.warn('[VsBotMode] External engine failed, falling back to AI:', error);\n        // Fall back to built-in AI\n        if (this.ai) {\n          move = this.ai.getBestMove();\n          engineStats = { source: 'builtin', ...this.ai.getStats() };\n        }\n      }\n    } else if (this.ai) {\n      // Use built-in AI\n      move = this.ai.getBestMove();\n      engineStats = { source: 'builtin', ...this.ai.getStats() };\n    }\n\n    if (!move) {\n      this._emit('botThinking', { thinking: false });\n      // Game might be over\n      this._checkGameEnd();\n      return;\n    }\n\n    // Execute the move\n    const moveStr = `${move.from}${move.to}${move.promotion || ''}`;\n    const success = this.chessboard.movePiece(moveStr);\n\n    if (success) {\n      const moveData = {\n        ...move,\n        player: 'bot',\n        timestamp: Date.now(),\n        stats: engineStats,\n      };\n\n      this.moveHistory.push(moveData);\n      this.lastBotMove = moveData;\n\n      this._emit('botMove', moveData);\n\n      if (this.config.onBotMove) {\n        this.config.onBotMove(moveData);\n      }\n\n      // Check for game end\n      this._checkGameEnd();\n    }\n\n    this._emit('botThinking', { thinking: false });\n\n    if (this.config.onBotThinking) {\n      this.config.onBotThinking(false);\n    }\n  }\n\n  /**\n   * Get best move from external engine\n   * @private\n   * @returns {Promise<Object>}\n   */\n  async _getEngineBestMove() {\n    if (!this.engine || !this.engine.ready()) {\n      throw new Error('Engine not ready');\n    }\n\n    const fen = this.chessboard.fen();\n\n    // Set position and get best move\n    await this.engine.setPosition(fen);\n    const analysis = await this.engine.go({\n      depth: this.config.engineDepth || 20,\n      moveTime: this.config.engineMoveTime || 1000,\n    });\n\n    if (!analysis?.bestMove) {\n      return null;\n    }\n\n    // Parse UCI move to {from, to, promotion} format\n    const uciMove = analysis.bestMove;\n    return {\n      from: uciMove.substring(0, 2),\n      to: uciMove.substring(2, 4),\n      promotion: uciMove.length > 4 ? uciMove[4] : undefined,\n      score: analysis.score,\n      depth: analysis.depth,\n      pv: analysis.pv,\n    };\n  }\n\n  /**\n   * Trigger bot move manually (if autoMove is disabled)\n   */\n  triggerBotMove() {\n    if (!this.isBotTurn()) return;\n    this._scheduleBotMove();\n  }\n\n  /**\n   * Get hint for player\n   * @returns {Promise<Object|null>} - Suggested move\n   */\n  async getHint() {\n    if (!this.config.allowHints) return null;\n    if (!this.isPlayerTurn()) return null;\n\n    let hint = null;\n\n    // Try external engine first for higher quality hints\n    if (this.useExternalEngine && this.engine && this.engine.ready()) {\n      try {\n        const fen = this.chessboard.fen();\n        await this.engine.setPosition(fen);\n        const analysis = await this.engine.go({\n          depth: Math.min(this.config.engineDepth || 20, 15), // Faster for hints\n          moveTime: 500,\n        });\n\n        if (analysis?.bestMove) {\n          const uciMove = analysis.bestMove;\n          hint = {\n            from: uciMove.substring(0, 2),\n            to: uciMove.substring(2, 4),\n            promotion: uciMove.length > 4 ? uciMove[4] : undefined,\n            score: analysis.score,\n            source: 'engine',\n          };\n        }\n      } catch (error) {\n        console.warn('[VsBotMode] Engine hint failed:', error);\n      }\n    }\n\n    // Fall back to built-in AI\n    if (!hint) {\n      const game = this.chessboard.positionService?.getGame();\n      if (!game) return null;\n\n      const hintAI = new ChessAI(game, { difficulty: 8 });\n      hint = hintAI.getBestMove();\n      if (hint) {\n        hint.source = 'builtin';\n      }\n    }\n\n    if (hint) {\n      this.hintsUsed++;\n      this._emit('hintUsed', { hint, totalHints: this.hintsUsed });\n    }\n\n    return hint;\n  }\n\n  /**\n   * Request takeback\n   * @returns {boolean}\n   */\n  requestTakeback() {\n    if (!this.config.allowTakeback) return false;\n    if (this.moveHistory.length < 2) return false;\n    if (this.isThinking) return false;\n\n    // Undo last two moves (player + bot)\n    this.chessboard.undoMove();\n    this.chessboard.undoMove();\n    this.chessboard.forceSync();\n\n    // Remove from history\n    const botMove = this.moveHistory.pop();\n    const playerMove = this.moveHistory.pop();\n\n    this._emit('takeback', { playerMove, botMove });\n\n    return true;\n  }\n\n  /**\n   * Resign the game\n   */\n  resign() {\n    if (!this.isActive) return;\n\n    this._cancelBotMove();\n\n    this._emit('gameEnd', {\n      result: 'resignation',\n      winner: this.botColor,\n      reason: 'Player resigned',\n    });\n\n    if (this.config.onGameEnd) {\n      this.config.onGameEnd({ result: 'resignation', winner: this.botColor });\n    }\n\n    this.stop();\n  }\n\n  /**\n   * Check for game end conditions\n   * @private\n   * @returns {boolean}\n   */\n  _checkGameEnd() {\n    const game = this.chessboard.positionService?.getGame();\n    if (!game) return false;\n\n    let result = null;\n    let winner = null;\n    let reason = '';\n\n    if (game.isCheckmate?.()) {\n      winner = this.getCurrentTurn() === 'w' ? 'b' : 'w';\n      result = 'checkmate';\n      const winnerName = winner === this.config.playerColor ? 'Player' : 'Bot';\n      reason = `Checkmate! ${winnerName} wins`;\n    } else if (game.isStalemate?.()) {\n      result = 'stalemate';\n      reason = 'Stalemate - Draw';\n    } else if (game.isThreefoldRepetition?.()) {\n      result = 'repetition';\n      reason = 'Draw by threefold repetition';\n    } else if (game.isInsufficientMaterial?.()) {\n      result = 'insufficient';\n      reason = 'Draw by insufficient material';\n    } else if (game.isDraw?.()) {\n      result = 'draw';\n      reason = 'Draw';\n    }\n\n    if (result) {\n      this._cancelBotMove();\n\n      const isPlayerWin = winner === this.config.playerColor;\n\n      this._emit('gameEnd', {\n        result,\n        winner,\n        reason,\n        isPlayerWin,\n      });\n\n      if (this.config.onGameEnd) {\n        this.config.onGameEnd({ result, winner, reason, isPlayerWin });\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Analyze current position\n   * @returns {Promise<Object>}\n   */\n  async analyzePosition() {\n    const game = this.chessboard.positionService?.getGame();\n    if (!game) return null;\n\n    let bestMove = null;\n    let stats = null;\n    let source = 'builtin';\n\n    // Try external engine first for deeper analysis\n    if (this.useExternalEngine && this.engine && this.engine.ready()) {\n      try {\n        const fen = this.chessboard.fen();\n        await this.engine.setPosition(fen);\n        const analysis = await this.engine.go({\n          depth: this.config.engineDepth || 20,\n          moveTime: this.config.engineMoveTime || 2000,\n        });\n\n        if (analysis?.bestMove) {\n          const uciMove = analysis.bestMove;\n          bestMove = {\n            from: uciMove.substring(0, 2),\n            to: uciMove.substring(2, 4),\n            promotion: uciMove.length > 4 ? uciMove[4] : undefined,\n          };\n          stats = {\n            score: analysis.score,\n            depth: analysis.depth,\n            nodes: analysis.nodes,\n            nps: analysis.nps,\n            pv: analysis.pv,\n            time: analysis.time,\n          };\n          source = 'engine';\n        }\n      } catch (error) {\n        console.warn('[VsBotMode] Engine analysis failed:', error);\n      }\n    }\n\n    // Fall back to built-in AI\n    if (!bestMove && this.ai) {\n      const analysisAI = new ChessAI(game, { difficulty: 10 });\n      bestMove = analysisAI.getBestMove();\n      stats = analysisAI.getStats();\n    }\n\n    // Get all legal moves\n    const moves = game.moves({ verbose: true });\n\n    return {\n      bestMove,\n      legalMoves: moves.length,\n      isCheck: game.isCheck?.() || false,\n      turn: game.turn(),\n      stats,\n      source,\n    };\n  }\n\n  /**\n   * Get mode-specific stats\n   * @override\n   * @returns {Object}\n   */\n  getStats() {\n    return {\n      ...super.getStats(),\n      playerColor: this.config.playerColor,\n      botColor: this.botColor,\n      difficulty: this.config.botDifficulty,\n      difficultyName: this.getDifficultyName(),\n      hintsUsed: this.hintsUsed,\n      isThinking: this.isThinking,\n      lastBotMove: this.lastBotMove,\n      aiStats: this.ai?.getStats() || null,\n      useExternalEngine: this.useExternalEngine,\n      engineInfo: this.engine?.getInfo?.() || null,\n      engineReady: this.engine?.ready?.() || false,\n    };\n  }\n\n  /**\n   * Reset vs bot game\n   * @override\n   */\n  reset() {\n    super.reset();\n    this._cancelBotMove();\n    this.hintsUsed = 0;\n    this.lastBotMove = null;\n\n    // Re-initialize AI\n    this._initializeAI();\n  }\n\n  /**\n   * Serialize mode state\n   * @override\n   * @returns {Object}\n   */\n  serialize() {\n    return {\n      ...super.serialize(),\n      playerColor: this.config.playerColor,\n      botColor: this.botColor,\n      botDifficulty: this.config.botDifficulty,\n      hintsUsed: this.hintsUsed,\n      lastBotMove: this.lastBotMove,\n    };\n  }\n\n  /**\n   * Restore mode state\n   * @override\n   * @param {Object} state - Serialized state\n   */\n  restore(state) {\n    super.restore(state);\n    if (state.playerColor) this.config.playerColor = state.playerColor;\n    if (state.botColor) this.botColor = state.botColor;\n    if (state.botDifficulty) this.setDifficulty(state.botDifficulty);\n    if (state.hintsUsed) this.hintsUsed = state.hintsUsed;\n    if (state.lastBotMove) this.lastBotMove = state.lastBotMove;\n  }\n}\n\nexport default VsBotMode;\n","/**\n * Mode Manager - Manages game modes for the chessboard\n * @module modes/ModeManager\n * @since 3.1.0\n */\n\nimport { CreativeMode } from './CreativeMode.js';\nimport { PvPMode } from './PvPMode.js';\nimport { VsBotMode } from './VsBotMode.js';\n\n/**\n * @typedef {'creative'|'pvp'|'vsBot'|'analysis'} ModeType\n */\n\n/**\n * Manages different game modes for the chessboard\n */\nexport class ModeManager {\n  /**\n   * Available mode constructors\n   * @static\n   */\n  static MODES = {\n    creative: CreativeMode,\n    pvp: PvPMode,\n    vsBot: VsBotMode,\n  };\n\n  /**\n   * @param {Object} chessboard - Reference to the chessboard instance\n   */\n  constructor(chessboard) {\n    this.chessboard = chessboard;\n    this.currentMode = null;\n    this.modes = new Map();\n    this.listeners = new Map();\n\n    // Initialize default modes\n    this._initializeDefaultModes();\n  }\n\n  /**\n   * Initialize default modes\n   * @private\n   */\n  _initializeDefaultModes() {\n    // Pre-register all available modes\n    Object.entries(ModeManager.MODES).forEach(([name, ModeClass]) => {\n      this.registerMode(name, ModeClass);\n    });\n  }\n\n  /**\n   * Register a custom mode\n   * @param {string} name - Mode name\n   * @param {typeof BaseMode} ModeClass - Mode class constructor\n   * @param {Object} [defaultConfig={}] - Default configuration\n   */\n  registerMode(name, ModeClass, defaultConfig = {}) {\n    this.modes.set(name, {\n      ModeClass,\n      defaultConfig,\n      instance: null,\n    });\n  }\n\n  /**\n   * Get or create a mode instance\n   * @param {string} name - Mode name\n   * @param {Object} [config={}] - Mode configuration\n   * @returns {BaseMode|null}\n   */\n  getMode(name, config = {}) {\n    const modeEntry = this.modes.get(name);\n    if (!modeEntry) {\n      console.error(`[ModeManager] Unknown mode: ${name}`);\n      return null;\n    }\n\n    // Create new instance if needed or config changed\n    if (!modeEntry.instance) {\n      const mergedConfig = { ...modeEntry.defaultConfig, ...config };\n      modeEntry.instance = new modeEntry.ModeClass(this.chessboard, mergedConfig);\n    }\n\n    return modeEntry.instance;\n  }\n\n  /**\n   * Set the active mode\n   * @param {ModeType|string} modeName - Name of the mode to activate\n   * @param {Object} [config={}] - Mode configuration\n   * @returns {BaseMode|null} - The activated mode\n   */\n  setMode(modeName, config = {}) {\n    // Stop current mode if any\n    if (this.currentMode) {\n      this.currentMode.stop();\n      this._emit('modeChanged', {\n        from: this.currentMode.getName(),\n        to: modeName,\n      });\n    }\n\n    // Get or create the new mode\n    const mode = this.getMode(modeName, config);\n    if (!mode) {\n      return null;\n    }\n\n    this.currentMode = mode;\n    mode.start();\n\n    this._emit('modeActivated', {\n      mode: modeName,\n      config: mode.config,\n    });\n\n    return mode;\n  }\n\n  /**\n   * Get the current active mode\n   * @returns {BaseMode|null}\n   */\n  getCurrentMode() {\n    return this.currentMode;\n  }\n\n  /**\n   * Get current mode name\n   * @returns {string|null}\n   */\n  getCurrentModeName() {\n    return this.currentMode ? this.currentMode.getName() : null;\n  }\n\n  /**\n   * Check if a specific mode is active\n   * @param {string} modeName - Mode name to check\n   * @returns {boolean}\n   */\n  isModeActive(modeName) {\n    return this.currentMode && this.currentMode.getName() === modeName;\n  }\n\n  /**\n   * Get list of available modes\n   * @returns {string[]}\n   */\n  getAvailableModes() {\n    return Array.from(this.modes.keys());\n  }\n\n  /**\n   * Check if a move is allowed in current mode\n   * @param {string} from - Source square\n   * @param {string} to - Target square\n   * @param {Object} [options={}] - Additional options\n   * @returns {boolean}\n   */\n  canMove(from, to, options = {}) {\n    if (!this.currentMode) return true; // No mode restrictions\n    return this.currentMode.canMove(from, to, options);\n  }\n\n  /**\n   * Execute a move in current mode\n   * @param {string} from - Source square\n   * @param {string} to - Target square\n   * @param {Object} [options={}] - Additional options\n   * @returns {boolean}\n   */\n  executeMove(from, to, options = {}) {\n    if (!this.currentMode) return false;\n    return this.currentMode.executeMove(from, to, options);\n  }\n\n  /**\n   * Check if piece creation is allowed\n   * @returns {boolean}\n   */\n  canCreatePiece() {\n    if (!this.currentMode) return false;\n    return this.currentMode.canCreatePiece();\n  }\n\n  /**\n   * Check if piece removal is allowed\n   * @returns {boolean}\n   */\n  canRemovePiece() {\n    if (!this.currentMode) return false;\n    return this.currentMode.canRemovePiece();\n  }\n\n  /**\n   * Add event listener\n   * @param {string} event - Event name\n   * @param {Function} callback - Callback function\n   */\n  on(event, callback) {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, []);\n    }\n    this.listeners.get(event).push(callback);\n  }\n\n  /**\n   * Remove event listener\n   * @param {string} event - Event name\n   * @param {Function} callback - Callback function\n   */\n  off(event, callback) {\n    if (!this.listeners.has(event)) return;\n    const callbacks = this.listeners.get(event);\n    const index = callbacks.indexOf(callback);\n    if (index > -1) {\n      callbacks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Emit event\n   * @private\n   * @param {string} event - Event name\n   * @param {Object} data - Event data\n   */\n  _emit(event, data) {\n    if (!this.listeners.has(event)) return;\n    this.listeners.get(event).forEach((callback) => {\n      try {\n        callback(data);\n      } catch (err) {\n        console.error(`[ModeManager] Error in event listener for ${event}:`, err);\n      }\n    });\n  }\n\n  /**\n   * Reset current mode\n   */\n  reset() {\n    if (this.currentMode) {\n      this.currentMode.reset();\n    }\n  }\n\n  /**\n   * Stop current mode\n   */\n  stop() {\n    if (this.currentMode) {\n      this.currentMode.stop();\n      this.currentMode = null;\n    }\n  }\n\n  /**\n   * Destroy the mode manager\n   */\n  destroy() {\n    this.stop();\n    this.modes.clear();\n    this.listeners.clear();\n  }\n\n  /**\n   * Get statistics for current mode\n   * @returns {Object|null}\n   */\n  getStats() {\n    if (!this.currentMode) return null;\n    return this.currentMode.getStats();\n  }\n\n  /**\n   * Serialize current state\n   * @returns {Object}\n   */\n  serialize() {\n    return {\n      currentMode: this.currentMode ? this.currentMode.serialize() : null,\n      availableModes: this.getAvailableModes(),\n    };\n  }\n}\n\nexport default ModeManager;\n","/**\n * Main Chessboard class - Orchestrates all services and components\n * @module core/Chessboard\n * @since 2.0.0\n */\n\nimport ChessboardConfig from './ChessboardConfig.js';\nimport Move from '../components/Move.js';\nimport {\n  AnimationService,\n  BoardService,\n  CoordinateService,\n  EventService,\n  MoveService,\n  PieceService,\n  PositionService,\n  ValidationService,\n} from '../services/index.js';\nimport { ChessboardError, ConfigurationError } from '../errors/ChessboardError.js';\nimport { PerformanceMonitor } from '../utils/performance.js';\nimport { ModeManager } from '../modes/index.js';\n\n/**\n * Main Chessboard class responsible for coordinating all services\n * Implements the Facade pattern to provide a unified interface\n * @class\n */\nclass Chessboard {\n  /**\n   * Creates a new Chessboard instance\n   * @param {Object} config - Configuration object\n   * @throws {ConfigurationError} If configuration is invalid\n   */\n  constructor(config) {\n    try {\n      // Initialize performance monitoring\n      this._performanceMonitor = new PerformanceMonitor();\n      this._performanceMonitor.startMeasure('chessboard-initialization');\n\n      // Validate and initialize configuration\n      this._validateAndInitializeConfig(config);\n\n      // Initialize services\n      this._initializeServices();\n\n      // Initialize the board\n      this._initialize();\n\n      this._performanceMonitor.endMeasure('chessboard-initialization');\n    } catch (error) {\n      this._handleConstructorError(error);\n    }\n    this._undoneMoves = [];\n    // Force synchronous initial population (no animation delay)\n    this._doUpdateBoardPieces(false, true);\n  }\n\n  /**\n   * Validates and initializes configuration\n   * @private\n   * @param {Object} config - Raw configuration object\n   * @throws {ConfigurationError} If configuration is invalid\n   */\n  _validateAndInitializeConfig(config) {\n    if (!config || typeof config !== 'object') {\n      throw new ConfigurationError('Configuration must be an object', 'config', config);\n    }\n\n    this.config = new ChessboardConfig(config);\n\n    // Validate required configuration\n    if (!this.config.id_div) {\n      throw new ConfigurationError(\n        'Configuration must include id_div',\n        'id_div',\n        this.config.id_div\n      );\n    }\n  }\n\n  /**\n   * Handles constructor errors gracefully\n   * @private\n   * @param {Error} error - Error that occurred during construction\n   */\n  _handleConstructorError(error) {\n    console.error('Chessboard initialization failed:', error);\n\n    // Clean up any partially initialized resources\n    this._cleanup();\n\n    // Re-throw with additional context\n    if (error instanceof ChessboardError) {\n      throw error;\n    } else {\n      throw new ChessboardError('Failed to initialize chessboard', 'INITIALIZATION_ERROR', {\n        originalError: error.message,\n        stack: error.stack,\n      });\n    }\n  }\n\n  /**\n   * Cleans up any partially initialized resources (safe to call multiple times)\n   * @private\n   */\n  _cleanup() {\n    // Remove event listeners if present\n    if (this.eventService && typeof this.eventService.removeListeners === 'function') {\n      this.eventService.removeListeners();\n    }\n    // Clear timeouts\n    if (this._updateTimeout) {\n      clearTimeout(this._updateTimeout);\n      this._updateTimeout = null;\n    }\n    // Null all services\n    this.validationService = null;\n    this.coordinateService = null;\n    this.positionService = null;\n    this.boardService = null;\n    this.pieceService = null;\n    this.animationService = null;\n    this.moveService = null;\n    this.eventService = null;\n  }\n\n  /**\n   * Initializes all services\n   * @private\n   */\n  _initializeServices() {\n    // Core services\n    this.validationService = new ValidationService();\n    this.coordinateService = new CoordinateService(this.config);\n    this.positionService = new PositionService(this.config);\n    this.boardService = new BoardService(this.config);\n    this.pieceService = new PieceService(this.config);\n    this.animationService = new AnimationService(this.config);\n    this.moveService = new MoveService(this.config, this.positionService);\n    this.eventService = new EventService(\n      this.config,\n      this.boardService,\n      this.moveService,\n      this.coordinateService,\n      this\n    );\n\n    // State management\n    this._updateTimeout = null;\n    this._isAnimating = false;\n\n    // Initialize Mode Manager\n    this.modeManager = new ModeManager(this);\n\n    // Bind methods to preserve context\n    this._boundUpdateBoardPieces = this._updateBoardPieces.bind(this);\n    this._boundOnSquareClick = this._onSquareClick.bind(this);\n    this._boundOnPieceHover = this._onPieceHover.bind(this);\n    this._boundOnPieceLeave = this._onPieceLeave.bind(this);\n  }\n\n  /**\n   * Initializes the board\n   * @private\n   */\n  _initialize() {\n    this._initParams();\n    this._setGame(this.config.position);\n    this._buildBoard();\n    this._buildSquares();\n    this._addListeners();\n    // Synchronous initial position load (no animation delay)\n    this._doUpdateBoardPieces(false, true);\n  }\n\n  /**\n   * Initializes parameters and state\n   * @private\n   */\n  _initParams() {\n    // Reset state\n    this.eventService.setClicked(null);\n    this.eventService.setPromoting(false);\n    this.eventService.setAnimating(false);\n  }\n\n  /**\n   * Sets up the game with initial position\n   * @private\n   * @param {string|Object} position - Initial position\n   */\n  _setGame(position) {\n    this.positionService.setGame(position);\n  }\n\n  /**\n   * Builds the board DOM structure\n   * @private\n   * Best practice: always remove squares (destroy JS/DOM) before clearing the board container.\n   */\n  _buildBoard() {\n    // Debug: _buildBoard called\n    if (this._isUndoRedo) {\n      // Skip _buildBoard for undo/redo\n      return;\n    }\n    // Forza la pulizia completa del contenitore board (DOM)\n    const boardContainer = document.getElementById(this.config.id_div);\n    if (boardContainer) boardContainer.innerHTML = '';\n    // Force remove all pieces from all squares (no animation, best practice)\n    if (this.boardService && this.boardService.squares) {\n      Object.values(this.boardService.squares).forEach(\n        (sq) => sq && sq.forceRemoveAllPieces && sq.forceRemoveAllPieces()\n      );\n    }\n    if (this.boardService && this.boardService.removeSquares) this.boardService.removeSquares();\n    if (this.boardService && this.boardService.removeBoard) this.boardService.removeBoard();\n    this.boardService.buildBoard();\n  }\n\n  /**\n   * Builds all squares on the board\n   * @private\n   */\n  _buildSquares() {\n    // Debug: _buildSquares called\n    if (this._isUndoRedo) {\n      // Skip _buildSquares for undo/redo\n      return;\n    }\n    if (this.boardService && this.boardService.removeSquares) {\n      this.boardService.removeSquares();\n    }\n    this.boardService.buildSquares((row, col) => {\n      return this.coordinateService.realCoord(row, col);\n    });\n  }\n\n  /**\n   * Adds event listeners to squares\n   * @private\n   */\n  _addListeners() {\n    this.eventService.addListeners(\n      this._boundOnSquareClick,\n      this._boundOnPieceHover,\n      this._boundOnPieceLeave\n    );\n  }\n\n  /**\n   * Handles square click events\n   * @private\n   * @param {Square} square - Clicked square\n   * @param {boolean} [animate=true] - Whether to animate\n   * @param {boolean} [dragged=false] - Whether triggered by drag\n   * @returns {boolean} True if successful\n   */\n  _onSquareClick(square, animate = true, dragged = false) {\n    return this.eventService.onClick(\n      square,\n      this._onMove.bind(this),\n      this._onSelect.bind(this),\n      this._onDeselect.bind(this),\n      animate,\n      dragged\n    );\n  }\n\n  /**\n   * Handles piece hover events\n   * @private\n   * @param {Square} square - Hovered square\n   */\n  _onPieceHover(square) {\n    if (this.config.hints && !this.eventService.getClicked()) {\n      // Only show hints if no square is selected\n      this._hintMoves(square);\n    }\n  }\n\n  /**\n   * Handles piece leave events\n   * @private\n   * @param {Square} square - Left square\n   */\n  _onPieceLeave(square) {\n    if (this.config.hints && !this.eventService.getClicked()) {\n      // Only remove hints if no square is selected\n      this._dehintMoves(square);\n    }\n  }\n\n  /**\n   * Handles move execution\n   * @private\n   * @param {Square} fromSquare - Source square\n   * @param {Square} toSquare - Target square\n   * @param {string} [promotion] - Promotion piece\n   * @param {boolean} [animate=true] - Whether to animate\n   * @returns {boolean} True if move was successful\n   */\n  _onMove(fromSquare, toSquare, promotion = null, animate = true) {\n    const move = new Move(fromSquare, toSquare, promotion);\n\n    // 1. Validate the move\n    if (\n      !move.check() ||\n      (this.config.onlyLegalMoves && !move.isLegal(this.positionService.getGame()))\n    ) {\n      this._clearVisualState(); // Always clear state on invalid move\n      return false;\n    }\n\n    // 2. Check for promotion (if not already provided)\n    if (!move.hasPromotion() && this._requiresPromotion(move)) {\n      // Promotion is required but not provided, let the promotion handler take over.\n      // Do not execute the move here.\n      return false;\n    }\n\n    // 3. Execute the move\n    // The onMove callback is for the user to approve the move, not to execute it.\n    if (this.config.onMove(move)) {\n      this._executeMove(move, animate);\n      return true;\n    }\n\n    // 4. If user rejects the move, clear state\n    this._clearVisualState();\n    return false;\n  }\n\n  /**\n   * Handles square selection\n   * @private\n   * @param {Square} square - Selected square\n   */\n  _onSelect(square) {\n    if (this.config.clickable) {\n      square.select();\n      this._hintMoves(square);\n    }\n  }\n\n  /**\n   * Handles square deselection\n   * @private\n   */\n  _onDeselect() {\n    this._clearVisualState();\n  }\n\n  /**\n   * Shows legal move hints for a square\n   * @private\n   * @param {Square} square - Square to show hints for\n   */\n  _hintMoves(square) {\n    if (!this.moveService.canMove(square)) return;\n\n    // Clear existing hints first\n    this.boardService.applyToAllSquares('removeHint');\n\n    const moves = this.moveService.getCachedLegalMoves(square);\n\n    for (const move of moves) {\n      if (move.to && move.to.length === 2) {\n        const targetSquare = this.boardService.getSquare(move.to);\n        if (targetSquare) {\n          const hasEnemyPiece =\n            targetSquare.piece &&\n            targetSquare.piece.color !== this.positionService.getGame().turn();\n          targetSquare.putHint(hasEnemyPiece);\n        }\n      }\n    }\n  }\n\n  /**\n   * Removes legal move hints for a square\n   * @private\n   * @param {Square} square - Square to remove hints for\n   */\n  _dehintMoves(square) {\n    const moves = this.moveService.getCachedLegalMoves(square);\n\n    for (const move of moves) {\n      if (move.to && move.to.length === 2) {\n        const targetSquare = this.boardService.getSquare(move.to);\n        if (targetSquare) {\n          targetSquare.removeHint();\n        }\n      }\n    }\n  }\n\n  /**\n   * Checks if a move requires promotion\n   * @private\n   * @param {Move} move - Move to check\n   * @returns {boolean} True if promotion is required\n   */\n  _requiresPromotion(move) {\n    return this.moveService.requiresPromotion(move);\n  }\n\n  /**\n   * Executes a move\n   * @private\n   * @param {Move} move - Move to execute\n   * @param {boolean} [animate=true] - Whether to animate\n   */\n  _executeMove(move, animate = true) {\n    // Always clear visual state before executing a move to prevent artifacts\n    this._clearVisualState();\n\n    const game = this.positionService.getGame();\n    if (!game) {\n      throw new ChessboardError('Game not initialized', 'GAME_ERROR');\n    }\n\n    // Execute the move on the game engine\n    const gameMove = this.moveService.executeMove(move);\n    if (!gameMove) {\n      // This should not happen if validation passed, but as a safeguard:\n      console.error('Move execution failed unexpectedly for move:', move);\n      this._updateBoardPieces(false); // Sync board with game state\n      return;\n    }\n\n    // Clear previous move highlights\n    this.boardService.applyToAllSquares('unmoved');\n\n    // Mark squares as moved for styling\n    move.from.moved();\n    move.to.moved();\n\n    // Handle animations and special moves (castle, en-passant)\n    const isCastle = this.moveService.isCastle(gameMove);\n    const isEnPassant = this.moveService.isEnPassant(gameMove);\n\n    if (animate && move.from.piece) {\n      // For castling, we need to animate king and rook simultaneously\n      if (isCastle) {\n        let kingDone = false;\n        let rookDone = false;\n\n        const checkComplete = () => {\n          if (kingDone && rookDone) {\n            // Both animations complete - now sync board\n            this._updateBoardPieces(false);\n            this.config.onMoveEnd(gameMove);\n          }\n        };\n\n        // Start king animation\n        this.pieceService.translatePiece(\n          move,\n          !!move.to.piece,\n          animate,\n          this._createDragFunction.bind(this),\n          () => {\n            kingDone = true;\n            checkComplete();\n          }\n        );\n\n        // Start rook animation simultaneously\n        this._handleCastleMove(gameMove, true, false, () => {\n          rookDone = true;\n          checkComplete();\n        });\n      } else if (isEnPassant) {\n        // For en passant, animate the piece first, then handle captured pawn\n        this.pieceService.translatePiece(\n          move,\n          false, // Don't remove target - en passant captures on different square\n          animate,\n          this._createDragFunction.bind(this),\n          () => {\n            this._handleEnPassantMove(gameMove, true);\n            this.config.onMoveEnd(gameMove);\n            this._updateBoardPieces(false);\n          }\n        );\n      } else {\n        // Normal move\n        this.pieceService.translatePiece(\n          move,\n          !!move.to.piece,\n          animate,\n          this._createDragFunction.bind(this),\n          () => {\n            this.config.onMoveEnd(gameMove);\n            this._updateBoardPieces(false);\n          }\n        );\n      }\n    } else {\n      // If not animating, handle special moves immediately and update the board\n      if (isCastle) {\n        this._handleSpecialMove(gameMove);\n      } else if (isEnPassant) {\n        this._handleSpecialMove(gameMove);\n      }\n      this._updateBoardPieces(false);\n      this.config.onMoveEnd(gameMove);\n    }\n  }\n\n  /**\n   * Handles special moves (castle, en passant) without animation\n   * @private\n   * @param {Object} gameMove - Game move object\n   */\n  _handleSpecialMove(gameMove) {\n    if (this.moveService.isCastle(gameMove)) {\n      this._handleCastleMove(gameMove, false);\n    } else if (this.moveService.isEnPassant(gameMove)) {\n      this._handleEnPassantMove(gameMove, false);\n    }\n  }\n\n  /**\n   * Handles special moves (castle, en passant) with animation\n   * @private\n   * @param {Object} gameMove - Game move object\n   */\n  _handleSpecialMoveAnimation(gameMove) {\n    if (this.moveService.isCastle(gameMove)) {\n      this._handleCastleMove(gameMove, true);\n    } else if (this.moveService.isEnPassant(gameMove)) {\n      this._handleEnPassantMove(gameMove, true);\n    }\n  }\n\n  /**\n   * Handles castle move by moving the rook\n   * @private\n   * @param {Object} gameMove - Game move object\n   * @param {boolean} animate - Whether to animate\n   * @param {boolean} [updateBoard=true] - Whether to update board after animation\n   * @param {Function} [onComplete] - Callback when animation completes\n   */\n  _handleCastleMove(gameMove, animate, updateBoard = true, onComplete = null) {\n    const rookMove = this.moveService.getCastleRookMove(gameMove);\n    if (!rookMove) {\n      if (onComplete) onComplete();\n      return;\n    }\n\n    const rookFromSquare = this.boardService.getSquare(rookMove.from);\n    const rookToSquare = this.boardService.getSquare(rookMove.to);\n\n    if (!rookFromSquare || !rookToSquare) {\n      if (onComplete) onComplete();\n      return;\n    }\n\n    const rookPiece = rookFromSquare.piece;\n    if (!rookPiece) {\n      if (updateBoard) this._updateBoardPieces(false);\n      if (onComplete) onComplete();\n      return;\n    }\n\n    if (animate) {\n      this.pieceService.translatePiece(\n        { from: rookFromSquare, to: rookToSquare, piece: rookPiece },\n        false,\n        true,\n        this._createDragFunction.bind(this),\n        () => {\n          if (updateBoard) this._updateBoardPieces(false);\n          if (onComplete) onComplete();\n        }\n      );\n    } else {\n      if (updateBoard) this._updateBoardPieces(false);\n      if (onComplete) onComplete();\n    }\n  }\n\n  /**\n   * Handles en passant move by removing the captured pawn\n   * @private\n   * @param {Object} gameMove - Game move object\n   * @param {boolean} animate - Whether to animate\n   */\n  _handleEnPassantMove(gameMove, animate) {\n    const capturedSquare = this.moveService.getEnPassantCapturedSquare(gameMove);\n    if (!capturedSquare) return;\n\n    const capturedSquareObj = this.boardService.getSquare(capturedSquare);\n    if (!capturedSquareObj || !capturedSquareObj.piece) {\n      console.warn('En passant captured square not found or empty');\n      return;\n    }\n\n    if (animate) {\n      // Animate the captured pawn removal\n      this.pieceService.removePieceFromSquare(capturedSquareObj, true);\n      // Update board state after animation\n      setTimeout(() => {\n        this._updateBoardPieces(false);\n      }, this.config.moveTime);\n    } else {\n      // Just update the board state\n      this._updateBoardPieces(false);\n    }\n  }\n\n  /**\n   * Updates board pieces to match game state\n   * @private\n   * @param {boolean} [animation=false] - Whether to animate\n   * @param {boolean} [isPositionLoad=false] - Whether this is a position load\n   */\n  _updateBoardPieces(animation = false, isPositionLoad = false) {\n    // Check if services are available\n    if (!this.positionService || !this.moveService || !this.eventService) {\n      return;\n    }\n\n    // Clear any pending update\n    if (this._updateTimeout) {\n      clearTimeout(this._updateTimeout);\n      this._updateTimeout = null;\n    }\n\n    // Clear moves cache\n    this.moveService.clearCache();\n\n    // Add small delay for click-to-move to avoid lag\n    if (animation && !this.eventService.getClicked()) {\n      this._updateTimeout = setTimeout(() => {\n        this._doUpdateBoardPieces(animation, isPositionLoad);\n        this._updateTimeout = null;\n\n        // Ensure hints are available for the next turn\n        this._ensureHintsAvailable();\n      }, 10);\n    } else {\n      this._doUpdateBoardPieces(animation, isPositionLoad);\n\n      // Ensure hints are available for the next turn\n      this._ensureHintsAvailable();\n    }\n  }\n\n  /**\n   * Ensures hints are available for the current turn\n   * @private\n   */\n  _ensureHintsAvailable() {\n    if (!this.config.hints) return;\n\n    // Small delay to ensure the board state is fully updated\n    setTimeout(() => {\n      // Clear any existing hints\n      this.boardService.applyToAllSquares('removeHint');\n\n      // The hints will be shown when the user hovers over pieces\n      // This just ensures the cache is ready\n      this.moveService.clearCache();\n    }, 50);\n  }\n\n  /**\n   * Updates board pieces after a delayed move\n   * @private\n   */\n  _updateBoardPiecesDelayed() {\n    this._updateBoardPieces(false);\n  }\n\n  /**\n   * Performs the actual board update\n   * @private\n   * @param {boolean} [animation=false] - Whether to animate\n   * @param {boolean} [isPositionLoad=false] - Whether this is a position load (affects delay)\n   */\n  _doUpdateBoardPieces(animation = false, isPositionLoad = false) {\n    // Skip update if we're in the middle of a promotion\n    if (this._isPromoting) {\n      return;\n    }\n\n    // Check if services are available\n    if (!this.positionService || !this.positionService.getGame()) {\n      return;\n    }\n\n    const squares = this.boardService.getAllSquares();\n    const gameStateBefore = this.positionService.getGame().fen();\n\n    // For initial position load, always use sequential (synchronous) update\n    // to ensure pieces are immediately available\n    if (isPositionLoad) {\n      this._doSequentialUpdate(squares, gameStateBefore, false);\n      return;\n    }\n\n    // Determine which animation style to use\n    const useSimultaneous = this.config.animationStyle === 'simultaneous';\n\n    if (useSimultaneous) {\n      this._doSimultaneousUpdate(squares, gameStateBefore, isPositionLoad);\n    } else {\n      this._doSequentialUpdate(squares, gameStateBefore, animation);\n    }\n  }\n\n  /**\n   * Performs sequential piece updates (original behavior)\n   * @private\n   * @param {Object} squares - All squares\n   * @param {string} gameStateBefore - Game state before update\n   * @param {boolean} animation - Whether to animate\n   */\n  _doSequentialUpdate(squares, gameStateBefore, animation) {\n    // Mappa: squareId -> expectedPieceId\n    const expectedMap = {};\n    Object.values(squares).forEach((square) => {\n      expectedMap[square.id] = this.positionService.getGamePieceId(square.id);\n    });\n\n    Object.values(squares).forEach((square) => {\n      const expectedPieceId = expectedMap[square.id];\n      const currentPiece = square.piece;\n      const currentPieceId = currentPiece ? currentPiece.getId() : null;\n\n      // Se il pezzo attuale e quello atteso sono identici, non fare nulla\n      if (currentPieceId === expectedPieceId) {\n        return;\n      }\n\n      // Se c' un pezzo attuale ma non  quello atteso, rimuovilo\n      if (currentPiece && currentPieceId !== expectedPieceId) {\n        this.pieceService.removePieceFromSquare(square, animation);\n      }\n\n      // Se c' un pezzo atteso ma non  quello attuale, aggiungilo\n      if (expectedPieceId && currentPieceId !== expectedPieceId) {\n        const newPiece = this.pieceService.convertPiece(expectedPieceId);\n        this.pieceService.addPieceOnSquare(\n          square,\n          newPiece,\n          animation,\n          this._createDragFunction.bind(this)\n        );\n      }\n    });\n\n    this._addListeners();\n    const gameStateAfter = this.positionService.getGame().fen();\n    if (gameStateBefore !== gameStateAfter) {\n      this.config.onChange(gameStateAfter);\n    }\n  }\n\n  /**\n   * Performs simultaneous piece updates\n   * @private\n   * @param {Object} squares - All squares\n   * @param {string} gameStateBefore - Game state before update\n   * @param {boolean} [isPositionLoad=false] - Whether this is a position load\n   */\n  _doSimultaneousUpdate(squares, gameStateBefore, isPositionLoad = false) {\n    // Matching greedy per distanza minima, robusto\n    const currentMap = {};\n    const expectedMap = {};\n\n    Object.values(squares).forEach((square) => {\n      const currentPiece = square.piece;\n      const expectedPieceId = this.positionService.getGamePieceId(square.id);\n      if (currentPiece) {\n        // Normalizza la chiave come 'color+type' lowercase\n        const key = (currentPiece.color + currentPiece.type).toLowerCase();\n        if (!currentMap[key]) currentMap[key] = [];\n        currentMap[key].push({ square, id: square.id });\n      }\n      if (expectedPieceId) {\n        // Normalizza la chiave come 'color+type' lowercase\n        const key = expectedPieceId.toLowerCase();\n        if (!expectedMap[key]) expectedMap[key] = [];\n        expectedMap[key].push({ square, id: square.id });\n      }\n    });\n\n    let animationsCompleted = 0;\n    let totalAnimations = 0;\n    const animationDelay = isPositionLoad ? 0 : this.config.simultaneousAnimationDelay;\n    let animationIndex = 0;\n\n    Object.keys(expectedMap).forEach((key) => {\n      totalAnimations += Math.max((currentMap[key] || []).length, expectedMap[key].length);\n    });\n\n    if (totalAnimations === 0) {\n      this._addListeners();\n      const gameStateAfter = this.positionService.getGame().fen();\n      if (gameStateBefore !== gameStateAfter) {\n        this.config.onChange(gameStateAfter);\n      }\n      return;\n    }\n\n    const onAnimationComplete = () => {\n      animationsCompleted++;\n      if (animationsCompleted === totalAnimations) {\n        this._addListeners();\n        const gameStateAfter = this.positionService.getGame().fen();\n        if (gameStateBefore !== gameStateAfter) {\n          this.config.onChange(gameStateAfter);\n        }\n      }\n    };\n\n    Object.keys(expectedMap).forEach((key) => {\n      const fromList = (currentMap[key] || []).slice();\n      const toList = expectedMap[key].slice();\n\n      // 1. Costruisci matrice delle distanze\n      const distances = [];\n      for (let i = 0; i < fromList.length; i++) {\n        distances[i] = [];\n        for (let j = 0; j < toList.length; j++) {\n          distances[i][j] =\n            Math.abs(fromList[i].square.row - toList[j].square.row) +\n            Math.abs(fromList[i].square.col - toList[j].square.col);\n        }\n      }\n\n      // 2. Matching greedy: abbina i pi vicini\n      const fromMatched = new Array(fromList.length).fill(false);\n      const toMatched = new Array(toList.length).fill(false);\n      const moves = [];\n\n      while (true) {\n        let minDist = Infinity,\n          minI = -1,\n          minJ = -1;\n        for (let i = 0; i < fromList.length; i++) {\n          if (fromMatched[i]) continue;\n          for (let j = 0; j < toList.length; j++) {\n            if (toMatched[j]) continue;\n            if (distances[i][j] < minDist) {\n              minDist = distances[i][j];\n              minI = i;\n              minJ = j;\n            }\n          }\n        }\n        if (minI === -1 || minJ === -1) break;\n        // Se la posizione  la stessa, non fare nulla (pezzo unchanged)\n        if (fromList[minI].square === toList[minJ].square) {\n          fromMatched[minI] = true;\n          toMatched[minJ] = true;\n          continue;\n        }\n        // Altrimenti, sposta il pezzo\n        moves.push({\n          from: fromList[minI].square,\n          to: toList[minJ].square,\n          piece: fromList[minI].square.piece,\n        });\n        fromMatched[minI] = true;\n        toMatched[minJ] = true;\n      }\n\n      // 3. Rimuovi i pezzi non abbinati (presenti solo in fromList)\n      for (let i = 0; i < fromList.length; i++) {\n        if (!fromMatched[i]) {\n          setTimeout(() => {\n            this.pieceService.removePieceFromSquare(fromList[i].square, true, onAnimationComplete);\n          }, animationIndex * animationDelay);\n          animationIndex++;\n        }\n      }\n\n      // 4. Aggiungi i pezzi non abbinati (presenti solo in toList)\n      for (let j = 0; j < toList.length; j++) {\n        if (!toMatched[j]) {\n          setTimeout(() => {\n            const newPiece = this.pieceService.convertPiece(key);\n            this.pieceService.addPieceOnSquare(\n              toList[j].square,\n              newPiece,\n              true,\n              this._createDragFunction.bind(this),\n              onAnimationComplete\n            );\n          }, animationIndex * animationDelay);\n          animationIndex++;\n        }\n      }\n\n      // 5. Anima i movimenti\n      moves.forEach((move) => {\n        setTimeout(() => {\n          this.pieceService.translatePiece(\n            move,\n            false,\n            true,\n            this._createDragFunction.bind(this),\n            onAnimationComplete\n          );\n        }, animationIndex * animationDelay);\n        animationIndex++;\n      });\n    });\n  }\n\n  /**\n   * Analyzes position changes to determine optimal animation strategy\n   * @private\n   * @param {Object} squares - All squares\n   * @returns {Object} Analysis of changes\n   */\n  _analyzePositionChanges(squares) {\n    const currentPieces = new Map();\n    const expectedPieces = new Map();\n\n    // Map current and expected piece positions\n    Object.values(squares).forEach((square) => {\n      const currentPiece = square.piece;\n      const expectedPieceId = this.positionService.getGamePieceId(square.id);\n\n      if (currentPiece) {\n        currentPieces.set(square.id, currentPiece.getId());\n      }\n\n      if (expectedPieceId) {\n        expectedPieces.set(square.id, expectedPieceId);\n      }\n    });\n\n    // Identify different types of changes\n    const moves = []; // Pieces that can slide to new positions\n    const removes = []; // Pieces that need to be removed\n    const adds = []; // Pieces that need to be added\n    const unchanged = []; // Pieces that stay in place\n\n    // First pass: identify pieces that don't need to move (same piece type on same square)\n    const processedSquares = new Set();\n\n    currentPieces.forEach((currentPieceId, square) => {\n      const expectedPieceId = expectedPieces.get(square);\n\n      if (currentPieceId === expectedPieceId) {\n        // Same piece type on same square - no movement needed\n        unchanged.push({\n          piece: currentPieceId,\n          square,\n        });\n        processedSquares.add(square);\n      }\n    });\n\n    // Second pass: handle pieces that need to move or be removed\n    currentPieces.forEach((currentPieceId, fromSquare) => {\n      if (processedSquares.has(fromSquare)) {\n        return; // Already processed as unchanged\n      }\n\n      // Try to find a destination for this piece\n      const availableDestination = Array.from(expectedPieces.entries()).find(\n        ([toSquare, expectedId]) => expectedId === currentPieceId && !processedSquares.has(toSquare)\n      );\n\n      if (availableDestination) {\n        const [toSquare] = availableDestination;\n        moves.push({\n          piece: currentPieceId,\n          from: fromSquare,\n          to: toSquare,\n          fromSquare: squares[fromSquare],\n          toSquare: squares[toSquare],\n        });\n        processedSquares.add(toSquare);\n      } else {\n        // This piece needs to be removed\n        removes.push({\n          piece: currentPieceId,\n          square: fromSquare,\n          squareObj: squares[fromSquare],\n        });\n      }\n    });\n\n    // Third pass: handle pieces that need to be added\n    expectedPieces.forEach((expectedPieceId, toSquare) => {\n      if (!processedSquares.has(toSquare)) {\n        adds.push({\n          piece: expectedPieceId,\n          square: toSquare,\n          squareObj: squares[toSquare],\n        });\n      }\n    });\n\n    return {\n      moves,\n      removes,\n      adds,\n      unchanged,\n      totalChanges: moves.length + removes.length + adds.length,\n    };\n  }\n\n  /**\n   * Executes simultaneous changes based on analysis\n   * @private\n   * @param {Object} changeAnalysis - Analysis of changes\n   * @param {string} gameStateBefore - Game state before update\n   * @param {boolean} [isPositionLoad=false] - Whether this is a position load\n   */\n  _executeSimultaneousChanges(changeAnalysis, gameStateBefore, isPositionLoad = false) {\n    const { moves, removes, adds } = changeAnalysis;\n\n    let animationsCompleted = 0;\n    const totalAnimations = moves.length + removes.length + adds.length;\n\n    // If no animations are needed, complete immediately\n    if (totalAnimations === 0) {\n      this._addListeners();\n\n      // Trigger change event if position changed\n      const gameStateAfter = this.positionService.getGame().fen();\n      if (gameStateBefore !== gameStateAfter) {\n        this.config.onChange(gameStateAfter);\n      }\n      return;\n    }\n\n    const onAnimationComplete = () => {\n      animationsCompleted++;\n      if (animationsCompleted === totalAnimations) {\n        this._addListeners();\n\n        // Trigger change event if position changed\n        const gameStateAfter = this.positionService.getGame().fen();\n        if (gameStateBefore !== gameStateAfter) {\n          this.config.onChange(gameStateAfter);\n        }\n      }\n    };\n\n    // Determine delay: 0 for position loads, configured delay for normal moves\n    const animationDelay = isPositionLoad ? 0 : this.config.simultaneousAnimationDelay;\n\n    let animationIndex = 0;\n\n    // Process moves (pieces sliding to new positions)\n    moves.forEach((move) => {\n      const delay = animationIndex * animationDelay;\n\n      setTimeout(() => {\n        this._animatePieceMove(move, onAnimationComplete);\n      }, delay);\n\n      animationIndex++;\n    });\n\n    // Process removes (pieces disappearing)\n    removes.forEach((remove) => {\n      const delay = animationIndex * animationDelay;\n\n      setTimeout(() => {\n        this._animatePieceRemoval(remove, onAnimationComplete);\n      }, delay);\n\n      animationIndex++;\n    });\n\n    // Process adds (pieces appearing)\n    adds.forEach((add) => {\n      const delay = animationIndex * animationDelay;\n\n      setTimeout(() => {\n        this._animatePieceAddition(add, onAnimationComplete);\n      }, delay);\n\n      animationIndex++;\n    });\n  }\n\n  /**\n   * Animates a piece moving from one square to another\n   * @private\n   * @param {Object} move - Move information\n   * @param {Function} onComplete - Callback when animation completes\n   */\n  _animatePieceMove(move, onComplete) {\n    const { fromSquare, toSquare } = move;\n    const piece = fromSquare.piece;\n\n    if (!piece) {\n      console.warn(`No piece found on ${move.from} for move animation`);\n      onComplete();\n      return;\n    }\n\n    // Use translatePiece for smooth sliding animation\n    this.pieceService.translatePiece(\n      { from: fromSquare, to: toSquare, piece },\n      false, // Assume no capture for now\n      true, // Always animate\n      this._createDragFunction.bind(this),\n      onComplete\n    );\n  }\n\n  /**\n   * Animates a piece being removed\n   * @private\n   * @param {Object} remove - Remove information\n   * @param {Function} onComplete - Callback when animation completes\n   */\n  _animatePieceRemoval(remove, onComplete) {\n    this.pieceService.removePieceFromSquare(remove.squareObj, true, onComplete);\n  }\n\n  /**\n   * Animates a piece being added\n   * @private\n   * @param {Object} add - Add information\n   * @param {Function} onComplete - Callback when animation completes\n   */\n  _animatePieceAddition(add, onComplete) {\n    const newPiece = this.pieceService.convertPiece(add.piece);\n    this.pieceService.addPieceOnSquare(\n      add.squareObj,\n      newPiece,\n      true,\n      this._createDragFunction.bind(this),\n      onComplete\n    );\n  }\n\n  /**\n   * Creates a drag function for a piece\n   * @private\n   * @param {Square} square - Square containing the piece\n   * @param {Piece} piece - Piece to create drag function for\n   * @returns {Function} Drag function\n   */\n  _createDragFunction(square, piece) {\n    return this.eventService.createDragFunction(\n      square,\n      piece,\n      this.config.onDragStart,\n      this.config.onDragMove,\n      this.config.onDrop,\n      this._onSnapback.bind(this),\n      this._onMove.bind(this),\n      this._onRemove.bind(this)\n    );\n  }\n\n  /**\n   * Handles snapback animation\n   * @private\n   * @param {Square} square - Square containing the piece\n   * @param {Piece} piece - Piece to snapback\n   */\n  _onSnapback(square, piece) {\n    this.pieceService.snapbackPiece(square, this.config.snapbackAnimation);\n    this.config.onSnapbackEnd(square, piece);\n  }\n\n  /**\n   * Handles piece removal\n   * @private\n   * @param {Square} square - Square containing the piece to remove\n   */\n  _onRemove(square) {\n    this.pieceService.removePieceFromSquare(square, true);\n    this.positionService.getGame().remove(square.id);\n    this._updateBoardPieces(true);\n  }\n\n  /**\n   * Clears all visual state (selections, hints, highlights)\n   * @private\n   */\n  _clearVisualState() {\n    this.boardService.applyToAllSquares('deselect');\n    this.boardService.applyToAllSquares('removeHint');\n    this.boardService.applyToAllSquares('dehighlight');\n    this.eventService.setClicked(null);\n  }\n\n  // -------------------\n  // Public API Methods (Refactored)\n  // -------------------\n\n  // --- POSITION & STATE ---\n  /**\n   * Get the current position as FEN\n   * @returns {string}\n   */\n  getPosition() {\n    return this.fen();\n  }\n  /**\n   * Set the board position (FEN or object)\n   * @param {string|Object} position\n   * @param {Object} [opts]\n   * @param {boolean} [opts.animate=true]\n   * @returns {boolean}\n   */\n  setPosition(position, opts = {}) {\n    const animate = opts.animate !== undefined ? opts.animate : true;\n    // Remove highlights and selections\n    if (this.boardService && this.boardService.applyToAllSquares) {\n      this.boardService.applyToAllSquares('removeHint');\n      this.boardService.applyToAllSquares('deselect');\n      this.boardService.applyToAllSquares('unmoved');\n    }\n    if (this.positionService && this.positionService.setGame) {\n      this.positionService.setGame(position);\n    }\n    if (this._updateBoardPieces) {\n      this._updateBoardPieces(animate, true);\n    }\n    return true;\n  }\n  /**\n   * Reset the board to the starting position\n   * @param {Object} [opts]\n   * @param {boolean} [opts.animate=true]\n   * @returns {boolean}\n   */\n  reset(opts = {}) {\n    const animate = opts.animate !== undefined ? opts.animate : true;\n    // Use the default starting position from config or fallback\n    const startPosition = this.config && this.config.position ? this.config.position : 'start';\n    this._updateBoardPieces(animate);\n    return this.setPosition(startPosition, { animate });\n  }\n  /**\n   * Clear the board\n   * @param {Object} [opts]\n   * @param {boolean} [opts.animate=true]\n   * @returns {boolean}\n   */\n  clear(opts = {}) {\n    const animate = opts.animate !== undefined ? opts.animate : true;\n    if (!this.positionService || !this.positionService.getGame()) {\n      return false;\n    }\n    if (this._clearVisualState) this._clearVisualState();\n    this.positionService.getGame().clear();\n    if (this._updateBoardPieces) {\n      this._updateBoardPieces(animate, true);\n    }\n    return true;\n  }\n\n  // --- MOVE MANAGEMENT ---\n  /**\n   * Undo last move\n   * @param {Object} [opts]\n   * @param {boolean} [opts.animate=true]\n   * @returns {boolean}\n   */\n  undoMove(opts = {}) {\n    const undone = this.positionService.getGame().undo();\n    if (undone) {\n      this._undoneMoves.push(undone);\n      this._updateBoardPieces(opts.animate !== false);\n      return undone;\n    }\n    return null;\n  }\n  /**\n   * Redo last undone move\n   * @param {Object} [opts]\n   * @param {boolean} [opts.animate=true]\n   * @returns {boolean}\n   */\n  redoMove(opts = {}) {\n    if (this._undoneMoves && this._undoneMoves.length > 0) {\n      const move = this._undoneMoves.pop();\n      const moveObj = { from: move.from, to: move.to };\n      if (move.promotion) moveObj.promotion = move.promotion;\n      const result = this.positionService.getGame().move(moveObj);\n      this._updateBoardPieces(opts.animate !== false);\n      return result;\n    }\n    return false;\n  }\n  /**\n   * Get legal moves for a square\n   * @param {string} square\n   * @returns {Array}\n   */\n  getLegalMoves(square) {\n    return this.legalMoves(square);\n  }\n\n  // --- PIECE MANAGEMENT ---\n  /**\n   * Get the piece at a square\n   * @param {string} square\n   * @returns {string|null}\n   */\n  getPiece(square) {\n    // Restituisce sempre 'wq' (colore prima, tipo dopo, lowercase) o null\n    const sq = this.boardService.getSquare(square);\n    if (!sq) return null;\n    const piece = sq.piece;\n    if (!piece) return null;\n    return (piece.color + piece.type).toLowerCase();\n  }\n  /**\n   * Put a piece on a square\n   * @param {string} piece\n   * @param {string} square\n   * @param {Object} [opts]\n   * @param {boolean} [opts.animate=true]\n   * @returns {boolean}\n   */\n  putPiece(piece, square, opts = {}) {\n    const animate = opts.animate !== undefined ? opts.animate : true;\n    let pieceStr = piece;\n    if (typeof piece === 'object' && piece.type && piece.color) {\n      pieceStr = (piece.color + piece.type).toLowerCase();\n    } else if (typeof piece === 'string' && piece.length === 2) {\n      // Accetta sia 'wq' che 'qw', normalizza a 'wq'\n      const a = piece[0].toLowerCase();\n      const b = piece[1].toLowerCase();\n      const types = 'kqrbnp';\n      const colors = 'wb';\n      if (types.includes(a) && colors.includes(b)) {\n        pieceStr = b + a;\n      } else if (colors.includes(a) && types.includes(b)) {\n        pieceStr = a + b;\n      } else {\n        throw new Error(`[putPiece] Invalid piece: ${piece}`);\n      }\n    }\n    const validSquare = this.validationService.isValidSquare(square);\n    const validPiece = this.validationService.isValidPiece(pieceStr);\n    if (!validSquare) throw new Error(`[putPiece] Invalid square: ${square}`);\n    if (!validPiece) throw new Error(`[putPiece] Invalid piece: ${pieceStr}`);\n    if (!this.positionService || !this.positionService.getGame()) {\n      throw new Error('[putPiece] No positionService or game');\n    }\n    const pieceObj = this.pieceService.convertPiece(pieceStr);\n    const squareObj = this.boardService.getSquare(square);\n    if (!squareObj) throw new Error(`[putPiece] Square not found: ${square}`);\n    squareObj.piece = pieceObj;\n    const chessJsPiece = { type: pieceObj.type, color: pieceObj.color };\n    const game = this.positionService.getGame();\n    const result = game.put(chessJsPiece, square);\n    if (!result) throw new Error(`[putPiece] Game.put failed for ${pieceStr} on ${square}`);\n    this._updateBoardPieces(animate);\n    return true;\n  }\n  /**\n   * Remove a piece from a square\n   * @param {string} square\n   * @param {Object} [opts]\n   * @param {boolean} [opts.animate=true]\n   * @returns {string|null}\n   */\n  removePiece(square, opts = {}) {\n    const animate = opts.animate !== undefined ? opts.animate : true;\n    if (!this.validationService.isValidSquare(square)) {\n      throw new Error(`[removePiece] Invalid square: ${square}`);\n    }\n    const squareObj = this.boardService.getSquare(square);\n    if (!squareObj) return true;\n    if (!squareObj.piece) return true;\n    squareObj.piece = null;\n    const game = this.positionService.getGame();\n    game.remove(square);\n    this._updateBoardPieces(animate);\n    return true;\n  }\n\n  // --- BOARD CONTROL ---\n  /**\n   * Flip the board orientation\n   * @param {Object} [opts]\n   * @param {boolean} [opts.animate=true]\n   */\n  flipBoard(_opts = {}) {\n    if (this.coordinateService && this.coordinateService.flipOrientation) {\n      this.coordinateService.flipOrientation();\n    }\n    if (this._buildBoard) this._buildBoard();\n    if (this._buildSquares) this._buildSquares();\n    if (this._addListeners) this._addListeners();\n    // Use instant update for flip - pieces reappear in new positions immediately\n    if (this._updateBoardPieces) this._updateBoardPieces(false, true);\n  }\n  /**\n   * Set the board orientation\n   * @param {'w'|'b'} color\n   * @param {Object} [opts]\n   * @param {boolean} [opts.animate=true]\n   */\n  setOrientation(color, opts = {}) {\n    if (this.validationService.isValidOrientation(color)) {\n      this.coordinateService.setOrientation(color);\n      if (this._buildBoard) this._buildBoard();\n      if (this._buildSquares) this._buildSquares();\n      if (this._addListeners) this._addListeners();\n      if (this._updateBoardPieces) this._updateBoardPieces(opts.animate !== false);\n    }\n    return this.coordinateService.getOrientation();\n  }\n  /**\n   * Get the current orientation\n   * @returns {'w'|'b'}\n   */\n  getOrientation() {\n    return this.orientation();\n  }\n  /**\n   * Resize the board\n   * @param {number|string} size\n   */\n  resizeBoard(size) {\n    if (size === 'auto') {\n      this.config.size = 'auto';\n      document.documentElement.style.setProperty('--dimBoard', 'auto');\n      this._updateBoardPieces(false);\n      return true;\n    }\n    if (typeof size !== 'number' || size < 50 || size > 3000) {\n      throw new Error(`[resizeBoard] Invalid size: ${size}`);\n    }\n    this.config.size = size;\n    document.documentElement.style.setProperty('--dimBoard', `${size}px`);\n    this._updateBoardPieces(false);\n    return true;\n  }\n\n  // --- HIGHLIGHTING & UI ---\n  /**\n   * Highlight a square\n   * @param {string} square\n   * @param {Object} [opts]\n   */\n  highlight(square) {\n    if (!this.validationService.isValidSquare(square)) return;\n    const squareObj = this.boardService.getSquare(square);\n    if (squareObj && typeof squareObj.highlight === 'function') {\n      squareObj.highlight();\n    }\n  }\n  /**\n   * Remove highlight from a square\n   * @param {string} square\n   */\n  dehighlight(square) {\n    if (!this.validationService.isValidSquare(square)) return;\n    const squareObj = this.boardService.getSquare(square);\n    if (squareObj && typeof squareObj.dehighlight === 'function') {\n      squareObj.dehighlight();\n    }\n  }\n\n  // --- GAME INFO ---\n  /**\n   * Get FEN string\n   * @returns {string}\n   */\n  fen() {\n    // Avoid recursion: call the underlying game object's fen()\n    const game = this.positionService.getGame();\n    if (!game || typeof game.fen !== 'function') return '';\n    return game.fen();\n  }\n  /**\n   * Get current turn\n   * @returns {'w'|'b'}\n   */\n  turn() {\n    return this.positionService.getGame().turn();\n  }\n  /**\n   * Is the game over?\n   * @returns {boolean}\n   */\n  isGameOver() {\n    const game = this.positionService.getGame();\n    if (!game) return false;\n    if (game.isGameOver) return game.isGameOver();\n    // Fallback: checkmate or draw\n    if (game.isCheckmate && game.isCheckmate()) return true;\n    if (game.isDraw && game.isDraw()) return true;\n    return false;\n  }\n  /**\n   * Is it checkmate?\n   * @returns {boolean}\n   */\n  isCheckmate() {\n    const game = this.positionService.getGame();\n    if (!game) return false;\n    return game.isCheckmate ? game.isCheckmate() : false;\n  }\n  /**\n   * Is it draw?\n   * @returns {boolean}\n   */\n  isDraw() {\n    const game = this.positionService.getGame();\n    if (!game) return false;\n    return game.isDraw ? game.isDraw() : false;\n  }\n  /**\n   * Get move history\n   * @returns {Array}\n   */\n  getHistory() {\n    const game = this.positionService.getGame();\n    if (!game) return [];\n    return game.history ? game.history() : [];\n  }\n\n  // --- LIFECYCLE ---\n  /**\n   * Destroy the board and cleanup all resources\n   */\n  destroyBoard() {\n    // Remove all event listeners\n    if (this.eventService && typeof this.eventService.removeListeners === 'function') {\n      this.eventService.removeListeners();\n    }\n\n    // Clear all timeouts\n    if (this._updateTimeout) {\n      clearTimeout(this._updateTimeout);\n      this._updateTimeout = null;\n    }\n\n    // Clear the DOM\n    const boardContainer = document.getElementById(this.config.id_div);\n    if (boardContainer) {\n      boardContainer.innerHTML = '';\n    }\n\n    // Remove all pieces from squares\n    if (this.boardService && this.boardService.squares) {\n      Object.values(this.boardService.squares).forEach((sq) => {\n        if (sq && sq.forceRemoveAllPieces) {\n          sq.forceRemoveAllPieces();\n        }\n      });\n    }\n\n    // Clean up board service\n    if (this.boardService) {\n      if (this.boardService.removeSquares) this.boardService.removeSquares();\n      if (this.boardService.removeBoard) this.boardService.removeBoard();\n    }\n\n    // Stop and cleanup mode manager\n    if (this.modeManager) {\n      this.modeManager.destroy();\n      this.modeManager = null;\n    }\n\n    // Null all services for garbage collection\n    this.validationService = null;\n    this.coordinateService = null;\n    this.positionService = null;\n    this.boardService = null;\n    this.pieceService = null;\n    this.animationService = null;\n    this.moveService = null;\n    this.eventService = null;\n\n    // Clear performance monitor\n    this._performanceMonitor = null;\n\n    // Clear state\n    this._undoneMoves = null;\n    this._boundUpdateBoardPieces = null;\n    this._boundOnSquareClick = null;\n    this._boundOnPieceHover = null;\n    this._boundOnPieceLeave = null;\n  }\n  /**\n   * Rebuild the board\n   */\n  rebuild() {\n    this._initialize();\n  }\n\n  // --- CONFIGURATION ---\n  /**\n   * Get current config\n   * @returns {Object}\n   */\n  getConfig() {\n    return this.config;\n  }\n  /**\n   * Set new config\n   * @param {Object} newConfig\n   */\n  updateConfig(newConfig) {\n    if (this.config && typeof this.config.update === 'function') {\n      this.config.update(newConfig);\n    }\n    if (newConfig.size !== undefined) {\n      this.resizeBoard(newConfig.size);\n    }\n    if (newConfig.orientation !== undefined) {\n      this.setOrientation(newConfig.orientation);\n    }\n  }\n\n  /**\n   * Move a piece using coordinate notation (e.g., 'e2e4', 'e7e8q')\n   * @param {string} moveStr - Move in coordinate notation\n   * @param {Object} [opts] - Options\n   * @param {boolean} [opts.animate=true] - Whether to animate\n   * @returns {boolean} True if move was successful\n   */\n  movePiece(moveStr, opts = {}) {\n    const animate = opts.animate !== undefined ? opts.animate : true;\n\n    if (typeof moveStr !== 'string' || moveStr.length < 4) {\n      console.error('[movePiece] Invalid move format:', moveStr);\n      return false;\n    }\n\n    const from = moveStr.substring(0, 2);\n    const to = moveStr.substring(2, 4);\n    const promotion = moveStr.length > 4 ? moveStr[4].toLowerCase() : null;\n\n    const fromSquare = this.boardService.getSquare(from);\n    const toSquare = this.boardService.getSquare(to);\n\n    if (!fromSquare || !toSquare) {\n      console.error('[movePiece] Invalid squares:', from, to);\n      return false;\n    }\n\n    // Clear redo stack on new move\n    this._undoneMoves = [];\n\n    return this._onMove(fromSquare, toSquare, promotion, animate);\n  }\n\n  /**\n   * Force synchronization of the visual board with the game state\n   * Useful after programmatic changes to ensure rendering is correct\n   */\n  forceSync() {\n    this._updateBoardPieces(false);\n  }\n\n  // --- MODES API ---\n  /**\n   * Set the active game mode\n   * @param {'creative'|'pvp'|'vsBot'} modeName - Mode to activate\n   * @param {Object} [config={}] - Mode configuration\n   * @returns {Object|null} - The activated mode instance\n   * @example\n   * // Start creative mode\n   * board.setMode('creative');\n   *\n   * // Start PvP with time control\n   * board.setMode('pvp', { timeControl: { initial: 300, increment: 5 } });\n   *\n   * // Play against bot\n   * board.setMode('vsBot', { botDifficulty: 7, playerColor: 'w' });\n   */\n  setMode(modeName, config = {}) {\n    return this.modeManager.setMode(modeName, config);\n  }\n\n  /**\n   * Get the current active mode\n   * @returns {Object|null} - Current mode instance\n   */\n  getMode() {\n    return this.modeManager.getCurrentMode();\n  }\n\n  /**\n   * Alias for getMode (for backward compatibility)\n   * @returns {Object|null} - Current mode instance\n   */\n  getCurrentMode() {\n    return this.getMode();\n  }\n\n  /**\n   * Get the current mode name\n   * @returns {string|null} - Mode name ('creative', 'pvp', 'vsBot')\n   */\n  getModeName() {\n    return this.modeManager.getCurrentModeName();\n  }\n\n  /**\n   * Get list of available modes\n   * @returns {string[]}\n   */\n  getAvailableModes() {\n    return this.modeManager.getAvailableModes();\n  }\n\n  /**\n   * Stop the current mode\n   */\n  stopMode() {\n    this.modeManager.stop();\n  }\n\n  /**\n   * Check if a specific mode is active\n   * @param {string} modeName - Mode name to check\n   * @returns {boolean}\n   */\n  isModeActive(modeName) {\n    return this.modeManager.isModeActive(modeName);\n  }\n\n  /**\n   * Start creative mode (shortcut)\n   * @param {Object} [config={}] - Creative mode config\n   * @returns {Object} - Creative mode instance\n   */\n  startCreativeMode(config = {}) {\n    return this.setMode('creative', config);\n  }\n\n  /**\n   * Start PvP mode (shortcut)\n   * @param {Object} [config={}] - PvP mode config\n   * @returns {Object} - PvP mode instance\n   */\n  startPvPMode(config = {}) {\n    return this.setMode('pvp', config);\n  }\n\n  /**\n   * Start vs Bot mode (shortcut)\n   * @param {Object} [config={}] - VsBot mode config\n   * @returns {Object} - VsBot mode instance\n   */\n  startVsBotMode(config = {}) {\n    return this.setMode('vsBot', config);\n  }\n\n  /**\n   * Get mode statistics\n   * @returns {Object|null}\n   */\n  getModeStats() {\n    return this.modeManager.getStats();\n  }\n\n  // --- ALIASES/DEPRECATED ---\n  /**\n   * Alias for movePiece (deprecated)\n   */\n  move(moveStr, animate = true) {\n    return this.movePiece(moveStr, { animate });\n  }\n  /**\n   * Alias for clear (deprecated)\n   */\n  clearBoard(animate = true) {\n    this._updateBoardPieces(animate);\n    return this.clear({ animate });\n  }\n  /**\n   * Alias for reset (deprecated)\n   */\n  start(animate = true) {\n    this._updateBoardPieces(animate);\n    return this.reset({ animate });\n  }\n\n  /**\n   * Alias for flipBoard (for backward compatibility)\n   */\n  flip(opts = {}) {\n    this._updateBoardPieces(opts.animate !== false);\n    return this.flipBoard(opts);\n  }\n\n  /**\n   * Gets or sets the current position\n   * @param {string|Object} [newPosition] - New position (optional)\n   * @param {boolean} [animate=true] - Whether to animate\n   * @returns {Object|void} Position object if getter, void if setter\n   */\n  getOrSetPosition(newPosition, animate = true) {\n    if (newPosition === undefined) {\n      return this.positionService.getPosition();\n    }\n    this.load(newPosition, {}, animate);\n  }\n\n  /**\n   * Undoes the last move\n   * @param {boolean} [animate=true] - Whether to animate\n   * @returns {boolean} True if undo was successful\n   */\n  undo(animate = true) {\n    const undone = this.positionService.getGame().undo();\n    if (undone) {\n      this._undoneMoves.push(undone);\n      this._updateBoardPieces(animate);\n      return undone;\n    }\n    return null;\n  }\n\n  /**\n   * Redoes the last undone move\n   * @param {boolean} [animate=true] - Whether to animate\n   * @returns {boolean} True if redo was successful\n   */\n  redo(animate = true) {\n    if (this._undoneMoves && this._undoneMoves.length > 0) {\n      const move = this._undoneMoves.pop();\n      const moveObj = { from: move.from, to: move.to };\n      if (move.promotion) moveObj.promotion = move.promotion;\n      const result = this.positionService.getGame().move(moveObj);\n      this._updateBoardPieces(animate);\n      return result;\n    }\n    return false;\n  }\n\n  /**\n   * Gets the game history\n   * @returns {Array} Array of moves\n   */\n  history() {\n    return this.positionService.getGame().history();\n  }\n\n  /**\n   * Gets the current game state\n   * @returns {Object} Game state object\n   */\n  game() {\n    return this.positionService.getGame();\n  }\n\n  /**\n   * Gets or sets the orientation\n   * @param {string} [orientation] - New orientation\n   * @returns {string} Current orientation\n   */\n  orientation(orientation) {\n    if (orientation === undefined) {\n      return this.coordinateService.getOrientation();\n    }\n\n    if (this.validationService.isValidOrientation(orientation)) {\n      this.coordinateService.setOrientation(orientation);\n      this.flip();\n    }\n\n    return this.coordinateService.getOrientation();\n  }\n\n  /**\n   * Gets or sets the size\n   * @param {number|string} [size] - New size\n   * @returns {number|string} Current size\n   */\n  size(size) {\n    if (size === undefined) {\n      return this.config.size;\n    }\n\n    if (this.validationService.isValidSize(size)) {\n      this.config.size = size;\n      this.resize(size);\n    }\n\n    return this.config.size;\n  }\n\n  /**\n   * Gets legal moves for a square\n   * @param {string} square - Square to get moves for\n   * @returns {Array} Array of legal moves\n   */\n  legalMoves(square) {\n    const squareObj = this.boardService.getSquare(square);\n    if (!squareObj) return [];\n\n    return this.moveService.getCachedLegalMoves(squareObj);\n  }\n\n  /**\n   * Checks if a move is legal\n   * @param {string|Object} move - Move to check\n   * @returns {boolean} True if move is legal\n   */\n  isLegal(move) {\n    const moveObj = typeof move === 'string' ? this.moveService.parseMove(move) : move;\n    if (!moveObj) return false;\n\n    const fromSquare = this.boardService.getSquare(moveObj.from);\n    const toSquare = this.boardService.getSquare(moveObj.to);\n\n    if (!fromSquare || !toSquare) return false;\n\n    const moveInstance = new Move(fromSquare, toSquare, moveObj.promotion);\n    return moveInstance.isLegal(this.positionService.getGame());\n  }\n\n  /**\n   * Checks if the current player is in check\n   * @returns {boolean} True if in check\n   */\n  inCheck() {\n    return this.positionService.getGame().inCheck();\n  }\n\n  /**\n   * Checks if the current player is in checkmate\n   * @returns {boolean} True if in checkmate\n   */\n  inCheckmate() {\n    return this.positionService.getGame().isCheckmate();\n  }\n\n  /**\n   * Checks if the game is in stalemate\n   * @returns {boolean} True if in stalemate\n   */\n  inStalemate() {\n    return this.positionService.getGame().isStalemate();\n  }\n\n  /**\n   * Checks if the game is drawn\n   * @returns {boolean} True if drawn\n   */\n  inDraw() {\n    return this.positionService.getGame().isDraw();\n  }\n\n  /**\n   * Checks if position is threefold repetition\n   * @returns {boolean} True if threefold repetition\n   */\n  inThreefoldRepetition() {\n    return this.positionService.getGame().isThreefoldRepetition();\n  }\n\n  /**\n   * Gets the PGN representation of the game\n   * @returns {string} PGN string\n   */\n  pgn() {\n    return this.positionService.getGame().pgn();\n  }\n\n  /**\n   * Loads a PGN string\n   * @param {string} pgn - PGN string to load\n   * @param {boolean} [animate=true] - Whether to animate\n   * @returns {boolean} True if loaded successfully\n   */\n  loadPgn(pgn, animate = true) {\n    try {\n      const success = this.positionService.getGame().loadPgn(pgn);\n      if (success) {\n        this._updateBoardPieces(animate, true); // Position load\n      }\n      return success;\n    } catch (error) {\n      console.error('Error loading PGN:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Gets configuration options (alias for getConfig)\n   * @returns {Object} Configuration object\n   */\n  getConfigOptions() {\n    return this.config && typeof this.config.getConfig === 'function'\n      ? this.config.getConfig()\n      : this.config;\n  }\n\n  /**\n   * Updates configuration options (alias for updateConfig)\n   * @param {Object} newConfig - New configuration options\n   */\n  setConfigOptions(newConfig) {\n    this.updateConfig(newConfig);\n  }\n\n  /**\n   * Gets or sets the animation style\n   * @param {string} [style] - New animation style ('sequential' or 'simultaneous')\n   * @returns {string} Current animation style\n   */\n  animationStyle(style) {\n    if (style === undefined) {\n      return this.config.animationStyle;\n    }\n\n    if (this.validationService.isValidAnimationStyle(style)) {\n      this.config.animationStyle = style;\n    }\n\n    return this.config.animationStyle;\n  }\n\n  /**\n   * Gets or sets the simultaneous animation delay\n   * @param {number} [delay] - New delay in milliseconds\n   * @returns {number} Current delay\n   */\n  simultaneousAnimationDelay(delay) {\n    if (delay === undefined) {\n      return this.config.simultaneousAnimationDelay;\n    }\n\n    if (typeof delay === 'number' && delay >= 0) {\n      this.config.simultaneousAnimationDelay = delay;\n    }\n\n    return this.config.simultaneousAnimationDelay;\n  }\n\n  // Additional API methods would be added here following the same pattern\n  // This is a good starting point for the refactored architecture\n\n  // Ensure all public API methods from README are present and routed\n  insert(square, piece) {\n    return this.putPiece(piece, square);\n  }\n  get(square) {\n    return this.getPiece(square);\n  }\n  /**\n   * Legacy position method - use getPosition/setPosition instead\n   * @deprecated\n   */\n  position(positionArg, colorOrAnimate) {\n    if (positionArg === undefined) {\n      return this.positionService.getPosition();\n    }\n    if (typeof colorOrAnimate === 'string' && (colorOrAnimate === 'w' || colorOrAnimate === 'b')) {\n      this.setOrientation(colorOrAnimate);\n    }\n    return this.setPosition(positionArg, { animate: colorOrAnimate !== false });\n  }\n  // Legacy aliases (using arrow functions to avoid duplicate method names)\n  destroy() {\n    return this.destroyBoard();\n  }\n  build() {\n    return this._initialize();\n  }\n  resize(value) {\n    return this.resizeBoard(value);\n  }\n  piece(square) {\n    return this.getPiece(square);\n  }\n  ascii() {\n    return this.positionService.getGame().ascii();\n  }\n  board() {\n    return this.positionService.getGame().board();\n  }\n  getCastlingRights(color) {\n    return this.positionService.getGame().getCastlingRights(color);\n  }\n  getComment() {\n    return this.positionService.getGame().getComment();\n  }\n  getComments() {\n    return this.positionService.getGame().getComments();\n  }\n  lastMove() {\n    return this.positionService.getGame().lastMove();\n  }\n  moveNumber() {\n    return this.positionService.getGame().moveNumber();\n  }\n  moves(options = {}) {\n    return this.positionService.getGame().moves(options);\n  }\n  squareColor(squareId) {\n    return this.boardService.getSquare(squareId).isWhite() ? 'light' : 'dark';\n  }\n  isDrawByFiftyMoves() {\n    return this.positionService.getGame().isDrawByFiftyMoves();\n  }\n  isInsufficientMaterial() {\n    return this.positionService.getGame().isInsufficientMaterial();\n  }\n  isStalemate() {\n    return this.positionService.getGame().isStalemate();\n  }\n  isThreefoldRepetition() {\n    return this.positionService.getGame().isThreefoldRepetition();\n  }\n  load(fen, options = {}, animation = true) {\n    return this.setPosition(fen, { ...options, animate: animation });\n  }\n  put(pieceId, squareId, animation = true) {\n    let pieceObj = null;\n    // Helper to normalize string like 'wQ', 'Qw', 'Wq', 'qw', etc.\n    function parsePieceString(str) {\n      if (typeof str !== 'string' || str.length !== 2) return null;\n      const a = str[0].toLowerCase();\n      const b = str[1].toLowerCase();\n      const types = 'kqrbnp';\n      const colors = 'wb';\n      if (types.includes(a) && colors.includes(b)) {\n        return { type: a, color: b };\n      } else if (colors.includes(a) && types.includes(b)) {\n        return { type: b, color: a };\n      }\n      return null;\n    }\n    if (typeof pieceId === 'string') {\n      pieceObj = parsePieceString(pieceId);\n      if (!pieceObj) {\n        console.error(`[put] Invalid piece string: '${pieceId}'. Use e.g. 'wQ', 'Qw', 'bK', 'kb'`);\n        return false;\n      }\n    } else if (typeof pieceId === 'object' && pieceId.type && pieceId.color) {\n      const type = String(pieceId.type).toLowerCase();\n      const color = String(pieceId.color).toLowerCase();\n      if ('kqrbnp'.includes(type) && 'wb'.includes(color)) {\n        pieceObj = { type, color };\n      } else {\n        console.error(\n          `[put] Invalid piece object: {type: '${pieceId.type}', color: '${pieceId.color}'}`\n        );\n        return false;\n      }\n    } else {\n      console.error('[put] Invalid pieceId:', pieceId);\n      return false;\n    }\n    if (typeof squareId !== 'string' || squareId.length !== 2) {\n      console.error('[put] Invalid squareId:', squareId);\n      return false;\n    }\n    // Call the internal putPiece method\n    const result = this.putPiece(pieceObj, squareId, { animate: animation });\n    return result;\n  }\n  remove(squareId, animation = true) {\n    return this.removePiece(squareId, { animate: animation });\n  }\n  removeComment() {\n    return this.positionService.getGame().removeComment();\n  }\n  removeComments() {\n    return this.positionService.getGame().removeComments();\n  }\n  removeHeader(field) {\n    return this.positionService.getGame().removeHeader(field);\n  }\n  setCastlingRights(color, rights) {\n    return this.positionService.getGame().setCastlingRights(color, rights);\n  }\n  setComment(comment) {\n    return this.positionService.getGame().setComment(comment);\n  }\n  setHeader(key, value) {\n    return this.positionService.getGame().setHeader(key, value);\n  }\n  validateFen(fen) {\n    return this.positionService.getGame().validateFen(fen);\n  }\n\n  // Alias methods for highlight/dehighlight\n  highlightSquare(square) {\n    return this.highlight(square);\n  }\n  dehighlightSquare(square) {\n    return this.dehighlight(square);\n  }\n}\n\nexport { Chessboard };\nexport default Chessboard;\n","/**\n * Structured logging system for Chessboard.js\n * @module utils/logger\n * @since 2.0.0\n */\n\n/**\n * Log levels in order of severity\n * @constant\n * @type {Object}\n */\nconst LOG_LEVELS = Object.freeze({\n  DEBUG: 0,\n  INFO: 1,\n  WARN: 2,\n  ERROR: 3,\n  NONE: 4,\n});\n\n/**\n * Default logger configuration\n * @constant\n * @type {Object}\n */\nconst DEFAULT_CONFIG = Object.freeze({\n  level: LOG_LEVELS.INFO,\n  enableColors: true,\n  enableTimestamp: true,\n  enableStackTrace: true,\n  maxLogSize: 1000,\n  enableConsole: true,\n  enableStorage: false,\n  storageKey: 'chessboard-logs',\n});\n\n/**\n * ANSI color codes for console output\n * @constant\n * @type {Object}\n */\nconst COLORS = Object.freeze({\n  DEBUG: '\\x1b[36m', // Cyan\n  INFO: '\\x1b[32m', // Green\n  WARN: '\\x1b[33m', // Yellow\n  ERROR: '\\x1b[31m', // Red\n  RESET: '\\x1b[0m', // Reset\n});\n\n/**\n * Structured logger class with configurable output and filtering\n * @class\n */\nexport class Logger {\n  /**\n   * Creates a new Logger instance\n   * @param {Object} [config] - Logger configuration\n   * @param {string} [name] - Logger name/namespace\n   */\n  constructor(config = {}, name = 'Chessboard') {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.name = name;\n    this.logs = [];\n    this.startTime = Date.now();\n\n    // Create bound methods for better performance\n    this.debug = this._createLogMethod('DEBUG');\n    this.info = this._createLogMethod('INFO');\n    this.warn = this._createLogMethod('WARN');\n    this.error = this._createLogMethod('ERROR');\n\n    // Performance tracking\n    this.performances = new Map();\n\n    // Initialize storage if enabled\n    if (this.config.enableStorage) {\n      this._initStorage();\n    }\n  }\n\n  /**\n   * Creates a log method for a specific level\n   * @private\n   * @param {string} level - Log level\n   * @returns {Function} Log method\n   */\n  _createLogMethod(level) {\n    return (message, data = {}, error = null) => {\n      this._log(level, message, data, error);\n    };\n  }\n\n  /**\n   * Core logging method\n   * @private\n   * @param {string} level - Log level\n   * @param {string} message - Log message\n   * @param {Object} data - Additional data\n   * @param {Error} error - Error object\n   */\n  _log(level, message, data, error) {\n    const levelNumber = LOG_LEVELS[level];\n\n    // Filter by level\n    if (levelNumber < this.config.level) {\n      return;\n    }\n\n    // Create log entry\n    const entry = this._createLogEntry(level, message, data, error);\n\n    // Store log entry\n    this._storeLogEntry(entry);\n\n    // Output to console\n    if (this.config.enableConsole) {\n      this._outputToConsole(entry);\n    }\n\n    // Store in localStorage if enabled\n    if (this.config.enableStorage) {\n      this._storeInStorage(entry);\n    }\n  }\n\n  /**\n   * Creates a structured log entry\n   * @private\n   * @param {string} level - Log level\n   * @param {string} message - Log message\n   * @param {Object} data - Additional data\n   * @param {Error} error - Error object\n   * @returns {Object} Log entry\n   */\n  _createLogEntry(level, message, data, error) {\n    const entry = {\n      timestamp: new Date().toISOString(),\n      level,\n      logger: this.name,\n      message,\n      data: { ...data },\n      runtime: Date.now() - this.startTime,\n    };\n\n    // Add error details if provided\n    if (error) {\n      entry.error = {\n        name: error.name,\n        message: error.message,\n        stack: this.config.enableStackTrace ? error.stack : null,\n      };\n    }\n\n    // Add performance context if available\n    if (typeof performance !== 'undefined' && performance.memory) {\n      entry.memory = {\n        used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),\n        total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024),\n      };\n    }\n\n    return entry;\n  }\n\n  /**\n   * Stores log entry in memory\n   * @private\n   * @param {Object} entry - Log entry\n   */\n  _storeLogEntry(entry) {\n    this.logs.push(entry);\n\n    // Limit log size\n    if (this.logs.length > this.config.maxLogSize) {\n      this.logs.shift();\n    }\n  }\n\n  /**\n   * Outputs log entry to console\n   * @private\n   * @param {Object} entry - Log entry\n   */\n  _outputToConsole(entry) {\n    const color = this.config.enableColors ? COLORS[entry.level] : '';\n    const reset = this.config.enableColors ? COLORS.RESET : '';\n    const timestamp = this.config.enableTimestamp\n      ? `[${new Date(entry.timestamp).toLocaleTimeString()}] `\n      : '';\n\n    const prefix = `${color}${timestamp}[${entry.logger}:${entry.level}]${reset}`;\n    const message = `${prefix} ${entry.message}`;\n\n    // Choose console method based on level\n    const consoleMethod = this._getConsoleMethod(entry.level);\n\n    if (Object.keys(entry.data).length > 0 || entry.error) {\n      consoleMethod(message, {\n        data: entry.data,\n        error: entry.error,\n        runtime: `${entry.runtime}ms`,\n      });\n    } else {\n      consoleMethod(message);\n    }\n  }\n\n  /**\n   * Gets appropriate console method for log level\n   * @private\n   * @param {string} level - Log level\n   * @returns {Function} Console method\n   */\n  _getConsoleMethod(level) {\n    switch (level) {\n      case 'DEBUG':\n        return console.debug || console.log;\n      case 'INFO':\n        return console.info || console.log;\n      case 'WARN':\n        return console.warn || console.log;\n      case 'ERROR':\n        return console.error || console.log;\n      default:\n        return console.log;\n    }\n  }\n\n  /**\n   * Initializes localStorage for log storage\n   * @private\n   */\n  _initStorage() {\n    if (typeof localStorage === 'undefined') {\n      this.config.enableStorage = false;\n      return;\n    }\n\n    try {\n      // Test localStorage availability\n      localStorage.setItem('test', 'test');\n      localStorage.removeItem('test');\n    } catch {\n      this.config.enableStorage = false;\n      console.warn('localStorage not available, disabling log storage');\n    }\n  }\n\n  /**\n   * Stores log entry in localStorage\n   * @private\n   * @param {Object} entry - Log entry\n   */\n  _storeInStorage(entry) {\n    if (!this.config.enableStorage) {\n      return;\n    }\n\n    try {\n      const stored = JSON.parse(localStorage.getItem(this.config.storageKey) || '[]');\n      stored.push(entry);\n\n      // Limit stored logs\n      if (stored.length > this.config.maxLogSize) {\n        stored.shift();\n      }\n\n      localStorage.setItem(this.config.storageKey, JSON.stringify(stored));\n    } catch (error) {\n      console.warn('Failed to store log entry:', error);\n    }\n  }\n\n  /**\n   * Starts performance measurement\n   * @param {string} name - Performance measurement name\n   */\n  startPerformance(name) {\n    this.performances.set(name, {\n      start: performance.now(),\n      measurements: [],\n    });\n\n    this.debug(`Started performance measurement: ${name}`);\n  }\n\n  /**\n   * Ends performance measurement\n   * @param {string} name - Performance measurement name\n   * @returns {number} Duration in milliseconds\n   */\n  endPerformance(name) {\n    const perf = this.performances.get(name);\n    if (!perf) {\n      this.warn(`Performance measurement not found: ${name}`);\n      return 0;\n    }\n\n    const duration = performance.now() - perf.start;\n    perf.measurements.push(duration);\n\n    this.debug(`Performance measurement completed: ${name}`, {\n      duration: `${duration.toFixed(2)}ms`,\n      measurements: perf.measurements.length,\n    });\n\n    return duration;\n  }\n\n  /**\n   * Gets performance statistics\n   * @param {string} name - Performance measurement name\n   * @returns {Object} Performance statistics\n   */\n  getPerformanceStats(name) {\n    const perf = this.performances.get(name);\n    if (!perf || perf.measurements.length === 0) {\n      return null;\n    }\n\n    const measurements = perf.measurements;\n    const total = measurements.reduce((sum, m) => sum + m, 0);\n    const avg = total / measurements.length;\n    const min = Math.min(...measurements);\n    const max = Math.max(...measurements);\n\n    return {\n      name,\n      count: measurements.length,\n      total: total.toFixed(2),\n      average: avg.toFixed(2),\n      min: min.toFixed(2),\n      max: max.toFixed(2),\n    };\n  }\n\n  /**\n   * Creates a child logger with a specific namespace\n   * @param {string} namespace - Child logger namespace\n   * @returns {Logger} Child logger instance\n   */\n  child(namespace) {\n    return new Logger(this.config, `${this.name}:${namespace}`);\n  }\n\n  /**\n   * Sets log level\n   * @param {string} level - Log level\n   */\n  setLevel(level) {\n    if (LOG_LEVELS[level] !== undefined) {\n      this.config.level = LOG_LEVELS[level];\n    }\n  }\n\n  /**\n   * Gets current log level\n   * @returns {string} Current log level\n   */\n  getLevel() {\n    return Object.keys(LOG_LEVELS).find((key) => LOG_LEVELS[key] === this.config.level);\n  }\n\n  /**\n   * Gets all stored logs\n   * @returns {Array} Array of log entries\n   */\n  getLogs() {\n    return [...this.logs];\n  }\n\n  /**\n   * Clears all stored logs\n   */\n  clearLogs() {\n    this.logs = [];\n\n    if (this.config.enableStorage) {\n      try {\n        localStorage.removeItem(this.config.storageKey);\n      } catch (error) {\n        console.warn('Failed to clear stored logs:', error);\n      }\n    }\n  }\n\n  /**\n   * Exports logs as JSON\n   * @returns {string} JSON string of logs\n   */\n  exportLogs() {\n    return JSON.stringify(this.logs, null, 2);\n  }\n\n  /**\n   * Cleans up resources\n   */\n  destroy() {\n    this.clearLogs();\n    this.performances.clear();\n  }\n}\n\n/**\n * Default logger instance\n * @type {Logger}\n */\nexport const logger = new Logger();\n\n/**\n * Creates a logger with specific configuration\n * @param {Object} config - Logger configuration\n * @param {string} name - Logger name\n * @returns {Logger} Logger instance\n */\nexport function createLogger(config, name) {\n  return new Logger(config, name);\n}\n\n/**\n * Log levels enumeration\n * @type {Object}\n */\nexport { LOG_LEVELS };\n","/**\n * Chessboard factory for creating and managing chessboard instances\n * @module core/ChessboardFactory\n * @since 2.0.0\n */\n\nimport { Chessboard } from './Chessboard.js';\nimport { ValidationService } from '../services/ValidationService.js';\nimport { ConfigurationError } from '../errors/ChessboardError.js';\nimport { logger } from '../utils/logger.js';\nimport { PerformanceMonitor } from '../utils/performance.js';\n\n/**\n * Factory class for creating and managing chessboard instances\n * Implements the Factory pattern with instance management\n * @class\n */\nexport class ChessboardFactory {\n  /**\n   * Creates a new ChessboardFactory instance\n   */\n  constructor() {\n    this.instances = new Map();\n    this.validationService = new ValidationService();\n    this.performanceMonitor = new PerformanceMonitor();\n    this.logger = logger.child('ChessboardFactory');\n\n    // Default configuration templates\n    this.templates = new Map();\n    this._initializeDefaultTemplates();\n  }\n\n  /**\n   * Initializes default configuration templates\n   * @private\n   */\n  _initializeDefaultTemplates() {\n    // Basic template\n    this.templates.set('basic', {\n      size: 400,\n      draggable: true,\n      hints: true,\n      clickable: true,\n      moveHighlight: true,\n      animationStyle: 'simultaneous',\n    });\n\n    // Tournament template\n    this.templates.set('tournament', {\n      size: 500,\n      draggable: false,\n      hints: false,\n      clickable: true,\n      moveHighlight: true,\n      onlyLegalMoves: true,\n      animationStyle: 'sequential',\n    });\n\n    // Analysis template\n    this.templates.set('analysis', {\n      size: 600,\n      draggable: true,\n      hints: true,\n      clickable: true,\n      moveHighlight: true,\n      mode: 'analysis',\n      animationStyle: 'simultaneous',\n    });\n\n    // Puzzle template\n    this.templates.set('puzzle', {\n      size: 450,\n      draggable: true,\n      hints: true,\n      clickable: true,\n      moveHighlight: true,\n      onlyLegalMoves: true,\n      animationStyle: 'sequential',\n    });\n\n    // Demo template\n    this.templates.set('demo', {\n      size: 'auto',\n      draggable: false,\n      hints: false,\n      clickable: false,\n      moveHighlight: true,\n      animationStyle: 'simultaneous',\n    });\n  }\n\n  /**\n   * Creates a new chessboard instance\n   * @param {string} containerId - Container element ID\n   * @param {Object} [config={}] - Configuration options\n   * @param {string} [template] - Template name to use\n   * @returns {Chessboard} Chessboard instance\n   * @throws {ConfigurationError} If configuration is invalid\n   */\n  create(containerId, config = {}, template = null) {\n    this.performanceMonitor.startMeasure('chessboard-creation');\n\n    try {\n      // Validate container ID\n      if (!containerId || typeof containerId !== 'string') {\n        throw new ConfigurationError(\n          'Container ID must be a non-empty string',\n          'containerId',\n          containerId\n        );\n      }\n\n      // Check if container exists\n      const container = document.getElementById(containerId);\n      if (!container) {\n        throw new ConfigurationError(\n          `Container element not found: ${containerId}`,\n          'containerId',\n          containerId\n        );\n      }\n\n      // Merge configuration with template if specified\n      let finalConfig = { ...config };\n      if (template) {\n        const templateConfig = this.templates.get(template);\n        if (!templateConfig) {\n          this.logger.warn(`Template \"${template}\" not found, using default configuration`);\n        } else {\n          finalConfig = { ...templateConfig, ...config };\n          this.logger.info(`Using template \"${template}\" for chessboard creation`);\n        }\n      }\n\n      // Set container ID\n      finalConfig.id = containerId;\n\n      // Validate configuration\n      this.validationService.validateConfig(finalConfig);\n\n      // Create chessboard instance\n      const chessboard = new Chessboard(finalConfig);\n\n      // Store instance for management\n      this.instances.set(containerId, {\n        instance: chessboard,\n        config: finalConfig,\n        template,\n        createdAt: new Date(),\n        container,\n      });\n\n      this.performanceMonitor.endMeasure('chessboard-creation');\n      this.logger.info(`Created chessboard instance for container: ${containerId}`, {\n        template,\n        configKeys: Object.keys(finalConfig),\n      });\n\n      return chessboard;\n    } catch (error) {\n      this.performanceMonitor.endMeasure('chessboard-creation');\n      this.logger.error('Failed to create chessboard instance', { containerId, error });\n      throw error;\n    }\n  }\n\n  /**\n   * Creates a chessboard using a predefined template\n   * @param {string} containerId - Container element ID\n   * @param {string} templateName - Template name\n   * @param {Object} [overrides={}] - Configuration overrides\n   * @returns {Chessboard} Chessboard instance\n   */\n  createFromTemplate(containerId, templateName, overrides = {}) {\n    return this.create(containerId, overrides, templateName);\n  }\n\n  /**\n   * Gets an existing chessboard instance\n   * @param {string} containerId - Container element ID\n   * @returns {Chessboard|null} Chessboard instance or null if not found\n   */\n  getInstance(containerId) {\n    const instance = this.instances.get(containerId);\n    return instance ? instance.instance : null;\n  }\n\n  /**\n   * Gets information about an instance\n   * @param {string} containerId - Container element ID\n   * @returns {Object|null} Instance information or null if not found\n   */\n  getInstanceInfo(containerId) {\n    const instance = this.instances.get(containerId);\n    if (!instance) {\n      return null;\n    }\n\n    return {\n      containerId,\n      template: instance.template,\n      createdAt: instance.createdAt,\n      config: { ...instance.config },\n    };\n  }\n\n  /**\n   * Destroys a chessboard instance\n   * @param {string} containerId - Container element ID\n   * @returns {boolean} True if instance was destroyed, false if not found\n   */\n  destroy(containerId) {\n    const instance = this.instances.get(containerId);\n    if (!instance) {\n      this.logger.warn(`Instance not found for destruction: ${containerId}`);\n      return false;\n    }\n\n    try {\n      // Destroy the chessboard instance\n      instance.instance.destroy();\n\n      // Remove from instances map\n      this.instances.delete(containerId);\n\n      this.logger.info(`Destroyed chessboard instance: ${containerId}`);\n      return true;\n    } catch (error) {\n      this.logger.error(`Failed to destroy chessboard instance: ${containerId}`, { error });\n      return false;\n    }\n  }\n\n  /**\n   * Destroys all chessboard instances\n   */\n  destroyAll() {\n    const containerIds = Array.from(this.instances.keys());\n    let destroyed = 0;\n\n    for (const containerId of containerIds) {\n      if (this.destroy(containerId)) {\n        destroyed++;\n      }\n    }\n\n    this.logger.info(`Destroyed ${destroyed} chessboard instances`);\n  }\n\n  /**\n   * Lists all active chessboard instances\n   * @returns {Array} Array of instance information\n   */\n  listInstances() {\n    return Array.from(this.instances.keys()).map((containerId) =>\n      this.getInstanceInfo(containerId)\n    );\n  }\n\n  /**\n   * Registers a new configuration template\n   * @param {string} name - Template name\n   * @param {Object} config - Template configuration\n   * @throws {ConfigurationError} If template name or config is invalid\n   */\n  registerTemplate(name, config) {\n    if (!name || typeof name !== 'string') {\n      throw new ConfigurationError('Template name must be a non-empty string', 'name', name);\n    }\n\n    if (!config || typeof config !== 'object') {\n      throw new ConfigurationError('Template configuration must be an object', 'config', config);\n    }\n\n    // Validate template configuration\n    this.validationService.validateConfig(config);\n\n    this.templates.set(name, { ...config });\n    this.logger.info(`Registered template: ${name}`, { configKeys: Object.keys(config) });\n  }\n\n  /**\n   * Removes a configuration template\n   * @param {string} name - Template name\n   * @returns {boolean} True if template was removed, false if not found\n   */\n  removeTemplate(name) {\n    const removed = this.templates.delete(name);\n    if (removed) {\n      this.logger.info(`Removed template: ${name}`);\n    }\n    return removed;\n  }\n\n  /**\n   * Gets a configuration template\n   * @param {string} name - Template name\n   * @returns {Object|null} Template configuration or null if not found\n   */\n  getTemplate(name) {\n    const template = this.templates.get(name);\n    return template ? { ...template } : null;\n  }\n\n  /**\n   * Lists all available templates\n   * @returns {Array} Array of template names\n   */\n  listTemplates() {\n    return Array.from(this.templates.keys());\n  }\n\n  /**\n   * Creates multiple chessboard instances from a configuration array\n   * @param {Array} configurations - Array of configuration objects\n   * @returns {Array} Array of created chessboard instances\n   */\n  createMultiple(configurations) {\n    const instances = [];\n    const errors = [];\n\n    for (const config of configurations) {\n      try {\n        const { containerId, template, ...options } = config;\n        const instance = this.create(containerId, options, template);\n        instances.push({ containerId, instance, success: true });\n      } catch (error) {\n        errors.push({ containerId: config.containerId, error, success: false });\n        this.logger.error(`Failed to create instance for ${config.containerId}`, { error });\n      }\n    }\n\n    if (errors.length > 0) {\n      this.logger.warn(\n        `Failed to create ${errors.length} out of ${configurations.length} instances`\n      );\n    }\n\n    return { instances, errors };\n  }\n\n  /**\n   * Gets factory statistics\n   * @returns {Object} Factory statistics\n   */\n  getStats() {\n    const stats = {\n      activeInstances: this.instances.size,\n      availableTemplates: this.templates.size,\n      performance: this.performanceMonitor.getMetrics(),\n      validation: this.validationService.getCacheStats(),\n    };\n\n    return stats;\n  }\n\n  /**\n   * Cleans up factory resources\n   */\n  cleanup() {\n    this.destroyAll();\n    this.validationService.destroy();\n    this.performanceMonitor.destroy();\n    this.templates.clear();\n  }\n}\n\n/**\n * Default factory instance\n * @type {ChessboardFactory}\n */\nexport const chessboardFactory = new ChessboardFactory();\n\n/**\n * Convenience method to create a chessboard instance\n * @param {string} containerId - Container element ID\n * @param {Object} [config={}] - Configuration options\n * @param {string} [template] - Template name to use\n * @returns {Chessboard} Chessboard instance\n */\nexport function createChessboard(containerId, config = {}, template = null) {\n  return chessboardFactory.create(containerId, config, template);\n}\n\n/**\n * Convenience method to create a chessboard from template\n * @param {string} containerId - Container element ID\n * @param {string} templateName - Template name\n * @param {Object} [overrides={}] - Configuration overrides\n * @returns {Chessboard} Chessboard instance\n */\nexport function createChessboardFromTemplate(containerId, templateName, overrides = {}) {\n  return chessboardFactory.createFromTemplate(containerId, templateName, overrides);\n}\n","/**\n * Chessboard.js - A beautiful, customizable chessboard widget\n * Entry point for the core library\n * @module core\n * @since 2.0.0\n */\n\nimport ChessboardClass from './Chessboard.js';\nimport ChessboardConfig from './ChessboardConfig.js';\nimport {\n    ChessboardFactory,\n    chessboardFactory,\n    createChessboard,\n    createChessboardFromTemplate\n} from './ChessboardFactory.js';\nimport { logger } from '../utils/logger.js';\n\n/**\n * Main Chessboard factory function for backward compatibility\n * Supports both legacy and modern calling conventions\n * @param {string|Object} containerElm - Container element ID or configuration object\n * @param {Object} [config={}] - Configuration options (when first param is string)\n * @returns {ChessboardClass} Chessboard instance\n */\nfunction Chessboard(containerElm, config = {}) {\n    const factoryLogger = logger.child('ChessboardFactory');\n\n    try {\n        // If first parameter is an object, treat it as config\n        if (typeof containerElm === 'object' && containerElm !== null) {\n            factoryLogger.debug('Creating chessboard with config object');\n            return new ChessboardClass(containerElm);\n        }\n\n        // Otherwise, treat first parameter as element ID\n        if (typeof containerElm === 'string') {\n            factoryLogger.debug('Creating chessboard with element ID', { elementId: containerElm });\n            const fullConfig = { ...config, id: containerElm };\n            return new ChessboardClass(fullConfig);\n        }\n\n        throw new Error('Invalid parameters: first parameter must be string or object');\n    } catch (error) {\n        factoryLogger.error('Failed to create chessboard instance', { error });\n        throw error;\n    }\n}\n\n/**\n * Wrapper class that handles both calling conventions\n * Provides enhanced error handling and logging\n * @class\n * @extends ChessboardClass\n */\nclass ChessboardWrapper extends ChessboardClass {\n    /**\n     * Creates a new ChessboardWrapper instance\n     * @param {string|Object} containerElm - Container element ID or configuration object\n     * @param {Object} [config={}] - Configuration options\n     */\n    constructor(containerElm, config = {}) {\n        const instanceLogger = logger.child('ChessboardWrapper');\n\n        try {\n            // If first parameter is an object, treat it as config\n            if (typeof containerElm === 'object' && containerElm !== null) {\n                instanceLogger.debug('Initializing with config object');\n                super(containerElm);\n            } else if (typeof containerElm === 'string') {\n                // Otherwise, treat first parameter as element ID\n                instanceLogger.debug('Initializing with element ID', { elementId: containerElm });\n                const fullConfig = { ...config, id: containerElm };\n                super(fullConfig);\n            } else {\n                throw new Error('Invalid constructor parameters');\n            }\n        } catch (error) {\n            instanceLogger.error('Failed to initialize ChessboardWrapper', { error });\n            throw error;\n        }\n    }\n}\n\n/**\n * Refactored Chessboard API - see Chessboard.js for full method docs\n * @typedef {import('./Chessboard.js').Chessboard} Chessboard\n */\n\n// --- STATIC/FACTORY METHODS ---\n/**\n * Create a new Chessboard instance\n * @param {string|Object} containerElm\n * @param {Object} [config]\n * @returns {Chessboard}\n */\nChessboard.create = createChessboard;\n/**\n * Create a Chessboard from a template\n * @param {string|Object} containerElm\n * @param {string} templateName\n * @param {Object} [config]\n * @returns {Chessboard}\n */\nChessboard.fromTemplate = createChessboardFromTemplate;\nChessboard.factory = chessboardFactory;\n\n// --- INSTANCE MANAGEMENT ---\nChessboard.getInstance = (containerId) => chessboardFactory.getInstance(containerId);\nChessboard.destroyInstance = (containerId) => chessboardFactory.destroy(containerId);\nChessboard.destroyAll = () => chessboardFactory.destroyAll();\nChessboard.listInstances = () => chessboardFactory.listInstances();\n\n// --- TEMPLATE MANAGEMENT ---\nChessboard.registerTemplate = (name, config) => chessboardFactory.registerTemplate(name, config);\nChessboard.removeTemplate = (name) => chessboardFactory.removeTemplate(name);\nChessboard.getTemplate = (name) => chessboardFactory.getTemplate(name);\nChessboard.listTemplates = () => chessboardFactory.listTemplates();\n\n// --- STATS & DEBUG ---\nChessboard.getStats = () => chessboardFactory.getStats();\n\n// --- DEPRECATED/LEGACY ALIASES ---\n/**\n * @deprecated Use Chessboard.create instead\n */\nChessboard.Class = ChessboardWrapper;\nChessboard.Chessboard = ChessboardWrapper;\nChessboard.Config = ChessboardConfig;\nChessboard.Factory = ChessboardFactory;\n\n// --- EXPORTS ---\nexport {\n    Chessboard,\n    ChessboardConfig,\n    ChessboardFactory,\n    chessboardFactory,\n    createChessboard,\n    createChessboardFromTemplate\n};\n\nexport default Chessboard;\n","/**\n * Coordinate utilities for Chessboard.js\n */\n\n/**\n * Convert algebraic notation to array coordinates\n * @param {string} square - Square in algebraic notation (e.g., 'a1', 'h8')\n * @returns {Object} Object with row and col properties\n */\nexport function algebraicToCoords(square) {\n  const file = square.charCodeAt(0) - 97; // 'a' = 0, 'b' = 1, etc.\n  const rank = parseInt(square[1]) - 1;    // '1' = 0, '2' = 1, etc.\n  \n  return { row: 7 - rank, col: file };\n}\n\n/**\n * Convert array coordinates to algebraic notation\n * @param {number} row - Row index (0-7)\n * @param {number} col - Column index (0-7)\n * @returns {string} Square in algebraic notation\n */\nexport function coordsToAlgebraic(row, col) {\n  const file = String.fromCharCode(97 + col); // 0 = 'a', 1 = 'b', etc.\n  const rank = (8 - row).toString();          // 0 = '8', 1 = '7', etc.\n  \n  return file + rank;\n}\n\n/**\n * Get the color of a square\n * @param {string} square - Square in algebraic notation\n * @returns {string} 'light' or 'dark'\n */\nexport function getSquareColor(square) {\n  const { row, col } = algebraicToCoords(square);\n  return (row + col) % 2 === 0 ? 'dark' : 'light';\n}\n\n/**\n * Check if coordinates are valid\n * @param {number} row - Row index\n * @param {number} col - Column index\n * @returns {boolean} True if coordinates are valid\n */\nexport function isValidCoords(row, col) {\n  return row >= 0 && row <= 7 && col >= 0 && col <= 7;\n}\n\n/**\n * Check if algebraic notation is valid\n * @param {string} square - Square in algebraic notation\n * @returns {boolean} True if square notation is valid\n */\nexport function isValidSquare(square) {\n  if (typeof square !== 'string' || square.length !== 2) return false;\n  \n  const file = square[0];\n  const rank = square[1];\n  \n  return file >= 'a' && file <= 'h' && rank >= '1' && rank <= '8';\n}\n","/**\n * Validation utilities for Chessboard.js\n * @module utils/validation\n * @since 2.0.0\n */\n\n// Import and re-export from coordinates utility\nimport { isValidSquare as validateSquare } from './coordinates.js';\nexport { validateSquare as isValidSquare };\n\n// Local alias for internal use\nconst isValidSquare = validateSquare;\n\n/**\n * Validation cache for performance optimization\n * @type {Map}\n */\nconst validationCache = new Map();\nconst CACHE_MAX_SIZE = 1000;\n\n/**\n * Caches validation result\n * @param {string} key - Cache key\n * @param {boolean} result - Validation result\n */\nfunction cacheResult(key, result) {\n  if (validationCache.size >= CACHE_MAX_SIZE) {\n    const firstKey = validationCache.keys().next().value;\n    validationCache.delete(firstKey);\n  }\n  validationCache.set(key, result);\n}\n\n/**\n * Validate piece notation with caching\n * @param {string} piece - Piece notation (e.g., 'wP', 'bK')\n * @returns {boolean} True if piece notation is valid\n */\nexport function isValidPiece(piece) {\n  if (typeof piece !== 'string' || piece.length !== 2) {\n    return false;\n  }\n\n  const cacheKey = `piece:${piece}`;\n  if (validationCache.has(cacheKey)) {\n    return validationCache.get(cacheKey);\n  }\n\n  const color = piece[0];\n  const type = piece[1];\n\n  const isValid = ['w', 'b'].includes(color) && ['P', 'R', 'N', 'B', 'Q', 'K'].includes(type);\n\n  cacheResult(cacheKey, isValid);\n  return isValid;\n}\n\n/**\n * Validate position object with comprehensive checks\n * @param {Object} position - Position object with square-piece mappings\n * @returns {boolean} True if position is valid\n */\nexport function isValidPosition(position) {\n  if (typeof position !== 'object' || position === null) {\n    return false;\n  }\n\n  // Check for circular references\n  try {\n    JSON.stringify(position);\n  } catch {\n    return false;\n  }\n\n  // Validate each square-piece mapping\n  for (const [square, piece] of Object.entries(position)) {\n    if (!isValidSquare(square) || !isValidPiece(piece)) {\n      return false;\n    }\n  }\n\n  // Optional: Check for chess-specific rules\n  return isValidChessPosition(position);\n}\n\n/**\n * Validates chess-specific position rules\n * @param {Object} position - Position object\n * @returns {boolean} True if position follows chess rules\n */\nfunction isValidChessPosition(position) {\n  const pieces = Object.values(position);\n\n  // Count kings\n  const whiteKings = pieces.filter((p) => p === 'wK').length;\n  const blackKings = pieces.filter((p) => p === 'bK').length;\n\n  // Must have exactly one king of each color\n  if (whiteKings !== 1 || blackKings !== 1) {\n    return false;\n  }\n\n  // Count pawns (max 8 per side)\n  const whitePawns = pieces.filter((p) => p === 'wP').length;\n  const blackPawns = pieces.filter((p) => p === 'bP').length;\n\n  if (whitePawns > 8 || blackPawns > 8) {\n    return false;\n  }\n\n  // Check pawn placement (not on first or last rank)\n  for (const [square, piece] of Object.entries(position)) {\n    if (piece === 'wP' || piece === 'bP') {\n      const rank = square[1];\n      if (rank === '1' || rank === '8') {\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\n\n/**\n * Validate FEN string format with comprehensive checks\n * @param {string} fen - FEN string\n * @returns {Object} Validation result with success and error properties\n */\nexport function validateFenFormat(fen) {\n  if (typeof fen !== 'string') {\n    return { success: false, error: 'FEN must be a string' };\n  }\n\n  const cacheKey = `fen:${fen}`;\n  if (validationCache.has(cacheKey)) {\n    return validationCache.get(cacheKey);\n  }\n\n  const parts = fen.trim().split(' ');\n  if (parts.length !== 6) {\n    const result = { success: false, error: 'FEN must have 6 parts separated by spaces' };\n    cacheResult(cacheKey, result);\n    return result;\n  }\n\n  // Validate piece placement\n  const ranks = parts[0].split('/');\n  if (ranks.length !== 8) {\n    const result = { success: false, error: 'Piece placement must have 8 ranks' };\n    cacheResult(cacheKey, result);\n    return result;\n  }\n\n  // Validate each rank\n  for (let i = 0; i < ranks.length; i++) {\n    const rankResult = validateRank(ranks[i]);\n    if (!rankResult.success) {\n      const result = { success: false, error: `Invalid rank ${i + 1}: ${rankResult.error}` };\n      cacheResult(cacheKey, result);\n      return result;\n    }\n  }\n\n  // Validate active color\n  if (!['w', 'b'].includes(parts[1])) {\n    const result = { success: false, error: 'Active color must be \"w\" or \"b\"' };\n    cacheResult(cacheKey, result);\n    return result;\n  }\n\n  // Validate castling availability\n  if (!/^[KQkq-]*$/.test(parts[2])) {\n    const result = { success: false, error: 'Invalid castling availability' };\n    cacheResult(cacheKey, result);\n    return result;\n  }\n\n  // Validate en passant target square\n  if (parts[3] !== '-' && !isValidSquare(parts[3])) {\n    const result = { success: false, error: 'Invalid en passant target square' };\n    cacheResult(cacheKey, result);\n    return result;\n  }\n\n  // Validate halfmove clock\n  const halfmove = parseInt(parts[4], 10);\n  if (isNaN(halfmove) || halfmove < 0) {\n    const result = { success: false, error: 'Invalid halfmove clock' };\n    cacheResult(cacheKey, result);\n    return result;\n  }\n\n  // Validate fullmove number\n  const fullmove = parseInt(parts[5], 10);\n  if (isNaN(fullmove) || fullmove < 1) {\n    const result = { success: false, error: 'Invalid fullmove number' };\n    cacheResult(cacheKey, result);\n    return result;\n  }\n\n  const result = { success: true };\n  cacheResult(cacheKey, result);\n  return result;\n}\n\n/**\n * Validates a single rank in FEN notation\n * @param {string} rank - Rank string\n * @returns {Object} Validation result\n */\nfunction validateRank(rank) {\n  if (typeof rank !== 'string') {\n    return { success: false, error: 'Rank must be a string' };\n  }\n\n  let squareCount = 0;\n\n  for (let i = 0; i < rank.length; i++) {\n    const char = rank[i];\n\n    if (/[1-8]/.test(char)) {\n      squareCount += parseInt(char, 10);\n    } else if (/[prnbqkPRNBQK]/.test(char)) {\n      squareCount += 1;\n    } else {\n      return { success: false, error: `Invalid character \"${char}\" in rank` };\n    }\n  }\n\n  if (squareCount !== 8) {\n    return { success: false, error: `Rank must represent exactly 8 squares, got ${squareCount}` };\n  }\n\n  return { success: true };\n}\n\n/**\n * Validate move notation in various formats\n * @param {string} move - Move string (e.g., 'e2e4', 'Nf3', 'O-O')\n * @returns {Object} Validation result\n */\nexport function validateMove(move) {\n  if (typeof move !== 'string') {\n    return { success: false, error: 'Move must be a string' };\n  }\n\n  const trimmed = move.trim();\n  if (trimmed.length === 0) {\n    return { success: false, error: 'Move cannot be empty' };\n  }\n\n  // Check for castling\n  if (trimmed === 'O-O' || trimmed === 'O-O-O') {\n    return { success: true, type: 'castling' };\n  }\n\n  // Check for coordinate notation (e.g., e2e4, e7e8q)\n  if (/^[a-h][1-8][a-h][1-8][qrnbQRNB]?$/.test(trimmed)) {\n    return { success: true, type: 'coordinate' };\n  }\n\n  // Check for algebraic notation (e.g., Nf3, Qxd5, e4)\n  if (/^[PRNBQK]?[a-h]?[1-8]?x?[a-h][1-8](\\+|#)?$/.test(trimmed)) {\n    return { success: true, type: 'algebraic' };\n  }\n\n  return { success: false, error: 'Invalid move format' };\n}\n\n/**\n * Validate configuration object with detailed error reporting\n * @param {Object} config - Configuration object\n * @returns {Object} Validation result with success and errors array\n */\nexport function validateConfig(config) {\n  const errors = [];\n\n  if (!config || typeof config !== 'object') {\n    return { success: false, errors: ['Configuration must be an object'] };\n  }\n\n  // Required fields\n  if (!config.id && !config.id_div) {\n    errors.push('Configuration must include \"id\" or \"id_div\"');\n  }\n\n  // Optional field validation\n  if (config.orientation && !['white', 'black', 'w', 'b'].includes(config.orientation)) {\n    errors.push('Invalid orientation. Must be \"white\", \"black\", \"w\", or \"b\"');\n  }\n\n  if (config.position && config.position !== 'start' && typeof config.position !== 'object') {\n    errors.push('Invalid position. Must be \"start\" or a position object');\n  }\n\n  if (config.position && typeof config.position === 'object' && !isValidPosition(config.position)) {\n    errors.push('Invalid position object format');\n  }\n\n  if (config.size && !isValidSize(config.size)) {\n    errors.push('Invalid size. Must be \"auto\", a positive number, or a valid CSS size');\n  }\n\n  if (\n    config.movableColors &&\n    !['white', 'black', 'w', 'b', 'both', 'none'].includes(config.movableColors)\n  ) {\n    errors.push('Invalid movableColors. Must be \"white\", \"black\", \"w\", \"b\", \"both\", or \"none\"');\n  }\n\n  if (config.dropOffBoard && !['snapback', 'trash'].includes(config.dropOffBoard)) {\n    errors.push('Invalid dropOffBoard. Must be \"snapback\" or \"trash\"');\n  }\n\n  // Validate callback functions\n  const callbacks = [\n    'onMove',\n    'onMoveEnd',\n    'onChange',\n    'onDragStart',\n    'onDragMove',\n    'onDrop',\n    'onSnapbackEnd',\n  ];\n  for (const callback of callbacks) {\n    if (config[callback] && typeof config[callback] !== 'function') {\n      errors.push(`Invalid ${callback}. Must be a function`);\n    }\n  }\n\n  // Validate color values\n  const colorFields = ['whiteSquare', 'blackSquare', 'highlight', 'hintColor'];\n  for (const field of colorFields) {\n    if (config[field] && !isValidColor(config[field])) {\n      errors.push(`Invalid ${field}. Must be a valid CSS color`);\n    }\n  }\n\n  // Validate animation settings\n  if (config.moveAnimation && !isValidEasing(config.moveAnimation)) {\n    errors.push('Invalid moveAnimation. Must be a valid easing function');\n  }\n\n  if (config.animationStyle && !['sequential', 'simultaneous'].includes(config.animationStyle)) {\n    errors.push('Invalid animationStyle. Must be \"sequential\" or \"simultaneous\"');\n  }\n\n  return {\n    success: errors.length === 0,\n    errors,\n  };\n}\n\n/**\n * Validates size value\n * @param {number|string} size - Size value\n * @returns {boolean} True if valid\n */\nfunction isValidSize(size) {\n  if (size === 'auto') {\n    return true;\n  }\n\n  if (typeof size === 'number') {\n    return size > 0 && size <= 5000; // Reasonable upper limit\n  }\n\n  if (typeof size === 'string') {\n    // Check for CSS size values\n    return /^\\d+(px|em|rem|%|vh|vw)$/.test(size);\n  }\n\n  return false;\n}\n\n/**\n * Validates CSS color value\n * @param {string} color - Color value\n * @returns {boolean} True if valid\n */\nfunction isValidColor(color) {\n  if (typeof color !== 'string') {\n    return false;\n  }\n\n  // Hex colors\n  if (/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(color)) {\n    return true;\n  }\n\n  // RGB/RGBA\n  if (/^rgba?\\(\\s*\\d+\\s*,\\s*\\d+\\s*,\\s*\\d+\\s*(,\\s*[0-1](\\.\\d+)?)?\\s*\\)$/.test(color)) {\n    return true;\n  }\n\n  // HSL/HSLA\n  if (/^hsla?\\(\\s*\\d+\\s*,\\s*\\d+%\\s*,\\s*\\d+%\\s*(,\\s*[0-1](\\.\\d+)?)?\\s*\\)$/.test(color)) {\n    return true;\n  }\n\n  // Named colors (basic set)\n  const namedColors = [\n    'white',\n    'black',\n    'red',\n    'green',\n    'blue',\n    'yellow',\n    'cyan',\n    'magenta',\n    'transparent',\n    'gray',\n    'grey',\n    'brown',\n    'orange',\n    'purple',\n    'pink',\n  ];\n\n  return namedColors.includes(color.toLowerCase());\n}\n\n/**\n * Validates easing function\n * @param {string} easing - Easing function name\n * @returns {boolean} True if valid\n */\nfunction isValidEasing(easing) {\n  const validEasing = ['linear', 'ease', 'ease-in', 'ease-out', 'ease-in-out', 'cubic-bezier'];\n\n  return (\n    validEasing.includes(easing) ||\n    /^cubic-bezier\\(\\s*[\\d.-]+\\s*,\\s*[\\d.-]+\\s*,\\s*[\\d.-]+\\s*,\\s*[\\d.-]+\\s*\\)$/.test(easing)\n  );\n}\n\n/**\n * Batch validates multiple items\n * @param {Array} items - Array of validation items\n * @returns {Array} Array of validation results\n */\nexport function batchValidate(items) {\n  return items.map((item) => {\n    const { type, value } = item;\n\n    switch (type) {\n      case 'piece':\n        return { ...item, valid: isValidPiece(value) };\n      case 'square':\n        return { ...item, valid: isValidSquare(value) };\n      case 'position':\n        return { ...item, valid: isValidPosition(value) };\n      case 'fen': {\n        const fenResult = validateFenFormat(value);\n        return { ...item, valid: fenResult.success, error: fenResult.error };\n      }\n      case 'move': {\n        const moveResult = validateMove(value);\n        return { ...item, valid: moveResult.success, error: moveResult.error };\n      }\n      case 'config': {\n        const configResult = validateConfig(value);\n        return { ...item, valid: configResult.success, errors: configResult.errors };\n      }\n      default:\n        return { ...item, valid: false, error: 'Unknown validation type' };\n    }\n  });\n}\n\n/**\n * Clears validation cache\n */\nexport function clearValidationCache() {\n  validationCache.clear();\n}\n\n/**\n * Gets validation cache statistics\n * @returns {Object} Cache statistics\n */\nexport function getValidationCacheStats() {\n  return {\n    size: validationCache.size,\n    maxSize: CACHE_MAX_SIZE,\n  };\n}\n","/**\n * Animation utilities for Chessboard.js\n */\n\n/**\n * Get the CSS transition duration in milliseconds\n * @param {string|number} time - Time value ('fast', 'slow', or number in ms)\n * @returns {number} Duration in milliseconds\n */\nexport function parseTime(time) {\n  if (typeof time === 'number') return time;\n  \n  switch (time) {\n    case 'fast': return 150;\n    case 'slow': return 500;\n    default: return 200;\n  }\n}\n\n/**\n * Get the CSS transition function\n * @param {string} animation - Animation type ('ease', 'linear', etc.)\n * @returns {string} CSS transition function\n */\nexport function parseAnimation(animation) {\n  const validAnimations = ['ease', 'ease-in', 'ease-out', 'ease-in-out', 'linear'];\n  return validAnimations.includes(animation) ? animation : 'ease';\n}\n\n/**\n * Create a promise that resolves after animation completion\n * @param {number} duration - Duration in milliseconds\n * @returns {Promise} Promise that resolves after the duration\n */\nexport function animationPromise(duration) {\n  return new Promise(resolve => setTimeout(resolve, duration));\n}\n","/**\n * Base Engine - Abstract class for all chess engine adapters\n * @module engines/BaseEngine\n * @since 3.1.0\n */\n\n/**\n * @typedef {Object} EngineInfo\n * @property {string} name - Engine name\n * @property {string} author - Engine author\n * @property {string} version - Engine version\n * @property {string[]} options - Supported options\n */\n\n/**\n * @typedef {Object} EngineAnalysis\n * @property {string} bestMove - Best move in UCI format (e.g., \"e2e4\")\n * @property {string} [ponder] - Ponder move\n * @property {number} score - Centipawn score or mate score\n * @property {boolean} isMate - Whether score is mate in X\n * @property {number} depth - Search depth reached\n * @property {number} nodes - Nodes searched\n * @property {number} time - Time spent in ms\n * @property {string[]} pv - Principal variation\n * @property {number} nps - Nodes per second\n */\n\n/**\n * @typedef {Object} EngineConfig\n * @property {number} [depth=20] - Search depth\n * @property {number} [moveTime=1000] - Time per move in ms\n * @property {number} [threads=1] - Number of threads\n * @property {number} [hashSize=16] - Hash table size in MB\n * @property {boolean} [useNNUE=true] - Use NNUE evaluation\n */\n\n/**\n * Abstract base class for chess engine adapters\n * @abstract\n */\nexport class BaseEngine {\n  /**\n   * @param {EngineConfig} [config={}] - Engine configuration\n   */\n  constructor(config = {}) {\n    if (new.target === BaseEngine) {\n      throw new Error('BaseEngine is abstract and cannot be instantiated directly');\n    }\n\n    this.config = {\n      depth: 20,\n      moveTime: 1000,\n      threads: 1,\n      hashSize: 16,\n      useNNUE: true,\n      ...config,\n    };\n\n    this.isReady = false;\n    this.isSearching = false;\n    this.info = null;\n    this.listeners = new Map();\n    this.currentAnalysis = null;\n  }\n\n  /**\n   * Initialize the engine\n   * @abstract\n   * @returns {Promise<boolean>}\n   */\n  async init() {\n    throw new Error('init() must be implemented by subclass');\n  }\n\n  /**\n   * Shutdown the engine\n   * @abstract\n   * @returns {Promise<void>}\n   */\n  async quit() {\n    throw new Error('quit() must be implemented by subclass');\n  }\n\n  /**\n   * Check if engine is ready\n   * @returns {boolean}\n   */\n  ready() {\n    return this.isReady;\n  }\n\n  /**\n   * Set position from FEN or moves\n   * @abstract\n   * @param {string} [_fen='startpos'] - FEN string or 'startpos'\n   * @param {string[]} [_moves=[]] - Moves to apply\n   * @returns {Promise<void>}\n   */\n  async setPosition(_fen = 'startpos', _moves = []) {\n    throw new Error('setPosition() must be implemented by subclass');\n  }\n\n  /**\n   * Start analysis/search\n   * @abstract\n   * @param {Object} [_options={}] - Search options\n   * @param {number} [_options.depth] - Search depth\n   * @param {number} [_options.moveTime] - Time per move in ms\n   * @param {number} [_options.wtime] - White time remaining\n   * @param {number} [_options.btime] - Black time remaining\n   * @param {number} [_options.winc] - White increment\n   * @param {number} [_options.binc] - Black increment\n   * @param {boolean} [_options.infinite=false] - Infinite analysis\n   * @returns {Promise<EngineAnalysis>}\n   */\n  async go(_options = {}) {\n    throw new Error('go() must be implemented by subclass');\n  }\n\n  /**\n   * Stop current analysis\n   * @abstract\n   * @returns {Promise<void>}\n   */\n  async stop() {\n    throw new Error('stop() must be implemented by subclass');\n  }\n\n  /**\n   * Set engine option\n   * @abstract\n   * @param {string} _name - Option name\n   * @param {string|number|boolean} _value - Option value\n   * @returns {Promise<void>}\n   */\n  async setOption(_name, _value) {\n    throw new Error('setOption() must be implemented by subclass');\n  }\n\n  /**\n   * Get engine info\n   * @returns {EngineInfo|null}\n   */\n  getInfo() {\n    return this.info;\n  }\n\n  /**\n   * Get best move for current position\n   * @param {string} fen - Position FEN\n   * @param {Object} [options={}] - Search options\n   * @returns {Promise<string>} - Best move in UCI format\n   */\n  async getBestMove(fen, options = {}) {\n    await this.setPosition(fen);\n    const analysis = await this.go({\n      depth: options.depth || this.config.depth,\n      moveTime: options.moveTime || this.config.moveTime,\n      ...options,\n    });\n    return analysis.bestMove;\n  }\n\n  /**\n   * Analyze position\n   * @param {string} fen - Position FEN\n   * @param {Object} [options={}] - Analysis options\n   * @returns {Promise<EngineAnalysis>}\n   */\n  async analyze(fen, options = {}) {\n    await this.setPosition(fen);\n    return this.go({\n      depth: options.depth || this.config.depth,\n      ...options,\n    });\n  }\n\n  /**\n   * Start infinite analysis\n   * @param {string} fen - Position FEN\n   * @returns {Promise<void>}\n   */\n  async startInfiniteAnalysis(fen) {\n    await this.setPosition(fen);\n    this.go({ infinite: true });\n  }\n\n  /**\n   * Add event listener\n   * @param {string} event - Event name ('info', 'bestmove', 'error')\n   * @param {Function} callback - Callback function\n   */\n  on(event, callback) {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, []);\n    }\n    this.listeners.get(event).push(callback);\n  }\n\n  /**\n   * Remove event listener\n   * @param {string} event - Event name\n   * @param {Function} callback - Callback function\n   */\n  off(event, callback) {\n    if (!this.listeners.has(event)) return;\n    const callbacks = this.listeners.get(event);\n    const index = callbacks.indexOf(callback);\n    if (index > -1) {\n      callbacks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Emit event\n   * @protected\n   * @param {string} event - Event name\n   * @param {*} data - Event data\n   */\n  _emit(event, data) {\n    if (!this.listeners.has(event)) return;\n    this.listeners.get(event).forEach((callback) => {\n      try {\n        callback(data);\n      } catch (err) {\n        console.error(`Error in engine event listener for ${event}:`, err);\n      }\n    });\n  }\n\n  /**\n   * Parse UCI info line\n   * @protected\n   * @param {string} line - UCI info line\n   * @returns {Object}\n   */\n  _parseInfo(line) {\n    const info = {};\n    const tokens = line.split(' ');\n    let i = 0;\n\n    while (i < tokens.length) {\n      const token = tokens[i];\n\n      switch (token) {\n        case 'depth':\n          info.depth = parseInt(tokens[++i], 10);\n          break;\n        case 'seldepth':\n          info.seldepth = parseInt(tokens[++i], 10);\n          break;\n        case 'multipv':\n          info.multipv = parseInt(tokens[++i], 10);\n          break;\n        case 'score':\n          if (tokens[i + 1] === 'cp') {\n            info.score = parseInt(tokens[i + 2], 10);\n            info.isMate = false;\n            i += 2;\n          } else if (tokens[i + 1] === 'mate') {\n            info.score = parseInt(tokens[i + 2], 10);\n            info.isMate = true;\n            i += 2;\n          }\n          break;\n        case 'nodes':\n          info.nodes = parseInt(tokens[++i], 10);\n          break;\n        case 'nps':\n          info.nps = parseInt(tokens[++i], 10);\n          break;\n        case 'time':\n          info.time = parseInt(tokens[++i], 10);\n          break;\n        case 'pv':\n          info.pv = tokens.slice(i + 1);\n          i = tokens.length;\n          break;\n        case 'hashfull':\n          info.hashfull = parseInt(tokens[++i], 10);\n          break;\n        case 'tbhits':\n          info.tbhits = parseInt(tokens[++i], 10);\n          break;\n        case 'currmove':\n          info.currmove = tokens[++i];\n          break;\n        case 'currmovenumber':\n          info.currmovenumber = parseInt(tokens[++i], 10);\n          break;\n        default:\n          break;\n      }\n      i++;\n    }\n\n    return info;\n  }\n\n  /**\n   * Parse bestmove line\n   * @protected\n   * @param {string} line - UCI bestmove line\n   * @returns {Object}\n   */\n  _parseBestMove(line) {\n    const tokens = line.split(' ');\n    const result = {\n      bestMove: tokens[1] || null,\n      ponder: null,\n    };\n\n    const ponderIndex = tokens.indexOf('ponder');\n    if (ponderIndex !== -1 && tokens[ponderIndex + 1]) {\n      result.ponder = tokens[ponderIndex + 1];\n    }\n\n    return result;\n  }\n\n  /**\n   * Convert UCI move to algebraic notation helper\n   * @param {string} uciMove - Move in UCI format (e.g., \"e2e4\")\n   * @returns {Object} - {from, to, promotion}\n   */\n  parseUCIMove(uciMove) {\n    if (!uciMove || uciMove.length < 4) return null;\n\n    return {\n      from: uciMove.slice(0, 2),\n      to: uciMove.slice(2, 4),\n      promotion: uciMove.length > 4 ? uciMove[4] : null,\n    };\n  }\n}\n\nexport default BaseEngine;\n","/**\n * Stockfish Engine - Browser-based Stockfish.js adapter\n * @module engines/StockfishEngine\n * @since 3.1.0\n *\n * Uses Stockfish.js (WebAssembly) for browser-based analysis.\n * Supports both single-threaded and multi-threaded (SharedArrayBuffer) modes.\n *\n * @example\n * const engine = new StockfishEngine();\n * await engine.init();\n * const bestMove = await engine.getBestMove('rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1');\n * console.log(bestMove); // \"e2e4\"\n */\n\nimport { BaseEngine } from './BaseEngine.js';\n\n/**\n * @typedef {Object} StockfishConfig\n * @extends EngineConfig\n * @property {string} [wasmPath] - Path to Stockfish WASM files\n * @property {boolean} [useNNUE=true] - Use NNUE evaluation\n * @property {string} [nnuePath] - Path to NNUE network file\n */\n\n/**\n * Browser-based Stockfish.js engine adapter\n */\nexport class StockfishEngine extends BaseEngine {\n  /**\n   * CDN URLs for Stockfish.js\n   */\n  static CDN_URLS = {\n    // Stockfish.js official releases\n    stockfish16: 'https://cdn.jsdelivr.net/npm/stockfish.js@16/stockfish.js',\n    stockfish15: 'https://cdn.jsdelivr.net/npm/stockfish.js@15/stockfish.js',\n    stockfish14: 'https://cdn.jsdelivr.net/npm/stockfish@14/stockfish.js',\n    // Alternative CDNs\n    unpkg: 'https://unpkg.com/stockfish.js/stockfish.js',\n  };\n\n  /**\n   * @param {StockfishConfig} [config={}] - Engine configuration\n   */\n  constructor(config = {}) {\n    super({\n      threads: 1,\n      hashSize: 16,\n      useNNUE: true,\n      ...config,\n    });\n\n    this.worker = null;\n    this.messageQueue = [];\n    this.pendingCommand = null;\n    this.wasmPath = config.wasmPath || null;\n    this.nnuePath = config.nnuePath || null;\n  }\n\n  /**\n   * Check if SharedArrayBuffer is available (needed for multi-threading)\n   * @returns {boolean}\n   */\n  static supportsThreads() {\n    try {\n      return typeof SharedArrayBuffer !== 'undefined';\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Check if WebAssembly is supported\n   * @returns {boolean}\n   */\n  static supportsWasm() {\n    try {\n      return typeof WebAssembly === 'object' && typeof WebAssembly.instantiate === 'function';\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Initialize the Stockfish engine\n   * @override\n   * @returns {Promise<boolean>}\n   */\n  async init() {\n    if (this.isReady) return true;\n\n    if (!StockfishEngine.supportsWasm()) {\n      throw new Error('WebAssembly is not supported in this environment');\n    }\n\n    try {\n      // Create worker\n      const workerUrl = this.wasmPath || StockfishEngine.CDN_URLS.stockfish16;\n      this.worker = new Worker(workerUrl);\n\n      // Set up message handling\n      this.worker.onmessage = (e) => this._handleMessage(e.data);\n      this.worker.onerror = (e) => this._handleError(e);\n\n      // Initialize UCI\n      await this._sendAndWait('uci', 'uciok');\n\n      // Configure engine options\n      await this._configureEngine();\n\n      // Wait for ready\n      await this._sendAndWait('isready', 'readyok');\n\n      this.isReady = true;\n      this._emit('ready', this.info);\n\n      return true;\n    } catch (error) {\n      this._emit('error', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Initialize from a custom Stockfish instance\n   * @param {Worker|Object} stockfishInstance - Stockfish worker or instance\n   * @returns {Promise<boolean>}\n   */\n  async initFromInstance(stockfishInstance) {\n    if (this.isReady) return true;\n\n    try {\n      if (stockfishInstance instanceof Worker) {\n        this.worker = stockfishInstance;\n        this.worker.onmessage = (e) => this._handleMessage(e.data);\n        this.worker.onerror = (e) => this._handleError(e);\n      } else if (typeof stockfishInstance.postMessage === 'function') {\n        // Duck-typing for custom implementations\n        this.worker = stockfishInstance;\n        if (typeof stockfishInstance.addMessageListener === 'function') {\n          stockfishInstance.addMessageListener((msg) => this._handleMessage(msg));\n        }\n      } else {\n        throw new Error('Invalid Stockfish instance');\n      }\n\n      await this._sendAndWait('uci', 'uciok');\n      await this._configureEngine();\n      await this._sendAndWait('isready', 'readyok');\n\n      this.isReady = true;\n      this._emit('ready', this.info);\n\n      return true;\n    } catch (error) {\n      this._emit('error', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Configure engine options\n   * @private\n   */\n  async _configureEngine() {\n    // Set threads (only if SharedArrayBuffer available)\n    if (StockfishEngine.supportsThreads() && this.config.threads > 1) {\n      await this._send(`setoption name Threads value ${this.config.threads}`);\n    }\n\n    // Set hash size\n    await this._send(`setoption name Hash value ${this.config.hashSize}`);\n\n    // Configure NNUE if available\n    if (this.config.useNNUE) {\n      await this._send('setoption name Use NNUE value true');\n      if (this.nnuePath) {\n        await this._send(`setoption name EvalFile value ${this.nnuePath}`);\n      }\n    }\n  }\n\n  /**\n   * Shutdown the engine\n   * @override\n   * @returns {Promise<void>}\n   */\n  async quit() {\n    if (!this.worker) return;\n\n    try {\n      this._send('quit');\n      this.worker.terminate();\n    } catch {\n      // Ignore errors during shutdown\n    }\n\n    this.worker = null;\n    this.isReady = false;\n    this.isSearching = false;\n    this._emit('quit');\n  }\n\n  /**\n   * Set position\n   * @override\n   * @param {string} [fen='startpos'] - FEN string or 'startpos'\n   * @param {string[]} [moves=[]] - Moves to apply\n   * @returns {Promise<void>}\n   */\n  async setPosition(fen = 'startpos', moves = []) {\n    if (!this.isReady) throw new Error('Engine not ready');\n\n    let command;\n    if (fen === 'startpos') {\n      command = 'position startpos';\n    } else {\n      command = `position fen ${fen}`;\n    }\n\n    if (moves.length > 0) {\n      command += ` moves ${moves.join(' ')}`;\n    }\n\n    await this._send(command);\n  }\n\n  /**\n   * Start search\n   * @override\n   * @param {Object} [options={}] - Search options\n   * @returns {Promise<EngineAnalysis>}\n   */\n  async go(options = {}) {\n    if (!this.isReady) throw new Error('Engine not ready');\n    if (this.isSearching) {\n      await this.stop();\n    }\n\n    this.isSearching = true;\n    this.currentAnalysis = {\n      bestMove: null,\n      ponder: null,\n      score: 0,\n      isMate: false,\n      depth: 0,\n      nodes: 0,\n      time: 0,\n      pv: [],\n      nps: 0,\n    };\n\n    // Build go command\n    let command = 'go';\n\n    if (options.infinite) {\n      command += ' infinite';\n    } else {\n      if (options.depth) {\n        command += ` depth ${options.depth}`;\n      }\n      if (options.moveTime) {\n        command += ` movetime ${options.moveTime}`;\n      }\n      if (options.wtime) {\n        command += ` wtime ${options.wtime}`;\n      }\n      if (options.btime) {\n        command += ` btime ${options.btime}`;\n      }\n      if (options.winc) {\n        command += ` winc ${options.winc}`;\n      }\n      if (options.binc) {\n        command += ` binc ${options.binc}`;\n      }\n      if (options.movestogo) {\n        command += ` movestogo ${options.movestogo}`;\n      }\n      if (options.nodes) {\n        command += ` nodes ${options.nodes}`;\n      }\n      if (options.mate) {\n        command += ` mate ${options.mate}`;\n      }\n    }\n\n    // For infinite analysis, just send command and return\n    if (options.infinite) {\n      this._send(command);\n      return this.currentAnalysis;\n    }\n\n    // Wait for bestmove\n    return new Promise((resolve, reject) => {\n      const timeout = setTimeout(\n        () => {\n          this.isSearching = false;\n          reject(new Error('Search timeout'));\n        },\n        (options.moveTime || this.config.moveTime) + 30000\n      );\n\n      const handler = (data) => {\n        if (data.bestMove) {\n          clearTimeout(timeout);\n          this.off('bestmove', handler);\n          this.isSearching = false;\n          resolve({\n            ...this.currentAnalysis,\n            ...data,\n          });\n        }\n      };\n\n      this.on('bestmove', handler);\n      this._send(command);\n    });\n  }\n\n  /**\n   * Stop current search\n   * @override\n   * @returns {Promise<void>}\n   */\n  async stop() {\n    if (!this.isSearching) return;\n\n    return new Promise((resolve) => {\n      const handler = () => {\n        this.off('bestmove', handler);\n        this.isSearching = false;\n        resolve();\n      };\n\n      // Set timeout in case bestmove never comes\n      const timeout = setTimeout(() => {\n        this.off('bestmove', handler);\n        this.isSearching = false;\n        resolve();\n      }, 1000);\n\n      this.on('bestmove', () => {\n        clearTimeout(timeout);\n        handler();\n      });\n\n      this._send('stop');\n    });\n  }\n\n  /**\n   * Set engine option\n   * @override\n   * @param {string} name - Option name\n   * @param {string|number|boolean} value - Option value\n   * @returns {Promise<void>}\n   */\n  async setOption(name, value) {\n    if (!this.isReady) throw new Error('Engine not ready');\n    await this._send(`setoption name ${name} value ${value}`);\n    await this._sendAndWait('isready', 'readyok');\n  }\n\n  /**\n   * Get evaluation of current position\n   * @returns {Promise<Object>}\n   */\n  async eval() {\n    if (!this.isReady) throw new Error('Engine not ready');\n\n    return new Promise((resolve) => {\n      let output = '';\n\n      const handler = (msg) => {\n        if (typeof msg === 'string') {\n          output += `${msg}\\n`;\n        }\n      };\n\n      this.on('message', handler);\n\n      setTimeout(() => {\n        this.off('message', handler);\n        resolve(this._parseEval(output));\n      }, 100);\n\n      this._send('eval');\n    });\n  }\n\n  /**\n   * Send command to engine\n   * @private\n   * @param {string} command - UCI command\n   */\n  _send(command) {\n    if (!this.worker) return;\n\n    this._emit('command', command);\n    this.worker.postMessage(command);\n  }\n\n  /**\n   * Send command and wait for response\n   * @private\n   * @param {string} command - UCI command\n   * @param {string} expectedResponse - Expected response to wait for\n   * @returns {Promise<void>}\n   */\n  _sendAndWait(command, expectedResponse) {\n    return new Promise((resolve, reject) => {\n      const timeout = setTimeout(() => {\n        reject(new Error(`Timeout waiting for ${expectedResponse}`));\n      }, 10000);\n\n      const handler = (msg) => {\n        if (typeof msg === 'string' && msg.includes(expectedResponse)) {\n          clearTimeout(timeout);\n          this.off('message', handler);\n          resolve();\n        }\n      };\n\n      this.on('message', handler);\n      this._send(command);\n    });\n  }\n\n  /**\n   * Handle engine message\n   * @private\n   * @param {string} data - Message from engine\n   */\n  _handleMessage(data) {\n    if (typeof data !== 'string') return;\n\n    this._emit('message', data);\n\n    // Parse different message types\n    if (data.startsWith('id ')) {\n      this._parseId(data);\n    } else if (data.startsWith('info ')) {\n      const info = this._parseInfo(data.slice(5));\n      this._updateAnalysis(info);\n      this._emit('info', info);\n    } else if (data.startsWith('bestmove ')) {\n      const result = this._parseBestMove(data);\n      this._emit('bestmove', result);\n    } else if (data.startsWith('option ')) {\n      this._parseOption(data);\n    }\n  }\n\n  /**\n   * Handle engine error\n   * @private\n   * @param {Error} error - Error object\n   */\n  _handleError(error) {\n    this._emit('error', error);\n  }\n\n  /**\n   * Parse engine ID\n   * @private\n   * @param {string} line - ID line\n   */\n  _parseId(line) {\n    if (!this.info) {\n      this.info = { name: '', author: '', version: '', options: [] };\n    }\n\n    if (line.startsWith('id name ')) {\n      this.info.name = line.slice(8);\n      // Extract version from name\n      const versionMatch = this.info.name.match(/(\\d+(?:\\.\\d+)*)/);\n      if (versionMatch) {\n        this.info.version = versionMatch[1];\n      }\n    } else if (line.startsWith('id author ')) {\n      this.info.author = line.slice(10);\n    }\n  }\n\n  /**\n   * Parse engine option\n   * @private\n   * @param {string} line - Option line\n   */\n  _parseOption(line) {\n    if (!this.info) {\n      this.info = { name: '', author: '', version: '', options: [] };\n    }\n\n    const nameMatch = line.match(/option name ([^ ]+)/);\n    if (nameMatch) {\n      this.info.options.push(nameMatch[1]);\n    }\n  }\n\n  /**\n   * Update current analysis with new info\n   * @private\n   * @param {Object} info - Parsed info\n   */\n  _updateAnalysis(info) {\n    if (!this.currentAnalysis) return;\n\n    if (info.depth !== undefined) this.currentAnalysis.depth = info.depth;\n    if (info.score !== undefined) {\n      this.currentAnalysis.score = info.score;\n      this.currentAnalysis.isMate = info.isMate || false;\n    }\n    if (info.nodes !== undefined) this.currentAnalysis.nodes = info.nodes;\n    if (info.time !== undefined) this.currentAnalysis.time = info.time;\n    if (info.nps !== undefined) this.currentAnalysis.nps = info.nps;\n    if (info.pv !== undefined) this.currentAnalysis.pv = info.pv;\n  }\n\n  /**\n   * Parse eval output\n   * @private\n   * @param {string} output - Eval output\n   * @returns {Object}\n   */\n  _parseEval(output) {\n    // Simple parsing of eval output\n    const lines = output.split('\\n');\n    const result = { raw: output };\n\n    for (const line of lines) {\n      if (line.includes('Final evaluation')) {\n        const match = line.match(/([-+]?\\d+\\.?\\d*)/);\n        if (match) {\n          result.evaluation = parseFloat(match[1]);\n        }\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Get current analysis state\n   * @returns {EngineAnalysis|null}\n   */\n  getCurrentAnalysis() {\n    return this.currentAnalysis;\n  }\n\n  /**\n   * New game - reset engine state\n   * @returns {Promise<void>}\n   */\n  async newGame() {\n    if (!this.isReady) throw new Error('Engine not ready');\n    await this._send('ucinewgame');\n    await this._sendAndWait('isready', 'readyok');\n  }\n}\n\nexport default StockfishEngine;\n","/**\n * UCI Engine - Universal Chess Interface protocol wrapper\n * @module engines/UCIEngine\n * @since 3.1.0\n *\n * Provides a base for connecting to UCI-compatible engines via:\n * - WebSocket connections\n * - HTTP API endpoints\n * - Custom transports\n *\n * @example\n * const engine = new UCIEngine({\n *   transport: 'websocket',\n *   url: 'ws://localhost:8080/stockfish'\n * });\n * await engine.init();\n */\n\nimport { BaseEngine } from './BaseEngine.js';\n\n/**\n * @typedef {Object} UCIConfig\n * @extends EngineConfig\n * @property {'websocket'|'http'|'custom'} [transport='websocket'] - Transport type\n * @property {string} url - Engine endpoint URL\n * @property {Function} [customSend] - Custom send function for 'custom' transport\n * @property {Function} [customReceive] - Custom receive setup for 'custom' transport\n * @property {number} [reconnectAttempts=3] - Number of reconnection attempts\n * @property {number} [reconnectDelay=1000] - Delay between reconnects in ms\n */\n\n/**\n * UCI engine connection via WebSocket or HTTP\n */\nexport class UCIEngine extends BaseEngine {\n  /**\n   * @param {UCIConfig} config - Engine configuration\n   */\n  constructor(config) {\n    if (!config.url && config.transport !== 'custom') {\n      throw new Error('URL is required for UCI engine connection');\n    }\n\n    super(config);\n\n    this.transport = config.transport || 'websocket';\n    this.url = config.url;\n    this.customSend = config.customSend;\n    this.customReceive = config.customReceive;\n    this.reconnectAttempts = config.reconnectAttempts || 3;\n    this.reconnectDelay = config.reconnectDelay || 1000;\n\n    this.connection = null;\n    this.messageBuffer = '';\n    this.pendingPromises = [];\n  }\n\n  /**\n   * Initialize the engine connection\n   * @override\n   * @returns {Promise<boolean>}\n   */\n  async init() {\n    if (this.isReady) return true;\n\n    try {\n      await this._connect();\n\n      // UCI initialization\n      await this._sendAndWait('uci', 'uciok');\n      await this._configureEngine();\n      await this._sendAndWait('isready', 'readyok');\n\n      this.isReady = true;\n      this._emit('ready', this.info);\n\n      return true;\n    } catch (error) {\n      this._emit('error', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Connect to the engine\n   * @private\n   * @returns {Promise<void>}\n   */\n  async _connect() {\n    switch (this.transport) {\n      case 'websocket':\n        await this._connectWebSocket();\n        break;\n      case 'http':\n        // HTTP doesn't need persistent connection\n        this.connection = { type: 'http' };\n        break;\n      case 'custom':\n        if (this.customReceive) {\n          this.customReceive((msg) => this._handleMessage(msg));\n        }\n        this.connection = { type: 'custom' };\n        break;\n      default:\n        throw new Error(`Unknown transport: ${this.transport}`);\n    }\n  }\n\n  /**\n   * Connect via WebSocket\n   * @private\n   * @returns {Promise<void>}\n   */\n  _connectWebSocket() {\n    return new Promise((resolve, reject) => {\n      let attempts = 0;\n\n      const connect = () => {\n        try {\n          this.connection = new WebSocket(this.url);\n\n          this.connection.onopen = () => {\n            this._emit('connected');\n            resolve();\n          };\n\n          this.connection.onmessage = (event) => {\n            this._handleMessage(event.data);\n          };\n\n          this.connection.onerror = (error) => {\n            this._emit('error', error);\n          };\n\n          this.connection.onclose = () => {\n            this._emit('disconnected');\n            this.isReady = false;\n\n            // Attempt reconnection\n            if (attempts < this.reconnectAttempts) {\n              attempts++;\n              setTimeout(connect, this.reconnectDelay * attempts);\n            }\n          };\n        } catch (error) {\n          if (attempts < this.reconnectAttempts) {\n            attempts++;\n            setTimeout(connect, this.reconnectDelay * attempts);\n          } else {\n            reject(error);\n          }\n        }\n      };\n\n      connect();\n    });\n  }\n\n  /**\n   * Shutdown the engine\n   * @override\n   * @returns {Promise<void>}\n   */\n  async quit() {\n    if (!this.connection) return;\n\n    try {\n      await this._send('quit');\n\n      if (this.transport === 'websocket' && this.connection instanceof WebSocket) {\n        this.connection.close();\n      }\n    } catch {\n      // Ignore errors during shutdown\n    }\n\n    this.connection = null;\n    this.isReady = false;\n    this.isSearching = false;\n    this._emit('quit');\n  }\n\n  /**\n   * Set position\n   * @override\n   * @param {string} [fen='startpos'] - FEN string or 'startpos'\n   * @param {string[]} [moves=[]] - Moves to apply\n   * @returns {Promise<void>}\n   */\n  async setPosition(fen = 'startpos', moves = []) {\n    if (!this.isReady) throw new Error('Engine not ready');\n\n    let command;\n    if (fen === 'startpos') {\n      command = 'position startpos';\n    } else {\n      command = `position fen ${fen}`;\n    }\n\n    if (moves.length > 0) {\n      command += ` moves ${moves.join(' ')}`;\n    }\n\n    await this._send(command);\n  }\n\n  /**\n   * Start search\n   * @override\n   * @param {Object} [options={}] - Search options\n   * @returns {Promise<EngineAnalysis>}\n   */\n  async go(options = {}) {\n    if (!this.isReady) throw new Error('Engine not ready');\n    if (this.isSearching) {\n      await this.stop();\n    }\n\n    this.isSearching = true;\n    this.currentAnalysis = {\n      bestMove: null,\n      ponder: null,\n      score: 0,\n      isMate: false,\n      depth: 0,\n      nodes: 0,\n      time: 0,\n      pv: [],\n      nps: 0,\n    };\n\n    // Build go command\n    let command = 'go';\n\n    if (options.infinite) {\n      command += ' infinite';\n      this._send(command);\n      return this.currentAnalysis;\n    }\n\n    if (options.depth) command += ` depth ${options.depth}`;\n    if (options.moveTime) command += ` movetime ${options.moveTime}`;\n    if (options.wtime) command += ` wtime ${options.wtime}`;\n    if (options.btime) command += ` btime ${options.btime}`;\n    if (options.winc) command += ` winc ${options.winc}`;\n    if (options.binc) command += ` binc ${options.binc}`;\n\n    return new Promise((resolve, reject) => {\n      const timeout = setTimeout(\n        () => {\n          this.isSearching = false;\n          reject(new Error('Search timeout'));\n        },\n        (options.moveTime || this.config.moveTime) + 30000\n      );\n\n      const handler = (data) => {\n        if (data.bestMove) {\n          clearTimeout(timeout);\n          this.off('bestmove', handler);\n          this.isSearching = false;\n          resolve({\n            ...this.currentAnalysis,\n            ...data,\n          });\n        }\n      };\n\n      this.on('bestmove', handler);\n      this._send(command);\n    });\n  }\n\n  /**\n   * Stop current search\n   * @override\n   * @returns {Promise<void>}\n   */\n  async stop() {\n    if (!this.isSearching) return;\n\n    return new Promise((resolve) => {\n      const timeout = setTimeout(() => {\n        this.isSearching = false;\n        resolve();\n      }, 1000);\n\n      const handler = () => {\n        clearTimeout(timeout);\n        this.off('bestmove', handler);\n        this.isSearching = false;\n        resolve();\n      };\n\n      this.on('bestmove', handler);\n      this._send('stop');\n    });\n  }\n\n  /**\n   * Set engine option\n   * @override\n   * @param {string} name - Option name\n   * @param {string|number|boolean} value - Option value\n   * @returns {Promise<void>}\n   */\n  async setOption(name, value) {\n    if (!this.isReady) throw new Error('Engine not ready');\n    await this._send(`setoption name ${name} value ${value}`);\n    await this._sendAndWait('isready', 'readyok');\n  }\n\n  /**\n   * Configure engine options\n   * @private\n   */\n  async _configureEngine() {\n    if (this.config.threads > 1) {\n      await this._send(`setoption name Threads value ${this.config.threads}`);\n    }\n    await this._send(`setoption name Hash value ${this.config.hashSize}`);\n  }\n\n  /**\n   * Send command to engine\n   * @private\n   * @param {string} command - UCI command\n   * @returns {Promise<void>}\n   */\n  async _send(command) {\n    this._emit('command', command);\n\n    switch (this.transport) {\n      case 'websocket':\n        if (this.connection && this.connection.readyState === WebSocket.OPEN) {\n          this.connection.send(command);\n        }\n        break;\n      case 'http':\n        await this._sendHttp(command);\n        break;\n      case 'custom':\n        if (this.customSend) {\n          await this.customSend(command);\n        }\n        break;\n    }\n  }\n\n  /**\n   * Send command via HTTP\n   * @private\n   * @param {string} command - UCI command\n   * @returns {Promise<string>}\n   */\n  async _sendHttp(command) {\n    const response = await fetch(this.url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'text/plain',\n      },\n      body: command,\n    });\n\n    const data = await response.text();\n\n    // Process response lines\n    const lines = data.split('\\n');\n    for (const line of lines) {\n      if (line.trim()) {\n        this._handleMessage(line);\n      }\n    }\n\n    return data;\n  }\n\n  /**\n   * Send command and wait for response\n   * @private\n   * @param {string} command - UCI command\n   * @param {string} expectedResponse - Expected response to wait for\n   * @returns {Promise<void>}\n   */\n  _sendAndWait(command, expectedResponse) {\n    return new Promise((resolve, reject) => {\n      const timeout = setTimeout(() => {\n        reject(new Error(`Timeout waiting for ${expectedResponse}`));\n      }, 10000);\n\n      const handler = (msg) => {\n        if (typeof msg === 'string' && msg.includes(expectedResponse)) {\n          clearTimeout(timeout);\n          this.off('message', handler);\n          resolve();\n        }\n      };\n\n      this.on('message', handler);\n      this._send(command);\n    });\n  }\n\n  /**\n   * Handle incoming message\n   * @private\n   * @param {string} data - Message from engine\n   */\n  _handleMessage(data) {\n    if (typeof data !== 'string') return;\n\n    // Handle multi-line messages\n    this.messageBuffer += data;\n    const lines = this.messageBuffer.split('\\n');\n    this.messageBuffer = lines.pop() || '';\n\n    for (const line of lines) {\n      const trimmed = line.trim();\n      if (!trimmed) continue;\n\n      this._emit('message', trimmed);\n\n      if (trimmed.startsWith('id ')) {\n        this._parseId(trimmed);\n      } else if (trimmed.startsWith('info ')) {\n        const info = this._parseInfo(trimmed.slice(5));\n        this._updateAnalysis(info);\n        this._emit('info', info);\n      } else if (trimmed.startsWith('bestmove ')) {\n        const result = this._parseBestMove(trimmed);\n        this._emit('bestmove', result);\n      } else if (trimmed.startsWith('option ')) {\n        this._parseOption(trimmed);\n      }\n    }\n  }\n\n  /**\n   * Parse engine ID\n   * @private\n   * @param {string} line - ID line\n   */\n  _parseId(line) {\n    if (!this.info) {\n      this.info = { name: '', author: '', version: '', options: [] };\n    }\n\n    if (line.startsWith('id name ')) {\n      this.info.name = line.slice(8);\n    } else if (line.startsWith('id author ')) {\n      this.info.author = line.slice(10);\n    }\n  }\n\n  /**\n   * Parse engine option\n   * @private\n   * @param {string} line - Option line\n   */\n  _parseOption(line) {\n    if (!this.info) {\n      this.info = { name: '', author: '', version: '', options: [] };\n    }\n\n    const nameMatch = line.match(/option name ([^ ]+)/);\n    if (nameMatch) {\n      this.info.options.push(nameMatch[1]);\n    }\n  }\n\n  /**\n   * Update current analysis\n   * @private\n   * @param {Object} info - Parsed info\n   */\n  _updateAnalysis(info) {\n    if (!this.currentAnalysis) return;\n\n    if (info.depth !== undefined) this.currentAnalysis.depth = info.depth;\n    if (info.score !== undefined) {\n      this.currentAnalysis.score = info.score;\n      this.currentAnalysis.isMate = info.isMate || false;\n    }\n    if (info.nodes !== undefined) this.currentAnalysis.nodes = info.nodes;\n    if (info.time !== undefined) this.currentAnalysis.time = info.time;\n    if (info.nps !== undefined) this.currentAnalysis.nps = info.nps;\n    if (info.pv !== undefined) this.currentAnalysis.pv = info.pv;\n  }\n\n  /**\n   * Get connection status\n   * @returns {boolean}\n   */\n  isConnected() {\n    if (!this.connection) return false;\n\n    if (this.transport === 'websocket') {\n      return this.connection.readyState === WebSocket.OPEN;\n    }\n\n    return true;\n  }\n\n  /**\n   * New game - reset engine state\n   * @returns {Promise<void>}\n   */\n  async newGame() {\n    if (!this.isReady) throw new Error('Engine not ready');\n    await this._send('ucinewgame');\n    await this._sendAndWait('isready', 'readyok');\n  }\n}\n\nexport default UCIEngine;\n","/**\n * Cloud Engine - API-based chess engine analysis\n * @module engines/CloudEngine\n * @since 3.1.0\n *\n * Connects to cloud-based chess analysis APIs:\n * - Lichess Cloud Analysis API\n * - Chess.com Analysis API\n * - Custom API endpoints\n *\n * @example\n * const engine = new CloudEngine({\n *   provider: 'lichess',\n *   apiKey: 'your-api-key' // Optional for Lichess\n * });\n * await engine.init();\n * const analysis = await engine.analyze('rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1');\n */\n\nimport { BaseEngine } from './BaseEngine.js';\n\n/**\n * @typedef {Object} CloudConfig\n * @extends EngineConfig\n * @property {'lichess'|'chesscom'|'custom'} [provider='lichess'] - Cloud provider\n * @property {string} [apiKey] - API key for authentication\n * @property {string} [apiUrl] - Custom API URL (for 'custom' provider)\n * @property {number} [multiPv=1] - Number of principal variations\n * @property {boolean} [useTablebase=true] - Use endgame tablebase\n */\n\n/**\n * Cloud-based chess analysis engine\n */\nexport class CloudEngine extends BaseEngine {\n  /**\n   * API endpoints for different providers\n   */\n  static PROVIDERS = {\n    lichess: {\n      analysis: 'https://lichess.org/api/cloud-eval',\n      tablebase: 'https://tablebase.lichess.ovh/standard',\n      opening: 'https://explorer.lichess.ovh/lichess',\n    },\n    chesscom: {\n      analysis: 'https://api.chess.com/pub/analysis',\n    },\n  };\n\n  /**\n   * @param {CloudConfig} [config={}] - Engine configuration\n   */\n  constructor(config = {}) {\n    super({\n      depth: 40, // Cloud engines typically go deeper\n      multiPv: 1,\n      useTablebase: true,\n      ...config,\n    });\n\n    this.provider = config.provider || 'lichess';\n    this.apiKey = config.apiKey || null;\n    this.apiUrl = config.apiUrl || null;\n    this.multiPv = config.multiPv || 1;\n    this.useTablebase = config.useTablebase !== false;\n\n    this.currentFen = null;\n    this.cachedAnalysis = new Map();\n  }\n\n  /**\n   * Initialize the cloud engine\n   * @override\n   * @returns {Promise<boolean>}\n   */\n  async init() {\n    if (this.isReady) return true;\n\n    try {\n      // Test API connectivity\n      await this._testConnection();\n\n      this.info = {\n        name: `Cloud Engine (${this.provider})`,\n        author: this.provider,\n        version: '1.0',\n        options: ['multiPv', 'useTablebase'],\n      };\n\n      this.isReady = true;\n      this._emit('ready', this.info);\n\n      return true;\n    } catch (error) {\n      this._emit('error', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Test API connection\n   * @private\n   * @returns {Promise<void>}\n   */\n  async _testConnection() {\n    const testFen = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';\n\n    try {\n      await this._fetchAnalysis(testFen);\n    } catch (error) {\n      // Some providers may not have analysis for start position\n      // Just check if we got a response\n      if (error.message?.includes('network') || error.message?.includes('fetch')) {\n        throw new Error(`Failed to connect to ${this.provider} API`);\n      }\n    }\n  }\n\n  /**\n   * Shutdown the cloud engine\n   * @override\n   * @returns {Promise<void>}\n   */\n  async quit() {\n    this.isReady = false;\n    this.cachedAnalysis.clear();\n    this._emit('quit');\n  }\n\n  /**\n   * Set position\n   * @override\n   * @param {string} [fen='startpos'] - FEN string or 'startpos'\n   * @param {string[]} [_moves=[]] - Moves to apply (not used for cloud)\n   * @returns {Promise<void>}\n   */\n  async setPosition(fen = 'startpos', _moves = []) {\n    if (fen === 'startpos') {\n      this.currentFen = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';\n    } else {\n      this.currentFen = fen;\n    }\n  }\n\n  /**\n   * Start analysis\n   * @override\n   * @param {Object} [options={}] - Analysis options\n   * @returns {Promise<EngineAnalysis>}\n   */\n  async go(options = {}) {\n    if (!this.isReady) throw new Error('Engine not ready');\n    if (!this.currentFen) throw new Error('Position not set');\n\n    this.isSearching = true;\n\n    try {\n      // Check cache first\n      const cacheKey = `${this.currentFen}-${options.multiPv || this.multiPv}`;\n      if (this.cachedAnalysis.has(cacheKey)) {\n        const cached = this.cachedAnalysis.get(cacheKey);\n        this.isSearching = false;\n        return cached;\n      }\n\n      // Fetch from cloud\n      const analysis = await this._fetchAnalysis(this.currentFen, options);\n\n      // Cache result\n      this.cachedAnalysis.set(cacheKey, analysis);\n\n      // Limit cache size\n      if (this.cachedAnalysis.size > 1000) {\n        const firstKey = this.cachedAnalysis.keys().next().value;\n        this.cachedAnalysis.delete(firstKey);\n      }\n\n      this.isSearching = false;\n      this._emit('bestmove', { bestMove: analysis.bestMove, ponder: analysis.ponder });\n\n      return analysis;\n    } catch (error) {\n      this.isSearching = false;\n      throw error;\n    }\n  }\n\n  /**\n   * Stop current analysis (no-op for cloud)\n   * @override\n   * @returns {Promise<void>}\n   */\n  async stop() {\n    this.isSearching = false;\n  }\n\n  /**\n   * Set engine option\n   * @override\n   * @param {string} name - Option name\n   * @param {string|number|boolean} value - Option value\n   * @returns {Promise<void>}\n   */\n  async setOption(name, value) {\n    switch (name.toLowerCase()) {\n      case 'multipv':\n        this.multiPv = parseInt(value, 10);\n        break;\n      case 'usetablebase':\n        this.useTablebase = value === true || value === 'true';\n        break;\n      default:\n        this.config[name] = value;\n    }\n  }\n\n  /**\n   * Fetch analysis from cloud API\n   * @private\n   * @param {string} fen - Position FEN\n   * @param {Object} [options={}] - Options\n   * @returns {Promise<EngineAnalysis>}\n   */\n  async _fetchAnalysis(fen, options = {}) {\n    switch (this.provider) {\n      case 'lichess':\n        return this._fetchLichessAnalysis(fen, options);\n      case 'chesscom':\n        return this._fetchChesscomAnalysis(fen, options);\n      case 'custom':\n        return this._fetchCustomAnalysis(fen, options);\n      default:\n        throw new Error(`Unknown provider: ${this.provider}`);\n    }\n  }\n\n  /**\n   * Fetch analysis from Lichess\n   * @private\n   * @param {string} fen - Position FEN\n   * @param {Object} [options={}] - Options\n   * @returns {Promise<EngineAnalysis>}\n   */\n  async _fetchLichessAnalysis(fen, options = {}) {\n    const multiPv = options.multiPv || this.multiPv;\n    const url = new URL(CloudEngine.PROVIDERS.lichess.analysis);\n    url.searchParams.set('fen', fen);\n    url.searchParams.set('multiPv', multiPv.toString());\n\n    const headers = {};\n    if (this.apiKey) {\n      headers['Authorization'] = `Bearer ${this.apiKey}`;\n    }\n\n    const response = await fetch(url.toString(), { headers });\n\n    if (!response.ok) {\n      if (response.status === 404) {\n        // Position not in cloud, return empty analysis\n        return this._createEmptyAnalysis();\n      }\n      throw new Error(`Lichess API error: ${response.status}`);\n    }\n\n    const data = await response.json();\n    return this._parseLichessResponse(data);\n  }\n\n  /**\n   * Parse Lichess API response\n   * @private\n   * @param {Object} data - API response\n   * @returns {EngineAnalysis}\n   */\n  _parseLichessResponse(data) {\n    if (!data.pvs || data.pvs.length === 0) {\n      return this._createEmptyAnalysis();\n    }\n\n    const pv = data.pvs[0];\n    const moves = pv.moves ? pv.moves.split(' ') : [];\n\n    return {\n      bestMove: moves[0] || null,\n      ponder: moves[1] || null,\n      score: pv.cp !== undefined ? pv.cp : pv.mate !== undefined ? pv.mate * 10000 : 0,\n      isMate: pv.mate !== undefined,\n      depth: data.depth || 0,\n      nodes: data.knodes ? data.knodes * 1000 : 0,\n      time: 0,\n      pv: moves,\n      nps: 0,\n      multiPv: data.pvs.map((p) => ({\n        moves: p.moves ? p.moves.split(' ') : [],\n        score: p.cp !== undefined ? p.cp : p.mate !== undefined ? p.mate * 10000 : 0,\n        isMate: p.mate !== undefined,\n      })),\n    };\n  }\n\n  /**\n   * Fetch analysis from Chess.com\n   * @private\n   * @param {string} fen - Position FEN\n   * @param {Object} [_options={}] - Options\n   * @returns {Promise<EngineAnalysis>}\n   */\n  async _fetchChesscomAnalysis(fen, _options = {}) {\n    // Chess.com analysis API (if available)\n    const url = new URL(CloudEngine.PROVIDERS.chesscom.analysis);\n    url.searchParams.set('fen', fen);\n\n    const response = await fetch(url.toString());\n\n    if (!response.ok) {\n      return this._createEmptyAnalysis();\n    }\n\n    const data = await response.json();\n    return this._parseChesscomResponse(data);\n  }\n\n  /**\n   * Parse Chess.com API response\n   * @private\n   * @param {Object} data - API response\n   * @returns {EngineAnalysis}\n   */\n  _parseChesscomResponse(data) {\n    // Parse Chess.com format (implementation depends on actual API format)\n    if (!data.bestMove) {\n      return this._createEmptyAnalysis();\n    }\n\n    return {\n      bestMove: data.bestMove,\n      ponder: data.ponder || null,\n      score: data.score || 0,\n      isMate: data.isMate || false,\n      depth: data.depth || 0,\n      nodes: data.nodes || 0,\n      time: 0,\n      pv: data.pv || [data.bestMove],\n      nps: 0,\n    };\n  }\n\n  /**\n   * Fetch analysis from custom API\n   * @private\n   * @param {string} fen - Position FEN\n   * @param {Object} [options={}] - Options\n   * @returns {Promise<EngineAnalysis>}\n   */\n  async _fetchCustomAnalysis(fen, options = {}) {\n    if (!this.apiUrl) {\n      throw new Error('Custom API URL not configured');\n    }\n\n    const response = await fetch(this.apiUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...(this.apiKey ? { Authorization: `Bearer ${this.apiKey}` } : {}),\n      },\n      body: JSON.stringify({ fen, options }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Custom API error: ${response.status}`);\n    }\n\n    const data = await response.json();\n\n    // Expect standard analysis format\n    return {\n      bestMove: data.bestMove || null,\n      ponder: data.ponder || null,\n      score: data.score || 0,\n      isMate: data.isMate || false,\n      depth: data.depth || 0,\n      nodes: data.nodes || 0,\n      time: data.time || 0,\n      pv: data.pv || [],\n      nps: data.nps || 0,\n    };\n  }\n\n  /**\n   * Create empty analysis result\n   * @private\n   * @returns {EngineAnalysis}\n   */\n  _createEmptyAnalysis() {\n    return {\n      bestMove: null,\n      ponder: null,\n      score: 0,\n      isMate: false,\n      depth: 0,\n      nodes: 0,\n      time: 0,\n      pv: [],\n      nps: 0,\n    };\n  }\n\n  /**\n   * Get tablebase probe\n   * @param {string} fen - Position FEN\n   * @returns {Promise<Object|null>}\n   */\n  async probeTablebase(fen) {\n    if (this.provider !== 'lichess') {\n      throw new Error('Tablebase probe only available with Lichess provider');\n    }\n\n    const url = new URL(CloudEngine.PROVIDERS.lichess.tablebase);\n    url.searchParams.set('fen', fen);\n\n    const response = await fetch(url.toString());\n\n    if (!response.ok) {\n      return null;\n    }\n\n    const data = await response.json();\n\n    return {\n      category: data.category, // 'win', 'draw', 'loss', 'maybe-win', etc.\n      dtz: data.dtz, // Distance to zeroing (50-move counter)\n      dtm: data.dtm, // Distance to mate (if available)\n      bestMove: data.moves?.[0]?.uci || null,\n      moves: data.moves?.map((m) => ({\n        uci: m.uci,\n        san: m.san,\n        category: m.category,\n        dtz: m.dtz,\n      })),\n    };\n  }\n\n  /**\n   * Get opening explorer data\n   * @param {string} fen - Position FEN\n   * @param {Object} [options={}] - Options\n   * @returns {Promise<Object>}\n   */\n  async getOpeningData(fen, options = {}) {\n    if (this.provider !== 'lichess') {\n      throw new Error('Opening explorer only available with Lichess provider');\n    }\n\n    const url = new URL(CloudEngine.PROVIDERS.lichess.opening);\n    url.searchParams.set('fen', fen);\n\n    if (options.speeds) {\n      url.searchParams.set('speeds', options.speeds.join(','));\n    }\n    if (options.ratings) {\n      url.searchParams.set('ratings', options.ratings.join(','));\n    }\n\n    const response = await fetch(url.toString());\n\n    if (!response.ok) {\n      return { moves: [], games: 0 };\n    }\n\n    const data = await response.json();\n\n    return {\n      moves: data.moves?.map((m) => ({\n        uci: m.uci,\n        san: m.san,\n        games: m.white + m.draws + m.black,\n        white: m.white,\n        draws: m.draws,\n        black: m.black,\n        averageRating: m.averageRating,\n      })),\n      games: data.white + data.draws + data.black,\n      opening: data.opening,\n    };\n  }\n\n  /**\n   * Clear analysis cache\n   */\n  clearCache() {\n    this.cachedAnalysis.clear();\n  }\n\n  /**\n   * Get cache statistics\n   * @returns {Object}\n   */\n  getCacheStats() {\n    return {\n      size: this.cachedAnalysis.size,\n      maxSize: 1000,\n    };\n  }\n}\n\nexport default CloudEngine;\n","/**\n * Engine Manager - Manages chess engine instances\n * @module engines/EngineManager\n * @since 3.1.0\n *\n * Provides unified interface to manage multiple engine types:\n * - Stockfish.js (browser WebAssembly)\n * - UCI engines (external via WebSocket/Worker)\n * - Cloud engines (API-based)\n *\n * @example\n * const manager = new EngineManager(chessboard);\n * await manager.loadEngine('stockfish');\n * const bestMove = await manager.getBestMove();\n */\n\nimport { StockfishEngine } from './StockfishEngine.js';\nimport { UCIEngine } from './UCIEngine.js';\nimport { CloudEngine } from './CloudEngine.js';\n\n/**\n * @typedef {Object} EngineManagerConfig\n * @property {string} [defaultEngine='stockfish'] - Default engine to use\n * @property {boolean} [autoInit=true] - Auto-initialize on load\n */\n\n/**\n * Engine manager for chess board\n */\nexport class EngineManager {\n  /**\n   * Available engine types\n   */\n  static ENGINE_TYPES = {\n    stockfish: StockfishEngine,\n    uci: UCIEngine,\n    cloud: CloudEngine,\n  };\n\n  /**\n   * Pre-configured engine presets\n   */\n  static PRESETS = {\n    stockfish: {\n      type: 'stockfish',\n      config: { depth: 20 },\n    },\n    'stockfish-lite': {\n      type: 'stockfish',\n      config: { depth: 12, threads: 1, hash: 8 },\n    },\n    'stockfish-strong': {\n      type: 'stockfish',\n      config: { depth: 25, threads: 4, hash: 128 },\n    },\n    lichess: {\n      type: 'cloud',\n      config: { provider: 'lichess' },\n    },\n    'lichess-tablebase': {\n      type: 'cloud',\n      config: { provider: 'lichess', useTablebase: true },\n    },\n  };\n\n  /**\n   * @param {Object} chessboard - Chessboard instance\n   * @param {EngineManagerConfig} [config={}] - Configuration\n   */\n  constructor(chessboard, config = {}) {\n    this.chessboard = chessboard;\n    this.config = {\n      defaultEngine: 'stockfish',\n      autoInit: true,\n      ...config,\n    };\n\n    this.engines = new Map();\n    this.currentEngine = null;\n    this.currentEngineName = null;\n    this.listeners = new Map();\n  }\n\n  /**\n   * Load an engine by name or preset\n   * @param {string} nameOrPreset - Engine name or preset\n   * @param {Object} [config={}] - Engine configuration\n   * @returns {Promise<BaseEngine>}\n   */\n  async loadEngine(nameOrPreset, config = {}) {\n    // Check if it's a preset\n    if (EngineManager.PRESETS[nameOrPreset]) {\n      const preset = EngineManager.PRESETS[nameOrPreset];\n      return this._createEngine(nameOrPreset, preset.type, { ...preset.config, ...config });\n    }\n\n    // Check if it's a direct engine type\n    if (EngineManager.ENGINE_TYPES[nameOrPreset]) {\n      return this._createEngine(nameOrPreset, nameOrPreset, config);\n    }\n\n    throw new Error(`Unknown engine: ${nameOrPreset}`);\n  }\n\n  /**\n   * Create and initialize an engine\n   * @private\n   * @param {string} name - Engine name\n   * @param {string} type - Engine type\n   * @param {Object} config - Engine configuration\n   * @returns {Promise<BaseEngine>}\n   */\n  async _createEngine(name, type, config) {\n    const EngineClass = EngineManager.ENGINE_TYPES[type];\n    if (!EngineClass) {\n      throw new Error(`Unknown engine type: ${type}`);\n    }\n\n    const engine = new EngineClass(config);\n\n    // Set up event forwarding\n    engine.on('ready', (info) => this._emit('engineReady', { name, info }));\n    engine.on('bestmove', (data) => this._emit('bestmove', { name, ...data }));\n    engine.on('info', (data) => this._emit('info', { name, ...data }));\n    engine.on('error', (error) => this._emit('error', { name, error }));\n\n    // Initialize if configured\n    if (this.config.autoInit) {\n      await engine.init();\n    }\n\n    // Store engine\n    this.engines.set(name, engine);\n\n    // Set as current if first engine or if no current\n    if (!this.currentEngine) {\n      this.currentEngine = engine;\n      this.currentEngineName = name;\n    }\n\n    this._emit('engineLoaded', { name, engine });\n\n    return engine;\n  }\n\n  /**\n   * Get engine by name\n   * @param {string} [name] - Engine name (uses current if not specified)\n   * @returns {BaseEngine|null}\n   */\n  getEngine(name) {\n    if (!name) return this.currentEngine;\n    return this.engines.get(name) || null;\n  }\n\n  /**\n   * Set current engine\n   * @param {string} name - Engine name\n   * @returns {BaseEngine}\n   */\n  setCurrentEngine(name) {\n    const engine = this.engines.get(name);\n    if (!engine) {\n      throw new Error(`Engine not loaded: ${name}`);\n    }\n\n    this.currentEngine = engine;\n    this.currentEngineName = name;\n    this._emit('engineChanged', { name, engine });\n\n    return engine;\n  }\n\n  /**\n   * Unload an engine\n   * @param {string} name - Engine name\n   * @returns {Promise<void>}\n   */\n  async unloadEngine(name) {\n    const engine = this.engines.get(name);\n    if (!engine) return;\n\n    await engine.quit();\n    this.engines.delete(name);\n\n    if (this.currentEngineName === name) {\n      // Switch to another engine or null\n      const remaining = Array.from(this.engines.keys());\n      if (remaining.length > 0) {\n        this.setCurrentEngine(remaining[0]);\n      } else {\n        this.currentEngine = null;\n        this.currentEngineName = null;\n      }\n    }\n\n    this._emit('engineUnloaded', { name });\n  }\n\n  /**\n   * Unload all engines\n   * @returns {Promise<void>}\n   */\n  async unloadAll() {\n    const names = Array.from(this.engines.keys());\n    await Promise.all(names.map((name) => this.unloadEngine(name)));\n  }\n\n  // ============================================================\n  // Analysis Methods (delegate to current engine)\n  // ============================================================\n\n  /**\n   * Get best move for current position\n   * @param {Object} [options={}] - Analysis options\n   * @returns {Promise<string>}\n   */\n  async getBestMove(options = {}) {\n    this._ensureEngine();\n\n    const fen = this.chessboard.fen();\n    await this.currentEngine.setPosition(fen);\n\n    return this.currentEngine.getBestMove(options);\n  }\n\n  /**\n   * Analyze current position\n   * @param {Object} [options={}] - Analysis options\n   * @returns {Promise<EngineAnalysis>}\n   */\n  async analyze(options = {}) {\n    this._ensureEngine();\n\n    const fen = this.chessboard.fen();\n    return this.currentEngine.analyze(fen, options);\n  }\n\n  /**\n   * Analyze a specific position\n   * @param {string} fen - Position FEN\n   * @param {Object} [options={}] - Analysis options\n   * @returns {Promise<EngineAnalysis>}\n   */\n  async analyzePosition(fen, options = {}) {\n    this._ensureEngine();\n    return this.currentEngine.analyze(fen, options);\n  }\n\n  /**\n   * Stop current analysis\n   * @returns {Promise<void>}\n   */\n  async stopAnalysis() {\n    if (this.currentEngine) {\n      await this.currentEngine.stop();\n    }\n  }\n\n  /**\n   * Set engine option\n   * @param {string} name - Option name\n   * @param {*} value - Option value\n   * @param {string} [engineName] - Engine name (uses current if not specified)\n   * @returns {Promise<void>}\n   */\n  async setOption(name, value, engineName) {\n    const engine = engineName ? this.engines.get(engineName) : this.currentEngine;\n    if (!engine) {\n      throw new Error('No engine available');\n    }\n    await engine.setOption(name, value);\n  }\n\n  // ============================================================\n  // Utility Methods\n  // ============================================================\n\n  /**\n   * Ensure an engine is loaded\n   * @private\n   */\n  _ensureEngine() {\n    if (!this.currentEngine) {\n      throw new Error('No engine loaded. Call loadEngine() first.');\n    }\n    if (!this.currentEngine.ready()) {\n      throw new Error('Engine not ready. Wait for initialization.');\n    }\n  }\n\n  /**\n   * Get list of loaded engines\n   * @returns {string[]}\n   */\n  getLoadedEngines() {\n    return Array.from(this.engines.keys());\n  }\n\n  /**\n   * Get current engine name\n   * @returns {string|null}\n   */\n  getCurrentEngineName() {\n    return this.currentEngineName;\n  }\n\n  /**\n   * Check if an engine is loaded\n   * @param {string} name - Engine name\n   * @returns {boolean}\n   */\n  isLoaded(name) {\n    return this.engines.has(name);\n  }\n\n  /**\n   * Get available presets\n   * @returns {string[]}\n   */\n  static getPresets() {\n    return Object.keys(EngineManager.PRESETS);\n  }\n\n  /**\n   * Get available engine types\n   * @returns {string[]}\n   */\n  static getEngineTypes() {\n    return Object.keys(EngineManager.ENGINE_TYPES);\n  }\n\n  // ============================================================\n  // Event System\n  // ============================================================\n\n  /**\n   * Register event listener\n   * @param {string} event - Event name\n   * @param {Function} callback - Event callback\n   * @returns {this}\n   */\n  on(event, callback) {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, []);\n    }\n    this.listeners.get(event).push(callback);\n    return this;\n  }\n\n  /**\n   * Remove event listener\n   * @param {string} event - Event name\n   * @param {Function} callback - Event callback\n   * @returns {this}\n   */\n  off(event, callback) {\n    if (this.listeners.has(event)) {\n      const callbacks = this.listeners.get(event);\n      const index = callbacks.indexOf(callback);\n      if (index > -1) {\n        callbacks.splice(index, 1);\n      }\n    }\n    return this;\n  }\n\n  /**\n   * Emit event\n   * @private\n   * @param {string} event - Event name\n   * @param {*} data - Event data\n   */\n  _emit(event, data) {\n    if (this.listeners.has(event)) {\n      this.listeners.get(event).forEach((callback) => {\n        try {\n          callback(data);\n        } catch (error) {\n          console.error(`Error in ${event} listener:`, error);\n        }\n      });\n    }\n  }\n\n  /**\n   * Destroy manager and all engines\n   * @returns {Promise<void>}\n   */\n  async destroy() {\n    await this.unloadAll();\n    this.listeners.clear();\n  }\n}\n\nexport default EngineManager;\n","/**\n * Chessboard.js - A beautiful, customizable chessboard widget\n * Main entry point for the library\n *\n * @version 3.2.0\n * @author alepot55\n * @license ISC\n */\n\n// Styles - bundled into chessboard.css\nimport './styles/index.css';\n\n// Core components\nexport {\n  Chessboard,\n  ChessboardConfig,\n  ChessboardFactory,\n  chessboardFactory,\n  createChessboard,\n  createChessboardFromTemplate,\n} from './core/index.js';\n\n// Component exports\nexport { default as Square } from './components/Square.js';\nexport { default as Piece } from './components/Piece.js';\nexport { default as Move } from './components/Move.js';\n\n// Service exports for advanced usage\nexport {\n  AnimationService,\n  BoardService,\n  CoordinateService,\n  EventService,\n  MoveService,\n  PieceService,\n  PositionService,\n  ValidationService,\n} from './services/index.js';\n\n// Constants exports\nexport * from './constants/index.js';\n\n// Error handling exports\nexport {\n  ChessboardError,\n  ValidationError,\n  ConfigurationError,\n  MoveError,\n  DOMError,\n  PieceError,\n} from './errors/index.js';\n\n// Utility exports\nexport { Chess, validateFen } from './utils/chess.js';\nexport {\n  PerformanceMonitor,\n  throttle,\n  debounce,\n  rafThrottle,\n  setTransform,\n  resetTransform,\n  batchDOMOperations,\n  isElementVisible,\n  getMemoryUsage,\n} from './utils/performance.js';\nexport * from './utils/coordinates.js';\nexport {\n  isValidPiece,\n  isValidPosition,\n  validateFenFormat,\n  validateMove,\n  validateConfig,\n  batchValidate,\n  clearValidationCache,\n  getValidationCacheStats,\n} from './utils/validation.js';\nexport * from './utils/animations.js';\n\n// Logging system exports\nexport { Logger, logger, createLogger, LOG_LEVELS } from './utils/logger.js';\n\n// Game modes exports\nexport { BaseMode, ModeManager, CreativeMode, PvPMode, VsBotMode } from './modes/index.js';\n\n// AI exports\nexport { ChessAI } from './ai/index.js';\n\n// Engine integration exports\nexport {\n  BaseEngine,\n  StockfishEngine,\n  UCIEngine,\n  CloudEngine,\n  EngineManager,\n} from './engines/index.js';\n\n// Default export for IIFE compatibility\nimport { Chessboard as ChessboardClass } from './core/index.js';\nexport default ChessboardClass;\n\n// Version information\nexport const version = '3.2.0';\nexport const build = 'dev';\nexport const buildDate = new Date().toISOString();\n\n// Library information\nexport const info = {\n  name: 'Chessboard.js',\n  version,\n  build,\n  buildDate,\n  author: 'alepot55',\n  license: 'ISC',\n  repository: 'https://github.com/alepot55/Chessboardjs',\n  homepage: 'https://chessboardjs.com',\n};\n"],"names":["STANDARD_POSITIONS","DEFAULT_STARTING_POSITION","PIECE_TYPES","PIECE_COLORS","PROMOTION_PIECES","BOARD_LETTERS","BOARD_SIZE","ERROR_CODES","ERROR_MESSAGES","ERROR_SEVERITY","ChessboardError","message","code","context","ValidationError","field","value","ConfigurationError","configKey","configValue","MoveError","from","to","piece","DOMError","elementId","PieceError","pieceId","square","VALIDATION_PATTERNS","VALID_VALUES","SIZE_CONSTRAINTS","ValidationService","cacheKey","isValid","first","second","format1","format2","fen","parts","ranks","rank","halfmove","fullmove","squares","char","move","promotion","orientation","color","size","time","callback","id","colors","dropOff","easing","style","config","errors","callbacks","colorFields","key","result","firstKey","validations","validation","type","error","ANIMATION_TIMES","BOOLEAN_VALUES","TRANSITION_FUNCTIONS","DEFAULT_CONFIG","ChessboardConfig","settings","cssProperties","property","delay","validatedOrientation","updates","newConfig","Piece","src","opacity","element","newSrc","newType","duration","halfDuration","scaleDownAnim","scaleUpAnim","speed","transition_f","start","fade","elapsed","progress","f","e","targetSquare","sourceRect","targetRect","dx","dy","animation","Square","row","col","preserve","newPiece","event","catchable","hint","cover","choice","img","Move$1","check","game","AnimationService","x","properties","animationId","timingFunction","startTime","startValues","prop","animate","currentTime","easedProgress","startValue","endValue","currentValue","end","BoardService","coordConverter","squareRow","squareCol","offsetWidth","offsetHeight","squareId","methodName","args","CoordinateService","realRow","realCol","letter","number","boardCol","y","boardElement","rect","width","height","squareWidth","squareHeight","coords","fromSquare","toSquare","fromRow","fromCol","toRow","toCol","rowDiff","colDiff","normalizedOrientation","file","getBrowserInfo","ua","isChrome","isFirefox","isSafari","isEdge","DragOptimizations","browserInfo","EventService","boardService","moveService","coordinateService","chessboard","onSquareClick","onPieceHover","onPieceLeave","listeners","handleMouseEnter","handleMouseLeave","handleClick","onDragStart","onDragMove","onDrop","onSnapback","onMove","onRemove","_a","_b","_c","_d","startX","startY","hasMoved","lastHighlighted","moveAt","clientX","clientY","boardRect","squareSize","relX","relY","onMouseMove","onMouseUp","dropResult","cleanup","Move","selectedPiece","promotionPiece","gamePiece","piecePath","dragFn","onSelect","onDeselect","_promotion","_isAnimating","handler","MoveService","positionService","movableColors","onlyLegalMoves","fromId","toId","legalMove","verbose","options","moves","moveOptions","targetRank","m","onPromotionSelect","onPromotionCancel","pieceType","index","choiceSquare","baseRow","piecesPath","moveString","gameMove","isKingSide","isWhite","PieceService","dragFunction","removeTarget","changeSquareCallback","el","WHITE","BLACK","PAWN","KNIGHT","BISHOP","ROOK","QUEEN","KING","DEFAULT_POSITION","chess","internal","__publicField","flags","captured","fromAlgebraic","algebraic","toAlgebraic","flag","BITS","FLAGS","EMPTY","Ox88","PAWN_OFFSETS","PIECE_OFFSETS","ATTACKS","RAYS","PIECE_MASKS","SYMBOLS","PROMOTIONS","RANK_1","RANK_2","RANK_7","RANK_8","SIDES","ROOKS","SECOND_RANK","TERMINATION_MARKERS","isDigit","c","r","swapColor","validateFen","tokens","moveNumber","halfMoves","rows","i","sumFields","previousWasNumber","k","kings","regex","getDisambiguator","ambiguities","sameRank","sameFile","len","ambigFrom","ambigTo","ambigPiece","addMove","inferPieceType","san","strippedSan","trimFen","Chess","preserveHeaders","skipValidation","adjustments","ok","position","empty","castling","epSquare","bigPawnSquare","isLegal","sq","currentPieceOnSquare","_e","_f","_g","_h","_i","_j","_k","_l","whiteKingInPlace","blackKingInPlace","startSquare","currentSquare","attackers","canCapture","difference","offset","j","blocked","attackedBy","pieces","bishops","numPieces","squareColor","sum","legal","forSquare","forPiece","us","them","firstSquare","lastSquare","singleSquare","castlingFrom","castlingTo","legalMoves","strict","moveObj","prettyMove","old","newline","maxWidth","headerExists","appendComment","comment","delimiter","reversedHistory","prefix","strip","wrapComment","token","currentWidth","pgn","newlineChar","mask","str","parsePgnHeader","header","headerObj","headers","headerRegexResults","headerString","toHex","s","fromHex","encodeComment","decodeComment","ms","_match","bracket","semicolon","ravRegex","halfMove","output","disambiguator","cleanMove","matches","overlyDisambiguated","symbol","depth","nodes","moveHistory","trimmedFen","currentComments","copyComment","rights","side","PositionService","rowParts","fenPiece","PerformanceMonitor","paintObserver","list","entry","name","measure","metric","summary","values","percentile","sorted","a","b","observer","throttle","func","limit","inThrottle","debounce","timeoutId","debounced","rafThrottle","isThrottled","throttled","setTransform","scale","resetTransform","batchDOMOperations","resolve","isElementVisible","getMemoryUsage","BaseMode","moveData","data","err","state","_CreativeMode","previousFen","nextFen","issues","whiteKings","blackKings","whitePawnsOnFirstRank","blackPawnsOnLastRank","format","parsed","CreativeMode","PvPMode","pieceColor","currentTurn","notation","loser","winner","reason","offerer","requester","undonMove","resigner","moveNum","whiteMove","blackMove","minutes","seconds","PIECE_VALUES","PIECE_SQUARE_TABLES","OPENING_BOOK","ChessAI","difficulty","level","bookMove","bestMove","bookMoves","moveStr","randomIndex","bestValue","isMaximizing","maxEval","evalScore","minEval","alpha","beta","sortedMoves","score","standPat","captures","aValue","board","pieceValue","positionValue","mobilityScore","table","actualRow","_VsBotMode","engine","info","thinkingTime","engineStats","analysis","uciMove","botMove","playerMove","isPlayerWin","stats","source","analysisAI","VsBotMode","_ModeManager","ModeClass","defaultConfig","modeEntry","mergedConfig","modeName","mode","ModeManager","Chessboard$1","boardContainer","dragged","hasEnemyPiece","isCastle","isEnPassant","kingDone","rookDone","checkComplete","updateBoard","onComplete","rookMove","rookFromSquare","rookToSquare","rookPiece","capturedSquare","capturedSquareObj","isPositionLoad","gameStateBefore","expectedMap","expectedPieceId","currentPiece","currentPieceId","gameStateAfter","currentMap","animationsCompleted","totalAnimations","animationDelay","animationIndex","onAnimationComplete","fromList","toList","distances","fromMatched","toMatched","minDist","minI","minJ","currentPieces","expectedPieces","removes","adds","unchanged","processedSquares","availableDestination","expectedId","changeAnalysis","remove","add","opts","startPosition","undone","pieceStr","types","validSquare","validPiece","pieceObj","squareObj","chessJsPiece","_opts","newPosition","success","positionArg","colorOrAnimate","parsePieceString","LOG_LEVELS","COLORS","Logger","reset","timestamp","consoleMethod","stored","perf","measurements","total","avg","min","max","namespace","logger","createLogger","ChessboardFactory","containerId","template","container","finalConfig","templateConfig","Chessboard","templateName","overrides","instance","containerIds","destroyed","removed","configurations","instances","chessboardFactory","createChessboard","createChessboardFromTemplate","containerElm","factoryLogger","ChessboardClass","fullConfig","ChessboardWrapper","instanceLogger","algebraicToCoords","coordsToAlgebraic","getSquareColor","isValidCoords","isValidSquare","validateSquare","validationCache","CACHE_MAX_SIZE","cacheResult","isValidPiece","isValidPosition","isValidChessPosition","p","whitePawns","blackPawns","validateFenFormat","rankResult","validateRank","squareCount","validateMove","trimmed","validateConfig","isValidSize","isValidColor","isValidEasing","batchValidate","items","item","fenResult","moveResult","configResult","clearValidationCache","getValidationCacheStats","parseTime","parseAnimation","animationPromise","BaseEngine","_fen","_moves","_options","_name","_value","line","ponderIndex","_StockfishEngine","workerUrl","stockfishInstance","msg","command","reject","timeout","expectedResponse","versionMatch","nameMatch","lines","match","StockfishEngine","UCIEngine","attempts","connect","_CloudEngine","testFen","cached","multiPv","url","response","pv","CloudEngine","_EngineManager","nameOrPreset","preset","EngineClass","remaining","names","engineName","EngineManager","version","build","buildDate"],"mappings":"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EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAChD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAChD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAChD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAChD;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAG;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAC3D;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAChD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAChD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAChD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAChD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAChD;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAChD;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAChD,GAEMC,KAAO;AAAA,EACT;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAChD;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAChD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAChD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAChD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAChD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAChD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAChD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EAAI;AAAA,EACpD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EACnD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAK;AAAA,EAAG;AAAA,EAAK;AAAA,EAAG;AAAA,EAAK;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EACnD;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAG;AAAA,EAAK;AAAA,EAAG;AAAA,EAAG;AAAA,EAAK;AAAA,EAAG;AAAA,EAAG;AAAA,EA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"}